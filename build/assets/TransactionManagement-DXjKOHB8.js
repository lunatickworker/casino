import{v as Te,r as i,s as b,j as e,L as Ae,w as x,T as Ee,i as Z,m as Le,n as Fe,o as $,Y as qe,S as ee,x as te,y as ae,z as se,D as E,I as ne,R as Me,c as re,p as R,E as L,B as V,t as w,K as oe,M as le,N as ie,O as ce,P as Oe}from"./index-DlK2WquE.js";import{T as de}from"./textarea-DWhBS6_c.js";import{A as me,a as pe,b as ue,c as he,d as ge,e as xe}from"./AdminDialog-e_e5blH4.js";import{C as Pe,a as $e,e as Re,b as We,c as Be,d as Ue}from"./command-DTU8i6KC.js";import{P as Ke,a as ze,b as Ve}from"./popover-DupcCkTN.js";import{D as W}from"./DataTable-DShsxcsG.js";import{M as B}from"./MetricCard-C4Jq9Aol.js";import{P as He}from"./plus-CFQWVZVj.js";import{C as Ye}from"./clock-BsgtTRc8.js";import{T as Ge}from"./triangle-alert-Dbc6QA6H.js";import{S as fe}from"./search-BrsHMGhG.js";import{T as Qe}from"./trash-2-D6daJXSA.js";import"./dialog-Be1FY237.js";function dt({user:h}){const{lastMessage:f,sendMessage:H}=Te(),[v,U]=i.useState(!0),[y,_]=i.useState(!1),be=()=>{const t=window.location.hash.substring(1);return t==="deposit-request"||t==="withdrawal-request"||t==="deposit-history"||t==="withdrawal-history"?t:"deposit-request"},[k,Y]=i.useState(be()),[F,G]=i.useState([]),[N,we]=i.useState([]),[S,je]=i.useState("today"),[K,ve]=i.useState(""),[q,D]=i.useState(0),[M,Q]=i.useState({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),[c,T]=i.useState({open:!1,transaction:null,action:"approve",memo:""}),[r,u]=i.useState({open:!1,type:"deposit",userId:"",amount:"",memo:""}),[J,z]=i.useState(!1),ye=[{label:"1ì²œ",value:1e3},{label:"3ì²œ",value:3e3},{label:"5ì²œ",value:5e3},{label:"1ë§Œ",value:1e4},{label:"3ë§Œ",value:3e4},{label:"5ë§Œ",value:5e4},{label:"100ë§Œ",value:1e6},{label:"300ë§Œ",value:3e6},{label:"500ë§Œ",value:5e6},{label:"1000ë§Œ",value:1e7}];i.useEffect(()=>{const t=()=>{const a=window.location.hash.substring(1);(a==="deposit-request"||a==="withdrawal-request"||a==="deposit-history"||a==="withdrawal-history")&&Y(a)};return window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)},[]);const C=async(t=!1)=>{try{t?U(!0):_(!0),console.log("ðŸ”„ ë°ì´í„° ë¡œë“œ ì‹œìž‘:",{isInitial:t,periodFilter:S,userLevel:h.level});const a=Ne(S);let s=b.from("transactions").select(`
          *,
          user:users(id, nickname, username, balance, bank_name, bank_account, bank_holder),
          processed_partner:partners!transactions_processed_by_fkey(nickname, level)
        `).gte("created_at",a.start).lte("created_at",a.end);if(h.level>1){const{data:m}=await b.from("users").select("id").eq("referrer_id",h.id),p=m?.map(g=>g.id)||[];if(p.length>0)s=s.in("user_id",p);else{G([]),Q({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),t&&U(!1);return}}const{data:n,error:l}=await s.order("created_at",{ascending:!1});if(l)throw l;console.log("âœ… ê±°ëž˜ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:",n?.length||0,"ê±´"),G(n||[]);let d=b.from("users").select("id, nickname, username, balance, bank_name, bank_account, bank_holder").eq("status","active");h.level>1&&(d=d.eq("referrer_id",h.id));const{data:j}=await d.order("nickname");if(we(j||[]),n){const m=n.filter(o=>(o.transaction_type==="deposit"||o.transaction_type==="admin_deposit")&&o.status==="completed").reduce((o,A)=>o+parseFloat(A.amount.toString()),0),p=n.filter(o=>(o.transaction_type==="withdrawal"||o.transaction_type==="admin_withdrawal")&&o.status==="completed").reduce((o,A)=>o+parseFloat(A.amount.toString()),0),g=n.filter(o=>o.transaction_type==="deposit"&&o.status==="pending"),I=n.filter(o=>o.transaction_type==="withdrawal"&&o.status==="pending");console.log("ðŸ“Š í†µê³„ ê³„ì‚°:",{depositSum:m,withdrawalSum:p,depositCount:n.filter(o=>(o.transaction_type==="deposit"||o.transaction_type==="admin_deposit")&&o.status==="completed").length,withdrawalCount:n.filter(o=>(o.transaction_type==="withdrawal"||o.transaction_type==="admin_withdrawal")&&o.status==="completed").length}),Q({totalDeposit:m,totalWithdrawal:p,pendingDepositCount:g.length,pendingWithdrawalCount:I.length})}}catch(a){console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",a),w.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{t?U(!1):_(!1)}},Ne=t=>{const a=new Date,s=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(t){case"today":return{start:s.toISOString(),end:a.toISOString()};case"week":const n=new Date(s);return n.setDate(s.getDate()-7),{start:n.toISOString(),end:a.toISOString()};case"month":const l=new Date(s);return l.setMonth(s.getMonth()-1),{start:l.toISOString(),end:a.toISOString()};default:return{start:s.toISOString(),end:a.toISOString()}}};i.useEffect(()=>{C(!0)},[]),i.useEffect(()=>{v||C(!1)},[S,q]),i.useEffect(()=>{const t=b.channel("transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},a=>{console.log("ðŸ’° transactions í…Œì´ë¸” ë³€ê²½ ê°ì§€:",a),D(s=>s+1)}).subscribe();return()=>{b.removeChannel(t)}},[]),i.useEffect(()=>{f&&["deposit_approved","withdrawal_approved","deposit_rejected","withdrawal_rejected"].includes(f.type)&&(console.log("ðŸ’¬ WebSocket ìž…ì¶œê¸ˆ ì•Œë¦¼:",f),D(t=>t+1))},[f]);const X=(t,a)=>{T({open:!0,transaction:t,action:a,memo:""})},_e=async()=>{if(c.transaction)try{_(!0);const{action:t,transaction:a,memo:s}=c;if(t==="approve"){const l=await oe(h),d=le(l)?l.opcodes[0]:l;if(!a.user?.username)throw new Error("ì‚¬ìš©ìž ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const j=Math.floor(parseFloat(a.amount.toString()));console.log("ðŸ’° ê±°ëž˜ ìŠ¹ì¸ ì²˜ë¦¬ ì‹œìž‘:",{transaction_type:a.transaction_type,username:a.user.username,amount:j,opcode:d.opcode});let m;if(a.transaction_type==="deposit"?(console.log("ðŸ“¥ ìž…ê¸ˆ API í˜¸ì¶œ ì¤‘..."),m=await ie(a.user.username,j,d.opcode,d.token,d.secretKey)):a.transaction_type==="withdrawal"&&(console.log("ðŸ“¤ ì¶œê¸ˆ API í˜¸ì¶œ ì¤‘..."),m=await ce(a.user.username,j,d.opcode,d.token,d.secretKey)),m&&!m.success)throw console.error("âŒ Invest API í˜¸ì¶œ ì‹¤íŒ¨:",m),new Error(m.error||"Invest API í˜¸ì¶œ ì‹¤íŒ¨");console.log("âœ… Invest API ì²˜ë¦¬ ì™„ë£Œ:",m)}const{error:n}=await b.from("transactions").update({status:t==="approve"?"completed":"rejected",processed_by:h.id,processed_at:new Date().toISOString(),memo:t==="reject"?s:a.memo}).eq("id",a.id);if(n)throw n;w.success(`ê±°ëž˜ê°€ ${t==="approve"?"ìŠ¹ì¸":"ê±°ì ˆ"}ë˜ì—ˆìŠµë‹ˆë‹¤.`),H({type:"transaction_processed",data:{transactionId:a.id,action:t,processedBy:h.nickname,userId:a.user_id}}),T({open:!1,transaction:null,action:"approve",memo:""})}catch(t){console.error("ê±°ëž˜ ì²˜ë¦¬ ì‹¤íŒ¨:",t),w.error(t instanceof Error?t.message:"ê±°ëž˜ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},Se=async()=>{try{_(!0);const{type:t,userId:a,amount:s,memo:n}=r;if(!a||!s){w.error("íšŒì›ê³¼ ê¸ˆì•¡ì„ ìž…ë ¥í•´ì£¼ì„¸ìš”.");return}const l=N.find(A=>A.id===a);if(!l){w.error("íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(!l.username){w.error("íšŒì› usernameì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const d=Math.floor(parseFloat(s)),j=parseFloat(l.balance?.toString()||"0");if(console.log("ðŸ’° ê°•ì œ ìž…ì¶œê¸ˆ ì²˜ë¦¬ ì‹œìž‘:",{type:t,username:l.username,amount:d,balanceBefore:j}),t==="withdrawal"&&d>j){w.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(â‚©${j.toLocaleString()})ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),_(!1);return}const m=await oe(h),p=le(m)?m.opcodes[0]:m;console.log("ðŸ”‘ OPCODE ì„¤ì •:",{opcode:p.opcode,token:"***"+p.token.slice(-4),secretKey:"***"+p.secretKey.slice(-4)});let g;if(t==="deposit"?(console.log("ðŸ“¥ ìž…ê¸ˆ API í˜¸ì¶œ ì¤‘..."),g=await ie(l.username,d,p.opcode,p.token,p.secretKey)):(console.log("ðŸ“¤ ì¶œê¸ˆ API í˜¸ì¶œ ì¤‘..."),g=await ce(l.username,d,p.opcode,p.token,p.secretKey)),!g.success||g.error)throw new Error(g.error||"Invest API í˜¸ì¶œ ì‹¤íŒ¨");console.log("âœ… Invest API ê°•ì œ ìž…ì¶œê¸ˆ ì™„ë£Œ:",g);const I=Oe(g.data,l.username);console.log("ðŸ’° ì‹¤ì œ ìž”ê³ :",I);const{error:o}=await b.from("transactions").insert({user_id:a,partner_id:h.id,transaction_type:t==="deposit"?"admin_deposit":"admin_withdrawal",amount:d,status:"completed",balance_before:j,balance_after:I,memo:`[ê´€ë¦¬ìž ê°•ì œ ${t==="deposit"?"ìž…ê¸ˆ":"ì¶œê¸ˆ"}] ${n}`,processed_by:h.id,processed_at:new Date().toISOString(),external_response:g.data});if(o)throw o;console.log("âœ… transactions INSERT ì™„ë£Œ â†’ íŠ¸ë¦¬ê±°ê°€ users.balance ìžë™ ì—…ë°ì´íŠ¸"),w.success(`ê°•ì œ ${t==="deposit"?"ìž…ê¸ˆ":"ì¶œê¸ˆ"}ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ìž”ì•¡: â‚©${I.toLocaleString()})`),H({type:"admin_force_transaction",data:{userId:a,type:t,amount:d,balanceAfter:I,processedBy:h.nickname}}),u({open:!1,type:"deposit",userId:"",amount:"",memo:""})}catch(t){console.error("ê°•ì œ ìž…ì¶œê¸ˆ ì‹¤íŒ¨:",t),w.error(t instanceof Error?t.message:"ê°•ì œ ìž…ì¶œê¸ˆì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}};if(i.useEffect(()=>{C(!0)},[]),i.useEffect(()=>{q>0&&!v&&(console.log("ðŸ”„ Realtime íŠ¸ë¦¬ê±° ë°ì´í„° ë¡œë“œ:",q),C(!1))},[q]),i.useEffect(()=>{v||(console.log("ðŸ“… ê¸°ê°„ í•„í„° ë³€ê²½:",S),C(!1))},[S]),i.useEffect(()=>{console.log("ðŸ”Œ Realtime subscription ì„¤ì • ì¤‘...");const t=b.channel("transactions-realtime-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},s=>{console.log("ðŸ’³ transactions í…Œì´ë¸” ë³€ê²½ ê°ì§€:",s.eventType,s.new),D(n=>n+1)}).subscribe(s=>{console.log("ðŸ’³ transactions ì±„ë„ êµ¬ë… ìƒíƒœ:",s)}),a=b.channel("users-realtime-balance-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},s=>{console.log("ðŸ‘¤ users í…Œì´ë¸” ë³€ê²½ ê°ì§€:",s.new),D(n=>n+1)}).subscribe(s=>{console.log("ðŸ‘¤ users ì±„ë„ êµ¬ë… ìƒíƒœ:",s)});return()=>{console.log("ðŸ”Œ Realtime subscription ì •ë¦¬ ì¤‘..."),b.removeChannel(t),b.removeChannel(a)}},[]),i.useEffect(()=>{(f?.type==="transaction_update"||f?.type==="deposit_request"||f?.type==="withdrawal_request"||f?.type==="admin_force_transaction"||f?.type==="transaction_processed")&&(console.log("ðŸ“¨ WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ :",f.type),D(t=>t+1))},[f]),v)return e.jsx(Ae,{});const O=t=>K===""||t.user?.nickname?.toLowerCase().includes(K.toLowerCase()),Ce=F.filter(t=>t.transaction_type==="deposit"&&t.status==="pending"&&O(t)),Ie=F.filter(t=>t.transaction_type==="withdrawal"&&t.status==="pending"&&O(t)),ke=F.filter(t=>(t.transaction_type==="deposit"||t.transaction_type==="withdrawal")&&t.status==="completed"&&O(t)),De=F.filter(t=>(t.transaction_type==="admin_deposit"||t.transaction_type==="admin_withdrawal"||t.transaction_type==="admin_adjustment")&&t.status==="completed"&&O(t)),P=(t=!1)=>[{header:"ê±°ëž˜ ì¼ì‹œ",cell:a=>e.jsx("span",{className:"text-sm text-slate-300",children:new Date(a.created_at).toLocaleString("ko-KR")})},{header:"íšŒì›",cell:a=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-200",children:a.user?.nickname}),e.jsx("p",{className:"text-sm text-slate-500",children:a.user?.username})]})},{header:"ê±°ëž˜ ìœ í˜•",cell:a=>{const n={deposit:{text:"ìž…ê¸ˆ",color:"bg-green-500"},withdrawal:{text:"ì¶œê¸ˆ",color:"bg-red-500"},admin_deposit:{text:"ìž…ê¸ˆ",color:"bg-green-600"},admin_withdrawal:{text:"ì¶œê¸ˆ",color:"bg-red-600"},admin_adjustment:{text:a.memo?.includes("ê°•ì œ ì¶œê¸ˆ")?"ì¶œê¸ˆ":"ìž…ê¸ˆ",color:a.memo?.includes("ê°•ì œ ì¶œê¸ˆ")?"bg-red-600":"bg-green-600"}}[a.transaction_type]||{text:a.transaction_type,color:"bg-gray-500"};return e.jsx(V,{className:`${n.color} text-white`,children:n.text})}},{header:"ê¸ˆì•¡",cell:a=>{const s=a.transaction_type==="withdrawal"||a.transaction_type==="admin_withdrawal"||a.transaction_type==="admin_adjustment"&&a.memo?.includes("ê°•ì œ ì¶œê¸ˆ");return e.jsxs("span",{className:re("font-mono font-semibold",s?"text-red-400":"text-green-400"),children:[s?"-":"+","â‚©",parseFloat(a.amount.toString()).toLocaleString()]})}},{header:"ë³€ê²½ í›„ ë³´ìœ ê¸ˆ",cell:a=>e.jsxs("span",{className:"font-mono text-cyan-400",children:["â‚©",parseFloat(a.balance_after?.toString()||"0").toLocaleString()]})},{header:"ìƒíƒœ",cell:a=>{const n={pending:{text:"ëŒ€ê¸°",color:"bg-yellow-500"},completed:{text:"ì™„ë£Œ",color:"bg-green-500"},rejected:{text:"ê±°ì ˆ",color:"bg-red-500"}}[a.status]||{text:a.status,color:"bg-gray-500"};return e.jsx(V,{className:`${n.color} text-white`,children:n.text})}},{header:"ë©”ëª¨",cell:a=>e.jsx("div",{className:"max-w-xs",children:e.jsx("span",{className:"text-sm text-slate-400 block truncate",title:a.memo||"",children:a.memo||"-"})})},{header:"ì²˜ë¦¬ìž",cell:a=>e.jsx("span",{className:"text-sm text-slate-400",children:a.processed_partner?.nickname||"-"})},...t?[{header:"ìž‘ì—…",cell:a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(x,{size:"sm",onClick:()=>X(a,"approve"),disabled:y,className:"h-8 px-3 bg-green-600 hover:bg-green-700",children:"ìŠ¹ì¸"}),e.jsx(x,{size:"sm",variant:"outline",onClick:()=>X(a,"reject"),disabled:y,className:"h-8 px-3 border-red-500 text-red-500 hover:bg-red-500 hover:text-white",children:"ê±°ì ˆ"})]})}]:[]];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"ìž…ì¶œê¸ˆ ê´€ë¦¬"}),e.jsx("p",{className:"text-sm text-slate-400",children:"íšŒì› ìž…ì¶œê¸ˆ ì‹ ì²­ ë° ì²˜ë¦¬ ê´€ë¦¬"})]}),e.jsxs(x,{onClick:()=>u({...r,open:!0}),className:"btn-premium-primary",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"ê°•ì œ ìž…ì¶œê¸ˆ"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(B,{title:"ì´ ìž…ê¸ˆ",value:`â‚©${M.totalDeposit.toLocaleString()}`,subtitle:"ëˆ„ì  ìž…ê¸ˆ",icon:Ee,color:"green"}),e.jsx(B,{title:"ì´ ì¶œê¸ˆ",value:`â‚©${M.totalWithdrawal.toLocaleString()}`,subtitle:"ëˆ„ì  ì¶œê¸ˆ",icon:Z,color:"red"}),e.jsx(B,{title:"ìž…ê¸ˆ ì‹ ì²­",value:`${M.pendingDepositCount}ê±´`,subtitle:"ì²˜ë¦¬ ëŒ€ê¸°",icon:Ye,color:"amber"}),e.jsx(B,{title:"ì¶œê¸ˆ ì‹ ì²­",value:`${M.pendingWithdrawalCount}ê±´`,subtitle:"ì²˜ë¦¬ ëŒ€ê¸°",icon:Ge,color:"orange"})]}),e.jsx("div",{className:"glass-card rounded-xl p-6",children:e.jsxs(Le,{value:k,onValueChange:Y,className:"space-y-6",children:[e.jsxs(Fe,{className:"grid w-full grid-cols-4 bg-slate-800/50 p-1 rounded-lg",children:[e.jsx($,{value:"deposit-request",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ìž…ê¸ˆ ì‹ ì²­"}),e.jsx($,{value:"withdrawal-request",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ì¶œê¸ˆ ì‹ ì²­"}),e.jsx($,{value:"completed-history",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ìž…ì¶œê¸ˆ ë‚´ì—­"}),e.jsx($,{value:"admin-history",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ê´€ë¦¬ìž ìž…ì¶œê¸ˆ ë‚´ì—­"})]}),e.jsx("div",{className:"flex items-center justify-between pb-4 border-b border-slate-700/50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(qe,{className:"h-5 w-5 text-slate-400"}),e.jsxs("h3",{className:"font-semibold text-slate-100",children:[k==="deposit-request"&&"ìž…ê¸ˆ ì‹ ì²­",k==="withdrawal-request"&&"ì¶œê¸ˆ ì‹ ì²­",k==="completed-history"&&"ìž…ì¶œê¸ˆ ë‚´ì—­",k==="admin-history"&&"ê´€ë¦¬ìž ìž…ì¶œê¸ˆ ë‚´ì—­"]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(ee,{value:S,onValueChange:je,children:[e.jsx(te,{className:"w-[140px] input-premium",children:e.jsx(ae,{placeholder:"ê¸°ê°„"})}),e.jsxs(se,{className:"bg-slate-800 border-slate-700",children:[e.jsx(E,{value:"today",children:"ì˜¤ëŠ˜"}),e.jsx(E,{value:"week",children:"ìµœê·¼ 7ì¼"}),e.jsx(E,{value:"month",children:"ìµœê·¼ 30ì¼"})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(fe,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(ne,{placeholder:"íšŒì› ê²€ìƒ‰...",className:"pl-10 input-premium",value:K,onChange:t=>ve(t.target.value)})]}),e.jsxs(x,{onClick:()=>{console.log("ðŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨"),C(!1)},disabled:y,variant:"outline",className:"btn-premium-primary",children:[e.jsx(Me,{className:re("h-4 w-4 mr-2",y&&"animate-spin")}),"ìƒˆë¡œê³ ì¹¨"]})]}),e.jsx(R,{value:"deposit-request",children:e.jsx(W,{searchable:!1,columns:P(!0),data:Ce,loading:v,emptyMessage:"ìž…ê¸ˆ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤."})}),e.jsx(R,{value:"withdrawal-request",children:e.jsx(W,{searchable:!1,columns:P(!0),data:Ie,loading:v,emptyMessage:"ì¶œê¸ˆ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤."})}),e.jsx(R,{value:"completed-history",children:e.jsx(W,{searchable:!1,columns:P(!1),data:ke,loading:v,emptyMessage:"ìž…ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})}),e.jsx(R,{value:"admin-history",children:e.jsx(W,{searchable:!1,columns:P(!1),data:De,loading:v,emptyMessage:"ê´€ë¦¬ìž ìž…ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})})]})}),e.jsx(me,{open:c.open,onOpenChange:t=>T({...c,open:t}),children:e.jsxs(pe,{className:"bg-slate-900 border-slate-700",children:[e.jsxs(ue,{children:[e.jsx(he,{className:"text-white",children:c.action==="approve"?"ê±°ëž˜ ìŠ¹ì¸":"ê±°ëž˜ ê±°ì ˆ"}),e.jsx(ge,{className:"text-slate-400",children:c.action==="approve"?"ì´ ê±°ëž˜ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?":"ê±°ì ˆ ì‚¬ìœ ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”."})]}),c.transaction&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"íšŒì›:"}),e.jsx("span",{className:"text-white",children:c.transaction.user?.nickname})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"ê±°ëž˜ ìœ í˜•:"}),e.jsx("span",{className:"text-white",children:c.transaction.transaction_type==="deposit"?"ìž…ê¸ˆ":"ì¶œê¸ˆ"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"ê¸ˆì•¡:"}),e.jsxs("span",{className:"text-green-400 font-mono",children:["â‚©",parseFloat(c.transaction.amount.toString()).toLocaleString()]})]})]}),c.action==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"text-slate-300",children:"ê±°ì ˆ ì‚¬ìœ "}),e.jsx(de,{value:c.memo,onChange:t=>T({...c,memo:t.target.value}),placeholder:"ê±°ì ˆ ì‚¬ìœ ë¥¼ ìž…ë ¥í•´ì£¼ì„¸ìš”...",className:"bg-slate-800 border-slate-700 text-white",rows:3})]})]}),e.jsxs(xe,{children:[e.jsx(x,{variant:"outline",onClick:()=>T({...c,open:!1}),disabled:y,children:"ì·¨ì†Œ"}),e.jsx(x,{onClick:_e,disabled:y||c.action==="reject"&&!c.memo,className:c.action==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:c.action==="approve"?"ìŠ¹ì¸":"ê±°ì ˆ"})]})]})}),e.jsx(me,{open:r.open,onOpenChange:t=>u({...r,open:t}),children:e.jsxs(pe,{className:"bg-slate-900 border-slate-700 max-w-2xl",children:[e.jsxs(ue,{children:[e.jsx(he,{className:"text-white",children:"ê´€ë¦¬ìž ê°•ì œ ìž…ì¶œê¸ˆ"}),e.jsx(ge,{className:"text-slate-400",children:"íšŒì›ì˜ ìž”ì•¡ì„ ì§ì ‘ ì¡°ì •í•©ë‹ˆë‹¤."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"text-slate-300",children:"ê±°ëž˜ ìœ í˜•"}),e.jsxs(ee,{value:r.type,onValueChange:t=>u({...r,type:t}),children:[e.jsx(te,{className:"bg-slate-800 border-slate-700 text-white",children:e.jsx(ae,{})}),e.jsxs(se,{children:[e.jsx(E,{value:"deposit",children:"ìž…ê¸ˆ"}),e.jsx(E,{value:"withdrawal",children:"ì¶œê¸ˆ"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"text-slate-300",children:"íšŒì› ì„ íƒ"}),e.jsxs(Ke,{open:J,onOpenChange:z,children:[e.jsx(ze,{asChild:!0,children:e.jsxs(x,{variant:"outline",role:"combobox","aria-expanded":J,className:"w-full justify-between bg-slate-800 border-slate-700 text-white hover:bg-slate-700",children:[r.userId?N.find(t=>t.id===r.userId)?.nickname+` (${N.find(t=>t.id===r.userId)?.username})`:"íšŒì›ì„ ì„ íƒí•˜ì„¸ìš”",e.jsx(fe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Ve,{className:"w-[500px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(Pe,{className:"bg-slate-800",children:[e.jsx($e,{placeholder:"íšŒì› ê²€ìƒ‰...",className:"text-white"}),e.jsxs(Re,{children:[e.jsx(We,{className:"text-slate-400 py-6 text-center",children:"íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}),e.jsx(Be,{children:N.map(t=>e.jsx(Ue,{value:`${t.nickname} ${t.username} ${t.id}`,onSelect:()=>{u({...r,userId:t.id}),z(!1)},className:"text-white hover:bg-slate-700 cursor-pointer",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:t.nickname}),e.jsxs("span",{className:"text-sm text-slate-400",children:["(",t.username,")"]})]}),e.jsxs("div",{className:"text-sm text-cyan-400 mt-1",children:["ìž”ì•¡: â‚©",parseFloat(t.balance?.toString()||"0").toLocaleString()]})]})},t.id))})]})]})})]})]}),r.userId&&(()=>{const t=N.find(a=>a.id===r.userId);return t?e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"ì„ íƒëœ íšŒì›"}),e.jsx(V,{className:"bg-cyan-600 text-white",children:t.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"í˜„ìž¬ ë³´ìœ ê¸ˆ"}),e.jsxs("span",{className:"text-lg font-mono text-cyan-400",children:["â‚©",parseFloat(t.balance?.toString()||"0").toLocaleString()]})]})]}):null})(),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"text-slate-300",children:"ê¸ˆì•¡"}),e.jsx(ne,{type:"number",value:r.amount,onChange:t=>{const a=parseFloat(t.target.value||"0");if(r.type==="withdrawal"&&r.userId){const s=N.find(n=>n.id===r.userId);if(s){const n=parseFloat(s.balance?.toString()||"0");if(a>n){w.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(â‚©${n.toLocaleString()})ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),u({...r,amount:n.toString()});return}}}u({...r,amount:t.target.value})},placeholder:"ê¸ˆì•¡ì„ ìž…ë ¥í•˜ì„¸ìš”",className:"bg-slate-800 border-slate-700 text-white"}),e.jsx("div",{className:"grid grid-cols-5 gap-2 pt-2",children:ye.map(t=>e.jsx(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const s=parseFloat(r.amount||"0")+t.value;if(r.type==="withdrawal"&&r.userId){const n=N.find(l=>l.id===r.userId);if(n){const l=parseFloat(n.balance?.toString()||"0");if(s>l){w.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(â‚©${l.toLocaleString()})ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),u({...r,amount:l.toString()});return}}}u({...r,amount:s.toString()})},className:"bg-slate-700 border-slate-600 text-white hover:bg-slate-600 text-xs",children:t.label},t.value))}),e.jsxs("div",{className:"flex gap-2 pt-2",children:[e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:()=>u({...r,amount:"0"}),className:"flex-1 bg-red-900/20 border-red-500 text-red-400 hover:bg-red-900/40",children:[e.jsx(Qe,{className:"h-4 w-4 mr-2"}),"ì „ì²´ì‚­ì œ"]}),r.type==="withdrawal"&&r.userId&&e.jsxs(x,{type:"button",variant:"outline",size:"sm",onClick:()=>{const t=N.find(a=>a.id===r.userId);if(t){const a=parseFloat(t.balance?.toString()||"0");u({...r,amount:a.toString()})}},className:"flex-1 bg-orange-900/20 border-orange-500 text-orange-400 hover:bg-orange-900/40",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"ì „ì²´ì¶œê¸ˆ"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{className:"text-slate-300",children:"ë©”ëª¨"}),e.jsx(de,{value:r.memo,onChange:t=>u({...r,memo:t.target.value}),placeholder:"ë©”ëª¨ë¥¼ ìž…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)",className:"bg-slate-800 border-slate-700 text-white",rows:2})]})]}),e.jsxs(xe,{children:[e.jsx(x,{variant:"outline",onClick:()=>{u({open:!1,type:"deposit",userId:"",amount:"",memo:""}),z(!1)},disabled:y,children:"ì·¨ì†Œ"}),e.jsx(x,{onClick:Se,disabled:y||!r.userId||!r.amount,className:"bg-purple-600 hover:bg-purple-700",children:"ì‹¤í–‰"})]})]})})]})}export{dt as TransactionManagement,dt as default};

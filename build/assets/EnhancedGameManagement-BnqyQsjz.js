import{k as le,r as n,aC as re,t as i,j as s,w as y,R as U,H as C,a2 as T,C as ne,a as ie,b as ce,e as oe,G as de,m as me,n as ue,o as H,I as he,S as Z,x as q,y as F,z as O,D as j,B as xe,aD as fe,aE as pe,aF as je,aG as _}from"./index-DlK2WquE.js";import{D as ve}from"./DataTable-DShsxcsG.js";import{g as v,S as E}from"./gameApi-BcRZTs-l.js";import{M as G}from"./MetricCard-C4Jq9Aol.js";import{Z as ge}from"./zap-4fyBrmT7.js";import{T as $}from"./triangle-alert-Dbc6QA6H.js";import{S as be}from"./search-BrsHMGhG.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],we=le("ellipsis-vertical",ye);function Ee({user:f}){const[c,W]=n.useState("casino"),[m,L]=n.useState([]),[g,J]=n.useState([]),[k,w]=n.useState(!1),[d,M]=n.useState(""),[u,P]=n.useState("all"),[h,D]=n.useState("all"),[b,A]=n.useState(new Set),[p,z]=n.useState(!1),[K,R]=n.useState([]),[Q,B]=n.useState(!1),{sendMessage:I,isConnected:V}=re(),X=n.useMemo(()=>m.filter(e=>!(e.type!==c||d&&!e.name.toLowerCase().includes(d.toLowerCase())&&!e.provider_name?.toLowerCase().includes(d.toLowerCase())||u!=="all"&&e.provider_id.toString()!==u||h!=="all"&&e.status!==h)),[m,c,d,u,h]);n.useEffect(()=>{Y()},[]),n.useEffect(()=>{V&&I({type:"subscribe",channel:"game_status_updates",userId:f.id})},[V,f.id]);const Y=async()=>{try{w(!0);const e=await v.getProviders();J(e),await v.initializeCasinoLobbyGames(),await x("casino")}catch(e){console.error("초기 데이터 로드 실패:",e),i.error("데이터를 불러오는데 실패했습니다.")}finally{w(!1)}},x=async e=>{try{w(!0);const a={type:(e||c)==="casino"?"casino":"slot"};u!=="all"&&(a.provider_id=parseInt(u)),h!=="all"&&(a.status=h),d.trim()&&(a.search=d.trim());const t=await v.getGames(f.id,a);console.log("🎮 EnhancedGameManagement - 로드된 게임:",{개수:t.length,샘플:t.slice(0,3).map(r=>({id:r.id,name:r.name,image_url:r.image_url,provider:r.provider_name}))}),L(t)}catch(l){console.error("게임 데이터 로드 실패:",l),i.error("게임 데이터를 불러오는데 실패했습니다.")}finally{w(!1)}},ee=async e=>{W(e),P("all"),D("all"),M(""),await x(e)};n.useEffect(()=>{const e=setTimeout(()=>{g.length>0&&!p&&b.size===0&&x()},300);return()=>clearTimeout(e)},[d,h]),n.useEffect(()=>{g.length>0&&!p&&b.size===0&&x()},[u]);const N=async(e,l,a,t)=>{try{await v.updateGameStatusForPartner(f.id,e,l,a,t),I({type:"game_status_update",partnerId:f.id,gameId:e,status:l,priority:a,isFeatured:t,updatedBy:f.id}),L(r=>r.map(o=>o.id===e?{...o,status:l,priority:a||o.priority,is_featured:t||o.is_featured}:o)),i.success("게임 상태가 업데이트되었습니다.")}catch(r){console.error("게임 상태 업데이트 실패:",r),i.error("게임 상태 업데이트에 실패했습니다.")}},se=async e=>{const l=g.find(a=>a.id===e);if(!l){i.error("제공사를 찾을 수 없습니다.");return}if(l.type==="casino"){i.info("카지노는 로비 진입 방식으로 게임 목록이 없습니다.");return}if(b.has(e)){i.warning("이미 동기화가 진행 중입니다.");return}A(a=>new Set([...a,e]));try{const a=await v.syncGamesFromAPI(e);a.newGames===0&&a.updatedGames===0&&a.totalGames===0?i.info(`${l.name}: 게임 리스트가 없거나 지원하지 않는 제공사입니다.`,{description:"카지노 제공사는 로비 진입 방식을 사용하거나, 일부 슬롯 제공사는 게임 목록을 제공하지 않을 수 있습니다."}):i.success(`${l.name} 동기화 완료: 신규 ${a.newGames}개, 업데이트 ${a.updatedGames}개`,{description:`총 ${a.totalGames}개 게임 처리됨`}),await x()}catch(a){console.error(`${l.name} 동기화 실패:`,a);const t=a instanceof Error?a.message:"알 수 없는 오류";i.error(`${l.name} 동기화 실패`,{description:t})}finally{A(a=>{const t=new Set(a);return t.delete(e),t})}},ae=async()=>{if(p){i.warning("이미 전체 동기화가 진행 중입니다.");return}z(!0),R([]),B(!0);try{const e=await v.syncAllProviderGames();R(e.results);const l=e.results.reduce((r,o)=>r+o.gamesAdded,0),a=e.results.reduce((r,o)=>r+o.gamesUpdated,0),t=e.results.filter(r=>r.error).length;e.success?i.success(`전체 동기화 완료: 신규 ${l}개, 업데이트 ${a}개`):i.warning(`동기화 완료 (일부 실패): 신규 ${l}개, 업데이트 ${a}개, 실패 ${t}개`),await x()}catch(e){console.error("전체 동기화 실패:",e),i.error("전체 동기화에 실패했습니다.")}finally{z(!1)}},S=n.useMemo(()=>({visible:m.filter(e=>e.status==="visible"&&e.type===c).length,hidden:m.filter(e=>e.status==="hidden"&&e.type===c).length,maintenance:m.filter(e=>e.status==="maintenance"&&e.type===c).length,featured:m.filter(e=>e.is_featured&&e.type===c).length}),[m,c]),te=[{header:"게임 정보",accessor:"name",cell:e=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"relative w-12 h-12 flex-shrink-0",children:[e.image_url?s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full rounded-lg object-cover bg-slate-100 dark:bg-slate-800",onError:l=>{const a=l.target;a.style.display="none";const t=a.parentElement;if(t&&!t.querySelector(".game-image-placeholder")){const r=document.createElement("div");r.className="game-image-placeholder w-full h-full rounded-lg text-xs",r.textContent="🎮",t.appendChild(r)}}}):s.jsx("div",{className:"game-image-placeholder w-full h-full rounded-lg text-xs",children:"🎮"}),e.is_featured&&s.jsx(E,{className:"absolute -top-1 -right-1 w-4 h-4 text-yellow-500 fill-current"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium truncate",children:e.name}),s.jsxs("div",{className:"text-sm text-muted-foreground truncate",children:[e.provider_name," ",e.rtp&&`• RTP ${e.rtp}%`]})]})]})},{header:"상태",accessor:"status",cell:e=>{const a={visible:{label:"노출",variant:"default",icon:C},hidden:{label:"비노출",variant:"secondary",icon:T},maintenance:{label:"점검중",variant:"destructive",icon:$}}[e.status],t=a?.icon||C;return s.jsxs(xe,{variant:a?.variant||"default",className:"gap-1",children:[s.jsx(t,{className:"w-3 h-3"}),a?.label||e.status]})}},{header:"우선순위",accessor:"priority",cell:e=>s.jsx("div",{className:"text-center font-mono",children:e.priority||0})},{header:"플레이 수",accessor:"play_count",cell:e=>s.jsx("div",{className:"text-center",children:e.play_count?.toLocaleString()||0})},{header:"액션",accessor:"actions",cell:e=>s.jsxs(fe,{children:[s.jsx(pe,{asChild:!0,children:s.jsx(y,{variant:"ghost",size:"sm",children:s.jsx(we,{className:"w-4 h-4"})})}),s.jsxs(je,{align:"end",children:[s.jsxs(_,{onClick:()=>N(e.id,"visible"),children:[s.jsx(C,{className:"w-4 h-4 mr-2"}),"노출하기"]}),s.jsxs(_,{onClick:()=>N(e.id,"hidden"),children:[s.jsx(T,{className:"w-4 h-4 mr-2"}),"숨기기"]}),s.jsxs(_,{onClick:()=>N(e.id,"maintenance"),children:[s.jsx($,{className:"w-4 h-4 mr-2"}),"점검중으로 설정"]}),s.jsxs(_,{onClick:()=>N(e.id,e.status,e.priority,!e.is_featured),children:[s.jsx(E,{className:"w-4 h-4 mr-2"}),e.is_featured?"추천 해제":"추천 설정"]})]})]})}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"게임 관리"}),s.jsx("p",{className:"text-sm text-slate-400",children:"게임 목록 동기화 및 상태 관리"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(y,{onClick:ae,disabled:p,className:"btn-premium-primary",children:[s.jsx(ge,{className:"w-4 h-4 mr-2"}),p?"동기화 중...":"전체 동기화"]}),s.jsx(y,{onClick:()=>x(),disabled:k,variant:"outline",className:"border-slate-600 hover:bg-slate-700",children:s.jsx(U,{className:`w-4 h-4 ${k?"animate-spin":""}`})})]})]}),s.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[s.jsx(G,{title:"노출 게임",value:S.visible.toLocaleString(),subtitle:"활성화된 게임",icon:C,color:"green"}),s.jsx(G,{title:"비노출 게임",value:S.hidden.toLocaleString(),subtitle:"숨김 처리됨",icon:T,color:"platinum"}),s.jsx(G,{title:"점검중",value:S.maintenance.toLocaleString(),subtitle:"점검 상태",icon:$,color:"red"}),s.jsx(G,{title:"추천 게임",value:S.featured.toLocaleString(),subtitle:"추천 설정됨",icon:E,color:"amber"})]}),Q&&s.jsxs(ne,{children:[s.jsx(ie,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(ce,{children:"동기화 결과"}),s.jsx(y,{variant:"ghost",size:"sm",onClick:()=>B(!1),children:"✕"})]})}),s.jsx(oe,{children:s.jsx("div",{className:"space-y-2",children:K.map(e=>s.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${e.error?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:[s.jsx("span",{className:"font-medium",children:e.providerName}),s.jsx("div",{className:"text-sm",children:e.error?s.jsxs("span",{className:"text-red-600",children:["실패: ",e.error]}):s.jsxs("span",{className:"text-green-600",children:["신규 ",e.gamesAdded,"개, 업데이트 ",e.gamesUpdated,"개"]})})]},e.providerId))})})]}),s.jsxs("div",{className:"glass-card rounded-xl p-6",children:[s.jsx("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold text-slate-100 flex items-center gap-2",children:[s.jsx(de,{className:"h-5 w-5 text-blue-400"}),"게임 목록"]}),s.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"게임 제공사별 게임 목록 관리 및 상태 설정"})]})}),s.jsxs(me,{value:c,onValueChange:ee,children:[s.jsxs(ue,{className:"grid w-full grid-cols-2 bg-slate-800/50 p-1 rounded-xl mb-6 border border-slate-700/50",children:[s.jsx(H,{value:"casino",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-[0_0_20px_rgba(168,85,247,0.5)] rounded-lg transition-all duration-300 font-semibold",children:"🎰 카지노"}),s.jsx(H,{value:"slot",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-600 data-[state=active]:to-cyan-600 data-[state=active]:text-white data-[state=active]:shadow-[0_0_20px_rgba(59,130,246,0.5)] rounded-lg transition-all duration-300 font-semibold",children:"🎲 슬롯"})]}),s.jsxs("div",{className:"mt-6 space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx(he,{placeholder:"게임명 또는 제공사명으로 검색...",value:d,onChange:e=>M(e.target.value),className:"pl-10 input-premium"})]})}),s.jsxs(Z,{value:u,onValueChange:P,children:[s.jsx(q,{className:"w-full sm:w-48 bg-slate-800/50 border-slate-600",children:s.jsx(F,{placeholder:"제공사 선택"})}),s.jsxs(O,{children:[s.jsx(j,{value:"all",children:"모든 제공사"}),g.filter(e=>e.type===(c==="casino"?"casino":"slot")).map(e=>s.jsx(j,{value:e.id.toString(),children:e.name},e.id))]})]}),s.jsxs(Z,{value:h,onValueChange:D,children:[s.jsx(q,{className:"w-full sm:w-32 bg-slate-800/50 border-slate-600",children:s.jsx(F,{placeholder:"상태"})}),s.jsxs(O,{children:[s.jsx(j,{value:"all",children:"모든 상태"}),s.jsx(j,{value:"visible",children:"노출"}),s.jsx(j,{value:"hidden",children:"비노출"}),s.jsx(j,{value:"maintenance",children:"점검중"})]})]})]}),c==="slot"&&s.jsxs("div",{className:"flex flex-wrap gap-2 p-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[s.jsx("div",{className:"text-sm text-slate-400 mb-2 w-full",children:"제공사별 게임 동기화:"}),g.filter(e=>e.type==="slot").map(e=>s.jsxs(y,{size:"sm",variant:"outline",onClick:()=>se(e.id),disabled:b.has(e.id)||p,className:"gap-1 border-slate-600 hover:bg-slate-700",children:[s.jsx(U,{className:`w-3 h-3 ${b.has(e.id)?"animate-spin":""}`}),e.name]},e.id))]}),s.jsx(ve,{data:X,columns:te,loading:k,enableSearch:!1,emptyMessage:"게임이 없습니다"})]})]})]})]})}export{Ee as EnhancedGameManagement,Ee as default};

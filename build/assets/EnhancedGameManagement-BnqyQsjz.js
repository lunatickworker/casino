import{k as le,r as n,aC as re,t as i,j as s,w as y,R as U,H as C,a2 as T,C as ne,a as ie,b as ce,e as oe,G as de,m as me,n as ue,o as H,I as he,S as Z,x as q,y as F,z as O,D as j,B as xe,aD as fe,aE as pe,aF as je,aG as _}from"./index-DlK2WquE.js";import{D as ve}from"./DataTable-DShsxcsG.js";import{g as v,S as E}from"./gameApi-BcRZTs-l.js";import{M as G}from"./MetricCard-C4Jq9Aol.js";import{Z as ge}from"./zap-4fyBrmT7.js";import{T as $}from"./triangle-alert-Dbc6QA6H.js";import{S as be}from"./search-BrsHMGhG.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]],we=le("ellipsis-vertical",ye);function Ee({user:f}){const[c,W]=n.useState("casino"),[m,L]=n.useState([]),[g,J]=n.useState([]),[k,w]=n.useState(!1),[d,M]=n.useState(""),[u,P]=n.useState("all"),[h,D]=n.useState("all"),[b,A]=n.useState(new Set),[p,z]=n.useState(!1),[K,R]=n.useState([]),[Q,B]=n.useState(!1),{sendMessage:I,isConnected:V}=re(),X=n.useMemo(()=>m.filter(e=>!(e.type!==c||d&&!e.name.toLowerCase().includes(d.toLowerCase())&&!e.provider_name?.toLowerCase().includes(d.toLowerCase())||u!=="all"&&e.provider_id.toString()!==u||h!=="all"&&e.status!==h)),[m,c,d,u,h]);n.useEffect(()=>{Y()},[]),n.useEffect(()=>{V&&I({type:"subscribe",channel:"game_status_updates",userId:f.id})},[V,f.id]);const Y=async()=>{try{w(!0);const e=await v.getProviders();J(e),await v.initializeCasinoLobbyGames(),await x("casino")}catch(e){console.error("ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",e),i.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{w(!1)}},x=async e=>{try{w(!0);const a={type:(e||c)==="casino"?"casino":"slot"};u!=="all"&&(a.provider_id=parseInt(u)),h!=="all"&&(a.status=h),d.trim()&&(a.search=d.trim());const t=await v.getGames(f.id,a);console.log("ğŸ® EnhancedGameManagement - ë¡œë“œëœ ê²Œì„:",{ê°œìˆ˜:t.length,ìƒ˜í”Œ:t.slice(0,3).map(r=>({id:r.id,name:r.name,image_url:r.image_url,provider:r.provider_name}))}),L(t)}catch(l){console.error("ê²Œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",l),i.error("ê²Œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{w(!1)}},ee=async e=>{W(e),P("all"),D("all"),M(""),await x(e)};n.useEffect(()=>{const e=setTimeout(()=>{g.length>0&&!p&&b.size===0&&x()},300);return()=>clearTimeout(e)},[d,h]),n.useEffect(()=>{g.length>0&&!p&&b.size===0&&x()},[u]);const N=async(e,l,a,t)=>{try{await v.updateGameStatusForPartner(f.id,e,l,a,t),I({type:"game_status_update",partnerId:f.id,gameId:e,status:l,priority:a,isFeatured:t,updatedBy:f.id}),L(r=>r.map(o=>o.id===e?{...o,status:l,priority:a||o.priority,is_featured:t||o.is_featured}:o)),i.success("ê²Œì„ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(r){console.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",r),i.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},se=async e=>{const l=g.find(a=>a.id===e);if(!l){i.error("ì œê³µì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(l.type==="casino"){i.info("ì¹´ì§€ë…¸ëŠ” ë¡œë¹„ ì§„ì… ë°©ì‹ìœ¼ë¡œ ê²Œì„ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");return}if(b.has(e)){i.warning("ì´ë¯¸ ë™ê¸°í™”ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");return}A(a=>new Set([...a,e]));try{const a=await v.syncGamesFromAPI(e);a.newGames===0&&a.updatedGames===0&&a.totalGames===0?i.info(`${l.name}: ê²Œì„ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ê±°ë‚˜ ì§€ì›í•˜ì§€ ì•ŠëŠ” ì œê³µì‚¬ì…ë‹ˆë‹¤.`,{description:"ì¹´ì§€ë…¸ ì œê³µì‚¬ëŠ” ë¡œë¹„ ì§„ì… ë°©ì‹ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ì¼ë¶€ ìŠ¬ë¡¯ ì œê³µì‚¬ëŠ” ê²Œì„ ëª©ë¡ì„ ì œê³µí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."}):i.success(`${l.name} ë™ê¸°í™” ì™„ë£Œ: ì‹ ê·œ ${a.newGames}ê°œ, ì—…ë°ì´íŠ¸ ${a.updatedGames}ê°œ`,{description:`ì´ ${a.totalGames}ê°œ ê²Œì„ ì²˜ë¦¬ë¨`}),await x()}catch(a){console.error(`${l.name} ë™ê¸°í™” ì‹¤íŒ¨:`,a);const t=a instanceof Error?a.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";i.error(`${l.name} ë™ê¸°í™” ì‹¤íŒ¨`,{description:t})}finally{A(a=>{const t=new Set(a);return t.delete(e),t})}},ae=async()=>{if(p){i.warning("ì´ë¯¸ ì „ì²´ ë™ê¸°í™”ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");return}z(!0),R([]),B(!0);try{const e=await v.syncAllProviderGames();R(e.results);const l=e.results.reduce((r,o)=>r+o.gamesAdded,0),a=e.results.reduce((r,o)=>r+o.gamesUpdated,0),t=e.results.filter(r=>r.error).length;e.success?i.success(`ì „ì²´ ë™ê¸°í™” ì™„ë£Œ: ì‹ ê·œ ${l}ê°œ, ì—…ë°ì´íŠ¸ ${a}ê°œ`):i.warning(`ë™ê¸°í™” ì™„ë£Œ (ì¼ë¶€ ì‹¤íŒ¨): ì‹ ê·œ ${l}ê°œ, ì—…ë°ì´íŠ¸ ${a}ê°œ, ì‹¤íŒ¨ ${t}ê°œ`),await x()}catch(e){console.error("ì „ì²´ ë™ê¸°í™” ì‹¤íŒ¨:",e),i.error("ì „ì²´ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{z(!1)}},S=n.useMemo(()=>({visible:m.filter(e=>e.status==="visible"&&e.type===c).length,hidden:m.filter(e=>e.status==="hidden"&&e.type===c).length,maintenance:m.filter(e=>e.status==="maintenance"&&e.type===c).length,featured:m.filter(e=>e.is_featured&&e.type===c).length}),[m,c]),te=[{header:"ê²Œì„ ì •ë³´",accessor:"name",cell:e=>s.jsxs("div",{className:"flex items-center space-x-3",children:[s.jsxs("div",{className:"relative w-12 h-12 flex-shrink-0",children:[e.image_url?s.jsx("img",{src:e.image_url,alt:e.name,className:"w-full h-full rounded-lg object-cover bg-slate-100 dark:bg-slate-800",onError:l=>{const a=l.target;a.style.display="none";const t=a.parentElement;if(t&&!t.querySelector(".game-image-placeholder")){const r=document.createElement("div");r.className="game-image-placeholder w-full h-full rounded-lg text-xs",r.textContent="ğŸ®",t.appendChild(r)}}}):s.jsx("div",{className:"game-image-placeholder w-full h-full rounded-lg text-xs",children:"ğŸ®"}),e.is_featured&&s.jsx(E,{className:"absolute -top-1 -right-1 w-4 h-4 text-yellow-500 fill-current"})]}),s.jsxs("div",{className:"flex-1 min-w-0",children:[s.jsx("div",{className:"font-medium truncate",children:e.name}),s.jsxs("div",{className:"text-sm text-muted-foreground truncate",children:[e.provider_name," ",e.rtp&&`â€¢ RTP ${e.rtp}%`]})]})]})},{header:"ìƒíƒœ",accessor:"status",cell:e=>{const a={visible:{label:"ë…¸ì¶œ",variant:"default",icon:C},hidden:{label:"ë¹„ë…¸ì¶œ",variant:"secondary",icon:T},maintenance:{label:"ì ê²€ì¤‘",variant:"destructive",icon:$}}[e.status],t=a?.icon||C;return s.jsxs(xe,{variant:a?.variant||"default",className:"gap-1",children:[s.jsx(t,{className:"w-3 h-3"}),a?.label||e.status]})}},{header:"ìš°ì„ ìˆœìœ„",accessor:"priority",cell:e=>s.jsx("div",{className:"text-center font-mono",children:e.priority||0})},{header:"í”Œë ˆì´ ìˆ˜",accessor:"play_count",cell:e=>s.jsx("div",{className:"text-center",children:e.play_count?.toLocaleString()||0})},{header:"ì•¡ì…˜",accessor:"actions",cell:e=>s.jsxs(fe,{children:[s.jsx(pe,{asChild:!0,children:s.jsx(y,{variant:"ghost",size:"sm",children:s.jsx(we,{className:"w-4 h-4"})})}),s.jsxs(je,{align:"end",children:[s.jsxs(_,{onClick:()=>N(e.id,"visible"),children:[s.jsx(C,{className:"w-4 h-4 mr-2"}),"ë…¸ì¶œí•˜ê¸°"]}),s.jsxs(_,{onClick:()=>N(e.id,"hidden"),children:[s.jsx(T,{className:"w-4 h-4 mr-2"}),"ìˆ¨ê¸°ê¸°"]}),s.jsxs(_,{onClick:()=>N(e.id,"maintenance"),children:[s.jsx($,{className:"w-4 h-4 mr-2"}),"ì ê²€ì¤‘ìœ¼ë¡œ ì„¤ì •"]}),s.jsxs(_,{onClick:()=>N(e.id,e.status,e.priority,!e.is_featured),children:[s.jsx(E,{className:"w-4 h-4 mr-2"}),e.is_featured?"ì¶”ì²œ í•´ì œ":"ì¶”ì²œ ì„¤ì •"]})]})]})}];return s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs("div",{className:"space-y-1",children:[s.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"ê²Œì„ ê´€ë¦¬"}),s.jsx("p",{className:"text-sm text-slate-400",children:"ê²Œì„ ëª©ë¡ ë™ê¸°í™” ë° ìƒíƒœ ê´€ë¦¬"})]}),s.jsxs("div",{className:"flex items-center space-x-2",children:[s.jsxs(y,{onClick:ae,disabled:p,className:"btn-premium-primary",children:[s.jsx(ge,{className:"w-4 h-4 mr-2"}),p?"ë™ê¸°í™” ì¤‘...":"ì „ì²´ ë™ê¸°í™”"]}),s.jsx(y,{onClick:()=>x(),disabled:k,variant:"outline",className:"border-slate-600 hover:bg-slate-700",children:s.jsx(U,{className:`w-4 h-4 ${k?"animate-spin":""}`})})]})]}),s.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[s.jsx(G,{title:"ë…¸ì¶œ ê²Œì„",value:S.visible.toLocaleString(),subtitle:"í™œì„±í™”ëœ ê²Œì„",icon:C,color:"green"}),s.jsx(G,{title:"ë¹„ë…¸ì¶œ ê²Œì„",value:S.hidden.toLocaleString(),subtitle:"ìˆ¨ê¹€ ì²˜ë¦¬ë¨",icon:T,color:"platinum"}),s.jsx(G,{title:"ì ê²€ì¤‘",value:S.maintenance.toLocaleString(),subtitle:"ì ê²€ ìƒíƒœ",icon:$,color:"red"}),s.jsx(G,{title:"ì¶”ì²œ ê²Œì„",value:S.featured.toLocaleString(),subtitle:"ì¶”ì²œ ì„¤ì •ë¨",icon:E,color:"amber"})]}),Q&&s.jsxs(ne,{children:[s.jsx(ie,{children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsx(ce,{children:"ë™ê¸°í™” ê²°ê³¼"}),s.jsx(y,{variant:"ghost",size:"sm",onClick:()=>B(!1),children:"âœ•"})]})}),s.jsx(oe,{children:s.jsx("div",{className:"space-y-2",children:K.map(e=>s.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${e.error?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:[s.jsx("span",{className:"font-medium",children:e.providerName}),s.jsx("div",{className:"text-sm",children:e.error?s.jsxs("span",{className:"text-red-600",children:["ì‹¤íŒ¨: ",e.error]}):s.jsxs("span",{className:"text-green-600",children:["ì‹ ê·œ ",e.gamesAdded,"ê°œ, ì—…ë°ì´íŠ¸ ",e.gamesUpdated,"ê°œ"]})})]},e.providerId))})})]}),s.jsxs("div",{className:"glass-card rounded-xl p-6",children:[s.jsx("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:s.jsxs("div",{children:[s.jsxs("h2",{className:"text-xl font-semibold text-slate-100 flex items-center gap-2",children:[s.jsx(de,{className:"h-5 w-5 text-blue-400"}),"ê²Œì„ ëª©ë¡"]}),s.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"ê²Œì„ ì œê³µì‚¬ë³„ ê²Œì„ ëª©ë¡ ê´€ë¦¬ ë° ìƒíƒœ ì„¤ì •"})]})}),s.jsxs(me,{value:c,onValueChange:ee,children:[s.jsxs(ue,{className:"grid w-full grid-cols-2 bg-slate-800/50 p-1 rounded-xl mb-6 border border-slate-700/50",children:[s.jsx(H,{value:"casino",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-[0_0_20px_rgba(168,85,247,0.5)] rounded-lg transition-all duration-300 font-semibold",children:"ğŸ° ì¹´ì§€ë…¸"}),s.jsx(H,{value:"slot",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-600 data-[state=active]:to-cyan-600 data-[state=active]:text-white data-[state=active]:shadow-[0_0_20px_rgba(59,130,246,0.5)] rounded-lg transition-all duration-300 font-semibold",children:"ğŸ² ìŠ¬ë¡¯"})]}),s.jsxs("div",{className:"mt-6 space-y-4",children:[s.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[s.jsx("div",{className:"flex-1",children:s.jsxs("div",{className:"relative",children:[s.jsx(be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),s.jsx(he,{placeholder:"ê²Œì„ëª… ë˜ëŠ” ì œê³µì‚¬ëª…ìœ¼ë¡œ ê²€ìƒ‰...",value:d,onChange:e=>M(e.target.value),className:"pl-10 input-premium"})]})}),s.jsxs(Z,{value:u,onValueChange:P,children:[s.jsx(q,{className:"w-full sm:w-48 bg-slate-800/50 border-slate-600",children:s.jsx(F,{placeholder:"ì œê³µì‚¬ ì„ íƒ"})}),s.jsxs(O,{children:[s.jsx(j,{value:"all",children:"ëª¨ë“  ì œê³µì‚¬"}),g.filter(e=>e.type===(c==="casino"?"casino":"slot")).map(e=>s.jsx(j,{value:e.id.toString(),children:e.name},e.id))]})]}),s.jsxs(Z,{value:h,onValueChange:D,children:[s.jsx(q,{className:"w-full sm:w-32 bg-slate-800/50 border-slate-600",children:s.jsx(F,{placeholder:"ìƒíƒœ"})}),s.jsxs(O,{children:[s.jsx(j,{value:"all",children:"ëª¨ë“  ìƒíƒœ"}),s.jsx(j,{value:"visible",children:"ë…¸ì¶œ"}),s.jsx(j,{value:"hidden",children:"ë¹„ë…¸ì¶œ"}),s.jsx(j,{value:"maintenance",children:"ì ê²€ì¤‘"})]})]})]}),c==="slot"&&s.jsxs("div",{className:"flex flex-wrap gap-2 p-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[s.jsx("div",{className:"text-sm text-slate-400 mb-2 w-full",children:"ì œê³µì‚¬ë³„ ê²Œì„ ë™ê¸°í™”:"}),g.filter(e=>e.type==="slot").map(e=>s.jsxs(y,{size:"sm",variant:"outline",onClick:()=>se(e.id),disabled:b.has(e.id)||p,className:"gap-1 border-slate-600 hover:bg-slate-700",children:[s.jsx(U,{className:`w-3 h-3 ${b.has(e.id)?"animate-spin":""}`}),e.name]},e.id))]}),s.jsx(ve,{data:X,columns:te,loading:k,enableSearch:!1,emptyMessage:"ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤"})]})]})]})]})}export{Ee as EnhancedGameManagement,Ee as default};

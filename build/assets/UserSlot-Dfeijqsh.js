import{k as _,r,aC as X,t as n,s as Q,j as e,V as b,I as Y,S as ee,x as te,y as se,z as ae,D as j,w as x,b0 as le,C as U,e as re,B as v}from"./index-DlK2WquE.js";import{S as ie,G as oe,I as ne,L as q}from"./ImageWithFallback-Kll8V3JI.js";import{g as w,S as N}from"./gameApi-BcRZTs-l.js";import{D as de}from"./dollar-sign-DZ1x-9IY.js";import{T as H}from"./trophy-OZDkiNkH.js";import{Z as ce}from"./zap-4fyBrmT7.js";import{S as me}from"./search-BrsHMGhG.js";import{T as pe}from"./target-D6R9lmud.js";import{P as E}from"./play-qJPxVQ0Z.js";import{C as xe}from"./clock-BsgtTRc8.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M6 3h12l4 6-10 13L2 9Z",key:"1pcd5k"}],["path",{d:"M11 3 8 9l4 13 4-13-3-6",key:"1fcu3u"}],["path",{d:"M2 9h20",key:"16fsjt"}]],ue=_("gem",he);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]],ye=_("grid-3x3",ge);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]],ve=_("list",fe),we=[{id:"all",name:"전체",icon:le,gradient:"from-yellow-500 to-amber-600"},{id:"featured",name:"인기",icon:N,gradient:"from-red-500 to-pink-600"},{id:"new",name:"신규",icon:ie,gradient:"from-blue-500 to-cyan-600"},{id:"jackpot",name:"잭팟",icon:H,gradient:"from-purple-500 to-purple-600"},{id:"bonus",name:"보너스",icon:ue,gradient:"from-green-500 to-emerald-600"},{id:"high-rtp",name:"고수익",icon:pe,gradient:"from-orange-500 to-red-600"}];function $e({user:m,onRouteChange:be}){const[d,V]=r.useState("all"),[c,k]=r.useState("all"),[g,S]=r.useState(""),[A,C]=r.useState([]),[B,R]=r.useState([]),[I,h]=r.useState(!1),[i,G]=r.useState("grid"),[y,W]=r.useState("featured"),[Z,M]=r.useState(0),[O,z]=r.useState(!0),[u,$]=r.useState(null),{sendMessage:P,isConnected:T}=X();r.useEffect(()=>{F()},[]),r.useEffect(()=>{T&&P({type:"subscribe",channel:"slot_status_updates",userId:m.id})},[T,m.id]),r.useEffect(()=>{L()},[d,c,y]);const F=async()=>{try{h(!0);let s=(await w.getProviders()).filter(a=>a.type==="slot");s.length<20&&(s=[{id:1,name:"마이크로게이밍",type:"slot",status:"active"},{id:17,name:"플레이앤고",type:"slot",status:"active"},{id:20,name:"CQ9 게이밍",type:"slot",status:"active"},{id:21,name:"제네시스 게이밍",type:"slot",status:"active"},{id:22,name:"하바네로",type:"slot",status:"active"},{id:23,name:"게임아트",type:"slot",status:"active"},{id:27,name:"플레이텍",type:"slot",status:"active"},{id:38,name:"블루프린트",type:"slot",status:"active"},{id:39,name:"부운고",type:"slot",status:"active"},{id:40,name:"드라군소프트",type:"slot",status:"active"},{id:41,name:"엘크 스튜디오",type:"slot",status:"active"},{id:47,name:"드림테크",type:"slot",status:"active"},{id:51,name:"칼람바 게임즈",type:"slot",status:"active"},{id:52,name:"모빌롯",type:"slot",status:"active"},{id:53,name:"노리밋 시티",type:"slot",status:"active"},{id:55,name:"OMI 게이밍",type:"slot",status:"active"},{id:56,name:"원터치",type:"slot",status:"active"},{id:59,name:"플레이슨",type:"slot",status:"active"},{id:60,name:"푸쉬 게이밍",type:"slot",status:"active"},{id:61,name:"퀵스핀",type:"slot",status:"active"},{id:62,name:"RTG 슬롯",type:"slot",status:"active"},{id:63,name:"리볼버 게이밍",type:"slot",status:"active"},{id:65,name:"슬롯밀",type:"slot",status:"active"},{id:66,name:"스피어헤드",type:"slot",status:"active"},{id:70,name:"썬더킥",type:"slot",status:"active"},{id:72,name:"우후 게임즈",type:"slot",status:"active"},{id:74,name:"릴렉스 게이밍",type:"slot",status:"active"},{id:75,name:"넷엔트",type:"slot",status:"active"},{id:76,name:"레드타이거",type:"slot",status:"active"},{id:87,name:"PG소프트",type:"slot",status:"active"},{id:88,name:"플레이스타",type:"slot",status:"active"},{id:90,name:"빅타임게이밍",type:"slot",status:"active"},{id:300,name:"프라그마틱 플레이",type:"slot",status:"active"}]),R(s),await L()}catch(t){console.error("초기 데이터 로드 실패:",t),n.error("데이터를 불러오는데 실패했습니다.")}finally{h(!1)}},L=async()=>{try{h(!0),M(0),z(!0);let t;try{t=await w.getUserVisibleGames(m.id,"slot",d!=="all"?parseInt(d):void 0,void 0,100,0)}catch{let l=Q.from("games").select(`
            id,
            provider_id,
            name,
            type,
            status,
            image_url,
            demo_available,
            is_featured,
            priority,
            rtp,
            play_count,
            created_at,
            updated_at,
            game_providers!inner(
              id,
              name,
              type
            )
          `).eq("type","slot").eq("status","visible").eq("game_providers.status","active");d!=="all"&&(l=l.eq("provider_id",parseInt(d)));const{data:p,error:D}=await l.order("priority",{ascending:!1}).limit(100);if(D)throw D;t=p?.map(o=>({game_id:o.id,provider_id:o.provider_id,provider_name:o.game_providers.name,game_name:o.name,game_type:o.type,image_url:o.image_url,is_featured:o.is_featured,status:o.status,priority:o.priority||0,rtp:o.rtp}))||[]}let s=[...t];if(c==="featured")s=s.filter(a=>a.is_featured);else if(c==="new")s=s.sort((a,l)=>l.game_id-a.game_id).slice(0,50);else if(c==="jackpot"){const a=["jackpot","mega","major","grand","잭팟","메가"];s=s.filter(l=>a.some(p=>l.game_name.toLowerCase().includes(p)))}else if(c==="bonus"){const a=["bonus","free","spin","보너스","프리"];s=s.filter(l=>a.some(p=>l.game_name.toLowerCase().includes(p)))}else c==="high-rtp"&&(s=s.filter(a=>a.rtp&&a.rtp>=96));y==="featured"?s.sort((a,l)=>a.is_featured&&!l.is_featured?-1:!a.is_featured&&l.is_featured?1:l.priority-a.priority):y==="name"?s.sort((a,l)=>a.game_name.localeCompare(l.game_name)):y==="rtp"&&s.sort((a,l)=>(l.rtp||0)-(a.rtp||0)),C(s)}catch(t){console.error("슬롯 게임 로드 실패:",t),n.error("슬롯 게임을 불러오는데 실패했습니다.")}finally{h(!1)}},J=async t=>{if(u!==t.game_id){$(t.game_id);try{console.log("🎰 슬롯 게임 실행 시작:",{userId:m.id,gameId:t.game_id,gameName:t.game_name});const s=await w.generateGameLaunchUrl(m.id,t.game_id);if(console.log("🎰 슬롯 게임 실행 결과:",s),s.success&&s.launchUrl){const a=s.sessionId;console.log("🎰 슬롯 게임 sessionId 확인:",{sessionId:a,result:s});const l=window.open(s.launchUrl,"_blank","width=1400,height=900,scrollbars=yes,resizable=yes");l?(n.success(`${t.game_name} 슬롯을 시작했습니다!`),P({type:"slot_started",userId:m.id,gameId:t.game_id,providerName:t.provider_name,sessionId:a,timestamp:new Date().toISOString()}),a&&setTimeout(()=>{const p=setInterval(()=>{l.closed&&(clearInterval(p),console.log("🎰 슬롯 게임 창 종료 감지"),setTimeout(()=>{a&&typeof a=="number"?window.syncBalanceAfterGame?.(a):console.warn("⚠️ 잔고 동기화 실패, sessionId가 유효하지 않음:",a)},3e3))},2e3)},1e4)):(n.error("팝업이 차단되었습니다. 팝업 허용 후 다시 시도해주세요."),a&&typeof a=="number"?window.endGameSession?.(a):console.warn("⚠️ 게임 실행 실패, 하지만 sessionId가 없음:",a))}else n.dismiss(`game-loading-${t.game_id}`),console.error("❌ 슬롯 게임 실행 실패:",s.error),n.error(`슬롯 시작 실패: ${s.error||"알 수 없는 오류가 발생했습니다."}`)}catch(s){n.dismiss(`game-loading-${t.game_id}`),console.error("❌ 슬롯 실행 예외 발생:",s),n.error(`슬롯 시작 중 오류: ${s instanceof Error?s.message:"시스템 오류가 발생했습니다."}`)}finally{$(null)}}},K=t=>t.image_url&&t.image_url.trim()&&t.image_url!=="null"?t.image_url:null,f=A.filter(t=>t.game_name.toLowerCase().includes(g.toLowerCase())||t.provider_name.toLowerCase().includes(g.toLowerCase()));return e.jsxs("div",{className:"relative min-h-screen overflow-x-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:{backgroundImage:"linear-gradient(rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0.85)), url('https://images.unsplash.com/photo-1701374930170-47ea6a246c0b?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxzbG90JTIwbWFjaGluZSUyMGNhc2lubyUyMG5lb258ZW58MXx8fHwxNzU5NzIwMzcyfDA&ixlib=rb-4.1.0&q=80&w=1080&utm_source=figma&utm_medium=referral')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"}}),e.jsxs("div",{className:"relative z-10 space-y-8 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx(b,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"}),e.jsx("h1",{className:"text-6xl lg:text-7xl font-bold gold-text neon-glow",children:"VIP 슬롯 머신"}),e.jsx(b,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"})]}),e.jsx("p",{className:"text-3xl text-yellow-100 tracking-wide",children:"최고 수익률과 메가 잭팟이 기다리는 프리미엄 슬롯"}),e.jsxs("div",{className:"flex items-center justify-center gap-6 text-yellow-300/80 text-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),e.jsx("span",{children:"높은 RTP"})]}),e.jsx("div",{className:"w-px h-6 bg-yellow-600/50"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-5 h-5"}),e.jsx("span",{children:"메가 잭팟"})]}),e.jsx("div",{className:"w-px h-6 bg-yellow-600/50"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-5 h-5"}),e.jsx("span",{children:"즉시 시작"})]})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-5 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-xl",children:[e.jsx(me,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-yellow-400"}),e.jsx(Y,{type:"text",placeholder:"슬롯 검색...",value:g,onChange:t=>S(t.target.value),className:"pl-12 h-14 text-lg bg-black/50 border-yellow-600/30 text-white placeholder:text-yellow-200/50 focus:border-yellow-500"})]}),e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsxs(ee,{value:y,onValueChange:W,children:[e.jsx(te,{className:"w-40 h-14 text-lg bg-black/50 border-yellow-600/30 text-white",children:e.jsx(se,{})}),e.jsxs(ae,{className:"bg-slate-800 border-slate-700",children:[e.jsx(j,{value:"featured",children:"추천순"}),e.jsx(j,{value:"name",children:"이름순"}),e.jsx(j,{value:"rtp",children:"수익률순"})]})]}),e.jsxs("div",{className:"flex gap-2 bg-black/50 border border-yellow-600/30 rounded-lg p-2",children:[e.jsx(x,{variant:i==="grid"?"default":"ghost",size:"sm",onClick:()=>G("grid"),className:`w-12 h-12 ${i==="grid"?"bg-yellow-600 text-black":"text-yellow-300"}`,children:e.jsx(ye,{className:"w-6 h-6"})}),e.jsx(x,{variant:i==="list"?"default":"ghost",size:"sm",onClick:()=>G("list"),className:`w-12 h-12 ${i==="list"?"bg-yellow-600 text-black":"text-yellow-300"}`,children:e.jsx(ve,{className:"w-6 h-6"})})]})]})]}),e.jsx("div",{className:"flex flex-wrap gap-3 justify-center",children:we.map(t=>{const s=t.icon,a=c===t.id;return e.jsxs(x,{variant:"ghost",onClick:()=>k(t.id),className:`
                  relative px-6 py-4 text-lg font-bold transition-all duration-300
                  ${a?`bg-gradient-to-r ${t.gradient} text-white shadow-lg shadow-yellow-500/50 scale-105`:"text-yellow-200/80 hover:text-yellow-100 hover:bg-yellow-900/20 border border-transparent hover:border-yellow-600/30"}
                `,children:[e.jsx(s,{className:"w-5 h-5 mr-2"}),t.name,a&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-300 to-transparent"})]},t.id)})}),e.jsx("div",{className:"luxury-card rounded-3xl p-8 border-2 border-yellow-600/20",children:e.jsx(oe,{selectedProvider:d,onProviderChange:V,gameType:"slot",providers:B})}),I?e.jsx("div",{className:`grid gap-6 ${i==="grid"?"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-1"}`,children:Array.from({length:8}).map((t,s)=>e.jsxs(U,{className:"luxury-card animate-pulse border-yellow-600/20",children:[e.jsx("div",{className:`${i==="grid"?"aspect-[4/3]":"aspect-[16/9]"} bg-gradient-to-br from-slate-700 to-slate-800 rounded-t-xl`}),e.jsxs(re,{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gradient-to-r from-yellow-600/20 to-yellow-400/20 rounded"}),e.jsx("div",{className:"h-4 bg-gradient-to-r from-yellow-600/20 to-yellow-400/20 rounded w-2/3"})]})]},s))}):e.jsx("div",{className:`grid gap-6 ${i==="grid"?"grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4":"grid-cols-1"}`,children:f.map(t=>e.jsxs(U,{className:`luxury-card group cursor-pointer border-2 border-yellow-600/20 hover:border-yellow-500/60 transition-all game-card-hover overflow-hidden ${u===t.game_id?"opacity-50":""} ${i==="list"?"flex flex-row":""}`,onClick:()=>J(t),children:[e.jsxs("div",{className:`relative overflow-hidden ${i==="grid"?"aspect-[4/3]":"w-48 aspect-[4/3] flex-shrink-0"}`,children:[e.jsx(ne,{src:K(t),alt:t.game_name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"}),t.is_featured&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(v,{className:"vip-badge text-white border-0",children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),"HOT"]})}),t.rtp&&e.jsx("div",{className:"absolute top-3 left-3",children:e.jsxs(v,{className:"bg-green-600 text-white border-0",children:["RTP ",t.rtp,"%"]})}),i==="grid"&&e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all duration-300 flex items-center justify-center",children:u===t.game_id?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-white",children:[e.jsx(q,{className:"w-8 h-8 animate-spin"}),e.jsx("span",{className:"text-sm font-semibold",children:"시작 중..."})]}):e.jsxs(x,{size:"lg",className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 text-black font-bold shadow-lg shadow-yellow-500/40",disabled:u===t.game_id,children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"플레이"]})}),i==="grid"&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 text-white",children:[e.jsx("h3",{className:"font-bold text-lg mb-1 truncate neon-glow",children:t.game_name}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-yellow-300 truncate",children:t.provider_name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-400",children:[e.jsx(xe,{className:"w-3 h-3"}),e.jsx("span",{children:"24H"})]})]})]})]}),i==="list"&&e.jsxs("div",{className:"flex-1 p-6 flex items-center justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-yellow-100 mb-2 neon-glow",children:t.game_name}),e.jsx("p",{className:"text-yellow-300 mb-3",children:t.provider_name}),e.jsxs("div",{className:"flex gap-2",children:[t.is_featured&&e.jsxs(v,{className:"vip-badge text-white",children:[e.jsx(N,{className:"w-3 h-3 mr-1"}),"인기"]}),t.rtp&&e.jsxs(v,{className:"bg-green-600 text-white",children:["RTP ",t.rtp,"%"]})]})]}),e.jsx("div",{className:"flex-shrink-0",children:u===t.game_id?e.jsxs("div",{className:"flex items-center gap-2 text-yellow-400",children:[e.jsx(q,{className:"w-6 h-6 animate-spin"}),e.jsx("span",{children:"시작 중..."})]}):e.jsxs(x,{size:"lg",className:"bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 text-black font-bold shadow-lg",disabled:u===t.game_id,children:[e.jsx(E,{className:"w-5 h-5 mr-2"}),"플레이"]})})]})]},t.game_id))}),f.length===0&&!I&&e.jsxs("div",{className:"text-center py-16 luxury-card rounded-2xl border-2 border-yellow-600/20",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-gradient-to-br from-yellow-500/20 to-amber-600/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(b,{className:"w-12 h-12 text-yellow-400"})}),e.jsx("h3",{className:"text-2xl font-bold gold-text mb-2",children:"슬롯을 찾을 수 없습니다"}),e.jsx("p",{className:"text-yellow-200/80 text-lg mb-4",children:g?`"${g}"에 대한 검색 결과가 없습니다.`:c!=="all"?"선택한 카테고리의 슬롯이 없습니다.":"사용 가능한 슬롯 게임이 없습니다."}),e.jsx(x,{variant:"outline",onClick:()=>{S(""),k("all")},className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20",children:"전체 슬롯 보기"})]}),O&&f.length>0&&f.length>=100&&e.jsx("div",{className:"text-center",children:e.jsx(x,{variant:"outline",size:"lg",onClick:async()=>{const t=Z+1;M(t);try{h(!0);const s=await w.getUserVisibleGames(m.id,"slot",d!=="all"?parseInt(d):void 0,void 0,100,t*100);s.length<100&&z(!1),C(a=>[...a,...s])}catch(s){console.error("추가 게임 로드 실패:",s),n.error("더 많은 게임을 불러오는데 실패했습니다.")}finally{h(!1)}},className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20 px-8 py-3",children:"더 많은 슬롯 보기"})})]})]})}export{$e as UserSlot};

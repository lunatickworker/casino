import{r as a,am as T,aY as me,j as t,al as be,ac as L,ap as U,an as P,aZ as j,a_ as pe,a$ as xe,a6 as ee,s as X,R as k,A as G,w as Se,aA as J,C as ve,a as ge,b as we,d as Ce,e as je,G as Pe,a3 as ye,B as V}from"./index-DlK2WquE.js";import{M as z}from"./MetricCard-C4Jq9Aol.js";import{T as K}from"./triangle-alert-Dbc6QA6H.js";import{C as Z}from"./clock-BsgtTRc8.js";function Ee(e,n){return a.useReducer((r,c)=>n[r][c]??r,e)}var F="ScrollArea",[te]=be(F),[Re,S]=te(F),re=a.forwardRef((e,n)=>{const{__scopeScrollArea:r,type:c="hover",dir:o,scrollHideDelay:l=600,...i}=e,[d,u]=a.useState(null),[m,f]=a.useState(null),[s,h]=a.useState(null),[b,x]=a.useState(null),[C,N]=a.useState(null),[w,y]=a.useState(0),[A,D]=a.useState(0),[H,_]=a.useState(!1),[W,O]=a.useState(!1),p=T(n,E=>u(E)),v=me(o);return t.jsx(Re,{scope:r,type:c,dir:v,scrollHideDelay:l,scrollArea:d,viewport:m,onViewportChange:f,content:s,onContentChange:h,scrollbarX:b,onScrollbarXChange:x,scrollbarXEnabled:H,onScrollbarXEnabledChange:_,scrollbarY:C,onScrollbarYChange:N,scrollbarYEnabled:W,onScrollbarYEnabledChange:O,onCornerWidthChange:y,onCornerHeightChange:D,children:t.jsx(L.div,{dir:v,...i,ref:p,style:{position:"relative","--radix-scroll-area-corner-width":w+"px","--radix-scroll-area-corner-height":A+"px",...e.style}})})});re.displayName=F;var oe="ScrollAreaViewport",ne=a.forwardRef((e,n)=>{const{__scopeScrollArea:r,children:c,nonce:o,...l}=e,i=S(oe,r),d=a.useRef(null),u=T(n,d,i.onViewportChange);return t.jsxs(t.Fragment,{children:[t.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:o}),t.jsx(L.div,{"data-radix-scroll-area-viewport":"",...l,ref:u,style:{overflowX:i.scrollbarXEnabled?"scroll":"hidden",overflowY:i.scrollbarYEnabled?"scroll":"hidden",...e.style},children:t.jsx("div",{ref:i.onContentChange,style:{minWidth:"100%",display:"table"},children:c})})]})});ne.displayName=oe;var g="ScrollAreaScrollbar",se=a.forwardRef((e,n)=>{const{forceMount:r,...c}=e,o=S(g,e.__scopeScrollArea),{onScrollbarXEnabledChange:l,onScrollbarYEnabledChange:i}=o,d=e.orientation==="horizontal";return a.useEffect(()=>(d?l(!0):i(!0),()=>{d?l(!1):i(!1)}),[d,l,i]),o.type==="hover"?t.jsx(Te,{...c,ref:n,forceMount:r}):o.type==="scroll"?t.jsx(Ne,{...c,ref:n,forceMount:r}):o.type==="auto"?t.jsx(le,{...c,ref:n,forceMount:r}):o.type==="always"?t.jsx($,{...c,ref:n}):null});se.displayName=g;var Te=a.forwardRef((e,n)=>{const{forceMount:r,...c}=e,o=S(g,e.__scopeScrollArea),[l,i]=a.useState(!1);return a.useEffect(()=>{const d=o.scrollArea;let u=0;if(d){const m=()=>{window.clearTimeout(u),i(!0)},f=()=>{u=window.setTimeout(()=>i(!1),o.scrollHideDelay)};return d.addEventListener("pointerenter",m),d.addEventListener("pointerleave",f),()=>{window.clearTimeout(u),d.removeEventListener("pointerenter",m),d.removeEventListener("pointerleave",f)}}},[o.scrollArea,o.scrollHideDelay]),t.jsx(U,{present:r||l,children:t.jsx(le,{"data-state":l?"visible":"hidden",...c,ref:n})})}),Ne=a.forwardRef((e,n)=>{const{forceMount:r,...c}=e,o=S(g,e.__scopeScrollArea),l=e.orientation==="horizontal",i=B(()=>u("SCROLL_END"),100),[d,u]=Ee("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return a.useEffect(()=>{if(d==="idle"){const m=window.setTimeout(()=>u("HIDE"),o.scrollHideDelay);return()=>window.clearTimeout(m)}},[d,o.scrollHideDelay,u]),a.useEffect(()=>{const m=o.viewport,f=l?"scrollLeft":"scrollTop";if(m){let s=m[f];const h=()=>{const b=m[f];s!==b&&(u("SCROLL"),i()),s=b};return m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[o.viewport,l,u,i]),t.jsx(U,{present:r||d!=="hidden",children:t.jsx($,{"data-state":d==="hidden"?"hidden":"visible",...c,ref:n,onPointerEnter:P(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:P(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),le=a.forwardRef((e,n)=>{const r=S(g,e.__scopeScrollArea),{forceMount:c,...o}=e,[l,i]=a.useState(!1),d=e.orientation==="horizontal",u=B(()=>{if(r.viewport){const m=r.viewport.offsetWidth<r.viewport.scrollWidth,f=r.viewport.offsetHeight<r.viewport.scrollHeight;i(d?m:f)}},10);return R(r.viewport,u),R(r.content,u),t.jsx(U,{present:c||l,children:t.jsx($,{"data-state":l?"visible":"hidden",...o,ref:n})})}),$=a.forwardRef((e,n)=>{const{orientation:r="vertical",...c}=e,o=S(g,e.__scopeScrollArea),l=a.useRef(null),i=a.useRef(0),[d,u]=a.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=ue(d.viewport,d.content),f={...c,sizes:d,onSizesChange:u,hasThumb:m>0&&m<1,onThumbChange:h=>l.current=h,onThumbPointerUp:()=>i.current=0,onThumbPointerDown:h=>i.current=h};function s(h,b){return We(h,i.current,d,b)}return r==="horizontal"?t.jsx(Ae,{...f,ref:n,onThumbPositionChange:()=>{if(o.viewport&&l.current){const h=o.viewport.scrollLeft,b=Q(h,d,o.dir);l.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollLeft=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollLeft=s(h,o.dir))}}):r==="vertical"?t.jsx(_e,{...f,ref:n,onThumbPositionChange:()=>{if(o.viewport&&l.current){const h=o.viewport.scrollTop,b=Q(h,d);l.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:h=>{o.viewport&&(o.viewport.scrollTop=h)},onDragScroll:h=>{o.viewport&&(o.viewport.scrollTop=s(h))}}):null}),Ae=a.forwardRef((e,n)=>{const{sizes:r,onSizesChange:c,...o}=e,l=S(g,e.__scopeScrollArea),[i,d]=a.useState(),u=a.useRef(null),m=T(n,u,l.onScrollbarXChange);return a.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),t.jsx(ce,{"data-orientation":"horizontal",...o,ref:m,sizes:r,style:{bottom:0,left:l.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:l.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":Y(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.x),onDragScroll:f=>e.onDragScroll(f.x),onWheelScroll:(f,s)=>{if(l.viewport){const h=l.viewport.scrollLeft+f.deltaX;e.onWheelScroll(h),fe(h,s)&&f.preventDefault()}},onResize:()=>{u.current&&l.viewport&&i&&c({content:l.viewport.scrollWidth,viewport:l.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:M(i.paddingLeft),paddingEnd:M(i.paddingRight)}})}})}),_e=a.forwardRef((e,n)=>{const{sizes:r,onSizesChange:c,...o}=e,l=S(g,e.__scopeScrollArea),[i,d]=a.useState(),u=a.useRef(null),m=T(n,u,l.onScrollbarYChange);return a.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),t.jsx(ce,{"data-orientation":"vertical",...o,ref:m,sizes:r,style:{top:0,right:l.dir==="ltr"?0:void 0,left:l.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":Y(r)+"px",...e.style},onThumbPointerDown:f=>e.onThumbPointerDown(f.y),onDragScroll:f=>e.onDragScroll(f.y),onWheelScroll:(f,s)=>{if(l.viewport){const h=l.viewport.scrollTop+f.deltaY;e.onWheelScroll(h),fe(h,s)&&f.preventDefault()}},onResize:()=>{u.current&&l.viewport&&i&&c({content:l.viewport.scrollHeight,viewport:l.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:M(i.paddingTop),paddingEnd:M(i.paddingBottom)}})}})}),[Le,ae]=te(g),ce=a.forwardRef((e,n)=>{const{__scopeScrollArea:r,sizes:c,hasThumb:o,onThumbChange:l,onThumbPointerUp:i,onThumbPointerDown:d,onThumbPositionChange:u,onDragScroll:m,onWheelScroll:f,onResize:s,...h}=e,b=S(g,r),[x,C]=a.useState(null),N=T(n,p=>C(p)),w=a.useRef(null),y=a.useRef(""),A=b.viewport,D=c.content-c.viewport,H=j(f),_=j(u),W=B(s,10);function O(p){if(w.current){const v=p.clientX-w.current.left,E=p.clientY-w.current.top;m({x:v,y:E})}}return a.useEffect(()=>{const p=v=>{const E=v.target;x?.contains(E)&&H(v,D)};return document.addEventListener("wheel",p,{passive:!1}),()=>document.removeEventListener("wheel",p,{passive:!1})},[A,x,D,H]),a.useEffect(_,[c,_]),R(x,W),R(b.content,W),t.jsx(Le,{scope:r,scrollbar:x,hasThumb:o,onThumbChange:j(l),onThumbPointerUp:j(i),onThumbPositionChange:_,onThumbPointerDown:j(d),children:t.jsx(L.div,{...h,ref:N,style:{position:"absolute",...h.style},onPointerDown:P(e.onPointerDown,p=>{p.button===0&&(p.target.setPointerCapture(p.pointerId),w.current=x.getBoundingClientRect(),y.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),O(p))}),onPointerMove:P(e.onPointerMove,O),onPointerUp:P(e.onPointerUp,p=>{const v=p.target;v.hasPointerCapture(p.pointerId)&&v.releasePointerCapture(p.pointerId),document.body.style.webkitUserSelect=y.current,b.viewport&&(b.viewport.style.scrollBehavior=""),w.current=null})})})}),I="ScrollAreaThumb",ie=a.forwardRef((e,n)=>{const{forceMount:r,...c}=e,o=ae(I,e.__scopeScrollArea);return t.jsx(U,{present:r||o.hasThumb,children:t.jsx(De,{ref:n,...c})})}),De=a.forwardRef((e,n)=>{const{__scopeScrollArea:r,style:c,...o}=e,l=S(I,r),i=ae(I,r),{onThumbPositionChange:d}=i,u=T(n,s=>i.onThumbChange(s)),m=a.useRef(void 0),f=B(()=>{m.current&&(m.current(),m.current=void 0)},100);return a.useEffect(()=>{const s=l.viewport;if(s){const h=()=>{if(f(),!m.current){const b=Oe(s,d);m.current=b,d()}};return d(),s.addEventListener("scroll",h),()=>s.removeEventListener("scroll",h)}},[l.viewport,f,d]),t.jsx(L.div,{"data-state":i.hasThumb?"visible":"hidden",...o,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...c},onPointerDownCapture:P(e.onPointerDownCapture,s=>{const b=s.target.getBoundingClientRect(),x=s.clientX-b.left,C=s.clientY-b.top;i.onThumbPointerDown({x,y:C})}),onPointerUp:P(e.onPointerUp,i.onThumbPointerUp)})});ie.displayName=I;var q="ScrollAreaCorner",de=a.forwardRef((e,n)=>{const r=S(q,e.__scopeScrollArea),c=!!(r.scrollbarX&&r.scrollbarY);return r.type!=="scroll"&&c?t.jsx(He,{...e,ref:n}):null});de.displayName=q;var He=a.forwardRef((e,n)=>{const{__scopeScrollArea:r,...c}=e,o=S(q,r),[l,i]=a.useState(0),[d,u]=a.useState(0),m=!!(l&&d);return R(o.scrollbarX,()=>{const f=o.scrollbarX?.offsetHeight||0;o.onCornerHeightChange(f),u(f)}),R(o.scrollbarY,()=>{const f=o.scrollbarY?.offsetWidth||0;o.onCornerWidthChange(f),i(f)}),m?t.jsx(L.div,{...c,ref:n,style:{width:l,height:d,position:"absolute",right:o.dir==="ltr"?0:void 0,left:o.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function M(e){return e?parseInt(e,10):0}function ue(e,n){const r=e/n;return isNaN(r)?0:r}function Y(e){const n=ue(e.viewport,e.content),r=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,c=(e.scrollbar.size-r)*n;return Math.max(c,18)}function We(e,n,r,c="ltr"){const o=Y(r),l=o/2,i=n||l,d=o-i,u=r.scrollbar.paddingStart+i,m=r.scrollbar.size-r.scrollbar.paddingEnd-d,f=r.content-r.viewport,s=c==="ltr"?[0,f]:[f*-1,0];return he([u,m],s)(e)}function Q(e,n,r="ltr"){const c=Y(n),o=n.scrollbar.paddingStart+n.scrollbar.paddingEnd,l=n.scrollbar.size-o,i=n.content-n.viewport,d=l-c,u=r==="ltr"?[0,i]:[i*-1,0],m=xe(e,u);return he([0,i],[0,d])(m)}function he(e,n){return r=>{if(e[0]===e[1]||n[0]===n[1])return n[0];const c=(n[1]-n[0])/(e[1]-e[0]);return n[0]+c*(r-e[0])}}function fe(e,n){return e>0&&e<n}var Oe=(e,n=()=>{})=>{let r={left:e.scrollLeft,top:e.scrollTop},c=0;return(function o(){const l={left:e.scrollLeft,top:e.scrollTop},i=r.left!==l.left,d=r.top!==l.top;(i||d)&&n(),r=l,c=window.requestAnimationFrame(o)})(),()=>window.cancelAnimationFrame(c)};function B(e,n){const r=j(e),c=a.useRef(0);return a.useEffect(()=>()=>window.clearTimeout(c.current),[]),a.useCallback(()=>{window.clearTimeout(c.current),c.current=window.setTimeout(r,n)},[r,n])}function R(e,n){const r=j(n);pe(()=>{let c=0;if(e){const o=new ResizeObserver(()=>{cancelAnimationFrame(c),c=window.requestAnimationFrame(r)});return o.observe(e),()=>{window.cancelAnimationFrame(c),o.unobserve(e)}}},[e,r])}var ze=re,Ie=ne,Me=de;function Ue({className:e,children:n,...r}){return t.jsxs(ze,{"data-slot":"scroll-area",className:ee("relative",e),...r,children:[t.jsx(Ie,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:n}),t.jsx(Ye,{}),t.jsx(Me,{})]})}function Ye({className:e,orientation:n="vertical",...r}){return t.jsx(se,{"data-slot":"scroll-area-scrollbar",orientation:n,className:ee("flex touch-none p-px transition-colors select-none",n==="vertical"&&"h-full w-2.5 border-l border-l-transparent",n==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",e),...r,children:t.jsx(ie,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function $e(){const[e,n]=a.useState([]),[r,c]=a.useState(!0),[o,l]=a.useState({total:0,success:0,error:0,lastSync:null}),i=async()=>{try{const{data:s,error:h}=await X.from("api_sync_logs").select("*").order("created_at",{ascending:!1}).limit(50);if(h)throw h;n(s||[]),s&&s.length>0&&l({total:s.length,success:s.filter(b=>b.status==="success").length,error:s.filter(b=>b.status==="error").length,lastSync:s[0].created_at})}catch(s){console.error("❌ 동기화 로그 조회 오류:",s)}finally{c(!1)}},d=s=>{const h=new Date(s),b=new Date(h.getTime()+540*60*1e3),x=b.getUTCFullYear(),C=String(b.getUTCMonth()+1).padStart(2,"0"),N=String(b.getUTCDate()).padStart(2,"0"),w=String(b.getUTCHours()).padStart(2,"0"),y=String(b.getUTCMinutes()).padStart(2,"0"),A=String(b.getUTCSeconds()).padStart(2,"0");return`${x}년${C}월${N}일 ${w}:${y}:${A}`};a.useEffect(()=>{i()},[]),a.useEffect(()=>{const s=X.channel("api_sync_logs_changes").on("postgres_changes",{event:"*",schema:"public",table:"api_sync_logs"},h=>{console.log("🔄 새로운 동기화 로그:",h),i()}).subscribe();return()=>{X.removeChannel(s)}},[]);const u=s=>{switch(s){case"success":return t.jsx(J,{className:"h-4 w-4 text-green-500"});case"error":return t.jsx(K,{className:"h-4 w-4 text-red-500"});default:return t.jsx(Z,{className:"h-4 w-4 text-gray-500"})}},m=s=>{switch(s){case"success":return t.jsx(V,{className:"bg-green-600",children:"성공"});case"error":return t.jsx(V,{variant:"destructive",children:"오류"});default:return t.jsx(V,{variant:"outline",children:"대기"})}},f=s=>{switch(s){case"balance":return{icon:t.jsx(ye,{className:"h-4 w-4 text-blue-400"}),label:"잔고 동기화"};case"game_history":return{icon:t.jsx(Pe,{className:"h-4 w-4 text-green-400"}),label:"게임 기록"};default:return{icon:t.jsx(G,{className:"h-4 w-4 text-purple-400"}),label:s}}};return r?t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx(k,{className:"h-6 w-6 animate-spin text-blue-400"})}):t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{children:[t.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[t.jsx(G,{className:"h-6 w-6"}),"자동 동기화 모니터"]}),t.jsx("p",{className:"text-slate-400 mt-1",children:"실시간 API 동기화 상태를 확인합니다"})]}),t.jsxs(Se,{onClick:i,className:"bg-slate-700 hover:bg-slate-600",children:[t.jsx(k,{className:"h-4 w-4 mr-2"}),"새로고침"]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[t.jsx(z,{title:"총 동기화",value:o.total.toLocaleString(),subtitle:"전체 동기화",icon:k,color:"blue"}),t.jsx(z,{title:"성공",value:o.success.toLocaleString(),subtitle:"성공한 동기화",icon:J,color:"green"}),t.jsx(z,{title:"오류",value:o.error.toLocaleString(),subtitle:"실패한 동기화",icon:K,color:"red"}),t.jsx(z,{title:"마지막 동기화",value:o.lastSync?d(o.lastSync):"-",subtitle:"최근 실행",icon:Z,color:"purple"})]}),t.jsxs(ve,{className:"bg-slate-800/50 border-slate-700",children:[t.jsxs(ge,{children:[t.jsx(we,{className:"text-white",children:"동기화 로그"}),t.jsx(Ce,{className:"text-slate-400",children:"최근 50개의 동기화 기록 (실시간 업데이트)"})]}),t.jsx(je,{children:t.jsx(Ue,{className:"h-[600px] pr-4",children:t.jsx("div",{className:"space-y-3",children:e.length===0?t.jsx("div",{className:"text-center py-8 text-slate-400",children:"동기화 로그가 없습니다"}):e.map(s=>{const h=f(s.sync_type);return t.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg border border-slate-600 hover:bg-slate-700/50 transition-colors",children:[t.jsxs("div",{className:"flex items-start justify-between mb-2",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[h.icon,t.jsx("span",{className:"text-white font-medium",children:h.label}),m(s.status)]}),t.jsxs("div",{className:"flex items-center gap-2",children:[u(s.status),t.jsxs("span",{className:"text-slate-400 text-sm font-mono",children:[s.sync_duration_ms,"ms"]})]})]}),t.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"OPCODE:"}),t.jsx("span",{className:"text-white ml-2 font-mono",children:s.opcode})]}),t.jsxs("div",{children:[t.jsx("span",{className:"text-slate-400",children:"처리 건수:"}),t.jsxs("span",{className:"text-white ml-2",children:[s.records_processed,"건"]})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-slate-400",children:"시간:"}),t.jsx("span",{className:"text-white ml-2 font-mono text-xs",children:d(s.created_at)})]}),t.jsxs("div",{className:"col-span-2",children:[t.jsx("span",{className:"text-slate-400",children:"API:"}),t.jsx("span",{className:"text-white ml-2 font-mono text-xs",children:s.api_endpoint})]})]}),s.error_message&&t.jsx("div",{className:"mt-2 p-2 bg-red-900/20 border border-red-500/30 rounded",children:t.jsxs("div",{className:"text-red-400 text-sm",children:["오류: ",s.error_message]})}),s.response_data&&t.jsxs("details",{className:"mt-2",children:[t.jsx("summary",{className:"text-slate-400 text-xs cursor-pointer hover:text-white",children:"응답 데이터 보기"}),t.jsx("pre",{className:"mt-2 p-2 bg-slate-900 rounded text-xs text-slate-300 overflow-x-auto",children:JSON.stringify(s.response_data,null,2)})]})]},s.id)})})})})]})]})}export{$e as AutoSyncMonitor};

# GMS 통합 관리 시스템 - 메뉴 구조 및 기능 정리

## 🏗️ 시스템 아키텍처 개요

### 핵심 구조
- **7단계 권한 체계**: 시스템관리자 → 대본사 → 본사 → 부본사 → 총판 → 매장 → 관리자
- **대본사-OPCODE 매칭**: 각 대본사는 외부 API OPCODE와 1:1 대응하여 독립적인 API 연동
- **실시간 양방향 연동**: 외부 API와 시스템 간 30초 주기 자동 동기화
- 상단 헤더 표시(보유금/일일입금/일일출금/온라인/가입승인요청(실시간알람)/고객센터(실시간알람)/입금요청(실시간통보및알람)/출금요청(실시간통보및알람))

**관련용어:**
온라인: 본인조직(파트너) 접속인원표시
헤더 제일 왼쪽은 관리자로그인 계정의 닉네임표시(클릭하면 사용자페이지 이동)

## 📊 관리자 페이지 메뉴 구조

### 1. 대시보드 (Dashboard)
**접근 권한:** 모든 파트너 등급 (시스템관리자, 대본사, 본사, 부본사, 총판, 매장)
**메뉴:**
실시간 현황

**🔑 핵심 기능
-시스템관리자는 모든 대본사의 현황파악
-각 파트너는 본인통계와/하부파트너의 통계를 분리 관리
-Websocket를 사용한 실시간 데이터 업데이트
-총회원수 : 전체 사용자가 보유한 금액의 총함
-보유금액 : 대본사들의 총 보유금(시스템 관리자:"시스템잔고" 로 표시) / 대본사의 총 보유금
-순입출금: 입금-출금금액
-일일입금금액: 입금금액
-일일출금금액: 출금금액
-일일입출금금액:입금-출금
-카지노 총베팅금액: 일일 카지노 베팅총액
-슬롯 총 베팅금액 : 일일 슬롯 베팅금액
-전체 베팅금액 : 카지노+슬롯

### 2. 회원 관리 (User Management)
**접근 권한:** 모든 파트너 등급
**메뉴:**
회원관리/블랙회원관리/포인트관리/온리인현황/로그관리

**🔑 핵심 기능
- 실시간 CRUD 기능
- 회원 Creat(아이디생성)만 외부API 연동
- 회원 RUD는 시스템DB에서만 사용(외부API 연동 못함)
- 블랙회원관리: 차단 회원 관리, 블랙리스트 등록/해제 기능
- 포인트 관리: 사용자 포인트 지급/회수, 사용자 포인트를 실제 게임 잔고로 전환, 파트너 보유금안에서 포인트 지급가능
- 온라인 현황: 실시간 접속중이 사용자 ip, 접속시간, 접속위치, 기기정보, 강제 종료 기능
(현재 게임 중인 회원 리스트(상위매장모두보임/아이디/닉네임/게임명/보유금액(클릭하면 게임머니동기화(사용자보유금api 호출))))
- 게임 패터 분석: 사용자게임성향(베팅 스타일, 선호게임) 및 패턴 분석 데이터
- 사용자: 게임을 플레이하는 일반 회원
- 상태: 회원 현재 상태(신청, 승인, 차단(블랙리스트로이동)
- 보유금: 사용자가 보유하고 있는 게임잔고(실시간 업데이트)
- 회원생성항목 -> 아이디/닉네임/비밀번호/은행정보/추천인(입력된 파트너아이디 그룹으로 됨)

### 3. 파트너 관리 (Partner Management)
**접근 권한:**
- 시스템관리자: 모든 파트너 데이터 감시 및 대본사 생성(opcode/secret_key/token/아이디/닉네임/비밀번호), 수정, 삭제
- 대본사: 모든 파트너 생성 및 수정, 삭제
- 본사/부본사/총판/매장: 하위 파트너와 회원 생성, 수정, 삭제
**메뉴:**
대본사관리/파트너 관리(페이지 통합:파트너계층관리(펼치기/숨기기)/파트너입출금관리/파트너별접속현황/파트너대시보드) 

**🔑 핵심 기능
- 대본사 관리**: OPCODE 연동 대본사 생성/수정/삭제, 외부 API 인증정보 설정, 실시간(websocket) 잔고 동기화
- 파트너 계층 관리**: 7단계 계층별 파트너 관리, 권한 설정, 조직도 시각화
- 파트너 입출금 관리**: 파트너 간 자금 이체, 승인 시스템, 거래 내역 조회
- 파트너 성과 대시보드**: 파트너별 수익/손실 현황, 통계 차트, 성과 분석
- 파트너 정보**: 파트너 상세 정보, 상위/하위 조직 관계, 권한 확인
- 파트너별 접속 현황**: 파트너별 관리하는 사용자 접속 통계
- 대본사 생성 시 외부 API OPCODE 입력 필수
- OPCODE별 고유 인증정보(secret_key, token) 관리
- 30초 주기 외부 API 잔고/사용자 데이터 자동 동기화
- 보유금(시스템관리자("시스템 잔고"표시)) vs 외부 API 잔고 실시간 검증
- 파트너: 하부 조직을 관리하고 수익을 분배받는 관리 계정
- OPCODE: 외부 API와 연동되는 대본사별 고유 식별코드
- 계층 구조: 시스템관리자 → 대본사 → 본사 → 부본사 → 총판 → 매장 → 관리자
---

### 4. 정산 및 거래 (Settlement & Transactions)
**접근 권한:**
- 시스템관리자/대본사: 모든 정산 내역 확인
- 본사/부본사/총판/매장: 자신에게 해당하는 정산 내역 확인
**메뉴:**
파트너별 수수료 정산/통합정산/입출금관리(페이지통합 입금신청/출금신청/입출금내역)


**🔑 핵심 기능
- 파트너별 수수료 정산**: 파트너별 카지노/슬롯(롤링/루징) 정산 금액을 일일/주간/월간/지정날짜별 조회 및 처리
- 통합 정산 관리**: 모든 정산 데이터를 통합하여 관리하는 중앙 집중식 정산 시스템
- 입금/출금 관리**: 모든 입금/출금 기록 조회, (관리자 권한 강제 충전/환전 처리(이 기능은 회원관리페이지에도 있어야함))
- 입금 요청 관리**: 사용자 입금 요청 실시간 수신, 승인/거절 처리, 외부 API 연동 입금 처리
- 출금 요청 관리**: 사용자 출금 요청 실시간 수신, 승인/거절 처리, 외부 API 연동 출금 처리

**🔑 핵심 기능 - 실시간 입출금 연동:**
- 사용자 입금 요청 시 즉시 관리자 알림
- 7단계 권한 체계 기반 상위 권한자 잔고 확인 후 승인
- 외부 API 입금/출금 호출 (POST/PUT /api/account/balance)
- 대본사 OPCODE별 개별 API 연동 처리
- 실시간 잔고 동기화 (불일치 감지 알림은 슈퍼관리자(시스템관리자)에게만 알림)
- 롤링 금액 / 루징 금액 표시
- 입출금시 누가했는지 표시

**관련 용어:**
- 총환전관리: 충전, 환전, 강제 충전, 강제 환전 등 모든 입출금 관련 내역 관리
- 충환전금액: 충전 금액에서 환전 금액을 뺀 값
- 롤링: 회원총베팅액x커미션요율(%)              (설정 페이지 수정가능함)          
- 루징(죽장): 회원순손실액(베팅 금액 - 당첨 금액)x커미션요율(%) (설정 페이지에서 수정가능함)    
- 환전 수수료: 환전 금액에 적용되는 수수료                   (설정 페이지에서 수정가능함)       
- OPCODE 동기화: 외부 API와 시스템 잔고(보유금액) 간 실시간 동기화
---

### 5. 게임 관리 (Game Management)
**접근 권한:** 대본사
**메뉴:**
게임리스트관리/베팅내역관리/콜주기

**🔑 핵심 기능
- 게임 내역**: 사용자 게임 플레이 기록(베팅 금액, 시작 보유금액, 처리 시간 등) 상세 조회
- 베팅 내역**: 실시간 베팅 활동 모니터링, 30초 주기 외부 API 베팅 데이터 수집
- 콜주기**: 슈퍼관리자(시스템관리자)에게만 메뉴 보임/기능 개발은 보류  
- 게임 설정**: 카지노 제공사 13개 모든게임/슬롯 제공사 33개에 모든 게임을 리스트 업해서 각 게임마다 노출/비노출/점검중 선택기능(사용자 페이지에 실시간으로 적용) 
- 외부 API 게임 연동:**
- 모든 대본사 OPCODE의 게임 리스트 통합 수집
- 게임별 노출/비노출/점검중 상태 설정
- 관리자 설정 변경 시 사용자 페이지 즉시 반영
- 30초 주기 베팅 내역 자동 수집 (GET /api/game/historyindex)
- 사용자 페이지에서 게임 실행시 OPCODE별 개별 API 호출(사용자 상위파트너의 opcode 확인)

**관련 용어:**
- 배팅금액: 게임에 베팅한 금액
- 게임 상태: 노출(visible)/비노출(hidden)/점검중(maintenance)
- 베팅 수집: 외부 API에서 베팅 데이터를 수집하는 과정
---

### 6. 커뮤니케이션 (Communication)
**접근 권한:**
- 고객 센터: 모든 파트너 등급
- 공지사항: 총판 등급 이상
- 메시지 센터: 매장 등급 이상
**메뉴:**
고객센터/공지사항/메시지센터(쪽지)

**🔑 핵심 기능
- 고객 센터**: 사용자 문의 처리(입금 계좌 문의 등), 상태 관리('접수' → '완료'), 실시간 알림, 사용자에 속한 파트너로 전달
- 공지사항**:  일반 공지 작성/관리, 회원 대상 공지 전달, 읽음 확인, 글작성 편집기 사용, 이미지 업로드(사용자페이지 실시간 연동)
- 메시지 센터**: 관리자-회원 간 실시간 메시지, 읽음 상태 표시, 읽지 않으면 사라지지 않음.
- 실시간 커뮤니케이션
- WebSocket 기반 실시간 메시지 전송/수신
- 메시지 읽음 상태 실시간 동기화
- 새 메시지 도착 시 즉시 알림
- 관리자별 권한에 따른 메시지 범위 제한

**관련 용어:**
- 실시간 메시지: WebSocket 기반 즉시 전송되는 메시지
- 읽음 확인: 메시지 읽음 상태 실시간 동기화

### 7. 시스템 설정 (System Settings)
**접근 권한:**
- 기본 설정: 부본사 등급 이상
- 고급 설정: 시스템관리자 전용
**메뉴:**
설정/시스템정보/외부API테스터/배너관리/메뉴관리(시스템관리자만 보임)

**🔑 핵심 기능
- 관리자 정보 관리**: 관리자 계정 정보, 비밀번호 변경 (시스템관리자 전용)
- 설정**: 시스템 전반 설정 관리 (부본사 이상)
- 알림소리(on/off)
- 시스템 정보**: 서버 상태, 버전 정보, 시스템 리소스 모니터링 (시스템관리자 전용)
- 서버 API 테스터**: 외부 API 연동 테스트, OPCODE 검증 도구 (시스템관리자 전용)
- 배너 관리**: 팝업(세로길이의 직사각형), 여러개 만들수 있음. 사용자 페이지에 배너 등록/수정/삭제, 팝업 배너 설정 (총판 이상), 노출을 권한별로 설정가능
- 데이터베이스 상태**: DB 연결 상태, 성능 모니터링 (시스템관리자 전용)
- 시스템 관리:**
- Supabase 데이터베이스 연결 상태 실시간 모니터링
- OPCODE별 API 연결 상태 모니터링
- 실시간 시스템 오류 감지 및 알림
- 메뉴관리(시스템 관리자)->모든 메뉴 리스트 관리(파트너별 노출메뉴 선택기능)

**관련 용어:**
- OPCODE 검증: 외부 API 인증정보 유효성 확인
- API 상태 모니터링: 외부 API 연결 상태 실시간 확인
- 시스템 리소스: CPU, 메모리, 디스크 사용량
- 배너 팝업->사용자 로그인 시 자동 표시되는 배너(편집창/이미지업로드 기능)
- 시스템 관리자는 모든 메뉴 보임 / 각 파트너조직은 시스템 관리자가 선택한 메뉴만 보임.
- 메뉴관리는 모든 메뉴가 다보이고, 권한별 선택된 메뉴만 보이도록 한다.
---

## 🎮 사용자 페이지 메뉴 구조
**메뉴:**
홈/카지노/슬롯/입금신청/출금신청/공지사항/고객센터(1:1문의)/내정보(입출금내역/포인트충환내역/베팅내역)
상단헤더(VIP), 보유금/포인트/로그인후 아이디표시
**🔑 핵심 기능
- 홈**: 메인 게임 로비, 잭팟 정보, 실시간 공지
- 게임**: 3단계 게임 선택 시스템
  - 1단계: 게임 로비 (슬롯/라이브카지노)
  - 2단계: 슬롯 제공사 선택 (슬롯 게임만)
  - 3단계: 개별 게임 선택 및 실행
- 입금**: 실시간 입금 요청, 관리자 승인 대기, 상태 확인
- 출금**: 실시간 출금 요청, 잔고 임시 동결, 승인/거절 처리  (출금 신청이 되면 게임이 안되고 부드러운 사용자 알림을 줌)
- 입출금내역**: 모든 입출금 거래 내역 조회, 실시간 업데이트
- 포인트내역**: 포인트 적립/사용/전환 내역, 포인트-잔고 전환 기능
- 고객센터**: 문의 작성/조회, 실시간 답변 확인
- 내정보**: 개인정보 수정, 계좌 정보 관리, 보안 설정 (사용자 정보 수정이 되면 관리자페이지에 로그만 남겨서 필요할때 관리자 확인(로그관리 메뉴))

### 실시간 기능
- WebSocket 실시간 통신**: 메시지, 알림, 잔고 업데이트
- 실시간 잔고 동기화**: 외부 API와 30초 주기 동기화
- 게임 상태 실시간 반영**: 관리자 설정 변경 즉시 반영
- 실시간 알림**: 입출금 승인/거절, 포인트 지급, 새 메시지(쪽지)->관리자페이지 메세지 센터에서 보내면 사용자는 읽음으로 될때까지 사라지지않는다)
- 팝업 공지**: 새 공지사항 자동 팝업 표시
  (
	1.데스크톱 팝업 공지 비율(700 x 500px)
	2. 모바일 팝업 공지 비율(360 x 660px)
	3. 반응형 디자인 (Responsive Design) 적용:
		가장 중요합니다. 데스크톱, 태블릿, 모바일 등 모든 기기에서 화면을 과도하게 가리지 않고 내용이 잘 보이도록 크기가 유연하게 조절되어야 합니다.
	4. 닫기 버튼의 명확성:
		팝업을 즉시 닫을 수 있는 'X' 버튼이나 '닫기' 링크를 명확하고 누르기 쉬운 위치(모바일에서는 최소 44x44px 크기)에 배치해야 합니다.
		(예:오늘하루표시하지않음)
		)

### 게임 시스템
- 통합 게임 로비**: 모든 OPCODE의 게임을 통합하여 표시
- 게임 실행**: OPCODE별 개별 API 호출 (POST /api/game/launch)
- 베팅 데이터**: 30초 주기 베팅 내역 자동 수집
- 게임 상태 관리**: 노출/비노출/점검중 상태별 게임 필터링
- 게임 즐겨찾기 기능
- 게임 검색 및 필터링 고도화
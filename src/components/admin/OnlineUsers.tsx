import { useState, useEffect, useRef } from "react";
import { supabase } from "../../lib/supabase";
import { Partner } from "../../types";
import { Button } from "../ui/button";
import { Badge } from "../ui/badge";
import { DataTable } from "../common/DataTable";
import { toast } from "sonner@2.0.3";
import { RefreshCw, Power, Smartphone, Monitor, Wifi, Clock, MapPin, CreditCard } from "lucide-react";
import {
  AdminDialog as Dialog,
  AdminDialogContent as DialogContent,
  AdminDialogDescription as DialogDescription,
  AdminDialogFooter as DialogFooter,
  AdminDialogHeader as DialogHeader,
  AdminDialogTitle as DialogTitle,
} from "./AdminDialog";
import { MetricCard } from "./MetricCard";
import { investApi } from "../../lib/investApi";

interface OnlineSession {
  session_id: string;
  user_id: string;
  username: string;
  nickname: string;
  partner_nickname: string;
  game_name: string;
  provider_name: string;
  balance_before: number;
  current_balance: number;
  vip_level: number;
  device_type: string;
  ip_address: string;
  location: string;
  launched_at: string;
  last_activity: string;
}

interface OnlineUsersProps {
  user: Partner;
}

export function OnlineUsers({ user }: OnlineUsersProps) {
  const [sessions, setSessions] = useState<OnlineSession[]>([]);
  const [loading, setLoading] = useState(true);
  const [selectedSession, setSelectedSession] = useState<OnlineSession | null>(null);
  const [showKickDialog, setShowKickDialog] = useState(false);
  const [syncingBalance, setSyncingBalance] = useState<string | null>(null);
  const reloadTimeoutRef = useRef<NodeJS.Timeout | null>(null);

  // Ïò®ÎùºÏù∏ ÏÑ∏ÏÖò Î°úÎìú
  const loadOnlineSessions = async (isInitial = false) => {
    try {
      if (isInitial) setLoading(true);

      // ÏûêÏã† Ïù¥Ìïò Î™®Îì† ÌååÌä∏ÎÑà ID Í∞ÄÏ†∏Ïò§Í∏∞
      let childPartnerIds: string[] = [];
      if (user.level !== 1) {
        childPartnerIds = await getAllChildPartnerIds(user.id);
      }

      // game_launch_sessions ÌÖåÏù¥Î∏îÏóêÏÑú Ïò®ÎùºÏù∏ ÏÑ∏ÏÖò Ï°∞Ìöå
      let query = supabase
        .from('game_launch_sessions')
        .select(`
          id,
          user_id,
          game_id,
          status,
          launched_at,
          last_activity_at,
          balance_before,
          users!inner (
            id,
            username,
            nickname,
            balance,
            vip_level,
            referrer_id,
            ip_address,
            device_info,
            partners!users_referrer_id_fkey (
              id,
              nickname
            )
          ),
          games (
            name,
            game_providers (
              name
            )
          )
        `)
        .eq('status', 'active')
        .order('launched_at', { ascending: false });

      // ÏãúÏä§ÌÖúÍ¥ÄÎ¶¨Ïûê(level 1)Í∞Ä ÏïÑÎãå Í≤ΩÏö∞ ÏûêÏã†Ïùò ÌïòÏúÑ ÏÇ¨Ïö©ÏûêÎßå ÌïÑÌÑ∞ÎßÅ
      if (user.level !== 1) {
        if (childPartnerIds.length === 0) {
          // ÌïòÏúÑ ÌååÌä∏ÎÑàÍ∞Ä ÏóÜÏúºÎ©¥ ÏûêÏã†Ïùò ÏßÅÏÜç ÏÇ¨Ïö©ÏûêÎßå
          query = query.eq('users.referrer_id', user.id);
        } else {
          // ÏûêÏã†Í≥º ÌïòÏúÑ ÌååÌä∏ÎÑàÏùò ÏÇ¨Ïö©Ïûê Ìè¨Ìï®
          const allPartnerIds = [user.id, ...childPartnerIds];
          query = query.in('users.referrer_id', allPartnerIds);
        }
      }

      const { data, error } = await query;

      if (error) throw error;

      // Îç∞Ïù¥ÌÑ∞ Ìè¨Îß∑ÌåÖ
      const formattedSessions: OnlineSession[] = (data || []).map((session: any) => {
        // device_infoÏóêÏÑú Í∏∞Í∏∞ ÌÉÄÏûÖ Ï∂îÏ∂ú (Îçî Ï†ïÌôïÌïú Í∞êÏßÄ)
        let deviceType = 'PC';
        let deviceName = 'Desktop';
        
        if (session.users.device_info) {
          const deviceInfo = session.users.device_info;
          
          // ÏßÅÏ†ë device ÌïÑÎìúÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ ÏµúÏö∞ÏÑ† Ï†ÅÏö©
          if (deviceInfo.device) {
            deviceType = deviceInfo.device;
          } else if (deviceInfo.userAgent) {
            // userAgent Î∂ÑÏÑù - Î™®Î∞îÏùº Ïö∞ÏÑ† Í∞êÏßÄ
            const ua = deviceInfo.userAgent.toLowerCase();
            
            // Î™®Î∞îÏùº Ïö∞ÏÑ† Í∞êÏßÄ (Îçî Ï†ïÌôïÌïú Ìå®ÌÑ¥)
            if (
              ua.includes('mobile') || 
              ua.includes('android') || 
              ua.includes('iphone') ||
              ua.includes('ipod') ||
              ua.includes('blackberry') ||
              ua.includes('windows phone') ||
              ua.includes('iemobile') ||
              ua.includes('opera mini')
            ) {
              deviceType = 'Mobile';
              if (ua.includes('iphone')) deviceName = 'iPhone';
              else if (ua.includes('android')) deviceName = 'Android';
              else deviceName = 'Mobile';
            }
            // iPad Î∞è ÌÉúÎ∏îÎ¶ø Í∞êÏßÄ
            else if (ua.includes('ipad') || ua.includes('tablet')) {
              deviceType = 'Mobile';
              deviceName = ua.includes('ipad') ? 'iPad' : 'Tablet';
            }
            // PC - macintosh, windows, linux Îì±
            else {
              deviceType = 'PC';
              if (ua.includes('macintosh') || ua.includes('mac os')) deviceName = 'Mac';
              else if (ua.includes('windows')) deviceName = 'Windows';
              else if (ua.includes('linux')) deviceName = 'Linux';
              else deviceName = 'PC';
            }
          }
          
          // deviceName ÌïÑÎìúÍ∞Ä ÏûàÎäî Í≤ΩÏö∞ Ïö∞ÏÑ† Ï†ÅÏö©
          if (deviceInfo.deviceName) {
            deviceName = deviceInfo.deviceName;
          }
        }

        // IP Ï£ºÏÜå Ï≤òÎ¶¨
        const ipAddress = session.users.ip_address || '-';
        
        // IP Í∏∞Î∞ò Í∞ÑÎã®Ìïú ÌÜµÏã†ÏÇ¨/ÏßÄÏó≠ ÌåêÎ≥Ñ
        let location = 'Ïïå Ïàò ÏóÜÏùå';
        if (ipAddress !== '-' && ipAddress.match(/^\d+\.\d+\.\d+\.\d+$/)) {
          const parts = ipAddress.split('.');
          const firstOctet = parseInt(parts[0]);
          const secondOctet = parseInt(parts[1]);
          
          // ÌïúÍµ≠ Ï£ºÏöî ÌÜµÏã†ÏÇ¨ IP ÎåÄÏó≠ (Í∞ÑÎã®Ìïú Íµ¨Î∂Ñ)
          if (firstOctet === 211 || firstOctet === 210 || firstOctet === 175) {
            location = 'KT';
          } else if (firstOctet === 218 || firstOctet === 121) {
            location = 'SKT';
          } else if (firstOctet === 220 || firstOctet === 117) {
            location = 'LG U+';
          } else if (firstOctet === 106 || firstOctet === 112) {
            location = 'ÏÑúÏö∏';
          } else if (firstOctet >= 1 && firstOctet <= 126) {
            location = 'Íµ≠ÎÇ¥';
          } else if (firstOctet >= 128 && firstOctet <= 191) {
            location = 'Íµ≠ÎÇ¥';
          } else if (firstOctet >= 192 && firstOctet <= 223) {
            location = 'Íµ≠ÎÇ¥';
          } else {
            location = 'Í∏∞ÌÉÄ';
          }
        }

        return {
          session_id: session.id,
          user_id: session.users.id,
          username: session.users.username,
          nickname: session.users.nickname || session.users.username,
          partner_nickname: session.users.partners?.nickname || '-',
          game_name: session.games?.name || 'Unknown Game',
          provider_name: session.games?.game_providers?.name || 'Unknown',
          balance_before: session.balance_before || 0,
          current_balance: session.users.balance || 0,
          vip_level: session.users.vip_level || 0,
          device_type: deviceType,
          ip_address: ipAddress,
          location: location,
          launched_at: session.launched_at,
          last_activity: session.last_activity_at || session.launched_at,
        };
      });

      setSessions(formattedSessions);

    } catch (error: any) {
      console.error("Ïò®ÎùºÏù∏ ÏÑ∏ÏÖò Î°úÎìú Ïò§Î•ò:", error);
      if (isInitial) toast.error("Ïò®ÎùºÏù∏ ÌòÑÌô©ÏùÑ Î∂àÎü¨Ïò¨ Ïàò ÏóÜÏäµÎãàÎã§");
    } finally {
      if (isInitial) setLoading(false);
    }
  };

  // Î™®Îì† ÌïòÏúÑ ÌååÌä∏ÎÑà IDÎ•º Ïû¨Í∑ÄÏ†ÅÏúºÎ°ú Í∞ÄÏ†∏Ïò§Í∏∞
  const getAllChildPartnerIds = async (partnerId: string): Promise<string[]> => {
    const partnerIds: string[] = [];
    const queue: string[] = [partnerId];

    while (queue.length > 0) {
      const currentId = queue.shift()!;
      
      const { data, error } = await supabase
        .from('partners')
        .select('id')
        .eq('parent_id', currentId);

      if (!error && data) {
        for (const partner of data) {
          partnerIds.push(partner.id);
          queue.push(partner.id);
        }
      }
    }

    return partnerIds;
  };

  // Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî
  const handleSyncBalance = async (session: OnlineSession) => {
    try {
      setSyncingBalance(session.user_id);

      console.log('üí∞ [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] ÏãúÏûë:', {
        user_id: session.user_id,
        username: session.username,
        nickname: session.nickname
      });

      // API Ìò∏Ï∂úÌïòÏó¨ Î≥¥Ïú†Í∏à Ï°∞Ìöå
      const apiConfig = await investApi.getApiConfig(user.id);
      const balanceResult = await investApi.getUserBalance(
        apiConfig.opcode,
        session.username,
        apiConfig.token,
        apiConfig.secretKey
      );

      console.log('üì° [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] API ÏùëÎãµ:', balanceResult);

      if (balanceResult.error) {
        console.error('‚ùå [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] API Ïò§Î•ò:', balanceResult.error);
        toast.error("Î≥¥Ïú†Í∏à Ï°∞ÌöåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§");
        return;
      }

      // extractBalanceFromResponse Ìï®ÏàòÎ•º ÏÇ¨Ïö©ÌïòÏó¨ ÏûîÍ≥† Ï∂îÏ∂ú
      const newBalance = investApi.extractBalanceFromResponse(balanceResult.data, session.username);
      
      console.log('üíµ [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] Ï∂îÏ∂úÎêú ÏûîÍ≥†:', newBalance);

      if (newBalance >= 0) {
        // Î≥¥Ïú†Í∏à ÏóÖÎç∞Ïù¥Ìä∏
        const { error } = await supabase
          .from('users')
          .update({ 
            balance: newBalance,
            updated_at: new Date().toISOString()
          })
          .eq('id', session.user_id);

        if (error) {
          console.error('‚ùå [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] DB ÏóÖÎç∞Ïù¥Ìä∏ Ïò§Î•ò:', error);
          throw error;
        }

        console.log('‚úÖ [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] ÏôÑÎ£å:', {
          user_id: session.user_id,
          username: session.username,
          new_balance: newBalance
        });

        toast.success(`${session.nickname}Ïùò Î≥¥Ïú†Í∏àÏù¥ ‚Ç©${newBalance.toLocaleString()}ÏúºÎ°ú ÎèôÍ∏∞ÌôîÎêòÏóàÏäµÎãàÎã§`);
        loadOnlineSessions();
      } else {
        console.warn('‚ö†Ô∏è [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] ÏûîÍ≥† Ï∂îÏ∂ú Ïã§Ìå®');
        toast.error("Î≥¥Ïú†Í∏à Ï°∞ÌöåÏóê Ïã§Ìå®ÌñàÏäµÎãàÎã§");
      }
    } catch (error: any) {
      console.error("‚ùå [Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî] Ïò§Î•ò:", error);
      toast.error("Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§");
    } finally {
      setSyncingBalance(null);
    }
  };

  // ÏÑ∏ÏÖò Í∞ïÏ†ú Ï¢ÖÎ£å
  const handleKickSession = async () => {
    if (!selectedSession) return;

    try {
      const { error } = await supabase
        .from('game_launch_sessions')
        .update({
          status: 'force_ended',
          ended_at: new Date().toISOString()
        })
        .eq('id', selectedSession.session_id);

      if (error) throw error;

      console.log('üî¥ Í¥ÄÎ¶¨Ïûê Í∞ïÏ†ú Ï¢ÖÎ£å:', {
        sessionId: selectedSession.session_id,
        userId: selectedSession.user_id,
        nickname: selectedSession.nickname
      });

      toast.success(`${selectedSession.nickname}Ïùò Í≤åÏûÑÏù¥ Í∞ïÏ†ú Ï¢ÖÎ£åÎêòÏóàÏäµÎãàÎã§`);
      setShowKickDialog(false);
      setSelectedSession(null);
      loadOnlineSessions();
    } catch (error: any) {
      console.error("ÏÑ∏ÏÖò Ï¢ÖÎ£å Ïò§Î•ò:", error);
      toast.error("ÏÑ∏ÏÖò Ï¢ÖÎ£å Ï§ë Ïò§Î•òÍ∞Ä Î∞úÏÉùÌñàÏäµÎãàÎã§");
    }
  };

  // Ï¥àÍ∏∞ Î°úÎìú
  useEffect(() => {
    loadOnlineSessions(true);
  }, [user.id]);

  // Realtime Íµ¨ÎèÖ
  useEffect(() => {
    console.log('üîî Realtime Íµ¨ÎèÖ ÏãúÏûë: game_launch_sessions');

    const channel = supabase
      .channel('online-users-realtime')
      .on(
        'postgres_changes',
        {
          event: '*',
          schema: 'public',
          table: 'game_launch_sessions'
        },
        (payload) => {
          console.log('üîî game_launch_sessions Î≥ÄÍ≤Ω Í∞êÏßÄ:', payload);
          
          if (reloadTimeoutRef.current) {
            clearTimeout(reloadTimeoutRef.current);
          }
          reloadTimeoutRef.current = setTimeout(() => {
            loadOnlineSessions();
          }, 500);
        }
      )
      .subscribe();

    return () => {
      supabase.removeChannel(channel);
      if (reloadTimeoutRef.current) {
        clearTimeout(reloadTimeoutRef.current);
      }
    };
  }, [user.id]);

  // ÏÑ∏ÏÖò ÏãúÍ∞Ñ Í≥ÑÏÇ∞
  const getSessionTime = (launchedAt: string) => {
    const diffMinutes = Math.floor((Date.now() - new Date(launchedAt).getTime()) / 1000 / 60);
    
    if (diffMinutes < 60) {
      return `${diffMinutes}Î∂Ñ`;
    }
    
    const hours = Math.floor(diffMinutes / 60);
    const minutes = diffMinutes % 60;
    return `${hours}ÏãúÍ∞Ñ ${minutes}Î∂Ñ`;
  };

  // Ï¥ù Í≤åÏûÑ Î≥¥Ïú†Í∏à
  const totalGameBalance = sessions.reduce((sum, s) => sum + s.current_balance, 0);

  // ÏÜêÏùµ Í≥ÑÏÇ∞
  const totalBalanceChange = sessions.reduce(
    (sum, s) => sum + (s.current_balance - s.balance_before),
    0
  );

  // Í∏∞Í∏∞ ÏïÑÏù¥ÏΩò Í∞ÄÏ†∏Ïò§Í∏∞
  const getDeviceIcon = (deviceType: string) => {
    if (deviceType === 'Mobile') return Smartphone;
    if (deviceType === 'Tablet') return Smartphone;
    return Monitor;
  };

  const columns = [
    {
      header: "ÏÇ¨Ïö©Ïûê",
      cell: (session: OnlineSession) => (
        <div className="py-3">
          <div className="flex flex-col items-center gap-0.5">
            <span className="font-medium text-white">{session.username}</span>
            <div className="flex items-center gap-1.5">
              <span className="text-xs text-slate-400">{session.nickname}</span>
              {session.vip_level > 0 && (
                <Badge variant="default" className="text-[10px] px-1.5 py-0.5 bg-gradient-to-r from-amber-500 to-yellow-500 border-0">
                  VIP{session.vip_level}
                </Badge>
              )}
            </div>
          </div>
        </div>
      ),
    },
    {
      header: "ÎãâÎÑ§ÏûÑ",
      cell: (session: OnlineSession) => (
        <div className="py-3">
          <span className="text-slate-300">{session.nickname}</span>
        </div>
      ),
    },
    {
      header: "Í≤åÏûÑ",
      cell: (session: OnlineSession) => (
        <div className="py-3">
          <div className="flex flex-col items-center gap-1">
            <span className="font-medium text-emerald-300">{session.game_name}</span>
            <Badge variant="outline" className="text-[10px] px-2 py-0.5 bg-emerald-500/10 border-emerald-500/30 text-emerald-400">
              {session.provider_name}
            </Badge>
          </div>
        </div>
      ),
    },
    {
      header: "Í≤åÏûÑ ÏãúÏûëÍ∏à",
      cell: (session: OnlineSession) => (
        <div className="py-3">
          <span className="font-medium text-slate-300">‚Ç©{session.balance_before.toLocaleString()}</span>
        </div>
      ),
    },
    {
      header: "ÌòÑÏû¨ Î≥¥Ïú†Í∏à",
      cell: (session: OnlineSession) => {
        const profit = session.current_balance - session.balance_before;
        return (
          <div className="py-3">
            <div className="flex flex-col items-center gap-1">
              <span className="font-medium text-white">‚Ç©{session.current_balance.toLocaleString()}</span>
              <span className={`text-xs font-medium ${profit >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                {profit >= 0 ? '+' : ''}‚Ç©{Math.abs(profit).toLocaleString()}
              </span>
            </div>
          </div>
        );
      },
    },
    {
      header: "Ï†ëÏÜçÍ≤ΩÎ°ú",
      cell: (session: OnlineSession) => {
        const DeviceIcon = getDeviceIcon(session.device_type);
        return (
          <div className="py-3">
            <div className="flex items-center justify-center gap-1.5">
              <DeviceIcon className="h-3.5 w-3.5 text-purple-400 shrink-0" />
              <span className="text-sm text-purple-300">{session.device_type}</span>
            </div>
          </div>
        );
      },
    },
    {
      header: "IP Ï£ºÏÜå",
      cell: (session: OnlineSession) => (
        <div className="py-3">
          <div className="flex flex-col items-center gap-0.5">
            <span className="text-xs font-mono text-cyan-300">{session.ip_address}</span>
            <Badge variant="outline" className="text-[10px] px-1.5 py-0 bg-cyan-500/10 border-cyan-500/30 text-cyan-400">
              {session.location}
            </Badge>
          </div>
        </div>
      ),
    },
    {
      header: "Ï†ëÏÜç ÏãúÍ∞Ñ",
      cell: (session: OnlineSession) => (
        <div className="py-3">
          <div className="flex items-center justify-center gap-1.5">
            <Clock className="h-3.5 w-3.5 text-orange-400" />
            <span className="font-medium text-orange-300">{getSessionTime(session.launched_at)}</span>
          </div>
        </div>
      ),
    },
    {
      header: "Í¥ÄÎ¶¨",
      cell: (session: OnlineSession) => (
        <div className="flex gap-2 py-3 justify-center">
          <Button
            size="sm"
            variant="outline"
            onClick={() => handleSyncBalance(session)}
            disabled={syncingBalance === session.user_id}
            className="h-7 w-7 p-0 bg-blue-500/10 border-blue-500/30 hover:bg-blue-500/20"
            title="Î≥¥Ïú†Í∏à ÎèôÍ∏∞Ìôî"
          >
            <RefreshCw className={`h-3.5 w-3.5 text-blue-400 ${syncingBalance === session.user_id ? 'animate-spin' : ''}`} />
          </Button>
          <Button
            size="sm"
            variant="destructive"
            onClick={() => {
              setSelectedSession(session);
              setShowKickDialog(true);
            }}
            className="h-7 w-7 p-0 bg-red-500/10 border-red-500/30 hover:bg-red-500/20"
            title="ÏÑ∏ÏÖò Í∞ïÏ†ú Ï¢ÖÎ£å"
          >
            <Power className="h-3.5 w-3.5 text-red-400" />
          </Button>
        </div>
      ),
    },
  ];

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h2 className="text-2xl">Ïò®ÎùºÏù∏ ÌòÑÌô©</h2>
          <p className="text-sm text-muted-foreground mt-1">
            Ïã§ÏãúÍ∞Ñ Í≤åÏûÑ Ï§ëÏù∏ ÏÇ¨Ïö©Ïûê ÌòÑÌô©
          </p>
        </div>
        <Button onClick={() => loadOnlineSessions(true)} variant="outline">
          <RefreshCw className="h-4 w-4 mr-2" />
          ÏÉàÎ°úÍ≥†Ïπ®
        </Button>
      </div>

      <div className="grid gap-5 md:grid-cols-2 lg:grid-cols-4">
        <MetricCard
          title="Ïò®ÎùºÏù∏ ÏÇ¨Ïö©Ïûê"
          value={`${sessions.length}Î™Ö`}
          subtitle="ÌòÑÏû¨ Í≤åÏûÑ Ï§ë"
          icon={Wifi}
          color="purple"
        />
        <MetricCard
          title="Ï¥ù Í≤åÏûÑ Î≥¥Ïú†Í∏à"
          value={`‚Ç©${totalGameBalance.toLocaleString()}`}
          subtitle="Ï†ÑÏ≤¥ Í≤åÏûÑ Ï§ë Î≥¥Ïú†Í∏à"
          icon={CreditCard}
          color="pink"
        />
        <MetricCard
          title="Ï¥ù ÏÜêÏùµ"
          value={`${totalBalanceChange >= 0 ? '+' : ''}‚Ç©${totalBalanceChange.toLocaleString()}`}
          subtitle="Í≤åÏûÑ ÏãúÏûë ÎåÄÎπÑ"
          icon={CreditCard}
          color={totalBalanceChange >= 0 ? "green" : "red"}
        />
        <MetricCard
          title="ÌèâÍ∑† ÏÑ∏ÏÖò"
          value={sessions.length > 0 
            ? `${Math.floor(sessions.reduce((sum, s) => sum + (Date.now() - new Date(s.launched_at).getTime()), 0) / sessions.length / 1000 / 60)}Î∂Ñ`
            : '0Î∂Ñ'
          }
          subtitle="ÌèâÍ∑† Í≤åÏûÑ ÏãúÍ∞Ñ"
          icon={Clock}
          color="cyan"
        />
      </div>

      {loading ? (
        <div className="flex items-center justify-center py-12">
          <div className="text-center space-y-2">
            <div className="w-8 h-8 border-4 border-primary border-t-transparent rounded-full animate-spin mx-auto" />
            <p className="text-sm text-muted-foreground">Î°úÎî© Ï§ë...</p>
          </div>
        </div>
      ) : (
        <DataTable
          data={sessions}
          columns={columns}
          emptyMessage="ÌòÑÏû¨ Í≤åÏûÑ Ï§ëÏù∏ ÏÇ¨Ïö©ÏûêÍ∞Ä ÏóÜÏäµÎãàÎã§"
          rowKey="session_id"
        />
      )}

      {/* Í∞ïÏ†ú Ï¢ÖÎ£å ÌôïÏù∏ Îã§Ïù¥ÏñºÎ°úÍ∑∏ */}
      <Dialog open={showKickDialog} onOpenChange={setShowKickDialog}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>ÏÑ∏ÏÖò Í∞ïÏ†ú Ï¢ÖÎ£å</DialogTitle>
            <DialogDescription>
              {selectedSession?.nickname}ÎãòÏùò Í≤åÏûÑ ÏÑ∏ÏÖòÏùÑ Í∞ïÏ†úÎ°ú Ï¢ÖÎ£åÌïòÏãúÍ≤†ÏäµÎãàÍπå?
            </DialogDescription>
          </DialogHeader>
          <DialogFooter>
            <Button variant="outline" onClick={() => setShowKickDialog(false)}>
              Ï∑®ÏÜå
            </Button>
            <Button variant="destructive" onClick={handleKickSession}>
              Ï¢ÖÎ£å
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  );
}

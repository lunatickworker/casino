import{k as re,ax as le,r,s as m,t as n,j as e,C as q,a as R,b as W,d as M,e as P,a7 as K,a8 as z,E as u,I as g,w as j,S as ne,x as ce,y as ie,z as oe,D as de,Q as me,B as he,az as xe,ay as ue,R as be}from"./index-DHLZKrSC.js";import{T as pe}from"./textarea-D3JOUlRQ.js";import{D as ge,f as je,a as we,b as fe,c as Ne,d as ye}from"./dialog-HEtsMRxu.js";import{T as O}from"./triangle-alert-CDjjtVAU.js";import{C as ve}from"./circle-alert-CfjAz5vG.js";import{C as _e}from"./clock-DJz0fDvN.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=[["path",{d:"M5 12h14",key:"1ays0h"}]],Q=re("minus",Ce);function Ee({user:t,onRouteChange:Se}){const{sendMessage:U}=le(),[b,w]=r.useState(""),[o,S]=r.useState(""),[h,k]=r.useState(""),[d,D]=r.useState(""),[f,I]=r.useState(""),[p,T]=r.useState(""),[B,F]=r.useState(!1),[H,V]=r.useState([]),[X,G]=r.useState(!0),[x,J]=r.useState(0),[c,E]=r.useState(!1),[Y,N]=r.useState(!1),[Z]=r.useState([5e4,1e5,3e5,5e5,1e6]),ee=["êµ­ë¯¼ì€í–‰","ì‹ í•œì€í–‰","ìš°ë¦¬ì€í–‰","KBêµ­ë¯¼ì€í–‰","KEBí•˜ë‚˜ì€í–‰","ë†í˜‘ì€í–‰","ê¸°ì—…ì€í–‰","ìƒˆë§ˆì„ê¸ˆê³ ","ì‹ í˜‘","ìš°ì²´êµ­","ì¹´ì¹´ì˜¤ë±…í¬","í† ìŠ¤ë±…í¬","ì¼€ì´ë±…í¬"],y=async()=>{try{const{data:s,error:a}=await m.from("transactions").select("*").eq("user_id",t.id).eq("transaction_type","withdrawal").in("status",["pending","approved"]).limit(1);if(a)throw a;s&&s.length>0?(E(!0),n.warning("ì§„í–‰ ì¤‘ì¸ ì¶œê¸ˆ ì‹ ì²­ì´ ìˆì–´ ìƒˆë¡œìš´ ì¶œê¸ˆì„ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.")):E(!1)}catch(s){console.error("ì¶œê¸ˆ ìƒíƒœ í™•ì¸ ì˜¤ë¥˜:",s)}},v=async()=>{try{const{data:s,error:a}=await m.from("transactions").select("*").eq("user_id",t.id).eq("transaction_type","withdrawal").order("created_at",{ascending:!1}).limit(10);if(a)throw a;V(s||[])}catch(s){console.error("ì¶œê¸ˆ ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",s),n.error("ì¶œê¸ˆ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{G(!1)}},_=async()=>{try{const{data:s,error:a}=await m.from("users").select("balance").eq("id",t.id).single();if(a)throw a;J(parseFloat(s.balance)||0)}catch(s){console.error("ì”ê³  ì¡°íšŒ ì˜¤ë¥˜:",s)}},se=async()=>{if(!b||!o||!h||!d||!p){n.error("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}const s=parseFloat(b);if(s<1e4){n.error("ìµœì†Œ ì¶œê¸ˆ ê¸ˆì•¡ì€ 10,000ì›ì…ë‹ˆë‹¤.");return}if(await _(),s>x){n.error(`ì¶œê¸ˆ ê°€ëŠ¥ ê¸ˆì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.
í˜„ì¬ ì”ê³ : ${x.toLocaleString()}ì›`);return}F(!0);try{const{data:a,error:l}=await m.rpc("user_login",{p_username:t.username,p_password:p});if(l||!a||a.length===0)throw new Error("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");const $={user_id:t.id,partner_id:t.referrer_id||null,transaction_type:"withdrawal",amount:s,status:"pending",balance_before:x,balance_after:x,bank_name:o,bank_account:h,bank_holder:d,memo:f||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("ğŸ’¸ ì¶œê¸ˆ ì‹ ì²­ ë°ì´í„°:",{...$,user_info:{id:t.id,username:t.username,referrer_id:t.referrer_id}});const{data:C,error:L}=await m.from("transactions").insert([$]).select().single();if(L)throw L;await U("withdrawal_request",{transaction_id:C.id,user_id:t.id,username:t.username,nickname:t.nickname,amount:s,bank_name:o,bank_account:h,bank_holder:d,memo:f||null,subject:`${t.nickname}ë‹˜ì˜ ì¶œê¸ˆ ì‹ ì²­`,reference_type:"transaction",reference_id:C.id},3)&&console.log("âœ… ì¶œê¸ˆ ìš”ì²­ ì•Œë¦¼ì´ ê´€ë¦¬ìì—ê²Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."),await m.from("activity_logs").insert([{actor_type:"user",actor_id:t.id,action:"withdrawal_request",target_type:"transaction",target_id:C.id,details:{amount:s,bank_name:o,bank_holder:d}}]),n.success(`ì¶œê¸ˆ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
ê´€ë¦¬ì ìŠ¹ì¸ í›„ ê³„ì¢Œë¡œ ì†¡ê¸ˆë©ë‹ˆë‹¤.`,{duration:4e3}),w(""),S(""),k(""),D(""),I(""),T(""),N(!1),await Promise.all([v(),y()])}catch(a){console.error("âŒ ì¶œê¸ˆ ì‹ ì²­ ì˜¤ë¥˜:",a),n.error(a.message||"ì¶œê¸ˆ ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{F(!1)}},ae=s=>{switch(s){case"pending":return{color:"bg-yellow-500",textColor:"text-yellow-400",icon:_e,label:"ìŠ¹ì¸ëŒ€ê¸°"};case"approved":return{color:"bg-blue-500",textColor:"text-blue-400",icon:be,label:"ì²˜ë¦¬ì¤‘"};case"completed":return{color:"bg-green-500",textColor:"text-green-400",icon:ue,label:"ì™„ë£Œ"};case"rejected":return{color:"bg-red-500",textColor:"text-red-400",icon:xe,label:"ê±°ì ˆ"};default:return{color:"bg-gray-500",textColor:"text-slate-400",icon:ve,label:"ì•Œ ìˆ˜ ì—†ìŒ"}}},i=s=>new Intl.NumberFormat("ko-KR").format(s),te=s=>new Date(s).toLocaleString("ko-KR"),A=parseFloat(b)||0;return r.useEffect(()=>{y(),v(),_();const s=m.channel(`withdrawal_updates_${t.id}`).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${t.id}`},a=>{if(console.log("ğŸ”„ ì¶œê¸ˆ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :",a),a.eventType==="UPDATE"||a.eventType==="INSERT"){const l=a.new;l.transaction_type==="withdrawal"&&(v(),y(),l.status==="completed"?(_(),n.success(`ì¶œê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
ê¸ˆì•¡: â‚©${i(l.amount)}`,{duration:5e3})):l.status==="rejected"?n.error(`ì¶œê¸ˆ ì‹ ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.
ê¸ˆì•¡: â‚©${i(l.amount)}`,{duration:5e3}):l.status==="approved"&&n.info(`ì¶œê¸ˆì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.
ê¸ˆì•¡: â‚©${i(l.amount)}`,{duration:4e3}))}}).subscribe();return()=>{s.unsubscribe()}},[t.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-white",children:"ì¶œê¸ˆ ì‹ ì²­"}),e.jsx("p",{className:"text-slate-400 mt-1",children:"ì•ˆì „í•˜ê³  ë¹ ë¥¸ ì¶œê¸ˆ ì„œë¹„ìŠ¤ë¥¼ ì œê³µí•©ë‹ˆë‹¤"})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-sm text-slate-400",children:"í˜„ì¬ ì”ê³ "}),e.jsxs("p",{className:"text-xl font-bold text-green-400",children:["â‚©",i(x)]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(q,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs(R,{children:[e.jsxs(W,{className:"text-white flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"ì¶œê¸ˆ ì‹ ì²­"]}),e.jsx(M,{className:"text-slate-400",children:"ì¶œê¸ˆí•  ê¸ˆì•¡ê³¼ ê³„ì¢Œ ì •ë³´ë¥¼ ì…ë ¥í•˜ì„¸ìš”"})]}),e.jsxs(P,{className:"space-y-4",children:[c&&e.jsxs(K,{className:"border-yellow-600 bg-yellow-900/20",children:[e.jsx(O,{className:"h-4 w-4 text-yellow-400"}),e.jsx(z,{className:"text-yellow-300",children:"ì§„í–‰ ì¤‘ì¸ ì¶œê¸ˆ ì‹ ì²­ì´ ìˆì–´ ìƒˆë¡œìš´ ì¶œê¸ˆì„ ì‹ ì²­í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(u,{htmlFor:"amount",className:"text-slate-300",children:"ì¶œê¸ˆ ê¸ˆì•¡ *"}),e.jsx(g,{id:"amount",type:"number",placeholder:"ì¶œê¸ˆí•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”",value:b,onChange:s=>w(s.target.value),className:"bg-slate-700/50 border-slate-600 text-white",disabled:c}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:Z.map(s=>e.jsx(j,{variant:"outline",size:"sm",onClick:()=>w(s.toString()),className:"text-xs border-slate-600 text-slate-300 hover:bg-slate-700",disabled:c,children:i(s)},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"bank",className:"text-slate-300",children:"ì€í–‰ ì„ íƒ *"}),e.jsxs(ne,{value:o,onValueChange:S,disabled:c,children:[e.jsx(ce,{className:"bg-slate-700/50 border-slate-600 text-white",children:e.jsx(ie,{placeholder:"ì€í–‰ì„ ì„ íƒí•˜ì„¸ìš”"})}),e.jsx(oe,{className:"bg-slate-800 border-slate-700",children:ee.map(s=>e.jsx(de,{value:s,className:"text-white",children:s},s))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"accountNumber",className:"text-slate-300",children:"ê³„ì¢Œë²ˆí˜¸ *"}),e.jsx(g,{id:"accountNumber",placeholder:"'-' ì—†ì´ ìˆ«ìë§Œ ì…ë ¥",value:h,onChange:s=>k(s.target.value.replace(/[^0-9]/g,"")),className:"bg-slate-700/50 border-slate-600 text-white",disabled:c})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(u,{htmlFor:"accountHolder",className:"text-slate-300",children:"ì˜ˆê¸ˆì£¼ëª… *"}),e.jsx(g,{id:"accountHolder",placeholder:"ê³„ì¢Œì˜ ì˜ˆê¸ˆì£¼ëª…ì„ ì…ë ¥í•˜ì„¸ìš”",value:d,onChange:s=>D(s.target.value),className:"bg-slate-700/50 border-slate-600 text-white",disabled:c})]}),e.jsxs("div",{className:"space-y-2 md:col-span-2",children:[e.jsx(u,{htmlFor:"memo",className:"text-slate-300",children:"ë©”ëª¨ (ì„ íƒ)"}),e.jsx(pe,{id:"memo",placeholder:"ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•˜ì„¸ìš”",value:f,onChange:s=>I(s.target.value),className:"bg-slate-700/50 border-slate-600 text-white",rows:3,disabled:c})]})]}),e.jsxs(K,{className:"border-red-600 bg-red-900/20",children:[e.jsx(O,{className:"h-4 w-4 text-red-400"}),e.jsx(z,{className:"text-red-300",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"â€¢ ìµœì†Œ ì¶œê¸ˆì•¡: 10,000ì›"}),e.jsx("p",{children:"â€¢ ì¶œê¸ˆ ì‹ ì²­ ì‹œ ê²Œì„ ì´ìš©ì´ ì œí•œë©ë‹ˆë‹¤"}),e.jsx("p",{children:"â€¢ ì˜ˆê¸ˆì£¼ëª…ì€ íšŒì› ë³¸ì¸ê³¼ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤"}),e.jsx("p",{children:"â€¢ ì¶œê¸ˆ ì²˜ë¦¬ ì‹œê°„: í‰ì¼ ê¸°ì¤€ 1-3ì‹œê°„"})]})})]}),e.jsxs(ge,{open:Y,onOpenChange:N,children:[e.jsx(je,{asChild:!0,children:e.jsxs(j,{disabled:c||!b||!o||!h||!d,className:"w-full bg-blue-600 hover:bg-blue-700 text-white py-3",children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"ì¶œê¸ˆ ì‹ ì²­í•˜ê¸°"]})}),e.jsxs(we,{className:"bg-slate-800 border-slate-700 text-white",children:[e.jsxs(fe,{children:[e.jsx(Ne,{children:"ì¶œê¸ˆ ì‹ ì²­ í™•ì¸"}),e.jsx(ye,{className:"text-slate-400",children:"ì¶œê¸ˆ ì‹ ì²­ ì •ë³´ë¥¼ í™•ì¸í•˜ê³  ìµœì¢… ìŠ¹ì¸í•´ì£¼ì„¸ìš”."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"ì¶œê¸ˆ ê¸ˆì•¡:"}),e.jsxs("span",{children:["â‚©",i(A)]})]}),e.jsxs("div",{className:"flex justify-between text-sm text-slate-400",children:[e.jsx("span",{children:"ì¶œê¸ˆ í›„ ì”ì•¡:"}),e.jsxs("span",{children:["â‚©",i(x-A)]})]})]}),e.jsxs("div",{className:"p-4 bg-slate-700/50 rounded-lg",children:[e.jsx("p",{className:"text-sm text-slate-300",children:"ì¶œê¸ˆ ê³„ì¢Œ ì •ë³´"}),e.jsxs("p",{children:[o," ",h]}),e.jsxs("p",{children:["ì˜ˆê¸ˆì£¼: ",d]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(u,{htmlFor:"confirmPassword",className:"text-slate-300",children:"ë¹„ë°€ë²ˆí˜¸ í™•ì¸ *"}),e.jsx(g,{id:"confirmPassword",type:"password",placeholder:"ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:p,onChange:s=>T(s.target.value),className:"bg-slate-700/50 border-slate-600 text-white"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(j,{variant:"outline",onClick:()=>N(!1),className:"flex-1",children:"ì·¨ì†Œ"}),e.jsx(j,{onClick:se,disabled:B||!p,className:"flex-1 bg-blue-600 hover:bg-blue-700",children:B?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"ì²˜ë¦¬ì¤‘..."]}):"ì¶œê¸ˆ ì‹ ì²­"})]})]})]})]})]})]}),e.jsxs(q,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs(R,{children:[e.jsxs(W,{className:"text-white flex items-center gap-2",children:[e.jsx(me,{className:"w-5 h-5"}),"ìµœê·¼ ì¶œê¸ˆ ë‚´ì—­"]}),e.jsx(M,{className:"text-slate-400",children:"ìµœê·¼ 10ê°œì˜ ì¶œê¸ˆ ì‹ ì²­ ë‚´ì—­ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"})]}),e.jsx(P,{children:X?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-400"})}):H.length===0?e.jsx("div",{className:"text-center py-8 text-slate-400",children:"ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤"}):e.jsx("div",{className:"space-y-3",children:H.map(s=>{const a=ae(s.status),l=a.icon;return e.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg border border-slate-600/50",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:`w-4 h-4 ${a.textColor}`}),e.jsx(he,{variant:"outline",className:`${a.color} text-white border-none`,children:a.label})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-semibold text-white",children:["â‚©",i(s.amount)]}),e.jsx("p",{className:"text-xs text-slate-400",children:te(s.created_at)})]})]}),e.jsxs("div",{className:"text-sm text-slate-400 space-y-1",children:[e.jsxs("p",{children:[s.bank_name," ",s.bank_account]}),e.jsxs("p",{children:["ì˜ˆê¸ˆì£¼: ",s.bank_holder]}),s.memo&&e.jsx("p",{className:"text-slate-500",children:s.memo})]})]},s.id)})})})]})]})]})}export{Ee as UserWithdraw};

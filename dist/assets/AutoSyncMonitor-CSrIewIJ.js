import{j as e,r as i}from"./react-core-CwM-CeLv.js";import{H as b,s as x,m as L,C as U,a as $,b as E,d as I,e as M,B as m}from"./index-B_UTQDGv.js";import{a4 as k,a5 as R,a6 as z,a7 as H,a8 as O}from"./radix-ui-SX2QAG6c.js";import{M as o}from"./MetricCard-CAttVRRt.js";import{R as h,A as p,n as j,z as g,t as f,G as P,D as G}from"./lucide-icons-wLPRtdhM.js";import"./vendor-CQn7sZ7L.js";import"./supabase-r6ABpEO8.js";function F({className:l,children:r,...c}){return e.jsxs(k,{"data-slot":"scroll-area",className:b("relative",l),...c,children:[e.jsx(R,{"data-slot":"scroll-area-viewport",className:"focus-visible:ring-ring/50 size-full rounded-[inherit] transition-[color,box-shadow] outline-none focus-visible:ring-[3px] focus-visible:outline-1",children:r}),e.jsx(J,{}),e.jsx(z,{})]})}function J({className:l,orientation:r="vertical",...c}){return e.jsx(H,{"data-slot":"scroll-area-scrollbar",orientation:r,className:b("flex touch-none p-px transition-colors select-none",r==="vertical"&&"h-full w-2.5 border-l border-l-transparent",r==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent",l),...c,children:e.jsx(O,{"data-slot":"scroll-area-thumb",className:"bg-border relative flex-1 rounded-full"})})}function Z(){const[l,r]=i.useState([]),[c,N]=i.useState(!0),[n,v]=i.useState({total:0,success:0,error:0,lastSync:null}),d=async()=>{try{const{data:s,error:a}=await x.from("api_sync_logs").select("*").order("created_at",{ascending:!1}).limit(50);if(a)throw a;r(s||[]),s&&s.length>0&&v({total:s.length,success:s.filter(t=>t.status==="success").length,error:s.filter(t=>t.status==="error").length,lastSync:s[0].created_at})}catch(s){console.error("‚ùå ÎèôÍ∏∞Ìôî Î°úÍ∑∏ Ï°∞Ìöå Ïò§Î•ò:",s)}finally{N(!1)}},u=s=>{const a=new Date(s),t=new Date(a.getTime()+540*60*1e3),C=t.getUTCFullYear(),_=String(t.getUTCMonth()+1).padStart(2,"0"),T=String(t.getUTCDate()).padStart(2,"0"),A=String(t.getUTCHours()).padStart(2,"0"),D=String(t.getUTCMinutes()).padStart(2,"0"),B=String(t.getUTCSeconds()).padStart(2,"0");return`${C}ÎÖÑ${_}Ïõî${T}Ïùº ${A}:${D}:${B}`};i.useEffect(()=>{d()},[]),i.useEffect(()=>{const s=x.channel("api_sync_logs_changes").on("postgres_changes",{event:"*",schema:"public",table:"api_sync_logs"},a=>{console.log("üîÑ ÏÉàÎ°úÏö¥ ÎèôÍ∏∞Ìôî Î°úÍ∑∏:",a),d()}).subscribe();return()=>{x.removeChannel(s)}},[]);const S=s=>{switch(s){case"success":return e.jsx(j,{className:"h-4 w-4 text-green-500"});case"error":return e.jsx(g,{className:"h-4 w-4 text-red-500"});default:return e.jsx(f,{className:"h-4 w-4 text-gray-500"})}},w=s=>{switch(s){case"success":return e.jsx(m,{className:"bg-green-600",children:"ÏÑ±Í≥µ"});case"error":return e.jsx(m,{variant:"destructive",children:"Ïò§Î•ò"});default:return e.jsx(m,{variant:"outline",children:"ÎåÄÍ∏∞"})}},y=s=>{switch(s){case"balance":return{icon:e.jsx(G,{className:"h-4 w-4 text-blue-400"}),label:"ÏûîÍ≥† ÎèôÍ∏∞Ìôî"};case"game_history":return{icon:e.jsx(P,{className:"h-4 w-4 text-green-400"}),label:"Í≤åÏûÑ Í∏∞Î°ù"};default:return{icon:e.jsx(p,{className:"h-4 w-4 text-purple-400"}),label:s}}};return c?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(h,{className:"h-6 w-6 animate-spin text-blue-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(p,{className:"h-6 w-6"}),"ÏûêÎèô ÎèôÍ∏∞Ìôî Î™®ÎãàÌÑ∞"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Ïã§ÏãúÍ∞Ñ API ÎèôÍ∏∞Ìôî ÏÉÅÌÉúÎ•º ÌôïÏù∏Ìï©ÎãàÎã§"})]}),e.jsxs(L,{onClick:d,className:"bg-slate-700 hover:bg-slate-600",children:[e.jsx(h,{className:"h-4 w-4 mr-2"}),"ÏÉàÎ°úÍ≥†Ïπ®"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(o,{title:"Ï¥ù ÎèôÍ∏∞Ìôî",value:n.total.toLocaleString(),subtitle:"Ï†ÑÏ≤¥ ÎèôÍ∏∞Ìôî",icon:h,color:"blue"}),e.jsx(o,{title:"ÏÑ±Í≥µ",value:n.success.toLocaleString(),subtitle:"ÏÑ±Í≥µÌïú ÎèôÍ∏∞Ìôî",icon:j,color:"green"}),e.jsx(o,{title:"Ïò§Î•ò",value:n.error.toLocaleString(),subtitle:"Ïã§Ìå®Ìïú ÎèôÍ∏∞Ìôî",icon:g,color:"red"}),e.jsx(o,{title:"ÎßàÏßÄÎßâ ÎèôÍ∏∞Ìôî",value:n.lastSync?u(n.lastSync):"-",subtitle:"ÏµúÍ∑º Ïã§Ìñâ",icon:f,color:"purple"})]}),e.jsxs(U,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs($,{children:[e.jsx(E,{className:"text-white",children:"ÎèôÍ∏∞Ìôî Î°úÍ∑∏"}),e.jsx(I,{className:"text-slate-400",children:"ÏµúÍ∑º 50Í∞úÏùò ÎèôÍ∏∞Ìôî Í∏∞Î°ù (Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏)"})]}),e.jsx(M,{children:e.jsx(F,{className:"h-[600px] pr-4",children:e.jsx("div",{className:"space-y-3",children:l.length===0?e.jsx("div",{className:"text-center py-8 text-slate-400",children:"ÎèôÍ∏∞Ìôî Î°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§"}):l.map(s=>{const a=y(s.sync_type);return e.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg border border-slate-600 hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.icon,e.jsx("span",{className:"text-white font-medium",children:a.label}),w(s.status)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[S(s.status),e.jsxs("span",{className:"text-slate-400 text-sm font-mono",children:[s.sync_duration_ms,"ms"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"OPCODE:"}),e.jsx("span",{className:"text-white ml-2 font-mono",children:s.opcode})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Ï≤òÎ¶¨ Í±¥Ïàò:"}),e.jsxs("span",{className:"text-white ml-2",children:[s.records_processed,"Í±¥"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400",children:"ÏãúÍ∞Ñ:"}),e.jsx("span",{className:"text-white ml-2 font-mono text-xs",children:u(s.created_at)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400",children:"API:"}),e.jsx("span",{className:"text-white ml-2 font-mono text-xs",children:s.api_endpoint})]})]}),s.error_message&&e.jsx("div",{className:"mt-2 p-2 bg-red-900/20 border border-red-500/30 rounded",children:e.jsxs("div",{className:"text-red-400 text-sm",children:["Ïò§Î•ò: ",s.error_message]})}),s.response_data&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-slate-400 text-xs cursor-pointer hover:text-white",children:"ÏùëÎãµ Îç∞Ïù¥ÌÑ∞ Î≥¥Í∏∞"}),e.jsx("pre",{className:"mt-2 p-2 bg-slate-900 rounded text-xs text-slate-300 overflow-x-auto",children:JSON.stringify(s.response_data,null,2)})]})]},s.id)})})})})]})]})}export{Z as AutoSyncMonitor};

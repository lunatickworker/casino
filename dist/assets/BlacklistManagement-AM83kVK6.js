import{r as l,j as e}from"./react-core-CwM-CeLv.js";import{n as y,s as n,m as L,i as g,I as S,B as R}from"./index-Cn1S8-JW.js";import{k as i}from"./vendor-CQn7sZ7L.js";import{M as b}from"./MetricCard-CBRAhT7E.js";import{S as h,R as N,K as v,V as B}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";function z(){const{authState:x}=y(),[a,u]=l.useState([]),[o,j]=l.useState(!0),[p,f]=l.useState(null),[r,w]=l.useState(""),d=async()=>{try{j(!0),console.log("ğŸ“‹ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©ì ì¡°íšŒ ì‹œì‘");const{data:s,error:t}=await n.from("blacklist_users_view").select("*").order("blocked_at",{ascending:!1});if(t)throw console.error("âŒ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì˜¤ë¥˜:",t),t;console.log("ğŸ“Š ë¸”ë™ë¦¬ìŠ¤íŠ¸ ë°ì´í„°:",s),console.log(`ğŸ“ˆ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì‚¬ìš©ì ìˆ˜: ${s?.length||0}ëª…`),u(s||[])}catch(s){console.error("âŒ ë¸”ë™ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ ì‹¤íŒ¨:",s),i.error("ë¸”ë™ë¦¬ìŠ¤íŠ¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{j(!1)}},_=async s=>{if(!x.user?.id){i.error("ê´€ë¦¬ì ì¸ì¦ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤.");return}try{f(s.user_id),console.log("ğŸ”“ ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•´ì œ ì‹œì‘:",s.user_id);const{data:t,error:m}=await n.rpc("remove_user_from_blacklist_simple",{p_user_id:s.user_id,p_admin_id:x.user.id});if(m)throw console.error("âŒ ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•´ì œ ì˜¤ë¥˜:",m),m;if(console.log("âœ… RPC ì‘ë‹µ:",t),!t.success)throw new Error(t.error||"ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•´ì œ ì‹¤íŒ¨");i.success(`${s.username}ë‹˜ì´ íšŒì›ê´€ë¦¬ë¡œ ë³µì›ë˜ì—ˆìŠµë‹ˆë‹¤.`),u(k=>k.filter(C=>C.user_id!==s.user_id))}catch(t){console.error("âŒ ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•´ì œ ì‹¤íŒ¨:",t),i.error(t.message||"ë¸”ë™ë¦¬ìŠ¤íŠ¸ í•´ì œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{f(null)}},c=a.filter(s=>s.username?.toLowerCase().includes(r.toLowerCase())||s.nickname?.toLowerCase().includes(r.toLowerCase())||s.blocked_reason?.toLowerCase().includes(r.toLowerCase()));return l.useEffect(()=>{d();const s=n.channel("blacklist-users-changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},t=>{console.log("ğŸ”” ì‚¬ìš©ì í…Œì´ë¸” ë³€ê²½ ê°ì§€:",t),(t.new?.status==="blocked"||t.old?.status==="blocked")&&d()}).subscribe();return()=>{n.removeChannel(s)}},[]),o&&a.length===0?e.jsx(L,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(h,{className:"h-6 w-6 text-rose-400"}),"ë¸”ë™ë¦¬ìŠ¤íŠ¸ ê´€ë¦¬"]}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"ì°¨ë‹¨ëœ íšŒì›ë“¤ì„ ê´€ë¦¬í•˜ê³  ë³µì›í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."})]}),e.jsxs(g,{onClick:d,variant:"outline",disabled:o,children:[e.jsx(N,{className:`h-4 w-4 mr-2 ${o?"animate-spin":""}`}),"ìƒˆë¡œê³ ì¹¨"]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsx(b,{title:"ë¸”ë™ë¦¬ìŠ¤íŠ¸ íšŒì›",value:a.length.toLocaleString(),subtitle:"ì°¨ë‹¨ëœ íšŒì› ìˆ˜",icon:h,color:"red"}),e.jsx(b,{title:"ê²€ìƒ‰ ê²°ê³¼",value:c.length.toLocaleString(),subtitle:"í•„í„°ë§ëœ ê²°ê³¼",icon:v,color:"blue"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100 mb-1",children:"ë¸”ë™ë¦¬ìŠ¤íŠ¸ ëª©ë¡"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["ì´ ",c.length.toLocaleString(),"ëª…ì˜ ì°¨ë‹¨ëœ ì‚¬ìš©ì"]})]}),e.jsxs("div",{className:"relative w-96",children:[e.jsx(v,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(S,{placeholder:"ì•„ì´ë””, ë‹‰ë„¤ì„, ì°¨ë‹¨ ì‚¬ìœ  ê²€ìƒ‰",className:"pl-10 input-premium",value:r,onChange:s=>w(s.target.value)})]})]}),e.jsx("div",{className:"space-y-4",children:c.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(h,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-500",children:a.length===0?"ë“±ë¡ëœ ë¸”ë™ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.":"ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ë¸”ë™ë¦¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤."}),a.length===0&&e.jsx("p",{className:"text-sm text-gray-400 mt-2",children:"íšŒì›ê´€ë¦¬ì—ì„œ ë¸”ë™ ë²„íŠ¼ì„ í´ë¦­í•˜ë©´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"text-left p-3",children:"ì•„ì´ë””"}),e.jsx("th",{className:"text-left p-3",children:"ë‹‰ë„¤ì„"}),e.jsx("th",{className:"text-left p-3",children:"ì°¨ë‹¨ ì‚¬ìœ "}),e.jsx("th",{className:"text-left p-3",children:"ì²˜ë¦¬ì"}),e.jsx("th",{className:"text-left p-3",children:"ì°¨ë‹¨ì¼ì‹œ"}),e.jsx("th",{className:"text-left p-3",children:"ìƒíƒœ"}),e.jsx("th",{className:"text-left p-3",children:"ê´€ë¦¬"})]})}),e.jsx("tbody",{children:c.map(s=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"p-3 font-medium",children:s.username}),e.jsx("td",{className:"p-3",children:s.nickname}),e.jsx("td",{className:"p-3",children:e.jsx("div",{className:"max-w-[200px] truncate",title:s.blocked_reason||"",children:s.blocked_reason||"ì‚¬ìœ  ì—†ìŒ"})}),e.jsx("td",{className:"p-3",children:s.admin_nickname||"ì‹œìŠ¤í…œ"}),e.jsx("td",{className:"p-3",children:s.blocked_at?new Date(s.blocked_at).toLocaleString("ko-KR"):"-"}),e.jsx("td",{className:"p-3",children:e.jsx(R,{variant:"destructive",children:"ì°¨ë‹¨ì¤‘"})}),e.jsx("td",{className:"p-3",children:e.jsxs(g,{variant:"outline",size:"sm",onClick:()=>_(s),disabled:p===s.user_id,className:"text-green-600 hover:bg-green-50",children:[p===s.user_id?e.jsx(N,{className:"h-3 w-3 animate-spin mr-1"}):e.jsx(B,{className:"h-3 w-3 mr-1"}),"ë³µì›"]})})]},s.user_id))})]})})})]})]})}export{z as BlacklistManagement,z as default};

import{j as e,r as x}from"./react-core-CwM-CeLv.js";import{c as N,C as ge,a as xe,b as be,d as he,e as _e,u as fe,s,g as ve,B as we,f as ye,h as c}from"./index-BFLxYssb.js";import{M as O}from"./MetricCard-ygDDKkqT.js";import{k as je}from"./vendor-CQn7sZ7L.js";import{calculatePendingDeposits as Ne}from"./settlementCalculator-DeinRsC0.js";import{t as Ce,U as De,W as Se,u as $,A as Be,T as M,i as ae,Z as W,v as se,w as ne}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";function H({title:o,description:g,children:_,className:C,headerAction:r,action:p,variant:d="modern",icon:f,iconColor:S="text-cyan-400"}){const U=N("transition-all duration-300 border-0",{"glass-card":d==="default"||d==="glass","admin-card-modern":d==="modern","glass-card rounded-2xl border border-slate-700/50":d==="premium"},C);return d==="premium"&&f?e.jsxs("div",{className:U,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-slate-700/50 px-6 pt-6",children:[e.jsx("div",{className:N("p-2 rounded-lg bg-slate-800/50",S.replace("text-","bg-")+"/20"),children:e.jsx(f,{className:N("h-5 w-5",S)})}),e.jsx("h3",{className:"font-semibold text-slate-100",children:o}),(r||p)&&e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[r,p]})]}),e.jsx("div",{className:"space-y-3 px-6 pb-6",children:_})]}):e.jsxs(ge,{className:U,children:[(o||g||r||p||f)&&e.jsx(xe,{className:"pb-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[f&&e.jsx("div",{className:N("p-2 rounded-lg bg-slate-800/50",S.replace("text-","bg-")+"/20"),children:e.jsx(f,{className:N("h-5 w-5",S)})}),e.jsxs("div",{className:"space-y-1.5",children:[o&&e.jsx(be,{className:"text-xl font-bold text-slate-100",children:o}),g&&e.jsx(he,{className:"text-base text-slate-400",children:g})]})]}),(r||p)&&e.jsxs("div",{className:"flex items-center gap-3",children:[r,p]})]})}),e.jsx(_e,{className:o||g||r||p||f?"pt-0":"pt-7",children:_})]})}function u({label:o,value:g,valueColor:_="text-cyan-400",badge:C,badgeColor:r="bg-cyan-500/20 text-cyan-400",icon:p,iconColor:d="text-slate-400"}){return e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-slate-800/30 hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p&&e.jsx("div",{className:N("p-1.5 rounded-lg bg-slate-700/50",d),children:e.jsx(p,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-slate-300 font-medium",children:o})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[C&&e.jsx("span",{className:N("px-2.5 py-1 rounded-full text-xs font-semibold",r),children:C}),e.jsx("span",{className:N("font-bold text-lg",_),children:g})]})]})}function Oe({user:o}){const{balance:g}=fe(),[_,C]=x.useState({total_users:0,total_balance:0,daily_deposit:0,daily_withdrawal:0,daily_net_deposit:0,casino_betting:0,slot_betting:0,total_betting:0,online_users:0,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0}),[r,p]=x.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[d,f]=x.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[S,U]=x.useState(0),[Pe,z]=x.useState(!0),[oe,le]=x.useState(new Date);if(x.useEffect(()=>{C(i=>({...i,total_balance:g}))},[g]),!o||typeof o.level!="number")return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"loading-premium mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})});const B=async()=>{try{z(!0),console.log("============================================"),console.log("ğŸ“Š ëŒ€ì‹œë³´ë“œ í†µê³„ ì¡°íšŒ ì‹œì‘"),console.log("Partner ID:",o.id),console.log("Partner Level:",o.level),console.log("Partner Type:",o.partner_type),console.log("============================================");const i=new Date;i.setHours(0,0,0,0),console.log("ğŸ” ì§ì ‘ DB ì¡°íšŒ ì‹œì‘...");const{data:v,error:A}=await s.from("transactions").select("transaction_type, status, amount, created_at").gte("created_at",i.toISOString());if(console.log("ğŸ“Š ì˜¤ëŠ˜ transactions:",v?.length||0,"ê±´"),v&&v.length>0){console.log("ìƒì„¸:",v);const a=v.filter(t=>t.transaction_type==="deposit"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount>0&&["approved","completed"].includes(t.status)).reduce((t,l)=>t+Number(l.amount),0),n=v.filter(t=>t.transaction_type==="withdrawal"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount<0&&["approved","completed"].includes(t.status)).reduce((t,l)=>t+Math.abs(Number(l.amount)),0);console.log("ğŸ’° ì§ì ‘ ê³„ì‚° ì…ê¸ˆ:",a),console.log("ğŸ’¸ ì§ì ‘ ê³„ì‚° ì¶œê¸ˆ:",n)}const{data:w,error:y}=await s.from("game_records").select("provider_id, bet_amount, played_at").gte("played_at",i.toISOString());if(console.log("ğŸ® ì˜¤ëŠ˜ game_records:",w?.length||0,"ê±´"),w&&w.length>0){console.log("ìƒì„¸:",w);const a=[410,77,2,30,78,86,11,28,89,91,44,85,0],n=w.filter(l=>a.includes(Number(l.provider_id))).reduce((l,D)=>l+Number(D.bet_amount),0),t=w.filter(l=>!a.includes(Number(l.provider_id))).reduce((l,D)=>l+Number(D.bet_amount),0);console.log("ğŸ° ì§ì ‘ ê³„ì‚° ì¹´ì§€ë…¸:",n),console.log("ğŸ² ì§ì ‘ ê³„ì‚° ìŠ¬ë¡¯:",t)}console.log(""),console.log("ğŸ”§ ì§ì ‘ SELECT ì¿¼ë¦¬ ì‹œì‘ (RPC ì œê±°)...");const re=new Date,J=540*60*1e3,Z=new Date(re.getTime()+J),ie=new Date(Z.getFullYear(),Z.getMonth(),Z.getDate()),j=new Date(ie.getTime()-J).toISOString();console.log("ğŸ“… ì˜¤ëŠ˜ ì‹œì‘ ì‹œê°:",j);let m=[];if(o.level===1){const{data:a}=await s.from("partners").select("id");m=a?.map(n=>n.id)||[]}else{m=[o.id];const{data:a}=await s.from("partners").select("id").eq("parent_id",o.id),n=a?.map(t=>t.id)||[];if(m.push(...n),n.length>0){const{data:t}=await s.from("partners").select("id").in("parent_id",n),l=t?.map(D=>D.id)||[];if(m.push(...l),l.length>0){const{data:D}=await s.from("partners").select("id").in("parent_id",l),F=D?.map(G=>G.id)||[];if(m.push(...F),F.length>0){const{data:G}=await s.from("partners").select("id").in("parent_id",F),K=G?.map(Y=>Y.id)||[];if(m.push(...K),K.length>0){const{data:Y}=await s.from("partners").select("id").in("parent_id",K),ue=Y?.map(pe=>pe.id)||[];m.push(...ue)}}}}}console.log("ğŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ ID ê°œìˆ˜:",m.length);let b=[];const{data:ce}=await s.from("users").select("id").eq("referrer_id",o.id);b=ce?.map(a=>a.id)||[],console.log("ğŸ‘¤ ì§ì† íšŒì› ID ê°œìˆ˜:",b.length);let h=[];const Q=m.filter(a=>a!==o.id);if(Q.length>0){const{data:a}=await s.from("users").select("id").in("referrer_id",Q);h=a?.map(n=>n.id)||[],console.log("ğŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ID ê°œìˆ˜:",h.length)}let R=0;if(b.length>0){const{data:a}=await s.from("transactions").select("amount").in("transaction_type",["deposit","admin_deposit"]).eq("status","completed").in("user_id",b).gte("created_at",j);R=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let q=0;if(b.length>0){const{data:a}=await s.from("transactions").select("amount").in("transaction_type",["withdrawal","admin_withdrawal"]).eq("status","completed").in("user_id",b).gte("created_at",j);q=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let k=0;if(h.length>0){const{data:a}=await s.from("transactions").select("amount").in("transaction_type",["deposit","admin_deposit"]).eq("status","completed").in("user_id",h).gte("created_at",j);k=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let L=0;if(h.length>0){const{data:a}=await s.from("transactions").select("amount").in("transaction_type",["withdrawal","admin_withdrawal"]).eq("status","completed").in("user_id",h).gte("created_at",j);L=a?.reduce((n,t)=>n+Number(t.amount),0)||0}let V=0;if(m.length>0){const{count:a}=await s.from("users").select("id",{count:"exact",head:!0}).in("referrer_id",m);V=a||0}let X=0;if(m.length>0){const{count:a}=await s.from("users").select("id",{count:"exact",head:!0}).in("referrer_id",m).eq("is_online",!0);X=a||0}const de=[...b,...h],me=await Ne(de,j,new Date().toISOString());let P=0,T=0;if(b.length>0){const{data:a}=await s.from("game_records").select("provider_id, bet_amount").in("user_id",b).gte("played_at",j);if(a&&a.length>0){const n=[410,77,2,30,78,86,11,28,89,91,44,85,0];P=a.filter(t=>n.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0),T=a.filter(t=>!n.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0)}}let I=0,E=0;if(h.length>0){const{data:a}=await s.from("game_records").select("provider_id, bet_amount").in("user_id",h).gte("played_at",j);if(a&&a.length>0){const n=[410,77,2,30,78,86,11,28,89,91,44,85,0];I=a.filter(t=>n.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0),E=a.filter(t=>!n.includes(Number(t.provider_id))).reduce((t,l)=>t+Number(l.bet_amount||0),0)}}const ee=R+k,te=q+L;C(a=>({...a,total_users:V||0,daily_deposit:ee,daily_withdrawal:te,daily_net_deposit:ee-te,online_users:X||0,casino_betting:P+I,slot_betting:T+E,total_betting:P+T+I+E,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0})),p({deposit:R,withdrawal:q,netDeposit:R-q,casinoBetting:P,slotBetting:T,totalBetting:P+T}),f({deposit:k,withdrawal:L,netDeposit:k-L,casinoBetting:I,slotBetting:E,totalBetting:I+E}),U(me),console.log(""),console.log("âœ… ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (RPC ì—†ìŒ)"),console.log("============================================")}catch(i){console.error(""),console.error("============================================"),console.error("âŒ ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë”© ì˜¤ë¥˜"),console.error("Error:",i),console.error("Message:",i?.message),console.error("Details:",i?.details),console.error("Hint:",i?.hint),console.error("============================================"),je.error("ëŒ€ì‹œë³´ë“œ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: "+(i?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"))}finally{z(!1)}};return x.useEffect(()=>{B()},[]),x.useEffect(()=>{const i=setInterval(()=>{le(new Date)},1e3);return()=>clearInterval(i)},[]),x.useEffect(()=>{console.log("ğŸ”” ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… ì‹œì‘:",o.id);const i=s.channel("dashboard_transactions").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},y=>{console.log("ğŸ’° [ëŒ€ì‹œë³´ë“œ] transactions ë³€ê²½ ê°ì§€:",y.eventType),B()}).subscribe(),v=s.channel("dashboard_partners").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${o.id}`},y=>{console.log("ğŸ’° [ëŒ€ì‹œë³´ë“œ] partners ë³´ìœ ê¸ˆ ë³€ê²½ ê°ì§€:",y.new),B()}).subscribe(),A=s.channel("dashboard_game_records").on("postgres_changes",{event:"INSERT",schema:"public",table:"game_records"},y=>{console.log("ğŸ® [ëŒ€ì‹œë³´ë“œ] game_records ë³€ê²½ ê°ì§€:",y.eventType),B()}).subscribe(),w=s.channel("dashboard_users").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},y=>{console.log("ğŸ‘¤ [ëŒ€ì‹œë³´ë“œ] users ë³€ê²½ ê°ì§€:",y.eventType),B()}).subscribe();return()=>{console.log("ğŸ”• ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… í•´ì œ"),s.removeChannel(i),s.removeChannel(v),s.removeChannel(A),s.removeChannel(w)}},[o.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ"}),e.jsxs("p",{className:"text-sm text-slate-400",children:[ve(o.level)," Â· ",o.nickname,"ë‹˜ì˜ ì‹¤ì‹œê°„ í˜„í™©"]})]}),e.jsxs(we,{variant:"outline",className:"flex items-center gap-2 px-3 py-1.5 text-xs badge-premium-primary",children:[e.jsx(Ce,{className:"h-3.5 w-3.5"}),oe.toLocaleString("ko-KR")]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(O,{title:"ì´ íšŒì›ìˆ˜",value:ye(_.total_users),subtitle:"â†‘ ë“±ë¡ íšŒì› ìˆ˜",icon:De,color:"blue"}),e.jsx(O,{title:"ë³´ìœ ê¸ˆ",value:c(g),subtitle:o.level<=2?"â†‘ GET /api/info ì‘ë‹µ":"â†‘ ì¶©ì „ê¸ˆ (ë‚´ë¶€ê³„ì‚°)",icon:Se,color:"green"}),e.jsx(O,{title:"ë§Œì¶©ê¸ˆ",value:c(S),subtitle:"â†‘ ê±°ë˜ì¤‘ - ì¶©ì „ ê¸ˆì•¡",icon:$,color:"orange"}),e.jsx(O,{title:"ì˜¤ëŠ˜ ìˆ˜ìµ",value:c(_.daily_net_deposit),subtitle:_.daily_net_deposit>=0?"â†‘ +5.0%":"â†“ -5.0%",icon:Be,color:"pink"})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsxs(H,{title:"ìì‹ ì˜ ì‚¬ìš©ì ì…ì¶œê¸ˆ",icon:M,iconColor:"text-cyan-400",children:[e.jsx(u,{label:"ì¼ì¼ ì…ê¸ˆ ê¸ˆì•¡",value:c(r.deposit),valueColor:"text-cyan-400",icon:M,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ì¼ì¼ ì¶œê¸ˆ ê¸ˆì•¡",value:c(r.withdrawal),valueColor:"text-rose-400",icon:ae,iconColor:"text-rose-400"}),e.jsx(u,{label:"ì¼ì¼ ìˆœì…ì¶œê¸ˆ ê¸ˆì•¡",value:c(r.netDeposit),valueColor:"text-cyan-400",icon:$,iconColor:"text-cyan-400"})]}),e.jsxs(H,{title:"ìì‹ ì˜ ì‚¬ìš©ì ë² íŒ…",icon:W,iconColor:"text-amber-400",children:[e.jsx(u,{label:"ì¹´ì§€ë…¸ ì´ ë°°íŒ…",value:c(r.casinoBetting),valueColor:"text-cyan-400",icon:se,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ìŠ¬ë¡¯ ì´ ë°°íŒ…",value:c(r.slotBetting),valueColor:"text-amber-400",icon:W,iconColor:"text-amber-400"}),e.jsx(u,{label:"ì „ì²´ ë°°íŒ… ê¸ˆì•¡",value:c(r.totalBetting),valueColor:"text-cyan-400",icon:ne,iconColor:"text-cyan-400"})]}),e.jsxs(H,{title:"í•˜ìœ„íŒŒíŠ¸ë„ˆ ì‚¬ìš©ì ì…ì¶œê¸ˆ",icon:M,iconColor:"text-purple-400",children:[e.jsx(u,{label:"ì¼ì¼ ì…ê¸ˆ ê¸ˆì•¡",value:c(d.deposit),valueColor:"text-cyan-400",icon:M,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ì¼ì¼ ì¶œê¸ˆ ê¸ˆì•¡",value:c(d.withdrawal),valueColor:"text-rose-400",icon:ae,iconColor:"text-rose-400"}),e.jsx(u,{label:"ì¼ì¼ ìˆœì…ì¶œê¸ˆ ê¸ˆì•¡",value:c(d.netDeposit),valueColor:"text-cyan-400",icon:$,iconColor:"text-cyan-400"})]}),e.jsxs(H,{title:"í•˜ìœ„íŒŒíŠ¸ë„ˆ ì‚¬ìš©ì ë² íŒ…",icon:W,iconColor:"text-green-400",children:[e.jsx(u,{label:"ì¹´ì§€ë…¸ ì´ ë°°íŒ…",value:c(d.casinoBetting),valueColor:"text-cyan-400",icon:se,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ìŠ¬ë¡¯ ì´ ë°°íŒ…",value:c(d.slotBetting),valueColor:"text-amber-400",icon:W,iconColor:"text-amber-400"}),e.jsx(u,{label:"ì „ì²´ ë°°íŒ… ê¸ˆì•¡",value:c(d.totalBetting),valueColor:"text-cyan-400",icon:ne,iconColor:"text-cyan-400"})]})]})]})}export{Oe as Dashboard,Oe as default};

import{c as N,j as e,C as ge,a as xe,b as be,d as he,e as fe,u as _e,r as x,s as n,g as ve,B as we,U as ye,f as je,W as Ne,h as c,A as Ce,T as M,i as ne,t as De}from"./index-BWgbPZ4l.js";import{M as O}from"./MetricCard-CsQsoRGz.js";import{C as Se}from"./clock-BQI8X08V.js";import{D as $}from"./dollar-sign-DTrUq9JA.js";import{Z as W}from"./zap-D_qKtgKG.js";import{T as oe}from"./target-DWFO45Tt.js";import{C as le}from"./chart-column-BeQZ38ke.js";function H({title:l,description:g,children:f,className:C,headerAction:r,action:p,variant:d="modern",icon:_,iconColor:S="text-cyan-400"}){const U=N("transition-all duration-300 border-0",{"glass-card":d==="default"||d==="glass","admin-card-modern":d==="modern","glass-card rounded-2xl border border-slate-700/50":d==="premium"},C);return d==="premium"&&_?e.jsxs("div",{className:U,children:[e.jsxs("div",{className:"flex items-center gap-3 mb-6 pb-4 border-b border-slate-700/50 px-6 pt-6",children:[e.jsx("div",{className:N("p-2 rounded-lg bg-slate-800/50",S.replace("text-","bg-")+"/20"),children:e.jsx(_,{className:N("h-5 w-5",S)})}),e.jsx("h3",{className:"font-semibold text-slate-100",children:l}),(r||p)&&e.jsxs("div",{className:"ml-auto flex items-center gap-3",children:[r,p]})]}),e.jsx("div",{className:"space-y-3 px-6 pb-6",children:f})]}):e.jsxs(ge,{className:U,children:[(l||g||r||p||_)&&e.jsx(xe,{className:"pb-5",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[_&&e.jsx("div",{className:N("p-2 rounded-lg bg-slate-800/50",S.replace("text-","bg-")+"/20"),children:e.jsx(_,{className:N("h-5 w-5",S)})}),e.jsxs("div",{className:"space-y-1.5",children:[l&&e.jsx(be,{className:"text-xl font-bold text-slate-100",children:l}),g&&e.jsx(he,{className:"text-base text-slate-400",children:g})]})]}),(r||p)&&e.jsxs("div",{className:"flex items-center gap-3",children:[r,p]})]})}),e.jsx(fe,{className:l||g||r||p||_?"pt-0":"pt-7",children:f})]})}function u({label:l,value:g,valueColor:f="text-cyan-400",badge:C,badgeColor:r="bg-cyan-500/20 text-cyan-400",icon:p,iconColor:d="text-slate-400"}){return e.jsxs("div",{className:"flex items-center justify-between py-3 px-4 rounded-lg bg-slate-800/30 hover:bg-slate-800/50 transition-colors",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[p&&e.jsx("div",{className:N("p-1.5 rounded-lg bg-slate-700/50",d),children:e.jsx(p,{className:"h-4 w-4"})}),e.jsx("span",{className:"text-slate-300 font-medium",children:l})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[C&&e.jsx("span",{className:N("px-2.5 py-1 rounded-full text-xs font-semibold",r),children:C}),e.jsx("span",{className:N("font-bold text-lg",f),children:g})]})]})}function ke({user:l}){const{balance:g}=_e(),[f,C]=x.useState({total_users:0,total_balance:0,daily_deposit:0,daily_withdrawal:0,daily_net_deposit:0,casino_betting:0,slot_betting:0,total_betting:0,online_users:0,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0}),[r,p]=x.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[d,_]=x.useState({deposit:0,withdrawal:0,netDeposit:0,casinoBetting:0,slotBetting:0,totalBetting:0}),[S,U]=x.useState(0),[Be,z]=x.useState(!0),[re,ie]=x.useState(new Date);if(x.useEffect(()=>{C(i=>({...i,total_balance:g}))},[g]),!l||typeof l.level!="number")return e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("div",{className:"loading-premium mx-auto"}),e.jsx("p",{className:"text-muted-foreground",children:"ëŒ€ì‹œë³´ë“œë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘..."})]})});const B=async()=>{try{z(!0),console.log("============================================"),console.log("ğŸ“Š ëŒ€ì‹œë³´ë“œ í†µê³„ ì¡°íšŒ ì‹œì‘"),console.log("Partner ID:",l.id),console.log("Partner Level:",l.level),console.log("Partner Type:",l.partner_type),console.log("============================================");const i=new Date;i.setHours(0,0,0,0),console.log("ğŸ” ì§ì ‘ DB ì¡°íšŒ ì‹œì‘...");const{data:v,error:A}=await n.from("transactions").select("transaction_type, status, amount, created_at").gte("created_at",i.toISOString());if(console.log("ğŸ“Š ì˜¤ëŠ˜ transactions:",v?.length||0,"ê±´"),v&&v.length>0){console.log("ìƒì„¸:",v);const a=v.filter(t=>t.transaction_type==="deposit"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount>0&&["approved","completed"].includes(t.status)).reduce((t,o)=>t+Number(o.amount),0),s=v.filter(t=>t.transaction_type==="withdrawal"&&["approved","completed"].includes(t.status)||t.transaction_type==="admin_adjustment"&&t.amount<0&&["approved","completed"].includes(t.status)).reduce((t,o)=>t+Math.abs(Number(o.amount)),0);console.log("ğŸ’° ì§ì ‘ ê³„ì‚° ì…ê¸ˆ:",a),console.log("ğŸ’¸ ì§ì ‘ ê³„ì‚° ì¶œê¸ˆ:",s)}const{data:w,error:y}=await n.from("game_records").select("provider_id, bet_amount, played_at").gte("played_at",i.toISOString());if(console.log("ğŸ® ì˜¤ëŠ˜ game_records:",w?.length||0,"ê±´"),w&&w.length>0){console.log("ìƒì„¸:",w);const a=[410,77,2,30,78,86,11,28,89,91,44,85,0],s=w.filter(o=>a.includes(Number(o.provider_id))).reduce((o,D)=>o+Number(D.bet_amount),0),t=w.filter(o=>!a.includes(Number(o.provider_id))).reduce((o,D)=>o+Number(D.bet_amount),0);console.log("ğŸ° ì§ì ‘ ê³„ì‚° ì¹´ì§€ë…¸:",s),console.log("ğŸ² ì§ì ‘ ê³„ì‚° ìŠ¬ë¡¯:",t)}console.log(""),console.log("ğŸ”§ ì§ì ‘ SELECT ì¿¼ë¦¬ ì‹œì‘ (RPC ì œê±°)...");const ce=new Date,J=540*60*1e3,Z=new Date(ce.getTime()+J),de=new Date(Z.getFullYear(),Z.getMonth(),Z.getDate()),j=new Date(de.getTime()-J).toISOString();console.log("ğŸ“… ì˜¤ëŠ˜ ì‹œì‘ ì‹œê°:",j);let m=[];if(l.level===1){const{data:a}=await n.from("partners").select("id");m=a?.map(s=>s.id)||[]}else{m=[l.id];const{data:a}=await n.from("partners").select("id").eq("parent_id",l.id),s=a?.map(t=>t.id)||[];if(m.push(...s),s.length>0){const{data:t}=await n.from("partners").select("id").in("parent_id",s),o=t?.map(D=>D.id)||[];if(m.push(...o),o.length>0){const{data:D}=await n.from("partners").select("id").in("parent_id",o),F=D?.map(G=>G.id)||[];if(m.push(...F),F.length>0){const{data:G}=await n.from("partners").select("id").in("parent_id",F),K=G?.map(Y=>Y.id)||[];if(m.push(...K),K.length>0){const{data:Y}=await n.from("partners").select("id").in("parent_id",K),ue=Y?.map(pe=>pe.id)||[];m.push(...ue)}}}}}console.log("ğŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ ID ê°œìˆ˜:",m.length);let b=[];const{data:me}=await n.from("users").select("id").eq("referrer_id",l.id);b=me?.map(a=>a.id)||[],console.log("ğŸ‘¤ ì§ì† íšŒì› ID ê°œìˆ˜:",b.length);let h=[];const Q=m.filter(a=>a!==l.id);if(Q.length>0){const{data:a}=await n.from("users").select("id").in("referrer_id",Q);h=a?.map(s=>s.id)||[],console.log("ğŸ‘¥ í•˜ìœ„ íŒŒíŠ¸ë„ˆ íšŒì› ID ê°œìˆ˜:",h.length)}let q=0;if(b.length>0){const{data:a}=await n.from("transactions").select("amount").in("transaction_type",["deposit","admin_deposit"]).eq("status","completed").in("user_id",b).gte("created_at",j);q=a?.reduce((s,t)=>s+Number(t.amount),0)||0}let R=0;if(b.length>0){const{data:a}=await n.from("transactions").select("amount").in("transaction_type",["withdrawal","admin_withdrawal"]).eq("status","completed").in("user_id",b).gte("created_at",j);R=a?.reduce((s,t)=>s+Number(t.amount),0)||0}let k=0;if(h.length>0){const{data:a}=await n.from("transactions").select("amount").in("transaction_type",["deposit","admin_deposit"]).eq("status","completed").in("user_id",h).gte("created_at",j);k=a?.reduce((s,t)=>s+Number(t.amount),0)||0}let L=0;if(h.length>0){const{data:a}=await n.from("transactions").select("amount").in("transaction_type",["withdrawal","admin_withdrawal"]).eq("status","completed").in("user_id",h).gte("created_at",j);L=a?.reduce((s,t)=>s+Number(t.amount),0)||0}let V=0;if(m.length>0){const{count:a}=await n.from("users").select("id",{count:"exact",head:!0}).in("referrer_id",m);V=a||0}let X=0;if(m.length>0){const{count:a}=await n.from("users").select("id",{count:"exact",head:!0}).in("referrer_id",m).eq("is_online",!0);X=a||0}let ee=0;const te=[...b,...h];if(te.length>0){const{data:a,error:s}=await n.from("transactions").select("amount").eq("transaction_type","deposit").eq("status","pending").in("user_id",te).gte("created_at",j);s&&console.error("âŒ ë§Œì¶©ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",s),ee=a?.reduce((t,o)=>t+Number(o.amount),0)||0}let P=0,T=0;if(b.length>0){const{data:a}=await n.from("game_records").select("provider_id, bet_amount").in("user_id",b).gte("played_at",j);if(a&&a.length>0){const s=[410,77,2,30,78,86,11,28,89,91,44,85,0];P=a.filter(t=>s.includes(Number(t.provider_id))).reduce((t,o)=>t+Number(o.bet_amount||0),0),T=a.filter(t=>!s.includes(Number(t.provider_id))).reduce((t,o)=>t+Number(o.bet_amount||0),0)}}let E=0,I=0;if(h.length>0){const{data:a}=await n.from("game_records").select("provider_id, bet_amount").in("user_id",h).gte("played_at",j);if(a&&a.length>0){const s=[410,77,2,30,78,86,11,28,89,91,44,85,0];E=a.filter(t=>s.includes(Number(t.provider_id))).reduce((t,o)=>t+Number(o.bet_amount||0),0),I=a.filter(t=>!s.includes(Number(t.provider_id))).reduce((t,o)=>t+Number(o.bet_amount||0),0)}}const ae=q+k,se=R+L;C(a=>({...a,total_users:V||0,daily_deposit:ae,daily_withdrawal:se,daily_net_deposit:ae-se,online_users:X||0,casino_betting:P+E,slot_betting:T+I,total_betting:P+T+E+I,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0})),p({deposit:q,withdrawal:R,netDeposit:q-R,casinoBetting:P,slotBetting:T,totalBetting:P+T}),_({deposit:k,withdrawal:L,netDeposit:k-L,casinoBetting:E,slotBetting:I,totalBetting:E+I}),U(ee),console.log(""),console.log("âœ… ëŒ€ì‹œë³´ë“œ í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (RPC ì—†ìŒ)"),console.log("============================================")}catch(i){console.error(""),console.error("============================================"),console.error("âŒ ëŒ€ì‹œë³´ë“œ í†µê³„ ë¡œë”© ì˜¤ë¥˜"),console.error("Error:",i),console.error("Message:",i?.message),console.error("Details:",i?.details),console.error("Hint:",i?.hint),console.error("============================================"),De.error("ëŒ€ì‹œë³´ë“œ í†µê³„ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: "+(i?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"))}finally{z(!1)}};return x.useEffect(()=>{B()},[]),x.useEffect(()=>{const i=setInterval(()=>{ie(new Date)},1e3);return()=>clearInterval(i)},[]),x.useEffect(()=>{console.log("ğŸ”” ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… ì‹œì‘:",l.id);const i=n.channel("dashboard_transactions").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},y=>{console.log("ğŸ’° [ëŒ€ì‹œë³´ë“œ] transactions ë³€ê²½ ê°ì§€:",y.eventType),B()}).subscribe(),v=n.channel("dashboard_partners").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${l.id}`},y=>{console.log("ğŸ’° [ëŒ€ì‹œë³´ë“œ] partners ë³´ìœ ê¸ˆ ë³€ê²½ ê°ì§€:",y.new),B()}).subscribe(),A=n.channel("dashboard_game_records").on("postgres_changes",{event:"INSERT",schema:"public",table:"game_records"},y=>{console.log("ğŸ® [ëŒ€ì‹œë³´ë“œ] game_records ë³€ê²½ ê°ì§€:",y.eventType),B()}).subscribe(),w=n.channel("dashboard_users").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},y=>{console.log("ğŸ‘¤ [ëŒ€ì‹œë³´ë“œ] users ë³€ê²½ ê°ì§€:",y.eventType),B()}).subscribe();return()=>{console.log("ğŸ”• ëŒ€ì‹œë³´ë“œ Realtime êµ¬ë… í•´ì œ"),n.removeChannel(i),n.removeChannel(v),n.removeChannel(A),n.removeChannel(w)}},[l.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between gap-4 mb-8",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ"}),e.jsxs("p",{className:"text-sm text-slate-400",children:[ve(l.level)," Â· ",l.nickname,"ë‹˜ì˜ ì‹¤ì‹œê°„ í˜„í™©"]})]}),e.jsxs(we,{variant:"outline",className:"flex items-center gap-2 px-3 py-1.5 text-xs badge-premium-primary",children:[e.jsx(Se,{className:"h-3.5 w-3.5"}),re.toLocaleString("ko-KR")]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(O,{title:"ì´ íšŒì›ìˆ˜",value:je(f.total_users),subtitle:"â†‘ ë“±ë¡ íšŒì› ìˆ˜",icon:ye,color:"blue"}),e.jsx(O,{title:"ë³´ìœ ê¸ˆ",value:c(g),subtitle:l.level<=2?"â†‘ GET /api/info ì‘ë‹µ":"â†‘ ì¶©ì „ê¸ˆ (ë‚´ë¶€ê³„ì‚°)",icon:Ne,color:"green"}),e.jsx(O,{title:"ë§Œì¶©ê¸ˆ",value:c(S),subtitle:"â†‘ ê±°ë˜ì¤‘ - ì¶©ì „ ê¸ˆì•¡",icon:$,color:"orange"}),e.jsx(O,{title:"ì˜¤ëŠ˜ ìˆ˜ìµ",value:c(f.daily_net_deposit),subtitle:f.daily_net_deposit>=0?"â†‘ +5.0%":"â†“ -5.0%",icon:Ce,color:"pink"})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2",children:[e.jsxs(H,{title:"ìì‹ ì˜ ì‚¬ìš©ì ì…ì¶œê¸ˆ",icon:M,iconColor:"text-cyan-400",children:[e.jsx(u,{label:"ì¼ì¼ ì…ê¸ˆ ê¸ˆì•¡",value:c(r.deposit),valueColor:"text-cyan-400",icon:M,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ì¼ì¼ ì¶œê¸ˆ ê¸ˆì•¡",value:c(r.withdrawal),valueColor:"text-rose-400",icon:ne,iconColor:"text-rose-400"}),e.jsx(u,{label:"ì¼ì¼ ìˆœì…ì¶œê¸ˆ ê¸ˆì•¡",value:c(r.netDeposit),valueColor:"text-cyan-400",icon:$,iconColor:"text-cyan-400"})]}),e.jsxs(H,{title:"ìì‹ ì˜ ì‚¬ìš©ì ë² íŒ…",icon:W,iconColor:"text-amber-400",children:[e.jsx(u,{label:"ì¹´ì§€ë…¸ ì´ ë°°íŒ…",value:c(r.casinoBetting),valueColor:"text-cyan-400",icon:oe,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ìŠ¬ë¡¯ ì´ ë°°íŒ…",value:c(r.slotBetting),valueColor:"text-amber-400",icon:W,iconColor:"text-amber-400"}),e.jsx(u,{label:"ì „ì²´ ë°°íŒ… ê¸ˆì•¡",value:c(r.totalBetting),valueColor:"text-cyan-400",icon:le,iconColor:"text-cyan-400"})]}),e.jsxs(H,{title:"í•˜ìœ„íŒŒíŠ¸ë„ˆ ì‚¬ìš©ì ì…ì¶œê¸ˆ",icon:M,iconColor:"text-purple-400",children:[e.jsx(u,{label:"ì¼ì¼ ì…ê¸ˆ ê¸ˆì•¡",value:c(d.deposit),valueColor:"text-cyan-400",icon:M,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ì¼ì¼ ì¶œê¸ˆ ê¸ˆì•¡",value:c(d.withdrawal),valueColor:"text-rose-400",icon:ne,iconColor:"text-rose-400"}),e.jsx(u,{label:"ì¼ì¼ ìˆœì…ì¶œê¸ˆ ê¸ˆì•¡",value:c(d.netDeposit),valueColor:"text-cyan-400",icon:$,iconColor:"text-cyan-400"})]}),e.jsxs(H,{title:"í•˜ìœ„íŒŒíŠ¸ë„ˆ ì‚¬ìš©ì ë² íŒ…",icon:W,iconColor:"text-green-400",children:[e.jsx(u,{label:"ì¹´ì§€ë…¸ ì´ ë°°íŒ…",value:c(d.casinoBetting),valueColor:"text-cyan-400",icon:oe,iconColor:"text-cyan-400"}),e.jsx(u,{label:"ìŠ¬ë¡¯ ì´ ë°°íŒ…",value:c(d.slotBetting),valueColor:"text-amber-400",icon:W,iconColor:"text-amber-400"}),e.jsx(u,{label:"ì „ì²´ ë°°íŒ… ê¸ˆì•¡",value:c(d.totalBetting),valueColor:"text-cyan-400",icon:le,iconColor:"text-cyan-400"})]})]})]})}export{ke as Dashboard,ke as default};

import{r as l,j as e}from"./react-core-CwM-CeLv.js";import{o as Ie,s as f,m as De,i as b,T as Te,j as Fe,k as P,S as X,p as Z,q as ee,r as te,t as L,I as ae,c as se,l as R,L as I,B as re,w as ne,x as oe,y as ie,z as le,A as Ae}from"./index-Cn1S8-JW.js";import{T as ce}from"./textarea-DcWc96jr.js";import{A as de,a as me,b as pe,c as he,d as ue,e as ge}from"./AdminDialog-qdCOZfhu.js";import{C as Le,a as $e,e as Ee,b as qe,c as Me,d as Oe}from"./command-D1kDSEeZ.js";import{P as Pe,a as Re,b as We}from"./popover-KcKD6lRl.js";import{D as W}from"./DataTable-CjdfiZ7Q.js";import{k as j}from"./vendor-CQn7sZ7L.js";import{M as B}from"./MetricCard-CBRAhT7E.js";import{P as Be,T as Ue,i as Ke,t as ze,z as Ve,d as Ge,K as He,R as Ye,Y as Qe,$ as Je,_ as Xe,k as Ze,O as et}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";import"./dialog-CE9i0HK9.js";function ut({user:h}){const{lastMessage:x,sendMessage:z}=Ie(),[y,U]=l.useState(!0),[N,_]=l.useState(!1),xe=()=>{const t=window.location.hash.substring(1);return t==="deposit-request"||t==="withdrawal-request"||t==="deposit-history"||t==="withdrawal-history"?t:"deposit-request"},[D,V]=l.useState(xe()),[$,G]=l.useState([]),[w,fe]=l.useState([]),[S,be]=l.useState("today"),[K,je]=l.useState(""),[E,T]=l.useState(0),[q,H]=l.useState({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),[c,F]=l.useState({open:!1,transaction:null,action:"approve",memo:""}),[s,u]=l.useState({open:!1,type:"deposit",userId:"",amount:"",memo:""}),[Y,Q]=l.useState(!1),ve=[1e3,3e3,5e3,1e4,3e4,5e4,1e5,3e5,5e5,1e6];l.useEffect(()=>{const t=()=>{const a=window.location.hash.substring(1);(a==="deposit-request"||a==="withdrawal-request"||a==="deposit-history"||a==="withdrawal-history")&&V(a)};return window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)},[]);const C=async(t=!1)=>{try{t?U(!0):_(!0),console.log("🔄 데이터 로드 시작:",{isInitial:t,periodFilter:S,userLevel:h.level});const a=we(S);let r=f.from("transactions").select(`
          *,
          user:users(id, nickname, username, balance, bank_name, bank_account, bank_holder),
          processed_partner:partners!transactions_processed_by_fkey(nickname, level)
        `).gte("created_at",a.start).lte("created_at",a.end);if(h.level>1){const{data:m}=await f.from("users").select("id").eq("referrer_id",h.id),p=m?.map(g=>g.id)||[];if(p.length>0)r=r.in("user_id",p);else{G([]),H({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),t&&U(!1);return}}const{data:n,error:i}=await r.order("created_at",{ascending:!1});if(i)throw i;console.log("✅ 거래 데이터 로드 완료:",n?.length||0,"건"),G(n||[]);let d=f.from("users").select("id, nickname, username, balance, bank_name, bank_account, bank_holder").eq("status","active");h.level>1&&(d=d.eq("referrer_id",h.id));const{data:v}=await d.order("nickname");if(fe(v||[]),n){const m=n.filter(o=>(o.transaction_type==="deposit"||o.transaction_type==="admin_deposit")&&o.status==="completed").reduce((o,A)=>o+parseFloat(A.amount.toString()),0),p=n.filter(o=>(o.transaction_type==="withdrawal"||o.transaction_type==="admin_withdrawal")&&o.status==="completed").reduce((o,A)=>o+parseFloat(A.amount.toString()),0),g=n.filter(o=>o.transaction_type==="deposit"&&o.status==="pending"),k=n.filter(o=>o.transaction_type==="withdrawal"&&o.status==="pending");console.log("📊 통계 계산:",{depositSum:m,withdrawalSum:p,depositCount:n.filter(o=>(o.transaction_type==="deposit"||o.transaction_type==="admin_deposit")&&o.status==="completed").length,withdrawalCount:n.filter(o=>(o.transaction_type==="withdrawal"||o.transaction_type==="admin_withdrawal")&&o.status==="completed").length}),H({totalDeposit:m,totalWithdrawal:p,pendingDepositCount:g.length,pendingWithdrawalCount:k.length})}}catch(a){console.error("❌ 데이터 로드 실패:",a),j.error("데이터를 불러오는데 실패했습니다.")}finally{t?U(!1):_(!1)}},we=t=>{const a=new Date,r=new Date(a.getFullYear(),a.getMonth(),a.getDate());switch(t){case"today":return{start:r.toISOString(),end:a.toISOString()};case"week":const n=new Date(r);return n.setDate(r.getDate()-7),{start:n.toISOString(),end:a.toISOString()};case"month":const i=new Date(r);return i.setMonth(r.getMonth()-1),{start:i.toISOString(),end:a.toISOString()};default:return{start:r.toISOString(),end:a.toISOString()}}};l.useEffect(()=>{C(!0)},[]),l.useEffect(()=>{y||C(!1)},[S,E]),l.useEffect(()=>{const t=f.channel("transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},a=>{console.log("💰 transactions 테이블 변경 감지:",a),T(r=>r+1)}).subscribe();return()=>{f.removeChannel(t)}},[]),l.useEffect(()=>{x&&["deposit_approved","withdrawal_approved","deposit_rejected","withdrawal_rejected"].includes(x.type)&&(console.log("💬 WebSocket 입출금 알림:",x),T(t=>t+1))},[x]);const J=(t,a)=>{F({open:!0,transaction:t,action:a,memo:""})},ye=async()=>{if(c.transaction)try{_(!0);const{action:t,transaction:a,memo:r}=c;if(t==="approve"){const i=await ne(h),d=oe(i)?i.opcodes[0]:i;if(!a.user?.username)throw new Error("사용자 정보를 찾을 수 없습니다.");const v=Math.floor(parseFloat(a.amount.toString()));console.log("💰 거래 승인 처리 시작:",{transaction_type:a.transaction_type,username:a.user.username,amount:v,opcode:d.opcode});let m;if(a.transaction_type==="deposit"?(console.log("📥 입금 API 호출 중..."),m=await ie(a.user.username,v,d.opcode,d.token,d.secretKey)):a.transaction_type==="withdrawal"&&(console.log("📤 출금 API 호출 중..."),m=await le(a.user.username,v,d.opcode,d.token,d.secretKey)),m&&!m.success)throw console.error("❌ Invest API 호출 실패:",m),new Error(m.error||"Invest API 호출 실패");console.log("✅ Invest API 처리 완료:",m)}const{error:n}=await f.from("transactions").update({status:t==="approve"?"completed":"rejected",processed_by:h.id,processed_at:new Date().toISOString(),memo:t==="reject"?r:a.memo}).eq("id",a.id);if(n)throw n;j.success(`거래가 ${t==="approve"?"승인":"거절"}되었습니다.`),z({type:"transaction_processed",data:{transactionId:a.id,action:t,processedBy:h.nickname,userId:a.user_id}}),F({open:!1,transaction:null,action:"approve",memo:""})}catch(t){console.error("거래 처리 실패:",t),j.error(t instanceof Error?t.message:"거래 처리에 실패했습니다.")}finally{_(!1)}},Ne=async()=>{try{_(!0);const{type:t,userId:a,amount:r,memo:n}=s;if(!a||!r){j.error("회원과 금액을 입력해주세요.");return}const i=w.find(A=>A.id===a);if(!i){j.error("회원을 찾을 수 없습니다.");return}if(!i.username){j.error("회원 username을 찾을 수 없습니다.");return}const d=Math.floor(parseFloat(r)),v=parseFloat(i.balance?.toString()||"0");if(console.log("💰 강제 입출금 처리 시작:",{type:t,username:i.username,amount:d,balanceBefore:v}),t==="withdrawal"&&d>v){j.error(`출금 금액이 보유금(₩${v.toLocaleString()})을 초과할 수 없습니다.`),_(!1);return}const m=await ne(h),p=oe(m)?m.opcodes[0]:m;console.log("🔑 OPCODE 설정:",{opcode:p.opcode,token:"***"+p.token.slice(-4),secretKey:"***"+p.secretKey.slice(-4)});let g;if(t==="deposit"?(console.log("📥 입금 API 호출 중..."),g=await ie(i.username,d,p.opcode,p.token,p.secretKey)):(console.log("📤 출금 API 호출 중..."),g=await le(i.username,d,p.opcode,p.token,p.secretKey)),!g.success||g.error)throw new Error(g.error||"Invest API 호출 실패");console.log("✅ Invest API 강제 입출금 완료:",g);const k=Ae(g.data,i.username);console.log("💰 실제 잔고:",k);const{error:o}=await f.from("transactions").insert({user_id:a,partner_id:h.id,transaction_type:t==="deposit"?"admin_deposit":"admin_withdrawal",amount:d,status:"completed",balance_before:v,balance_after:k,memo:`[관리자 강제 ${t==="deposit"?"입금":"출금"}] ${n}`,processed_by:h.id,processed_at:new Date().toISOString(),external_response:g.data});if(o)throw o;console.log("✅ transactions INSERT 완료 → 트리거가 users.balance 자동 업데이트"),j.success(`강제 ${t==="deposit"?"입금":"출금"}이 완료되었습니다. (잔액: ₩${k.toLocaleString()})`),z({type:"admin_force_transaction",data:{userId:a,type:t,amount:d,balanceAfter:k,processedBy:h.nickname}}),u({open:!1,type:"deposit",userId:"",amount:"",memo:""})}catch(t){console.error("강제 입출금 실패:",t),j.error(t instanceof Error?t.message:"강제 입출금에 실패했습니다.")}finally{_(!1)}};if(l.useEffect(()=>{C(!0)},[]),l.useEffect(()=>{E>0&&!y&&(console.log("🔄 Realtime 트리거 데이터 로드:",E),C(!1))},[E]),l.useEffect(()=>{y||(console.log("📅 기간 필터 변경:",S),C(!1))},[S]),l.useEffect(()=>{console.log("🔌 Realtime subscription 설정 중...");const t=f.channel("transactions-realtime-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},r=>{console.log("💳 transactions 테이블 변경 감지:",r.eventType,r.new),T(n=>n+1)}).subscribe(r=>{console.log("💳 transactions 채널 구독 상태:",r)}),a=f.channel("users-realtime-balance-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},r=>{console.log("👤 users 테이블 변경 감지:",r.new),T(n=>n+1)}).subscribe(r=>{console.log("👤 users 채널 구독 상태:",r)});return()=>{console.log("🔌 Realtime subscription 정리 중..."),f.removeChannel(t),f.removeChannel(a)}},[]),l.useEffect(()=>{(x?.type==="transaction_update"||x?.type==="deposit_request"||x?.type==="withdrawal_request"||x?.type==="admin_force_transaction"||x?.type==="transaction_processed")&&(console.log("📨 WebSocket 메시지 수신:",x.type),T(t=>t+1))},[x]),y)return e.jsx(De,{});const M=t=>K===""||t.user?.nickname?.toLowerCase().includes(K.toLowerCase()),_e=$.filter(t=>t.transaction_type==="deposit"&&t.status==="pending"&&M(t)),Se=$.filter(t=>t.transaction_type==="withdrawal"&&t.status==="pending"&&M(t)),Ce=$.filter(t=>(t.transaction_type==="deposit"||t.transaction_type==="withdrawal")&&t.status==="completed"&&M(t)),ke=$.filter(t=>(t.transaction_type==="admin_deposit"||t.transaction_type==="admin_withdrawal"||t.transaction_type==="admin_adjustment")&&t.status==="completed"&&M(t)),O=(t=!1)=>[{header:"거래 일시",cell:a=>e.jsx("span",{className:"text-sm text-slate-300",children:new Date(a.created_at).toLocaleString("ko-KR")})},{header:"회원",cell:a=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-200",children:a.user?.nickname}),e.jsx("p",{className:"text-sm text-slate-500",children:a.user?.username})]})},{header:"거래 유형",cell:a=>{const n={deposit:{text:"입금",color:"bg-green-500"},withdrawal:{text:"출금",color:"bg-red-500"},admin_deposit:{text:"입금",color:"bg-green-600"},admin_withdrawal:{text:"출금",color:"bg-red-600"},admin_adjustment:{text:a.memo?.includes("강제 출금")?"출금":"입금",color:a.memo?.includes("강제 출금")?"bg-red-600":"bg-green-600"}}[a.transaction_type]||{text:a.transaction_type,color:"bg-gray-500"};return e.jsx(re,{className:`${n.color} text-white`,children:n.text})}},{header:"금액",cell:a=>{const r=a.transaction_type==="withdrawal"||a.transaction_type==="admin_withdrawal"||a.transaction_type==="admin_adjustment"&&a.memo?.includes("강제 출금");return e.jsxs("span",{className:se("font-mono font-semibold",r?"text-red-400":"text-green-400"),children:[r?"-":"+","₩",parseFloat(a.amount.toString()).toLocaleString()]})}},{header:"변경 후 보유금",cell:a=>e.jsxs("span",{className:"font-mono text-cyan-400",children:["₩",parseFloat(a.balance_after?.toString()||"0").toLocaleString()]})},{header:"상태",cell:a=>{const n={pending:{text:"대기",color:"bg-yellow-500"},completed:{text:"완료",color:"bg-green-500"},rejected:{text:"거절",color:"bg-red-500"}}[a.status]||{text:a.status,color:"bg-gray-500"};return e.jsx(re,{className:`${n.color} text-white`,children:n.text})}},{header:"메모",cell:a=>e.jsx("div",{className:"max-w-xs",children:e.jsx("span",{className:"text-sm text-slate-400 block truncate",title:a.memo||"",children:a.memo||"-"})})},{header:"처리자",cell:a=>e.jsx("span",{className:"text-sm text-slate-400",children:a.processed_partner?.nickname||"-"})},...t?[{header:"작업",cell:a=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(b,{size:"sm",onClick:()=>J(a,"approve"),disabled:N,className:"h-8 px-3 bg-green-600 hover:bg-green-700",children:"승인"}),e.jsx(b,{size:"sm",variant:"outline",onClick:()=>J(a,"reject"),disabled:N,className:"h-8 px-3 border-red-500 text-red-500 hover:bg-red-500 hover:text-white",children:"거절"})]})}]:[]];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"입출금 관리"}),e.jsx("p",{className:"text-sm text-slate-400",children:"회원 입출금 신청 및 처리 관리"})]}),e.jsxs(b,{onClick:()=>u({...s,open:!0}),className:"btn-premium-primary",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"강제 입출금"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(B,{title:"총 입금",value:`₩${q.totalDeposit.toLocaleString()}`,subtitle:"누적 입금",icon:Ue,color:"green"}),e.jsx(B,{title:"총 출금",value:`₩${q.totalWithdrawal.toLocaleString()}`,subtitle:"누적 출금",icon:Ke,color:"red"}),e.jsx(B,{title:"입금 신청",value:`${q.pendingDepositCount}건`,subtitle:"처리 대기",icon:ze,color:"amber"}),e.jsx(B,{title:"출금 신청",value:`${q.pendingWithdrawalCount}건`,subtitle:"처리 대기",icon:Ve,color:"orange"})]}),e.jsx("div",{className:"glass-card rounded-xl p-6",children:e.jsxs(Te,{value:D,onValueChange:V,className:"space-y-6",children:[e.jsx("div",{className:"bg-slate-800/30 rounded-xl p-1.5 border border-slate-700/40",children:e.jsxs(Fe,{className:"bg-transparent h-auto p-0 border-0 gap-2 w-full grid grid-cols-4",children:[e.jsx(P,{value:"deposit-request",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-blue-500/20 data-[state=active]:to-cyan-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-blue-500/20 data-[state=active]:border data-[state=active]:border-blue-400/30 transition-all duration-200",children:"입금 신청"}),e.jsx(P,{value:"withdrawal-request",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-purple-500/20 data-[state=active]:to-pink-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-purple-500/20 data-[state=active]:border data-[state=active]:border-purple-400/30 transition-all duration-200",children:"출금 신청"}),e.jsx(P,{value:"completed-history",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-green-500/20 data-[state=active]:to-emerald-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-green-500/20 data-[state=active]:border data-[state=active]:border-green-400/30 transition-all duration-200",children:"입출금 내역"}),e.jsx(P,{value:"admin-history",className:"bg-transparent text-slate-400 rounded-lg px-6 py-3 data-[state=active]:bg-gradient-to-br data-[state=active]:from-orange-500/20 data-[state=active]:to-amber-500/10 data-[state=active]:text-white data-[state=active]:shadow-lg data-[state=active]:shadow-orange-500/20 data-[state=active]:border data-[state=active]:border-orange-400/30 transition-all duration-200",children:"관리자 입출금 내역"})]})}),e.jsx("div",{className:"flex items-center justify-between pb-4 border-b border-slate-700/50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-slate-400"}),e.jsxs("h3",{className:"font-semibold text-slate-100",children:[D==="deposit-request"&&"입금 신청",D==="withdrawal-request"&&"출금 신청",D==="completed-history"&&"입출금 내역",D==="admin-history"&&"관리자 입출금 내역"]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{value:S,onValueChange:be,children:[e.jsx(Z,{className:"w-[140px] input-premium",children:e.jsx(ee,{placeholder:"기간"})}),e.jsxs(te,{className:"bg-slate-800 border-slate-700",children:[e.jsx(L,{value:"today",children:"오늘"}),e.jsx(L,{value:"week",children:"최근 7일"}),e.jsx(L,{value:"month",children:"최근 30일"})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(He,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(ae,{placeholder:"회원 검색...",className:"pl-10 input-premium",value:K,onChange:t=>je(t.target.value)})]}),e.jsxs(b,{onClick:()=>{console.log("🔄 수동 새로고침"),C(!1)},disabled:N,variant:"outline",className:"btn-premium-primary",children:[e.jsx(Ye,{className:se("h-4 w-4 mr-2",N&&"animate-spin")}),"새로고침"]})]}),e.jsx(R,{value:"deposit-request",children:e.jsx(W,{searchable:!1,columns:O(!0),data:_e,loading:y,emptyMessage:"입금 신청이 없습니다."})}),e.jsx(R,{value:"withdrawal-request",children:e.jsx(W,{searchable:!1,columns:O(!0),data:Se,loading:y,emptyMessage:"출금 신청이 없습니다."})}),e.jsx(R,{value:"completed-history",children:e.jsx(W,{searchable:!1,columns:O(!1),data:Ce,loading:y,emptyMessage:"입출금 내역이 없습니다."})}),e.jsx(R,{value:"admin-history",children:e.jsx(W,{searchable:!1,columns:O(!1),data:ke,loading:y,emptyMessage:"관리자 입출금 내역이 없습니다."})})]})}),e.jsx(de,{open:c.open,onOpenChange:t=>F({...c,open:t}),children:e.jsxs(me,{className:"bg-slate-900 border-slate-700",children:[e.jsxs(pe,{children:[e.jsx(he,{className:"text-white",children:c.action==="approve"?"거래 승인":"거래 거절"}),e.jsx(ue,{className:"text-slate-400",children:c.action==="approve"?"이 거래를 승인하시겠습니까?":"거절 사유를 입력해주세요."})]}),c.transaction&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"회원:"}),e.jsx("span",{className:"text-white",children:c.transaction.user?.nickname})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"거래 유형:"}),e.jsx("span",{className:"text-white",children:c.transaction.transaction_type==="deposit"?"입금":"출금"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"금액:"}),e.jsxs("span",{className:"text-green-400 font-mono",children:["₩",parseFloat(c.transaction.amount.toString()).toLocaleString()]})]})]}),c.action==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(I,{htmlFor:"transaction-reject-reason",className:"text-slate-300",children:"거절 사유"}),e.jsx(ce,{id:"transaction-reject-reason",name:"reject_reason",value:c.memo,onChange:t=>F({...c,memo:t.target.value}),placeholder:"거절 사유를 입력해주세요...",className:"bg-slate-800 border-slate-700 text-white",rows:3})]})]}),e.jsxs(ge,{children:[e.jsx(b,{variant:"outline",onClick:()=>F({...c,open:!1}),disabled:N,children:"취소"}),e.jsx(b,{onClick:ye,disabled:N||c.action==="reject"&&!c.memo,className:c.action==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:c.action==="approve"?"승인":"거절"})]})]})}),e.jsx(de,{open:s.open,onOpenChange:t=>u({...s,open:t}),children:e.jsxs(me,{className:"sm:max-w-[550px]",children:[e.jsxs(pe,{children:[e.jsx(he,{className:"flex items-center gap-2",children:s.type==="deposit"?e.jsxs(e.Fragment,{children:[e.jsx(Qe,{className:"h-5 w-5 text-emerald-500"}),"강제 입금"]}):e.jsxs(e.Fragment,{children:[e.jsx(Je,{className:"h-5 w-5 text-rose-500"}),"강제 출금"]})}),e.jsx(ue,{children:"회원의 잔액을 직접 조정합니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"force-dialog-type",children:"거래 유형"}),e.jsxs(X,{value:s.type,onValueChange:t=>u({...s,type:t}),children:[e.jsx(Z,{id:"force-dialog-type",className:"input-premium h-10",children:e.jsx(ee,{})}),e.jsxs(te,{className:"bg-slate-800 border-slate-700",children:[e.jsx(L,{value:"deposit",children:"입금"}),e.jsx(L,{value:"withdrawal",children:"출금"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"force-dialog-user-search",children:"회원 선택"}),e.jsxs(Pe,{open:Y,onOpenChange:Q,children:[e.jsx(Re,{asChild:!0,children:e.jsxs(b,{id:"force-dialog-user-search",variant:"outline",role:"combobox","aria-expanded":Y,className:"justify-between input-premium h-10",children:[s.userId?w.find(t=>t.id===s.userId)?.username+` (${w.find(t=>t.id===s.userId)?.nickname}) - ${parseFloat(w.find(t=>t.id===s.userId)?.balance?.toString()||"0").toLocaleString()}원`:"아이디, 닉네임으로 검색",e.jsx(Xe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(We,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(Le,{className:"bg-slate-800",children:[e.jsx($e,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsxs(Ee,{children:[e.jsx(qe,{className:"text-slate-400 py-6 text-center text-sm",children:"회원을 찾을 수 없습니다."}),e.jsx(Me,{className:"max-h-64 overflow-auto",children:w.map(t=>e.jsxs(Oe,{value:`${t.username} ${t.nickname}`,onSelect:()=>{u({...s,userId:t.id}),Q(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ze,{className:`mr-2 h-4 w-4 ${s.userId===t.id?`opacity-100 ${s.type==="deposit"?"text-emerald-500":"text-rose-500"}`:"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:t.username}),e.jsx("div",{className:"text-xs text-slate-400",children:t.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-cyan-400 font-mono",children:[parseFloat(t.balance?.toString()||"0").toLocaleString(),"원"]})})]},t.id))})]})]})})]})]}),s.userId&&(()=>{const t=w.find(a=>a.id===s.userId);return t?e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"선택된 회원"}),e.jsx("span",{className:"text-cyan-400 font-medium",children:t.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"현재 보유금"}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[parseFloat(t.balance?.toString()||"0").toLocaleString(),"원"]})]})]}):null})(),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(I,{htmlFor:"force-dialog-amount",children:"금액"}),e.jsx(b,{type:"button",variant:"ghost",size:"sm",onClick:()=>u({...s,amount:"0"}),className:`h-7 px-2 text-xs text-slate-400 ${s.type==="deposit"?"hover:text-orange-400 hover:bg-orange-500/10":"hover:text-red-400 hover:bg-red-500/10"}`,children:"전체삭제"})]}),e.jsx(ae,{id:"force-dialog-amount",name:"amount",type:"number",value:s.amount,onChange:t=>{const a=parseFloat(t.target.value||"0");if(s.type==="withdrawal"&&s.userId){const r=w.find(n=>n.id===s.userId);if(r){const n=parseFloat(r.balance?.toString()||"0");if(a>n){j.error(`출금 금액이 보유금(${n.toLocaleString()}원)을 초과할 수 없습니다.`),u({...s,amount:n.toString()});return}}}u({...s,amount:t.target.value})},placeholder:"금액을 입력하세요",className:"input-premium"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{className:"text-slate-400 text-sm",children:"단축 입력 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:ve.map(t=>e.jsxs(b,{type:"button",variant:"outline",onClick:()=>{const r=parseFloat(s.amount||"0")+t;if(s.type==="withdrawal"&&s.userId){const n=w.find(i=>i.id===s.userId);if(n){const i=parseFloat(n.balance?.toString()||"0");if(r>i){j.error(`출금 금액이 보유금(${i.toLocaleString()}원)을 초과할 수 없습니다.`),u({...s,amount:i.toString()});return}}}u({...s,amount:r.toString()})},className:`h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 ${s.type==="deposit"?"hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]":"hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]"}`,children:["+",t>=1e4?`${t/1e4}만`:`${t/1e3}천`]},t))})]}),s.type==="withdrawal"&&s.userId&&e.jsx("div",{className:"grid gap-2",children:e.jsxs(b,{type:"button",variant:"outline",onClick:()=>{const t=w.find(a=>a.id===s.userId);if(t){const a=parseFloat(t.balance?.toString()||"0");u({...s,amount:a.toString()})}},className:"w-full h-9 bg-red-900/20 border-red-500/50 text-red-400 hover:bg-red-900/40 hover:border-red-500",children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),"전액출금"]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(I,{htmlFor:"force-dialog-memo",children:"메모"}),e.jsx(ce,{id:"force-dialog-memo",name:"memo",value:s.memo,onChange:t=>u({...s,memo:t.target.value}),placeholder:"메모를 입력하세요 (선택사항)",className:"input-premium min-h-[80px]"})]})]}),e.jsx(ge,{children:e.jsx(b,{type:"button",onClick:Ne,disabled:N||!s.userId||!s.amount||parseFloat(s.amount)<=0,className:`w-full ${s.type==="deposit"?"btn-premium-warning":"btn-premium-danger"}`,children:N?"처리 중...":s.type==="deposit"?"강제 입금":"강제 출금"})})]})})]})}export{ut as TransactionManagement,ut as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Cn1S8-JW.js","assets/react-core-CwM-CeLv.js","assets/vendor-CQn7sZ7L.js","assets/radix-ui-SX2QAG6c.js","assets/lucide-icons-wLPRtdhM.js","assets/supabase-r6ABpEO8.js","assets/index-BVHCjfv2.css"])))=>i.map(i=>d[i]);
import{_ as Q}from"./supabase-r6ABpEO8.js";import{r as u,j as e}from"./react-core-CwM-CeLv.js";import{n as ss,o as rs,u as ts,m as as,i as f,L as _,I as z,S as ns,p as os,q as is,r as ls,t as F,s as m,B as cs}from"./index-Cn1S8-JW.js";import{D as ds}from"./DataTable-CjdfiZ7Q.js";import{A as te,f as ae,a as ne,b as oe,c as ie,d as le,e as ce}from"./AdminDialog-qdCOZfhu.js";import{T as de}from"./textarea-DcWc96jr.js";import{C as me,a as pe,b as ue,c as xe,d as he}from"./command-D1kDSEeZ.js";import{P as ge,a as fe,b as je}from"./popover-KcKD6lRl.js";import{k as n}from"./vendor-CQn7sZ7L.js";import{M as H}from"./MetricCard-CBRAhT7E.js";import{q as Oe,Y as ve,_ as _e,k as be,$ as Te,a0 as Be,T as ms,i as ps,K as us}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./dialog-CE9i0HK9.js";const xs={earn:"적립",use:"회수",convert_to_balance:"보유금전환",admin_adjustment:"지급"};function Ds(){const{authState:h}=ss(),{connected:Y,sendMessage:y}=rs(),{balance:S,syncBalance:hs}=ts(),[M,we]=u.useState([]),[j,Fe]=u.useState([]),[w,i]=u.useState(!0),[D,Me]=u.useState(""),[U,Ue]=u.useState("all"),[qe,Ne]=u.useState(!1),[Re,ye]=u.useState(!1),[Ke,Se]=u.useState(!1),[o,P]=u.useState(""),[k,q]=u.useState(""),[I,R]=u.useState(""),[$,K]=u.useState(""),[A,C]=u.useState(""),[Pe,Ae]=u.useState(!1),[Ce,De]=u.useState(!1),[ke,Ie]=u.useState(!1),V=async()=>{try{i(!0);let s=m.from("point_transactions").select(`
          *,
          users:user_id (
            username,
            nickname
          ),
          partners:partner_id (
            nickname
          )
        `);if(h.user?.level&&h.user.level>1){const{data:c}=await m.from("users").select("id").eq("referrer_id",h.user.id),g=c?.map(v=>v.id)||[];if(g.length>0)s=s.in("user_id",g);else{we([]),i(!1);return}}const{data:t,error:l}=await s.order("created_at",{ascending:!1}).limit(1e3);if(l)throw l;const d=t?.map(c=>({...c,user_username:c.users?.username||"",user_nickname:c.users?.nickname||"",partner_nickname:c.partners?.nickname||""}))||[];we(d)}catch(s){console.error("포인트 거래 내역 조회 오류:",s),n.error("포인트 거래 내역을 불러오는데 실패했습니다.")}finally{i(!1)}},G=async()=>{try{let s=m.from("users").select("id, username, nickname, points, balance").eq("status","active");h.user?.level&&h.user.level>1&&(s=s.eq("referrer_id",h.user.id));const{data:t,error:l}=await s.order("username");if(l)throw l;Fe(t||[])}catch(s){console.error("사용자 목록 조회 오류:",s)}},W=[10,30,50,70,100,200,300,400],Ve=s=>{const t=parseFloat(k)||0;q((t+s).toString())},Ge=s=>{const t=parseFloat($)||0;K((t+s).toString())},Qe=s=>{const t=parseFloat(I)||0;R((t+s).toString())},ze=()=>{q("")},He=()=>{R("")},Ye=()=>{K("")},We=async()=>{try{if(!o||!k||parseFloat(k)<=0){n.error("사용자와 유효한 포인트 금액을 입력해주세요.");return}const s=parseFloat(k);if(s>S){n.error(`보유금이 부족합니다. 현재 보유금: ${S.toLocaleString()}원`);return}i(!0);const{data:t,error:l}=await m.from("users").select("*").eq("id",o).single();if(l){n.error(`사용자 정보 조회 실패: ${l.message}`),i(!1);return}const d=t.points||0;console.log("🎁 [포인트 지급] 외부 API 호출 시작");let c,g,v,b;try{if(!t.referrer_id)throw new Error("사용자의 소속 파트너(referrer_id)가 설정되지 않았습니다.");const{data:r,error:a}=await m.from("partners").select("*").eq("id",t.referrer_id).single();if(a||!r)throw new Error(`소속 파트너 조회 실패: ${a?.message||"파트너를 찾을 수 없습니다."}`);console.log("✅ [포인트 지급] 소속 파트너 조회:",{partner_id:r.id,partner_username:r.username,partner_type:r.partner_type});const{getAdminOpcode:X,isMultipleOpcode:Z}=await Q(async()=>{const{getAdminOpcode:ee,isMultipleOpcode:se}=await import("./index-Cn1S8-JW.js").then(re=>re.$);return{getAdminOpcode:ee,isMultipleOpcode:se}},__vite__mapDeps([0,1,2,3,4,5,6])),p=await X(r);if(Z(p)){if(p.opcodes.length===0)throw new Error("사용 가능한 OPCODE가 없습니다. 시스템 관리자에게 문의하세요.");c=p.opcodes[0].opcode,g=p.opcodes[0].secretKey,v=p.opcodes[0].token}else c=p.opcode,g=p.secretKey,v=p.token;b=t.username.replace(/^btn_/,""),console.log("✅ [포인트 지급] API 설정 조회 완료:",{opcode:c,apiUsername:b})}catch(r){const a=`상위 대본사 API 설정 조회 실패: ${r.message}`;console.error("❌ [포인트 지급]",a),n.error(a,{duration:5e3,description:"API 설정을 확인하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}const{depositToAccount:L}=await Q(async()=>{const{depositToAccount:r}=await import("./index-Cn1S8-JW.js").then(a=>a._);return{depositToAccount:r}},__vite__mapDeps([0,1,2,3,4,5,6]));let x;try{x=await L(c,b,v,s,g)}catch(r){const a=`외부 API 호출 실패: ${r.message}`;console.error("❌ [포인트 지급]",a),n.error(a,{duration:7e3,description:"네트워크 오류 또는 API 서버 문제입니다. 잠시 후 다시 시도하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(console.log("📡 [포인트 지급] API 응답:",x),x.error){const r=`외부 API 오류: ${x.error}`;console.error("❌ [포인트 지급]",r),n.error(r,{duration:7e3,description:"API 서버에서 오류가 발생했습니다. 시스템 관리자에게 문의하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(x.data){const r=x.data;if(r.RESULT===!1){const a=r.DATA?.message||r.message||"외부 API 처리 실패";console.error("❌ [포인트 지급] API 응답 에러:",a),n.error(`외부 API 오류: ${a}`,{duration:7e3,description:"외부 시스템에서 요청을 거부했습니다. DB는 업데이트되지 않았습니다."}),i(!1);return}if(r.is_text&&r.text_response){const a=r.text_response.toLowerCase();if(a.includes("error")||a.includes("실패")||a.includes("초과")){console.error("❌ [포인트 지급] API 텍스트 응답 에러:",r.text_response),n.error(`외부 API 오류: ${r.text_response}`,{duration:7e3,description:"DB는 업데이트되지 않았습니다."}),i(!1);return}}}console.log("✅ [포인트 지급] 외부 API 성공 - DB 업데이트 시작");const E=d+s,{error:O}=await m.from("users").update({points:E,updated_at:new Date().toISOString()}).eq("id",o);if(O){console.error("❌ [포인트 지급] DB 업데이트 실패:",O),n.error("DB 업데이트 실패. 외부 API는 성공했지만 내부 DB 동기화에 문제가 발생했습니다. 시스템 관리자에게 문의하세요.",{duration:1e4}),i(!1);return}const N=S-s,{error:T}=await m.from("partners").update({balance:N,updated_at:new Date().toISOString()}).eq("id",h.user?.id);if(T){console.error("❌ [포인트 지급] 관리자 보유금 업데이트 실패:",T),n.error("관리자 보유금 업데이트 실패. 시스템 관리자에게 문의하세요."),i(!1);return}await m.from("partner_balance_logs").insert({partner_id:h.user?.id,balance_before:S,balance_after:N,amount:-s,transaction_type:"admin_adjustment",processed_by:h.user?.id,memo:`포인트 지급: ${t.username} (${t.nickname})`});const{data:J,error:B}=await m.from("point_transactions").insert([{user_id:o,partner_id:h.user?.id,transaction_type:"admin_adjustment",amount:s,points_before:d,points_after:E,memo:A||"관리자 포인트 지급"}]).select().single();B&&console.error("❌ [포인트 지급] 거래내역 생성 실패:",B),n.success(`${s.toLocaleString()}P가 지급되었습니다. (보유금: ${N.toLocaleString()}원)`,{duration:3e3,icon:"🎁"}),Ne(!1),P(""),q(""),C(""),console.log("✅ [포인트 지급] 보유금 실시간 업데이트 대기 중..."),Y&&y&&y({type:"points_given",data:{transaction:J}}),V(),G()}catch(s){console.error("❌ [포인트 지급] 예상치 못한 오류:",s),n.error("포인트 지급에 실패했습니다.")}finally{i(!1)}},Je=async()=>{try{if(!o||!I||parseFloat(I)<=0){n.error("사용자와 유효한 포인트 금액을 입력해주세요.");return}i(!0);const s=parseFloat(I),{data:t,error:l}=await m.from("users").select("*").eq("id",o).single();if(l){n.error(`사용자 정보 조회 실패: ${l.message}`),i(!1);return}const d=t.points||0;if(d<s){n.error(`회수할 포인트가 부족합니다. 현재 포인트: ${d.toLocaleString()}P`),i(!1);return}console.log("🔄 [포인트 회수] 외부 API 호출 시작");let c,g,v,b;try{if(!t.referrer_id)throw new Error("사용자의 소속 파트너(referrer_id)가 설정되지 않았습니다.");const{data:r,error:a}=await m.from("partners").select("*").eq("id",t.referrer_id).single();if(a||!r)throw new Error(`소속 파트너 조회 실패: ${a?.message||"파트너를 찾을 수 없습니다."}`);console.log("✅ [포인트 회수] 소속 파트너 조회:",{partner_id:r.id,partner_username:r.username,partner_type:r.partner_type});const{getAdminOpcode:X,isMultipleOpcode:Z}=await Q(async()=>{const{getAdminOpcode:ee,isMultipleOpcode:se}=await import("./index-Cn1S8-JW.js").then(re=>re.$);return{getAdminOpcode:ee,isMultipleOpcode:se}},__vite__mapDeps([0,1,2,3,4,5,6])),p=await X(r);if(Z(p)){if(p.opcodes.length===0)throw new Error("사용 가능한 OPCODE가 없습니다. 시스템 관리자에게 문의하세요.");c=p.opcodes[0].opcode,g=p.opcodes[0].secretKey,v=p.opcodes[0].token}else c=p.opcode,g=p.secretKey,v=p.token;b=t.username.replace(/^btn_/,""),console.log("✅ [포인트 회수] API 설정 조회 완료:",{opcode:c,apiUsername:b})}catch(r){const a=`상위 대본사 API 설정 조회 실패: ${r.message}`;console.error("❌ [포인트 회수]",a),n.error(a,{duration:5e3,description:"API 설정을 확인하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}const{withdrawFromAccount:L}=await Q(async()=>{const{withdrawFromAccount:r}=await import("./index-Cn1S8-JW.js").then(a=>a._);return{withdrawFromAccount:r}},__vite__mapDeps([0,1,2,3,4,5,6]));let x;try{x=await L(c,b,v,s,g)}catch(r){const a=`외부 API 호출 실패: ${r.message}`;console.error("❌ [포인트 회수]",a),n.error(a,{duration:7e3,description:"네트워크 오류 또는 API 서버 문제입니다. 잠시 후 다시 시도하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(console.log("📡 [포인트 회수] API 응답:",x),x.error){const r=`외부 API 오류: ${x.error}`;console.error("❌ [포인트 회수]",r),n.error(r,{duration:7e3,description:"API 서버에서 오류가 발생했습니다. 시스템 관리자에게 문의하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(x.data){const r=x.data;if(r.RESULT===!1){const a=r.DATA?.message||r.message||"외부 API 처리 실패";console.error("❌ [포인트 회수] API 응답 에러:",a),n.error(`외부 API 오류: ${a}`,{duration:7e3,description:"외부 시스템에서 요청을 거부했습니다. DB는 업데이트되지 않았습니다."}),i(!1);return}if(r.is_text&&r.text_response){const a=r.text_response.toLowerCase();if(a.includes("error")||a.includes("실패")||a.includes("초과")){console.error("❌ [포인트 회수] API 텍스트 응답 에러:",r.text_response),n.error(`외부 API 오류: ${r.text_response}`,{duration:7e3,description:"DB는 업데이트되지 않았습니다."}),i(!1);return}}}console.log("✅ [포인트 회수] 외부 API 성공 - DB 업데이트 시작");const E=d-s,{error:O}=await m.from("users").update({points:E,updated_at:new Date().toISOString()}).eq("id",o);if(O){console.error("❌ [포인트 회수] DB 업데이트 실패:",O),n.error("DB 업데이트 실패. 외부 API는 성공했지만 내부 DB 동기화에 문제가 발생했습니다. 시스템 관리자에게 문의하세요.",{duration:1e4}),i(!1);return}const N=S+s,{error:T}=await m.from("partners").update({balance:N,updated_at:new Date().toISOString()}).eq("id",h.user?.id);if(T){console.error("❌ [포인트 회수] 관리자 보유금 업데이트 실패:",T),n.error("관리자 보유금 업데이트 실패. 시스템 관리자에게 문의하세요."),i(!1);return}await m.from("partner_balance_logs").insert({partner_id:h.user?.id,balance_before:S,balance_after:N,amount:s,transaction_type:"admin_adjustment",processed_by:h.user?.id,memo:`포인트 회수: ${t.username} (${t.nickname})`});const{data:J,error:B}=await m.from("point_transactions").insert([{user_id:o,partner_id:h.user?.id,transaction_type:"use",amount:s,points_before:d,points_after:E,memo:A||"관리자 포인트 회수"}]).select().single();B&&console.error("❌ [포인트 회수] 거래내역 생성 실패:",B),n.success(`${s.toLocaleString()}P가 회수되었습니다. (보유금: ${N.toLocaleString()}원)`,{duration:3e3,icon:"🔄"}),ye(!1),P(""),R(""),C(""),console.log("✅ [포인트 회수] 보유금 실시간 업데이트 대기 중..."),Y&&y&&y({type:"points_recovered",data:{transaction:J}}),V(),G()}catch(s){console.error("❌ [포인트 회수] 예상치 못한 오류:",s),n.error("포인트 회수에 실패했습니다.")}finally{i(!1)}},Xe=async()=>{try{if(!o||!$||parseFloat($)<=0){n.error("사용자와 유효한 전환 금액을 입력해주세요.");return}i(!0);const s=parseFloat($),{data:t,error:l}=await m.from("users").select("points, balance").eq("id",o).single();if(l)throw l;const d=t.points||0,c=t.balance||0;if(d<s){n.error("보유 포인트가 부족합니다.");return}const g=d-s,v=c+s,{error:b}=await m.from("users").update({points:g,balance:v,updated_at:new Date().toISOString()}).eq("id",o);if(b)throw b;const{data:L,error:x}=await m.from("point_transactions").insert([{user_id:o,partner_id:h.user?.id,transaction_type:"convert_to_balance",amount:s,points_before:d,points_after:g,memo:A||"포인트 -> 보유금 전환"}]).select().single();if(x)throw x;n.success(`${s.toLocaleString()}P가 보유금으로 전환되었습니다.`),Se(!1),P(""),K(""),C(""),Y&&y&&y({type:"points_converted",data:{transaction:L}}),V(),G()}catch(s){console.error("포인트 전환 오류:",s),n.error("포인트 전환에 실패했습니다.")}finally{i(!1)}},$e=M.filter(s=>{const t=s.user_username.toLowerCase().includes(D.toLowerCase())||s.user_nickname.toLowerCase().includes(D.toLowerCase())||s.memo.toLowerCase().includes(D.toLowerCase()),l=U==="all"||s.transaction_type===U;return t&&l}),Ze=[{key:"user_username",header:"아이디"},{key:"user_nickname",header:"닉네임"},{key:"transaction_type",header:"거래유형",cell:s=>{const t=s.transaction_type,l={earn:"px-3 py-1 bg-gradient-to-r from-emerald-500/20 to-teal-500/20 text-emerald-400 border border-emerald-500/50 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]",use:"px-3 py-1 bg-gradient-to-r from-rose-500/20 to-red-500/20 text-rose-400 border border-rose-500/50 rounded-full shadow-[0_0_10px_rgba(244,63,94,0.5)]",convert_to_balance:"px-3 py-1 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-400 border border-blue-500/50 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]",admin_adjustment:"px-3 py-1 bg-gradient-to-r from-amber-500/20 to-orange-500/20 text-amber-400 border border-amber-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]"};return e.jsx(cs,{className:l[t],children:xs[t]})}},{key:"amount",header:"금액",cell:s=>{const t=s.amount,l=s.transaction_type,d=l==="earn"||l==="admin_adjustment";return e.jsxs("span",{className:`font-mono font-semibold ${d?"text-emerald-400":"text-rose-400"}`,children:[d?"+":"-",Math.abs(t).toLocaleString(),"P"]})}},{key:"points_before",header:"이전 포인트",cell:s=>e.jsxs("span",{className:"font-mono text-slate-400",children:[s.points_before.toLocaleString(),"P"]})},{key:"points_after",header:"변경 후 포인트",cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-amber-400",children:[s.points_after.toLocaleString(),"P"]})},{key:"memo",header:"메모",cell:s=>e.jsx("div",{className:"max-w-[200px] truncate text-slate-400",title:s.memo,children:s.memo})},{key:"partner_nickname",header:"처리자",cell:s=>e.jsx("span",{className:"text-cyan-400",children:s.partner_nickname})},{key:"created_at",header:"처리시간",cell:s=>{const t=new Date(s.created_at),l=t.getFullYear(),d=t.getMonth()+1,c=t.getDate(),g=t.getHours().toString().padStart(2,"0"),v=t.getMinutes().toString().padStart(2,"0");return e.jsxs("span",{className:"text-slate-400 text-sm",children:[l,". ",d,". ",c,". ",g,":",v]})}}],Le=M.filter(s=>s.transaction_type==="earn"||s.transaction_type==="admin_adjustment").reduce((s,t)=>s+t.amount,0),Ee=M.filter(s=>s.transaction_type==="use"||s.transaction_type==="convert_to_balance").reduce((s,t)=>s+t.amount,0),es=j.reduce((s,t)=>s+(t.points||0),0);return u.useEffect(()=>{V(),G()},[]),w&&M.length===0?e.jsx(as,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(Oe,{className:"h-6 w-6 text-amber-400"}),"포인트 관리"]}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 포인트 지급, 회수 및 잔고 전환을 관리합니다."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(te,{open:qe,onOpenChange:Ne,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-warning",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"포인트 지급"]})}),e.jsxs(ne,{className:"sm:max-w-[550px]",children:[e.jsxs(oe,{children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx(ve,{className:"h-5 w-5 text-orange-500"}),"포인트 지급"]}),e.jsx(le,{children:"사용자에게 포인트를 지급합니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"user",children:"사용자"}),e.jsxs(ge,{open:Pe,onOpenChange:Ae,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":Pe,className:"justify-between input-premium h-10",children:[o?j.find(s=>s.id===o)?.username+" ("+j.find(s=>s.id===o)?.nickname+") - "+(j.find(s=>s.id===o)?.points||0).toLocaleString()+"P":"아이디, 닉네임, 메모 검색",e.jsx(_e,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(je,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(me,{className:"bg-slate-800",children:[e.jsx(pe,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(ue,{className:"text-slate-400 py-6 text-center text-sm",children:"사용자를 찾을 수 없습니다."}),e.jsx(xe,{className:"max-h-64 overflow-auto",children:j.map(s=>e.jsxs(he,{value:`${s.username} ${s.nickname}`,onSelect:()=>{P(s.id),Ae(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:`mr-2 h-4 w-4 ${o===s.id?"opacity-100 text-orange-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[s.points.toLocaleString(),"P"]})})]},s.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{htmlFor:"amount",children:"포인트"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:ze,className:"h-7 px-2 text-xs text-slate-400 hover:text-orange-400 hover:bg-orange-500/10",children:"전체삭제"})]}),e.jsx(z,{id:"amount",type:"number",value:k,onChange:s=>q(s.target.value),className:"input-premium",placeholder:"지급할 포인트 입력"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{className:"text-slate-400 text-sm",children:"단축 지급 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:W.map(s=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Ve(s),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]",children:["+",s,"P"]},s))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"memo",children:"메모"}),e.jsx(de,{id:"memo",value:A,onChange:s=>C(s.target.value),className:"input-premium min-h-[80px]",placeholder:"지급 사유 입력 (선택사항)"})]})]}),e.jsx(ce,{children:e.jsx(f,{type:"submit",onClick:We,disabled:w,className:"btn-premium-warning w-full",children:w?"처리 중...":"포인트 지급"})})]})]}),e.jsxs(te,{open:Re,onOpenChange:ye,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-danger",children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"포인트 회수"]})}),e.jsxs(ne,{className:"sm:max-w-[550px]",children:[e.jsxs(oe,{children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx(Te,{className:"h-5 w-5 text-red-500"}),"포인트 회수"]}),e.jsx(le,{children:"사용자로부터 포인트를 회수합니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"recover_user",children:"사용자"}),e.jsxs(ge,{open:Ce,onOpenChange:De,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":Ce,className:"justify-between input-premium h-10",children:[o?j.find(s=>s.id===o)?.username+" ("+j.find(s=>s.id===o)?.nickname+") - "+(j.find(s=>s.id===o)?.points||0).toLocaleString()+"P":"아이디, 닉네임으로 검색",e.jsx(_e,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(je,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(me,{className:"bg-slate-800",children:[e.jsx(pe,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(ue,{className:"text-slate-400 py-6 text-center text-sm",children:"사용자를 찾을 수 없습니다."}),e.jsx(xe,{className:"max-h-64 overflow-auto",children:j.filter(s=>s.points>0).map(s=>e.jsxs(he,{value:`${s.username} ${s.nickname}`,onSelect:()=>{P(s.id),De(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:`mr-2 h-4 w-4 ${o===s.id?"opacity-100 text-red-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[s.points.toLocaleString(),"P"]})})]},s.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{htmlFor:"recover_amount",children:"회수 포인트"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:He,className:"h-7 px-2 text-xs text-slate-400 hover:text-red-400 hover:bg-red-500/10",children:"전체삭제"})]}),e.jsx(z,{id:"recover_amount",type:"number",value:I,onChange:s=>R(s.target.value),className:"input-premium",placeholder:"회수할 포인트 입력"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{className:"text-slate-400 text-sm",children:"단축 회수 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:W.map(s=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Qe(s),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]",children:["+",s,"P"]},s))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"recover_memo",children:"메모"}),e.jsx(de,{id:"recover_memo",value:A,onChange:s=>C(s.target.value),className:"input-premium min-h-[80px]",placeholder:"회수 사유 입력 (선택사항)"})]})]}),e.jsx(ce,{children:e.jsx(f,{type:"submit",onClick:Je,disabled:w,className:"btn-premium-danger w-full",children:w?"처리 중...":"포인트 회수"})})]})]}),e.jsxs(te,{open:Ke,onOpenChange:Se,children:[e.jsx(ae,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-primary",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"보유금 전환"]})}),e.jsxs(ne,{className:"sm:max-w-[550px]",children:[e.jsxs(oe,{children:[e.jsxs(ie,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-blue-500"}),"포인트 → 보유금 전환"]}),e.jsx(le,{children:"사용자의 포인트를 게임 보유금으로 전환합니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"convert_user",children:"사용자"}),e.jsxs(ge,{open:ke,onOpenChange:Ie,children:[e.jsx(fe,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":ke,className:"justify-between input-premium h-10",children:[o?j.find(s=>s.id===o)?.username+" ("+j.find(s=>s.id===o)?.nickname+") - "+(j.find(s=>s.id===o)?.points||0).toLocaleString()+"P":"아이디, 닉네임으로 검색",e.jsx(_e,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(je,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(me,{className:"bg-slate-800",children:[e.jsx(pe,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(ue,{className:"text-slate-400 py-6 text-center text-sm",children:"사용자를 찾을 수 없습니다."}),e.jsx(xe,{className:"max-h-64 overflow-auto",children:j.filter(s=>s.points>0).map(s=>e.jsxs(he,{value:`${s.username} ${s.nickname}`,onSelect:()=>{P(s.id),Ie(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:`mr-2 h-4 w-4 ${o===s.id?"opacity-100 text-blue-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[s.points.toLocaleString(),"P"]})})]},s.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{htmlFor:"convert_amount",children:"전환금액"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:Ye,className:"h-7 px-2 text-xs text-slate-400 hover:text-blue-400 hover:bg-blue-500/10",children:"전체삭제"})]}),e.jsx(z,{id:"convert_amount",type:"number",value:$,onChange:s=>K(s.target.value),className:"input-premium",placeholder:"전환할 포인트 입력"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{className:"text-slate-400 text-sm",children:"단축 전환 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:W.map(s=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Ge(s),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-blue-500/20 hover:border-blue-500/60 hover:text-blue-400 hover:shadow-[0_0_15px_rgba(59,130,246,0.3)]",children:["+",s,"P"]},s))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"convert_memo",children:"메모"}),e.jsx(de,{id:"convert_memo",value:A,onChange:s=>C(s.target.value),className:"input-premium min-h-[80px]",placeholder:"전환 사유 입력 (선택사항)"})]})]}),e.jsx(ce,{children:e.jsx(f,{type:"submit",onClick:Xe,disabled:w,className:"btn-premium-primary w-full",children:w?"처리 중...":"보유금으로 전환"})})]})]})]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-4",children:[e.jsx(H,{title:"총 지급 포인트",value:`${Le.toLocaleString()}P`,subtitle:"누적 지급",icon:ms,color:"green"}),e.jsx(H,{title:"총 사용 포인트",value:`${Ee.toLocaleString()}P`,subtitle:"누적 사용",icon:ps,color:"red"}),e.jsx(H,{title:"시스템 내 포인트",value:`${es.toLocaleString()}P`,subtitle:"현재 보유",icon:Oe,color:"orange"}),e.jsx(H,{title:"순 포인트",value:`${(Le-Ee).toLocaleString()}P`,subtitle:"지급 - 사용",icon:ve,color:"purple"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100 mb-1",children:"포인트 거래 내역"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["총 ",$e.length.toLocaleString(),"건의 거래 내역"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(us,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(z,{placeholder:"아이디, 닉네임, 메모 검색",className:"pl-10 input-premium",value:D,onChange:s=>Me(s.target.value)})]}),e.jsxs(ns,{value:U,onValueChange:Ue,children:[e.jsx(os,{className:"w-[180px] input-premium",children:e.jsx(is,{placeholder:"거래유형 필터"})}),e.jsxs(ls,{className:"bg-slate-800 border-slate-700",children:[e.jsx(F,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),"전체 유형"]})}),e.jsx(F,{value:"earn",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),"적립"]})}),e.jsx(F,{value:"use",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-rose-500"}),"사용"]})}),e.jsx(F,{value:"convert_to_balance",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),"보유금전환"]})}),e.jsx(F,{value:"admin_adjustment",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),"관리자조정"]})})]})]})]})]}),e.jsx(ds,{columns:Ze,data:$e,searchable:!1,loading:w,emptyMessage:D||U!=="all"?"검색 결과가 없습니다.":"거래 내역이 없습니다."})]})]})}export{Ds as PointManagement,Ds as default};

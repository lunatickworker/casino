import{r as n,j as e}from"./react-core-CwM-CeLv.js";import{s as h,i as x,L as c,I as g,S as B,p as I,q as k,r as D,t as u,C as Z,a as ee,b as se,d as ae,e as te,B as P}from"./index-XNFiaZD4.js";import{T as le}from"./textarea-jEH6QWba.js";import{D as re}from"./DataTable-CpNEyjEM.js";import{A as ie,a as ne,b as ce,c as de,d as oe}from"./AdminDialog-UTlf4p9n.js";import{k as i}from"./vendor-CQn7sZ7L.js";import{M as N}from"./MetricCard-gDtl4jB5.js";import{P as me,I as T,m as q,U as xe,ab as ue,aq as A,X as he,ar as pe,aa as ge,a8 as je,O as be}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";function Ie({user:d}){const[p,E]=n.useState([]),[G,L]=n.useState(!1),[j,y]=n.useState(!1),[b,U]=n.useState(null),[M,_]=n.useState(!1),[w,$]=n.useState(!1),[o,f]=n.useState(null),[C,v]=n.useState(null),[l,r]=n.useState({title:"",content:"",image_url:"",banner_type:"popup",target_audience:"users",status:"active",display_order:0});n.useEffect(()=>{S()},[d.id]);const S=async()=>{L(!0);try{let s=h.from("banners").select("*").order("display_order",{ascending:!0});d.level>1&&(s=s.eq("partner_id",d.id));const{data:a,error:t}=await s;if(t)throw t;E(a||[])}catch(s){console.error("배너 로드 실패:",s),i.error("배너 목록을 불러오는데 실패했습니다.")}finally{L(!1)}},O=s=>{const a=s.target.files?.[0];if(!a)return;if(a.size>2*1024*1024){i.error("이미지 파일 크기는 2MB 이하여야 합니다.");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type)){i.error("JPG, PNG, GIF, WebP 형식의 이미지만 업로드 가능합니다.");return}f(a);const m=new FileReader;m.onloadend=()=>{v(m.result)},m.readAsDataURL(a)},R=()=>{f(null),v(null),r(s=>({...s,image_url:""}))},V=async()=>{if(!o)return l.image_url||null;$(!0);try{const s=o.name.split(".").pop(),t=`${`${d.id}_${Date.now()}.${s}`}`,{error:m}=await h.storage.from("banner-images").upload(t,o,{cacheControl:"3600",upsert:!1});if(m)throw console.error("이미지 업로드 에러:",m),m;const{data:{publicUrl:Y}}=h.storage.from("banner-images").getPublicUrl(t);return Y}catch(s){return console.error("이미지 업로드 실패:",s),i.error("이미지 업로드에 실패했습니다."),null}finally{$(!1)}},H=async()=>{if(!l.title?.trim()){i.error("배너 제목을 입력하세요.");return}if(!l.content?.trim()){i.error("배너 내용을 입력하세요.");return}y(!0);try{let s=l.image_url;if(o){const t=await V();if(t)s=t;else{y(!1);return}}const a={...l,image_url:s,partner_id:d.id,updated_at:new Date().toISOString()};if(b){const{error:t}=await h.from("banners").update(a).eq("id",b);if(t)throw t;i.success("배너가 성공적으로 수정되었습니다.")}else{const{error:t}=await h.from("banners").insert({...a,created_at:new Date().toISOString()});if(t)throw t;i.success("배너가 성공적으로 생성되었습니다.")}F(),await S()}catch(s){console.error("배너 저장 실패:",s),i.error("배너 저장에 실패했습니다.")}finally{y(!1)}},W=async s=>{if(confirm("이 배너를 삭제하시겠습니까?"))try{const{error:a}=await h.from("banners").delete().eq("id",s);if(a)throw a;i.success("배너가 성공적으로 삭제되었습니다."),await S()}catch(a){console.error("배너 삭제 실패:",a),i.error("배너 삭제에 실패했습니다.")}},J=s=>{r({title:s.title,content:s.content,image_url:s.image_url,banner_type:s.banner_type,target_audience:s.target_audience,target_level:s.target_level,status:s.status,display_order:s.display_order,start_date:s.start_date,end_date:s.end_date}),U(s.id),f(null),v(s.image_url||null),_(!0)},F=()=>{r({title:"",content:"",image_url:"",banner_type:"popup",target_audience:"users",status:"active",display_order:0}),U(null),f(null),v(null),_(!1)},K=s=>{const a=window.open("","_blank","width=600,height=400");a&&a.document.write(`
        <html>
          <head>
            <title>배너 미리보기 - ${s.title}</title>
            <style>
              body { margin: 0; padding: 20px; font-family: sans-serif; background: #1e293b; }
              .banner-preview { 
                border: 2px solid #f97316; 
                padding: 20px; 
                max-width: 500px; 
                margin: 0 auto; 
                background: #0f172a; 
                color: #fff; 
                border-radius: 8px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.3);
              }
              .banner-title { 
                margin: 0 0 15px 0; 
                color: #f97316; 
                font-size: 18px;
                font-weight: bold;
                text-align: center;
              }
              .banner-content { 
                line-height: 1.6; 
                color: #e2e8f0;
              }
              .banner-image { 
                max-width: 100%; 
                height: auto; 
                margin: 10px 0; 
                border-radius: 4px;
              }
            </style>
          </head>
          <body>
            <div class="banner-preview">
              <h3 class="banner-title">★★★ ${s.title} ★★★</h3>
              ${s.image_url?`<img src="${s.image_url}" class="banner-image" />`:""}
              <div class="banner-content">${s.content}</div>
            </div>
          </body>
        </html>
      `)},X=[{key:"title",title:"제목",sortable:!0,cell:s=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-medium truncate",children:s.title}),s.image_url&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"이미지 포함"})]})},{key:"banner_type",title:"타입",cell:s=>e.jsx(P,{variant:s.banner_type==="popup"?"default":"secondary",children:s.banner_type==="popup"?"팝업":"배너"})},{key:"target_audience",title:"대상",cell:s=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(P,{variant:"outline",children:s.target_audience==="all"?"전체":s.target_audience==="users"?"사용자":"파트너"}),s.target_level&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Level ",s.target_level]})]})},{key:"status",title:"상태",cell:s=>e.jsx(P,{variant:s.status==="active"?"default":"secondary",children:s.status==="active"?"활성":"비활성"})},{key:"display_order",title:"순서",sortable:!0},{key:"actions",title:"작업",cell:s=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:()=>K(s),variant:"outline",size:"sm",title:"미리보기",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx(x,{onClick:()=>J(s),variant:"outline",size:"sm",title:"수정",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(x,{onClick:()=>W(s.id),variant:"outline",size:"sm",title:"삭제",children:e.jsx(be,{className:"h-4 w-4"})})]})}],Q=p.filter(s=>s.status==="active").length,z=p.filter(s=>s.banner_type==="popup").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"배너 관리"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["사용자 페이지에 표시되는 배너를 관리합니다. (",d.level<=5?"총판 이상":"접근 제한",")"]})]}),d.level<=5&&e.jsxs(x,{onClick:()=>_(!0),className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"새 배너 만들기"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(N,{title:"전체 배너",value:p.length.toLocaleString(),subtitle:"등록된 배너",icon:T,color:"blue"}),e.jsx(N,{title:"활성 배너",value:Q.toLocaleString(),subtitle:"노출 중",icon:q,color:"green"}),e.jsx(N,{title:"팝업 배너",value:z.toLocaleString(),subtitle:"팝업 형식",icon:xe,color:"purple"}),e.jsx(N,{title:"일반 배너",value:(p.length-z).toLocaleString(),subtitle:"배너 형식",icon:ue,color:"orange"})]}),e.jsx(ie,{open:M&&d.level<=5,onOpenChange:s=>!s&&F(),children:e.jsxs(ne,{className:"max-w-6xl max-h-[95vh] overflow-hidden glass-card",children:[e.jsxs(ce,{className:"pb-3",children:[e.jsxs(de,{className:"flex items-center gap-2 text-lg text-slate-100",children:[e.jsx(T,{className:"h-5 w-5 text-blue-400"}),b?"배너 수정":"새 배너 만들기"]}),e.jsx(oe,{className:"text-sm text-slate-400",children:"직사각형 팝업 형태의 배너를 생성하여 사용자에게 공지사항을 전달하세요."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-3 p-3 border border-slate-700/50 rounded-lg bg-slate-900/30",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-blue-400"}),"기본 정보"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_title",className:"text-xs text-slate-300",children:"배너 제목 *"}),e.jsx(g,{id:"banner_title",value:l.title||"",onChange:s=>r(a=>({...a,title:s.target.value})),placeholder:"배너 제목을 입력하세요",className:"input-premium h-9 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_type",className:"text-xs text-slate-300",children:"배너 타입"}),e.jsxs(B,{value:l.banner_type,onValueChange:s=>r(a=>({...a,banner_type:s})),children:[e.jsx(I,{className:"h-9 text-sm bg-slate-800 border-slate-700",children:e.jsx(k,{})}),e.jsxs(D,{className:"bg-slate-900 border-slate-700",children:[e.jsx(u,{value:"popup",children:"팝업"}),e.jsx(u,{value:"banner",children:"배너"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_status",className:"text-xs text-slate-300",children:"상태"}),e.jsxs(B,{value:l.status,onValueChange:s=>r(a=>({...a,status:s})),children:[e.jsx(I,{className:"h-9 text-sm bg-slate-800 border-slate-700",children:e.jsx(k,{})}),e.jsxs(D,{className:"bg-slate-900 border-slate-700",children:[e.jsx(u,{value:"active",children:"활성"}),e.jsx(u,{value:"inactive",children:"비활성"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"target_audience",className:"text-xs text-slate-300",children:"대상"}),e.jsxs(B,{value:l.target_audience,onValueChange:s=>r(a=>({...a,target_audience:s})),children:[e.jsx(I,{className:"h-9 text-sm bg-slate-800 border-slate-700",children:e.jsx(k,{})}),e.jsxs(D,{className:"bg-slate-900 border-slate-700",children:[e.jsx(u,{value:"all",children:"전체"}),e.jsx(u,{value:"users",children:"사용자"}),e.jsx(u,{value:"partners",children:"파트너"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"display_order",className:"text-xs text-slate-300",children:"순서"}),e.jsx(g,{id:"display_order",type:"number",value:l.display_order||0,onChange:s=>r(a=>({...a,display_order:parseInt(s.target.value)})),placeholder:"0",className:"input-premium h-9 text-sm"})]})]})]}),e.jsxs("div",{className:"space-y-2 p-3 border border-slate-700/50 rounded-lg bg-slate-900/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(T,{className:"h-4 w-4 text-blue-400"}),"배너 이미지"]}),C&&e.jsxs(x,{type:"button",variant:"ghost",size:"sm",onClick:R,className:"h-7 text-xs text-red-400 hover:text-red-300",children:[e.jsx(he,{className:"h-3 w-3 mr-1"}),"제거"]})]}),C?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"border border-slate-600 rounded-lg p-2 bg-slate-800",children:e.jsx("img",{src:C,alt:"배너 미리보기",className:"max-w-full h-auto max-h-32 rounded mx-auto"})}),o&&e.jsxs("p",{className:"text-[10px] text-slate-400 text-center",children:[o.name," (",(o.size/1024).toFixed(0),"KB)"]})]}):e.jsxs(c,{htmlFor:"banner_image_upload",className:"flex flex-col items-center justify-center w-full h-36 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors bg-slate-800/50",children:[e.jsx(pe,{className:"h-8 w-8 mb-2 text-slate-400"}),e.jsx("p",{className:"text-xs text-slate-300 mb-1",children:e.jsx("span",{className:"font-semibold",children:"클릭하여 업로드"})}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"JPG, PNG, GIF, WebP (최대 2MB)"}),e.jsx(g,{id:"banner_image_upload",type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:O,className:"hidden"})]})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2 p-3 border border-slate-700/50 rounded-lg bg-slate-900/30 h-full",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(A,{className:"h-4 w-4 text-blue-400"}),"배너 내용"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_content",className:"text-xs text-slate-300",children:"내용 *"}),e.jsx(le,{id:"banner_content",rows:14,value:l.content||"",onChange:s=>r(a=>({...a,content:s.target.value})),placeholder:"배너에 표시될 내용을 입력하세요. HTML 태그 사용 가능합니다.",className:"min-h-[280px] bg-slate-800 border-slate-700 text-sm resize-none"}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"사용 가능: <p>, <br>, <strong>, <em>, <span>, <div>, <a>"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"start_date",className:"text-xs text-slate-300",children:"시작 일시"}),e.jsx(g,{id:"start_date",type:"datetime-local",value:l.start_date||"",onChange:s=>r(a=>({...a,start_date:s.target.value})),className:"h-8 text-xs bg-slate-800 border-slate-700"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"end_date",className:"text-xs text-slate-300",children:"종료 일시"}),e.jsx(g,{id:"end_date",type:"datetime-local",value:l.end_date||"",onChange:s=>r(a=>({...a,end_date:s.target.value})),className:"h-8 text-xs bg-slate-800 border-slate-700"})]})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-3 border-t border-slate-700/50 mt-3",children:[e.jsxs(x,{onClick:H,disabled:j||w,className:"btn-premium-primary flex items-center gap-2 flex-1",children:[e.jsx(ge,{className:"h-4 w-4"}),w?"이미지 업로드 중...":b?j?"수정 중...":"배너 수정":j?"생성 중...":"배너 생성"]}),e.jsx(x,{onClick:F,variant:"outline",disabled:j||w,className:"border-slate-600 hover:bg-slate-700/50",children:"취소"})]})]})}),e.jsxs(Z,{children:[e.jsxs(ee,{children:[e.jsx(se,{children:"배너 목록"}),e.jsx(ae,{children:"생성된 배너 목록을 확인하고 관리하세요."})]}),e.jsx(te,{children:e.jsx(re,{data:p,columns:X,loading:G,searchPlaceholder:"배너를 검색하세요..."})})]})]})}export{Ie as BannerManagement,Ie as default};

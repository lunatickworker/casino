import{ax as W,r as n,s as x,t as l,j as e,W as X,C as A,a as F,b as T,Q as $,e as q,E as i,I as N,w as _,S as J,x as Y,y as Z,z as ee,D as se,a7 as te,a8 as ae,L as re,B as ne,az as le,ay as ce,R as ie}from"./index-DHLZKrSC.js";import{T as oe}from"./textarea-D3JOUlRQ.js";import{I as de}from"./info-Bn9fJqEX.js";import{P as me}from"./plus-Co1dk4Al.js";import{A as xe}from"./arrow-up-right-BJ4TjU8d.js";import{C as ue}from"./circle-alert-CfjAz5vG.js";import{C as he}from"./clock-DJz0fDvN.js";function ve({user:a,onRouteChange:M}){const{sendMessage:R}=W(),[o,h]=n.useState(""),[d,w]=n.useState(""),[u,v]=n.useState(""),[m,y]=n.useState(""),[p,S]=n.useState(""),[C,k]=n.useState(!1),[B,E]=n.useState([]),[H,D]=n.useState(!0),[L,G]=n.useState([]),[z]=n.useState([5e4,1e5,3e5,5e5,1e6]),[b,K]=n.useState(0),P=async()=>{try{G([{bank_name:"êµ­ë¯¼ì€í–‰",account_number:"123456-78-901234",holder_name:"GMSì¹´ì§€ë…¸",is_active:!0},{bank_name:"ì‹ í•œì€í–‰",account_number:"110-456-789012",holder_name:"GMSì¹´ì§€ë…¸",is_active:!0},{bank_name:"ìš°ë¦¬ì€í–‰",account_number:"1002-987-654321",holder_name:"GMSì¹´ì§€ë…¸",is_active:!0},{bank_name:"KBì€í–‰",account_number:"123-456789-01-234",holder_name:"GMSì¹´ì§€ë…¸",is_active:!0}])}catch(s){console.error("ì€í–‰ ê³„ì¢Œ ì¡°íšŒ ì˜¤ë¥˜:",s)}},j=async()=>{try{D(!0);const{data:s,error:t}=await x.from("transactions").select("*").eq("user_id",a.id).eq("transaction_type","deposit").order("created_at",{ascending:!1}).limit(10);if(t)throw t;E(s||[])}catch(s){console.error("ì…ê¸ˆ ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",s),l.error("ì…ê¸ˆ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{D(!1)}},g=async()=>{try{const{data:s,error:t}=await x.from("users").select("balance").eq("id",a.id).single();if(t)throw t;K(parseFloat(s.balance)||0)}catch(s){console.error("ì”ê³  ì¡°íšŒ ì˜¤ë¥˜:",s)}},Q=async s=>{if(s.preventDefault(),!o||!d||!u||!m){l.error("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}const t=parseFloat(o);if(t<1e4){l.error("ìµœì†Œ ì…ê¸ˆ ê¸ˆì•¡ì€ 10,000ì›ì…ë‹ˆë‹¤.");return}if(t>1e7){l.error("ìµœëŒ€ ì…ê¸ˆ ê¸ˆì•¡ì€ 10,000,000ì›ì…ë‹ˆë‹¤.");return}k(!0);try{await g();const r={user_id:a.id,partner_id:a.referrer_id||null,transaction_type:"deposit",amount:t,status:"pending",balance_before:b,balance_after:b,bank_name:d,bank_account:u,bank_holder:m,memo:p.trim()||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("ğŸ’° ì…ê¸ˆ ì‹ ì²­ ë°ì´í„°:",{...r,user_info:{id:a.id,username:a.username,referrer_id:a.referrer_id}});const{data:f,error:I}=await x.from("transactions").insert([r]).select().single();if(I)throw I;await R("deposit_request",{transaction_id:f.id,user_id:a.id,username:a.username,nickname:a.nickname,amount:t,bank_name:d,bank_account:u,depositor_name:m,memo:p.trim()||null,subject:`${a.nickname}ë‹˜ì˜ ì…ê¸ˆ ì‹ ì²­`,reference_type:"transaction",reference_id:f.id},3)&&console.log("âœ… ì…ê¸ˆ ìš”ì²­ ì•Œë¦¼ì´ ê´€ë¦¬ìì—ê²Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."),await x.from("activity_logs").insert([{actor_type:"user",actor_id:a.id,action:"deposit_request",target_type:"transaction",target_id:f.id,details:{amount:t,bank_name:d,depositor_name:m}}]),h(""),w(""),v(""),y(""),S(""),await j(),l.success(`ì…ê¸ˆ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì”ê³ ì— ë°˜ì˜ë©ë‹ˆë‹¤.`,{duration:4e3})}catch(r){console.error("âŒ ì…ê¸ˆ ì‹ ì²­ ì˜¤ë¥˜:",r),l.error(r.message||"ì…ê¸ˆ ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{k(!1)}},U=s=>{h(s.toString())},O=s=>{switch(s){case"pending":return{color:"bg-yellow-500",textColor:"text-yellow-400",icon:he,label:"ìŠ¹ì¸ëŒ€ê¸°"};case"approved":return{color:"bg-blue-500",textColor:"text-blue-400",icon:ie,label:"ì²˜ë¦¬ì¤‘"};case"completed":return{color:"bg-green-500",textColor:"text-green-400",icon:ce,label:"ì™„ë£Œ"};case"rejected":return{color:"bg-red-500",textColor:"text-red-400",icon:le,label:"ê±°ì ˆ"};default:return{color:"bg-slate-500",textColor:"text-slate-400",icon:ue,label:"ì•Œ ìˆ˜ ì—†ìŒ"}}},c=s=>new Intl.NumberFormat("ko-KR").format(s),V=s=>new Date(s).toLocaleString("ko-KR");return n.useEffect(()=>{P(),j(),g();const s=x.channel(`deposit_updates_${a.id}`).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${a.id}`},t=>{if(console.log("ğŸ”„ ì…ê¸ˆ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :",t),t.eventType==="UPDATE"||t.eventType==="INSERT"){const r=t.new;r.transaction_type==="deposit"&&(j(),r.status==="completed"?(g(),l.success(`ì…ê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
ê¸ˆì•¡: â‚©${c(r.amount)}`,{duration:5e3})):r.status==="rejected"?l.error(`ì…ê¸ˆ ì‹ ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.
ê¸ˆì•¡: â‚©${c(r.amount)}`,{duration:5e3}):r.status==="approved"&&l.info(`ì…ê¸ˆì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.
ê¸ˆì•¡: â‚©${c(r.amount)}`,{duration:4e3}))}}).subscribe();return()=>s.unsubscribe()},[a.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"ì…ê¸ˆ ì‹ ì²­"}),e.jsx("p",{className:"text-slate-400",children:"ì•ˆì „í•˜ê³  ë¹ ë¥¸ ì…ê¸ˆ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/50 rounded-lg px-4 py-2",children:[e.jsx(X,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-300",children:"í˜„ì¬ ë³´ìœ ê¸ˆ"}),e.jsxs("div",{className:"text-lg font-bold text-green-400",children:["â‚©",c(b)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(A,{className:"bg-slate-800/50 border-slate-700",children:[e.jsx(F,{children:e.jsxs(T,{className:"flex items-center text-white",children:[e.jsx($,{className:"w-5 h-5 mr-2 text-green-400"}),"ì…ê¸ˆ ì‹ ì²­"]})}),e.jsx(q,{children:e.jsxs("form",{onSubmit:Q,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"amount",className:"text-slate-300",children:"ì…ê¸ˆ ê¸ˆì•¡ *"}),e.jsx(N,{id:"amount",type:"text",placeholder:"ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”",value:o,onChange:s=>{const t=s.target.value.replace(/[^0-9]/g,"");h(t)},className:"bg-slate-700/50 border-slate-600 text-white text-lg"}),o&&e.jsxs("p",{className:"text-sm text-slate-400",children:["â‚©",c(parseInt(o)||0)]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{className:"text-slate-300",children:"ë¹ ë¥¸ ì„ íƒ"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:z.map(s=>e.jsxs(_,{type:"button",variant:"outline",size:"sm",onClick:()=>U(s),className:"whitespace-nowrap",children:[c(s),"ì›"]},s))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"bank",className:"text-slate-300",children:"ì…ê¸ˆ ì€í–‰ *"}),e.jsxs(J,{value:d,onValueChange:w,children:[e.jsx(Y,{className:"bg-slate-700/50 border-slate-600 text-white",children:e.jsx(Z,{placeholder:"ì…ê¸ˆí•  ì€í–‰ì„ ì„ íƒí•˜ì„¸ìš”"})}),e.jsx(ee,{className:"bg-slate-800 border-slate-700",children:L.map(s=>e.jsx(se,{value:s.bank_name,children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{children:s.bank_name}),e.jsxs("span",{className:"text-sm text-slate-400",children:[s.account_number," (",s.holder_name,")"]})]})},s.bank_name))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"accountNumber",className:"text-slate-300",children:"ì…ê¸ˆì ê³„ì¢Œë²ˆí˜¸ *"}),e.jsx(N,{id:"accountNumber",type:"text",placeholder:"ì…ê¸ˆì— ì‚¬ìš©í•  ê³„ì¢Œë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:u,onChange:s=>v(s.target.value),className:"bg-slate-700/50 border-slate-600 text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"depositorName",className:"text-slate-300",children:"ì…ê¸ˆìëª… *"}),e.jsx(N,{id:"depositorName",type:"text",placeholder:"ì‹¤ì œ ì…ê¸ˆí•˜ì‹¤ ë¶„ì˜ ì„±í•¨ì„ ì…ë ¥í•˜ì„¸ìš”",value:m,onChange:s=>y(s.target.value),className:"bg-slate-700/50 border-slate-600 text-white"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"memo",className:"text-slate-300",children:"ë©”ëª¨ (ì„ íƒ)"}),e.jsx(oe,{id:"memo",placeholder:"ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•˜ì„¸ìš”",value:p,onChange:s=>S(s.target.value),className:"bg-slate-700/50 border-slate-600 text-white",rows:3})]}),e.jsxs(te,{className:"border-yellow-600 bg-yellow-900/20",children:[e.jsx(de,{className:"h-4 w-4 text-yellow-400"}),e.jsx(ae,{className:"text-yellow-300",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"â€¢ ìµœì†Œ ì…ê¸ˆì•¡: 10,000ì› | ìµœëŒ€ ì…ê¸ˆì•¡: 10,000,000ì›"}),e.jsx("p",{children:"â€¢ ì…ê¸ˆìëª…ê³¼ ê³„ì¢Œ ì†Œìœ ìëª…ì´ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤"}),e.jsx("p",{children:"â€¢ ìŠ¹ì¸ê¹Œì§€ í‰ê·  5-10ë¶„ ì†Œìš”ë©ë‹ˆë‹¤"}),e.jsx("p",{children:"â€¢ ë¬¸ì˜ì‚¬í•­ì€ ê³ ê°ì„¼í„°ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”"})]})})]}),e.jsx(_,{type:"submit",disabled:C,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3",children:C?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"ì‹ ì²­ ì²˜ë¦¬ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(me,{className:"w-4 h-4 mr-2"}),"ì…ê¸ˆ ì‹ ì²­í•˜ê¸°"]})})]})})]})}),e.jsx("div",{children:e.jsxs(A,{className:"bg-slate-800/50 border-slate-700",children:[e.jsx(F,{children:e.jsxs(T,{className:"flex items-center text-white",children:[e.jsx(xe,{className:"w-5 h-5 mr-2 text-blue-400"}),"ìµœê·¼ ì…ê¸ˆ ë‚´ì—­"]})}),e.jsx(q,{children:H?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(re,{})}):B.length>0?e.jsxs("div",{className:"space-y-4",children:[B.map(s=>{const t=O(s.status),r=t.icon;return e.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:`w-4 h-4 ${t.textColor}`}),e.jsx(ne,{className:`${t.color} text-white`,children:t.label})]}),e.jsxs("span",{className:"text-lg font-bold text-white",children:["â‚©",c(s.amount)]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-slate-400",children:[e.jsxs("p",{children:[s.bank_name," ",s.bank_account]}),e.jsx("p",{children:V(s.created_at)}),s.memo&&e.jsxs("p",{className:"text-slate-300",children:["ë©”ëª¨: ",s.memo]})]})]},s.id)}),e.jsx(_,{variant:"outline",onClick:()=>M("/user/profile"),className:"w-full",children:"ì „ì²´ ë‚´ì—­ ë³´ê¸°"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx($,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"ì…ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤"})]})})]})})]})]})}export{ve as UserDeposit};

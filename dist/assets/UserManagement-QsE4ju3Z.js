import{k as ue,r as x,j as e,l as be,B as w,m as We,n as Oe,o as ce,W as je,G as Ne,p as de,L as ne,A as Ue,T as ze,C as J,e as Q,s as m,t as d,q as Pe,v as Ke,w as M,U as Ge,I as ee,S as Ae,x as Le,y as Te,z as Me,D as re,E as se,F as Ve,X as Ye,H as Xe,J as Ze,K as Je,M as Qe,N as es}from"./index-DHLZKrSC.js";import{D as ss}from"./DataTable-BAIDb4XS.js";import{A as we,a as ye,b as _e,c as ve,d as ke,e as Fe}from"./AdminDialog-Ho0rn2DP.js";import{getAdminOpcode as ts,isMultipleOpcode as as}from"./opcodeHelper-C_oRYdTN.js";import{C as Se}from"./clock-DJz0fDvN.js";import{T as rs}from"./target-BtFOR7Pr.js";import{T as ns}from"./triangle-alert-CDjjtVAU.js";import{C as ls}from"./chart-column-CQjzEXte.js";import{T as os}from"./trophy-DlkZw1ZH.js";import{M as me}from"./MetricCard-DmGakNT9.js";import{F as is}from"./ForceTransactionModal-CGzYgJqt.js";import{P as cs}from"./plus-Co1dk4Al.js";import{S as ds}from"./search-DGG3ycOS.js";import{F as ms}from"./funnel-CMa3jBKb.js";import{T as Ie}from"./trash-2-krsq29sW.js";import{D as Be}from"./dollar-sign-CWZXTHhc.js";import"./textarea-D3JOUlRQ.js";import"./popover-BcsfXb2q.js";import"./command-h9k2RnUb.js";import"./dialog-HEtsMRxu.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"M12 17V3",key:"1cwfxf"}],["path",{d:"m6 11 6 6 6-6",key:"12ii2o"}],["path",{d:"M19 21H5",key:"150jfl"}]],us=ue("arrow-down-to-line",xs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z",key:"l5xja"}],["path",{d:"M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z",key:"ep3f8r"}],["path",{d:"M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4",key:"1p4c4q"}],["path",{d:"M17.599 6.5a3 3 0 0 0 .399-1.375",key:"tmeiqw"}],["path",{d:"M6.003 5.125A3 3 0 0 0 6.401 6.5",key:"105sqy"}],["path",{d:"M3.477 10.896a4 4 0 0 1 .585-.396",key:"ql3yin"}],["path",{d:"M19.938 10.5a4 4 0 0 1 .585.396",key:"1qfode"}],["path",{d:"M6 18a4 4 0 0 1-1.967-.516",key:"2e4loj"}],["path",{d:"M19.967 17.484A4 4 0 0 1 18 18",key:"159ez6"}]],xe=ue("brain",ps);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]],qe=ue("user-check",hs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]],Ee=ue("user-x",gs);function fs({user:r,isOpen:S,onClose:R}){const[F,L]=x.useState("basic"),[g,C]=x.useState(!1),[H,D]=x.useState([]),[le,te]=x.useState([]),[v,oe]=x.useState(null),[f,pe]=x.useState({totalDeposit:0,totalWithdraw:0,totalBets:0,totalWinAmount:0,accountAge:0,lastActivity:"",gameCount:0,winRate:0}),W=async()=>{try{C(!0);const{data:a}=await m.from("transactions").select("transaction_type, amount, status").eq("user_id",r.id),o=(a||[]).filter(h=>h.transaction_type==="deposit"&&h.status==="approved").reduce((h,_)=>h+(_.amount||0),0),B=(a||[]).filter(h=>h.transaction_type==="withdrawal"&&h.status==="approved").reduce((h,_)=>h+(_.amount||0),0),{data:I}=await m.from("game_records").select("bet_amount, win_amount").eq("user_id",r.id),V=(I||[]).reduce((h,_)=>h+(_.bet_amount||0),0),Y=(I||[]).reduce((h,_)=>h+(_.win_amount||0),0),U=I?.length||0,T=(I||[]).filter(h=>(h.win_amount||0)>(h.bet_amount||0)).length,j=U>0?T/U*100:0,p=Math.floor((Date.now()-new Date(r.created_at).getTime())/(1e3*60*60*24)),{data:q}=await m.from("game_launch_sessions").select("launched_at").eq("user_id",r.id).order("launched_at",{ascending:!1}).limit(1).single();pe({totalDeposit:o,totalWithdraw:B,totalBets:V,totalWinAmount:Y,accountAge:p,lastActivity:q?.launched_at||r.created_at,gameCount:U,winRate:j})}catch(a){console.error("통계 계산 오류:",a)}finally{C(!1)}},he=async()=>{try{C(!0);const{data:a,error:o}=await m.from("transactions").select("*").eq("user_id",r.id).order("created_at",{ascending:!1}).limit(100);if(o)throw o;D(a||[])}catch(a){console.error("입출금 내역 조회 오류:",a),d.error("입출금 내역을 불러오는데 실패했습니다.")}finally{C(!1)}},ie=async()=>{try{C(!0);const{data:a,error:o}=await m.from("game_records").select("*").eq("user_id",r.id).order("played_at",{ascending:!1}).limit(100);if(o)throw o;te(a||[])}catch(a){console.error("베팅 내역 조회 오류:",a),d.error("베팅 내역을 불러오는데 실패했습니다.")}finally{C(!1)}},ge=async()=>{try{C(!0);const{data:a}=await m.from("game_records").select("*").eq("user_id",r.id).order("played_at",{ascending:!1}).limit(500);if(!a||a.length===0){oe(null);return}const o=new Map;a.forEach(l=>{const b=`${l.game_id}_${l.game_title||""}`;o.has(b)||o.set(b,{gameName:l.game_title||`게임 ${l.game_id}`,providerName:l.provider_name||"",count:0,totalBet:0,totalWin:0,wins:0});const X=o.get(b);X.count++,X.totalBet+=l.bet_amount||0,X.totalWin+=l.win_amount||0,(l.win_amount||0)>(l.bet_amount||0)&&X.wins++});const B=Array.from(o.values()).sort((l,b)=>b.count-l.count).slice(0,5).map(l=>({game:l.gameName,provider:l.providerName,count:l.count,winRate:l.count>0?l.wins/l.count*100:0,netProfit:l.totalWin-l.totalBet})),I=new Array(24).fill(0);a.forEach(l=>{const b=new Date(l.played_at).getHours();I[b]++});const V=I.indexOf(Math.max(...I)),U=(I.slice(22).reduce((l,b)=>l+b,0)+I.slice(0,6).reduce((l,b)=>l+b,0))/a.length*100,T=a.map(l=>l.bet_amount||0),j=T.reduce((l,b)=>l+b,0)/a.length,p=Math.max(...T),q=a.reduce((l,b)=>l+(b.bet_amount||0),0),_=a.reduce((l,b)=>l+(b.win_amount||0),0)-q,P=a.filter(l=>(l.win_amount||0)>(l.bet_amount||0)).length/a.length*100;let A=0;j>1e5?A+=3:j>5e4?A+=2:j>1e4&&(A+=1),p>5e5?A+=3:p>2e5?A+=2:p>5e4&&(A+=1),_<-1e6?A+=3:_<-5e5?A+=2:_<-1e5&&(A+=1),a.length>500&&(A+=1);const ae=A>=6?"HIGH":A>=3?"MEDIUM":"LOW",$=[];if(B.length>0){const l=B[0],b=(l.count/a.length*100).toFixed(1);$.push(`💎 가장 선호하는 게임은 "${l.game}"로, 전체 플레이의 ${b}%를 차지합니다.`),l.winRate>60?$.push(`✅ "${l.game}"에서 ${l.winRate.toFixed(1)}%의 높은 승률을 기록 중입니다.`):l.winRate<40&&$.push(`⚠️ "${l.game}"에서 ${l.winRate.toFixed(1)}%의 낮은 승률로, 전략 개선이 필요합니다.`)}$.push(`🕐 주로 ${V}시에 가장 활발한 활동을 보입니다.`),U>40&&$.push(`🌙 야간 시간대(22시~6시) 플레이 비율이 ${U.toFixed(1)}%로 높습니다.`),P>55?$.push(`📈 전체 승률 ${P.toFixed(1)}%로 평균 이상의 우수한 성과를 보입니다.`):P<45?$.push(`📉 전체 승률 ${P.toFixed(1)}%로 게임 전략 재검토가 필요합니다.`):$.push(`📊 전체 승률 ${P.toFixed(1)}%로 평균적인 수준입니다.`),_>0?$.push(`💰 총 ${Math.abs(_).toLocaleString()}원의 수익을 달성했습니다.`):$.push(`💸 총 ${Math.abs(_).toLocaleString()}원의 손실이 발생했습니다.`),j>5e4&&$.push(`⚡ 평균 베팅액이 ${j.toLocaleString()}원으로 고액 베팅 성향입니다.`),p/j>10&&$.push("📊 베팅 금액 변동성이 높아 일관된 베팅 전략이 필요합니다.");let O="";ae==="HIGH"?O="공격적 고위험 플레이어":ae==="MEDIUM"?P>50?O="적극적 안정형 플레이어":O="도전적 중위험 플레이어":j<1e4?O="보수적 저위험 플레이어":O="신중한 안정형 플레이어",oe({topGames:B,peakHour:V,nightPlayRatio:U,avgBet:j,maxBet:p,totalBets:a.length,winRate:P,netProfit:_,riskLevel:ae,userType:O,insights:$})}catch(a){console.error("패턴 분석 오류:",a),d.error("패턴 분석에 실패했습니다.")}finally{C(!1)}};x.useEffect(()=>{!S||!r||(F==="basic"?W():F==="transactions"?he():F==="betting"?ie():F==="pattern"&&ge())},[F,S,r]);const y=a=>`₩${a.toLocaleString()}`,fe=a=>{const o=new Date(a);return`${o.getFullYear()}.${String(o.getMonth()+1).padStart(2,"0")}.${String(o.getDate()).padStart(2,"0")}`},K=a=>{const o=new Date(a);return`${o.getFullYear()}.${String(o.getMonth()+1).padStart(2,"0")}.${String(o.getDate()).padStart(2,"0")} ${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}`},G=a=>{switch(a){case"approved":case"completed":return e.jsx(w,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"승인"});case"pending":return e.jsx(w,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30 text-xs",children:"대기"});case"rejected":return e.jsx(w,{className:"bg-red-500/20 text-red-400 border-red-500/30 text-xs",children:"거절"});default:return e.jsx(w,{className:"text-xs",children:a})}};return r?e.jsx(we,{open:S,onOpenChange:R,children:e.jsxs(ye,{className:"!max-w-[2400px] w-[98vw] max-h-[92vh] overflow-hidden glass-card border border-white/10 p-0",children:[e.jsxs(_e,{className:"border-b border-white/10 pb-3 pt-4 px-6",children:[e.jsxs(ve,{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-9 h-9 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center",children:e.jsx(be,{className:"h-4 w-4 text-white"})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:r.nickname}),e.jsxs("span",{className:"text-muted-foreground text-sm",children:["(",r.username,")"]}),r.status==="active"?e.jsx(w,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"활성"}):r.status==="suspended"?e.jsx(w,{className:"bg-red-500/20 text-red-400 border-red-500/30 text-xs",children:"정지"}):e.jsx(w,{className:"bg-yellow-500/20 text-yellow-400 border-yellow-500/30 text-xs",children:"대기"}),r.is_online&&e.jsx(w,{className:"bg-green-500/20 text-green-400 border-green-500/30 text-xs",children:"접속중"})]})})]}),e.jsx(ke,{className:"text-xs text-muted-foreground mt-0.5 pl-12",children:"회원의 상세 정보, 입출금 내역, 베팅 내역 및 AI 게임 패턴 분석을 확인할 수 있습니다."})]}),e.jsxs(We,{value:F,onValueChange:L,className:"w-full px-6",children:[e.jsxs(Oe,{className:"grid w-full grid-cols-4 glass-card h-9",children:[e.jsxs(ce,{value:"basic",className:"flex items-center gap-1.5 text-xs",children:[e.jsx(be,{className:"h-3 w-3"}),"기본정보"]}),e.jsxs(ce,{value:"transactions",className:"flex items-center gap-1.5 text-xs",children:[e.jsx(je,{className:"h-3 w-3"}),"입출금내역"]}),e.jsxs(ce,{value:"betting",className:"flex items-center gap-1.5 text-xs",children:[e.jsx(Ne,{className:"h-3 w-3"}),"베팅내역"]}),e.jsxs(ce,{value:"pattern",className:"flex items-center gap-1.5 text-xs",children:[e.jsx(xe,{className:"h-3 w-3"}),"AI 게임패턴"]})]}),e.jsx(de,{value:"basic",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:g?e.jsx(ne,{}):e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-3",children:[e.jsx(be,{className:"h-3.5 w-3.5 text-blue-400"}),e.jsx("span",{className:"text-xs",children:"기본 정보"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"아이디"}),e.jsx("span",{className:"text-xs font-mono",children:r.username})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"닉네임"}),e.jsx("span",{className:"text-xs",children:r.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"가입일"}),e.jsx("span",{className:"text-xs",children:fe(r.created_at)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"가입 경과"}),e.jsxs("span",{className:"text-xs",children:[f.accountAge,"일"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"은행"}),e.jsx("span",{className:"text-xs",children:r.bank_name||"-"})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"계좌번호"}),e.jsx("span",{className:"text-xs font-mono",children:r.bank_account||"-"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-3",children:[e.jsx(je,{className:"h-3.5 w-3.5 text-emerald-400"}),e.jsx("span",{className:"text-xs",children:"잔고 정보"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"보유금"}),e.jsx("span",{className:"text-xs font-mono",children:y(r.balance||0)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"포인트"}),e.jsx("span",{className:"text-xs font-mono",children:y(r.points||0)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"총 입금"}),e.jsx("span",{className:"text-xs font-mono text-blue-400",children:y(f.totalDeposit)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"총 출금"}),e.jsx("span",{className:"text-xs font-mono text-pink-400",children:y(f.totalWithdraw)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-gradient-to-r from-white/10 to-white/5 border border-white/20",children:[e.jsx("span",{className:"text-xs",children:"순 입출금"}),e.jsx("span",{className:`text-xs font-mono ${f.totalDeposit-f.totalWithdraw>=0?"text-green-400":"text-red-400"}`,children:y(f.totalDeposit-f.totalWithdraw)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-gradient-to-r from-white/10 to-white/5 border border-white/20",children:[e.jsx("span",{className:"text-xs",children:"게임 손익"}),e.jsxs("span",{className:`text-xs font-mono ${f.totalWinAmount-f.totalBets>=0?"text-green-400":"text-red-400"}`,children:[f.totalWinAmount-f.totalBets>=0?"+":"",y(f.totalWinAmount-f.totalBets)]})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Ue,{className:"h-3.5 w-3.5 text-amber-400"}),e.jsx("span",{className:"text-xs",children:"베팅 통계"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"게임 플레이"}),e.jsxs("span",{className:"text-xs font-mono",children:[f.gameCount,"회"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"승률"}),e.jsxs("span",{className:`text-xs font-mono ${f.winRate>50?"text-green-400":"text-red-400"}`,children:[f.winRate.toFixed(1),"%"]})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"총 베팅액"}),e.jsx("span",{className:"text-xs font-mono",children:y(f.totalBets)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"총 당첨액"}),e.jsx("span",{className:"text-xs font-mono",children:y(f.totalWinAmount)})]})]})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"flex items-center gap-2 mb-3",children:[e.jsx(Se,{className:"h-3.5 w-3.5 text-purple-400"}),e.jsx("span",{className:"text-xs",children:"활동 정보"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-6 gap-y-2.5",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"최근 활동"}),e.jsx("span",{className:"text-xs",children:K(f.lastActivity)})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"추천인"}),e.jsx("span",{className:"text-xs",children:r.referrer?.username||"-"})]}),r.memo&&e.jsxs("div",{className:"col-span-2 py-2 px-3 rounded-lg bg-white/5 border border-white/10",children:[e.jsx("span",{className:"text-xs text-muted-foreground block mb-1",children:"메모"}),e.jsx("span",{className:"text-xs",children:r.memo})]})]})]})]})}),e.jsx(de,{value:"transactions",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:g?e.jsx(ne,{}):H.length===0?e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx(je,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"입출금 내역이 없습니다."})]}):e.jsx("div",{className:"glass-card rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-white/10",children:e.jsxs("tr",{className:"bg-white/5",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs",children:"구분"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs",children:"상태"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs",children:"일시"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs",children:"메모"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs",children:"금액"})]})}),e.jsx("tbody",{children:H.map(a=>e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`p-1 rounded-lg ${a.transaction_type==="deposit"?"bg-green-500/20":"bg-red-500/20"}`,children:a.transaction_type==="deposit"?e.jsx(ze,{className:"h-3 w-3 text-green-400"}):e.jsx(us,{className:"h-3 w-3 text-red-400"})}),e.jsx("span",{className:"text-xs",children:a.transaction_type==="deposit"?"입금":"출금"})]})}),e.jsx("td",{className:"px-3 py-2",children:G(a.status)}),e.jsx("td",{className:"px-3 py-2 text-muted-foreground text-xs",children:K(a.created_at)}),e.jsx("td",{className:"px-3 py-2 text-muted-foreground text-xs max-w-xs truncate",children:a.notes||"-"}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("span",{className:`font-mono text-xs ${a.transaction_type==="deposit"?"text-green-400":"text-red-400"}`,children:[a.transaction_type==="deposit"?"+":"-",y(a.amount)]})})]},a.id))})]})})})}),e.jsx(de,{value:"betting",className:"max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:g?e.jsx(ne,{}):le.length===0?e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx(Ne,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-xs",children:"베팅 내역이 없습니다."})]}):e.jsx("div",{className:"glass-card rounded-xl overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{className:"border-b border-white/10",children:e.jsxs("tr",{className:"bg-white/5",children:[e.jsx("th",{className:"px-3 py-2 text-left text-xs",children:"게임"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs",children:"프로바이더"}),e.jsx("th",{className:"px-3 py-2 text-left text-xs",children:"일시"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs",children:"베팅"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs",children:"당첨"}),e.jsx("th",{className:"px-3 py-2 text-right text-xs",children:"손익"})]})}),e.jsx("tbody",{children:le.map(a=>{const o=(a.win_amount||0)>(a.bet_amount||0),B=(a.win_amount||0)-(a.bet_amount||0);return e.jsxs("tr",{className:"border-b border-white/5 hover:bg-white/5 transition-colors",children:[e.jsx("td",{className:"px-3 py-2",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:`p-1 rounded-lg ${o?"bg-green-500/20":"bg-red-500/20"}`,children:e.jsx(Ne,{className:`h-3 w-3 ${o?"text-green-400":"text-red-400"}`})}),e.jsx("span",{className:"text-xs",children:a.game_title||`게임 ID: ${a.game_id}`})]})}),e.jsx("td",{className:"px-3 py-2 text-muted-foreground text-xs",children:a.provider_name||`프로바이더 ${a.provider_id}`}),e.jsx("td",{className:"px-3 py-2 text-muted-foreground text-xs",children:K(a.played_at)}),e.jsx("td",{className:"px-3 py-2 text-right font-mono text-xs",children:y(a.bet_amount||0)}),e.jsx("td",{className:"px-3 py-2 text-right font-mono text-xs",children:y(a.win_amount||0)}),e.jsx("td",{className:"px-3 py-2 text-right",children:e.jsxs("span",{className:`font-mono text-xs ${o?"text-green-400":"text-red-400"}`,children:[B>=0?"+":"",y(B)]})})]},a.id)})})]})})})}),e.jsx(de,{value:"pattern",className:"space-y-3 max-h-[calc(92vh-140px)] overflow-y-auto pr-2 pt-3",children:g?e.jsx(ne,{}):v?e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"grid gap-3 grid-cols-4",children:[e.jsx(J,{className:"glass-card metric-gradient-purple",children:e.jsxs(Q,{className:"pt-3 pb-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(rs,{className:"h-3 w-3 text-white"}),e.jsx("h3",{className:"text-xs text-white",children:"사용자 성향"})]}),e.jsx("p",{className:"text-sm font-bold text-white mb-1",children:v.userType}),e.jsx("p",{className:"text-xs text-white/80",children:"베팅 패턴 종합 분석"})]})}),e.jsx(J,{className:"glass-card",children:e.jsxs(Q,{className:"pt-3 pb-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(ns,{className:"h-3 w-3 text-yellow-400"}),e.jsx("h3",{className:"text-xs",children:"리스크 분석"})]}),e.jsx(w,{className:`text-xs px-2 py-0.5 mb-1.5 ${v.riskLevel==="HIGH"?"bg-red-500/20 text-red-400 border-red-500/30":v.riskLevel==="MEDIUM"?"bg-yellow-500/20 text-yellow-400 border-yellow-500/30":"bg-green-500/20 text-green-400 border-green-500/30"}`,children:v.riskLevel==="HIGH"?"고위험":v.riskLevel==="MEDIUM"?"중위험":"저위험"}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["평균: ",e.jsx("span",{className:"font-mono",children:y(v.avgBet)})]})]})}),e.jsx(J,{className:"glass-card",children:e.jsxs(Q,{className:"pt-3 pb-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(ls,{className:"h-3 w-3 text-cyan-400"}),e.jsx("h3",{className:"text-xs",children:"베팅 통계"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"총 베팅"}),e.jsxs("span",{className:"text-xs font-mono",children:[v.totalBets,"회"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"승률"}),e.jsxs("span",{className:`text-xs font-mono ${v.winRate>50?"text-green-400":"text-red-400"}`,children:[v.winRate.toFixed(1),"%"]})]})]})]})}),e.jsx(J,{className:"glass-card",children:e.jsxs(Q,{className:"pt-3 pb-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2",children:[e.jsx(Se,{className:"h-3 w-3 text-orange-400"}),e.jsx("h3",{className:"text-xs",children:"시간 패턴"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"피크"}),e.jsxs("span",{className:"text-xs font-mono",children:[v.peakHour,"시"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-xs text-muted-foreground",children:"야간"}),e.jsxs("span",{className:"text-xs font-mono",children:[v.nightPlayRatio.toFixed(1),"%"]})]})]})]})})]}),e.jsx(J,{className:"glass-card",children:e.jsxs(Q,{className:"pt-3 pb-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2 pb-2 border-b border-white/10",children:[e.jsx(os,{className:"h-3 w-3 text-yellow-400"}),e.jsx("h3",{className:"text-xs",children:"선호 게임 TOP 5"})]}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:v.topGames.map((a,o)=>e.jsxs("div",{className:"p-2 rounded-lg bg-white/5 hover:bg-white/10 transition-colors",children:[e.jsxs(w,{className:"bg-blue-500/20 text-blue-400 border-blue-500/30 text-xs px-1.5 py-0.5 mb-1.5",children:[o+1,"위"]}),e.jsx("p",{className:"text-xs mb-0.5 truncate",children:a.game}),e.jsx("p",{className:"text-xs text-muted-foreground mb-1.5 truncate",children:a.provider}),e.jsxs("div",{className:"space-y-0.5",children:[e.jsxs("p",{className:"font-mono text-xs",children:[a.count,"회"]}),e.jsxs("p",{className:`text-xs ${a.winRate>50?"text-green-400":"text-red-400"}`,children:["승률 ",a.winRate.toFixed(1),"%"]})]})]},o))})]})}),e.jsx(J,{className:"glass-card",children:e.jsxs(Q,{className:"pt-3 pb-3 px-4",children:[e.jsxs("div",{className:"flex items-center gap-1.5 mb-2 pb-2 border-b border-white/10",children:[e.jsx(xe,{className:"h-3 w-3 text-purple-400"}),e.jsx("h3",{className:"text-xs",children:"AI 분석 인사이트"})]}),e.jsx("div",{className:"grid grid-cols-2 gap-2",children:v.insights.map((a,o)=>e.jsxs("div",{className:"flex items-start gap-1.5 p-2 rounded-lg bg-purple-500/10 border border-purple-500/20 hover:bg-purple-500/15 transition-colors",children:[e.jsx(xe,{className:"h-3 w-3 text-purple-400 mt-0.5 flex-shrink-0"}),e.jsx("p",{className:"text-xs leading-relaxed",children:a})]},o))})]})})]}):e.jsxs("div",{className:"text-center py-12 glass-card rounded-xl",children:[e.jsx(xe,{className:"h-12 w-12 text-muted-foreground mx-auto mb-3 opacity-50"}),e.jsx("p",{className:"text-muted-foreground text-xs mb-2",children:"분석할 베팅 데이터가 부족합니다."})]})})]})]})}):null}const bs={1:"시스템관리자",2:"대본사",3:"본사",4:"부본사",5:"총판",6:"매장",7:"사용자"};function js(){const{authState:r}=Pe(),[S,R]=x.useState(null),[F,L]=x.useState(!0);return x.useEffect(()=>{(async()=>{if(!r.user?.id){L(!1);return}try{const{data:C,error:H}=await m.from("partners").select("level").eq("id",r.user.id).maybeSingle();H?(console.error("사용자 레벨 확인 오류:",H),R(null)):C?R(C.level||null):(console.log("파트너가 아닙니다. 일반 사용자로 판단합니다."),R(7))}catch(C){console.error("사용자 레벨 확인 실패:",C),R(null)}finally{L(!1)}})()},[r.user?.id]),{userLevel:S,loading:F,isSystemAdmin:S===1,canManageUsers:S&&S<=6,getLevelName:g=>bs[g]||"알 수 없음"}}const Ns=["KB국민은행","신한은행","우리은행","하나은행","농협은행","IBK기업은행","부산은행","대구은행","광주은행","전북은행","경남은행","제주은행","SC제일은행","HSBC은행","KDB산업은행","NH농협은행","신협중앙회","우체국예금보험","새마을금고","카카오뱅크","케이뱅크","토스뱅크"];function Rs(){const{authState:r}=Pe(),{lastMessage:S,connected:R,sendMessage:F}=Ke();js();const[L,g]=x.useState([]),[C,H]=x.useState(!0),[D,le]=x.useState(""),[te,v]=x.useState("all"),[oe,f]=x.useState(!1),[pe,W]=x.useState(!1),[he,ie]=x.useState(!1),[ge,y]=x.useState(!1),[fe,K]=x.useState("deposit"),[G,a]=x.useState(null),[o,B]=x.useState(null),[I,V]=x.useState(null),[Y,U]=x.useState(!1),[T,j]=x.useState(null),[p,q]=x.useState({username:"",nickname:"",password:"",bank_name:"",bank_account:"",memo:""}),h=async(s=!1)=>{try{s||H(!0);let t=[];if(r.user?.level===1){const{data:c,error:u}=await m.from("users").select(`
            *,
            referrer:partners!referrer_id(
              id,
              username,
              level,
              opcode,
              secret_key,
              api_token
            )
          `).order("created_at",{ascending:!1});if(u)throw u;g(c||[]);return}else{const{data:c}=await m.rpc("get_hierarchical_partners",{p_partner_id:r.user?.id});t=[r.user?.id||"",...c?.map(u=>u.id)||[]]}const{data:n,error:i}=await m.from("users").select(`
          *,
          referrer:partners!referrer_id(
            id,
            username,
            level,
            opcode,
            secret_key,
            api_token
          )
        `).in("referrer_id",t).order("created_at",{ascending:!1});if(i)throw i;g(n||[])}catch(t){console.error("❌ 회원 목록 조회 실패:",t),s||d.error("회원 목록을 불러오는데 실패했습니다."),g([])}finally{s||H(!1)}};x.useEffect(()=>{h()},[r.user?.id,r.user?.level]),x.useEffect(()=>{const s=m.channel("users-changes").on("postgres_changes",{event:"*",schema:"public",table:"users"},t=>{console.log("👥 users 테이블 변경 감지:",t),h(!0)}).subscribe();return()=>{m.removeChannel(s)}},[]),x.useEffect(()=>{(S?.type==="user_balance_updated"||S?.type==="user_updated")&&(console.log("🔔 사용자 업데이트 알림 수신:",S),h(!0))},[S]);const _=async()=>{if(!p.username||!p.password){d.error("아이디와 비밀번호는 필수입니다.");return}try{console.log("👤 새 회원 생성 시작:",p.username);const{data:s,error:t}=await m.rpc("create_user_with_api",{p_username:p.username,p_nickname:p.nickname||p.username,p_password:p.password,p_bank_name:p.bank_name,p_bank_account:p.bank_account,p_memo:p.memo,p_referrer_id:r.user?.id});if(t)throw console.error("❌ 회원 생성 DB 오류:",t),t;if(s&&Array.isArray(s)&&s.length>0){const n=s[0];n.success?(d.success(`회원 ${p.username}이 성공적으로 생성되었습니다.`),f(!1),q({username:"",nickname:"",password:"",bank_name:"",bank_account:"",memo:""}),await h()):(console.error("❌ 회원 생성 실패:",n.error),d.error(n.error||"회원 생성에 실패했습니다."))}else console.error("❌ 예상치 못한 응답:",s),d.error("회원 생성 중 오류가 발생했습니다.")}catch(s){console.error("❌ 회원 생성 전체 오류:",s),d.error(s.message||"회원 생성에 실패했습니다.")}},Ce=async(s,t)=>{const n=L.find(i=>i.id===s);if(!n){d.error("사용자 정보를 찾을 수 없습니다.");return}g(i=>i.map(c=>c.id===s?{...c,status:"active",updated_at:new Date().toISOString()}:c));try{j(s),console.log("✅ 회원 승인 처리 시작:",t);const i=n.referrer?.opcode||"",c=n.referrer?.secret_key||"";if(!i||!c)console.warn("⚠️ 파트너 API 설정이 없어 외부 API 동기화 스킵");else{console.log("🌐 외부 API 서버에 계정 생성 요청:",{opcode:i,username:t});const N=await es(i,t,c);if(N.error){g(k=>k.map(E=>E.id===s?{...E,status:"pending"}:E)),d.error(`외부 API 동기화 실패: ${N.error}`),console.error("❌ 외부 API 계정 생성 실패:",N.error);return}console.log("✅ 외부 API 계정 생성 성공:",N.data)}const{error:u}=await m.from("users").update({status:"active",updated_at:new Date().toISOString()}).eq("id",s);if(u)throw g(N=>N.map(k=>k.id===s?{...k,status:"pending"}:k)),console.error("❌ 회원 승인 DB 오류:",u),u;d.success(`회원 ${t}이 승인되었습니다. (외부 API 동기화 완료)`)}catch(i){console.error("회원 승인 실패:",i),d.error(i.message||"회원 승인에 실패했습니다.")}finally{j(null)}},P=async(s,t)=>{const n=L.find(i=>i.id===s);g(i=>i.filter(c=>c.id!==s));try{j(s),console.log("❌ 회원 가입 거절:",t);const{error:i}=await m.from("users").update({status:"blocked",memo:(n?.memo||"")+" [가입 거절됨]",updated_at:new Date().toISOString()}).eq("id",s);if(i)throw n&&g(c=>[...c,n]),console.error("❌ 회원 거절 오류:",i),i;d.success(`회원 ${t}의 가입이 거절되었습니다.`)}catch(i){console.error("회원 거절 실패:",i),d.error(i.message||"회원 거절에 실패했습니다.")}finally{j(null)}},A=async()=>{if(!o)return;const s=o;g(t=>t.filter(n=>n.id!==o.id)),W(!1);try{U(!0),console.log("🗑️ 회원 삭제 처리:",o.username);const{error:t}=await m.from("user_sessions").delete().eq("user_id",o.id);t&&console.warn("⚠️ 게임 세션 삭제 중 오류:",t);const{error:n}=await m.from("message_queue").delete().eq("sender_id",o.id);n&&console.warn("⚠️ 메시지 큐 (발송자) 삭제 중 오류:",n);const{error:i}=await m.from("message_queue").delete().eq("target_id",o.id);i&&console.warn("⚠️ 메시지 큐 (수신자) 삭제 중 오류:",i);const{error:c}=await m.from("notifications").delete().eq("recipient_id",o.id);c&&console.warn("⚠️ 알림 삭제 중 오류:",c);const{error:u}=await m.from("realtime_notifications").delete().eq("recipient_id",o.id);u&&console.warn("⚠️ 실시간 알림 삭제 중 오류:",u);const{error:N}=await m.from("transactions").delete().eq("user_id",o.id);if(N){console.error("❌ 트랜잭션 삭제 중 오류:",N),g(Z=>[...Z,s]),d.error("회원의 거래 내역 삭제에 실패했습니다."),W(!0);return}const{error:k}=await m.from("game_records").delete().eq("user_id",o.id);k&&console.warn("⚠️ 게임 기록 삭제 중 오류:",k);const{error:E}=await m.from("users").delete().eq("id",o.id);if(E)throw g(Z=>[...Z,s]),console.error("❌ 회원 삭제 오류:",E),E;console.log("✅ 회원 삭제 완료:",o.username),d.success(`회원 ${o.username}이 삭제되었습니다.`),B(null)}catch(t){console.error("회원 삭제 실패:",t),d.error(t.message||"회원 삭제에 실패했습니다."),W(!0)}finally{U(!1)}},ae=async s=>{try{j(s.targetId);const t=L.find(He=>He.id===s.targetId);if(!t){d.error("사용자를 찾을 수 없습니다.");return}if(console.log(`💰 강제 ${s.type==="deposit"?"입금":"출금"} 처리 시작:`,t.username,s.amount),!r.user){d.error("로그인 정보가 없습니다.");return}const{data:n,error:i}=await m.from("partners").select("balance, level, nickname, partner_type").eq("id",r.user.id).single();if(i||!n){d.error("관리자 정보를 찾을 수 없습니다.");return}const c=n.level===1;if(s.type==="deposit"&&!c&&n.balance<s.amount){d.error(`관리자 보유금이 부족합니다. (현재: ${n.balance.toLocaleString()}원)`);return}const u=await ts(r.user);if(!u){d.error("관리자 API 설정을 찾을 수 없습니다."),console.error("❌ opcodeConfig가 없습니다. partners 테이블에 opcode, api_token, secret_key를 설정하세요.");return}const N=as(u)?u.opcodes[0]:u;if(!N){d.error("사용 가능한 OPCODE가 없습니다.");return}const k=s.type==="deposit"?await Ze(t.username,s.amount,N.opcode,N.token,N.secretKey):await Je(t.username,s.amount,N.opcode,N.token,N.secretKey);if(!k.success||k.error){d.error(`API ${s.type==="deposit"?"입금":"출금"} 실패: ${k.error||"알 수 없는 오류"}`),console.error(`API ${s.type==="deposit"?"입금":"출금"} 실패:`,k.error);return}console.log(`✅ API ${s.type==="deposit"?"입금":"출금"} 성공:`,k.data);const E=Qe(k.data,t.username);console.log("💰 실제 잔고:",E);const{error:Z}=await m.from("transactions").insert({user_id:t.id,partner_id:r.user?.id,transaction_type:s.type==="deposit"?"admin_deposit":"admin_withdrawal",amount:s.amount,status:"completed",processed_by:r.user?.id,memo:s.memo||`[관리자 강제 ${s.type==="deposit"?"입금":"출금"}] ${r.user?.username}`,balance_before:t.balance||0,balance_after:E,external_response:k.data});if(Z)throw Z;const{error:De}=await m.from("users").update({balance:E,updated_at:new Date().toISOString()}).eq("id",t.id);if(De)throw De;let z=n.balance;s.type==="deposit"?(z=n.balance-s.amount,await m.from("partners").update({balance:z,updated_at:new Date().toISOString()}).eq("id",r.user.id),await m.from("partner_balance_logs").insert({partner_id:r.user.id,balance_before:n.balance,balance_after:z,amount:-s.amount,transaction_type:"withdrawal",from_partner_id:r.user.id,to_partner_id:null,processed_by:r.user.id,memo:`[회원 강제입금] ${t.username}에게 ${s.amount.toLocaleString()}원 입금${s.memo?`: ${s.memo}`:""}`}),console.log(`💸 관리자 보유금 차감: ${n.balance.toLocaleString()}원 → ${z.toLocaleString()}원`)):(z=n.balance+s.amount,await m.from("partners").update({balance:z,updated_at:new Date().toISOString()}).eq("id",r.user.id),await m.from("partner_balance_logs").insert({partner_id:r.user.id,balance_before:n.balance,balance_after:z,amount:s.amount,transaction_type:"deposit",from_partner_id:null,to_partner_id:r.user.id,processed_by:r.user.id,memo:`[회원 강제출금] ${t.username}으로부터 ${s.amount.toLocaleString()}원 회수${s.memo?`: ${s.memo}`:""}`}),console.log(`💰 관리자 보유금 증가: ${n.balance.toLocaleString()}원 → ${z.toLocaleString()}원`)),R&&F&&(F({type:"user_balance_updated",data:{userId:t.id,amount:s.amount,type:s.type}}),F({type:"partner_balance_updated",data:{partnerId:r.user.id,amount:s.type==="deposit"?-s.amount:s.amount,type:s.type==="deposit"?"withdrawal":"deposit"}})),d.success(`${t.username}님에게서 ${s.amount.toLocaleString()}원이 ${s.type==="deposit"?"입금":"출금"}되었습니다.`),await h()}catch(t){throw console.error("강제 입출금 처리 실패:",t),d.error(t.message||"강제 입출금 처리에 실패했습니다."),t}finally{j(null)}},$=s=>{a(s),K("deposit"),y(!0)},$e=s=>{a(s),K("withdrawal"),y(!0)},O=async s=>{if(!s)return;const t=s.status==="suspended",n=t?"active":"suspended",i=t?(s.memo||"").replace(/\s*\[차단됨.*?\]/g,""):(s.memo||"")+" [차단됨: 관리자 조치]";g(c=>c.map(u=>u.id===s.id?{...u,status:n,memo:i,updated_at:new Date().toISOString()}:u));try{j(s.id),console.log("🚫 회원 차단/해제:",s.username,n);const{error:c}=await m.from("users").update({status:n,memo:i,updated_at:new Date().toISOString()}).eq("id",s.id);if(c)throw g(u=>u.map(N=>N.id===s.id?{...N,status:s.status,memo:s.memo}:N)),c;d.success(`${s.username}님이 ${t?"차단 해제":"차단"}되었습니다.`)}catch(c){console.error("회원 차단/해제 실패:",c),d.error(c.message||"회원 차단/해제에 실패했습니다.")}finally{j(null)}},l=async s=>{if(!s)return;const t=s.status==="blocked";t||g(n=>n.filter(i=>i.id!==s.id));try{if(j(s.id),console.log("🚨 블랙리스트 처리:",s.username),t){const{data:n,error:i}=await m.rpc("remove_user_from_blacklist_simple",{p_user_id:s.id,p_admin_id:r.user?.id});if(i)throw i;const c=Array.isArray(n)?n[0]:n;if(!c.success)throw new Error(c.error);d.success(`${s.username}님이 블랙리스트에서 해제되었습니다.`)}else{const{data:n,error:i}=await m.rpc("add_user_to_blacklist_simple",{p_user_id:s.id,p_admin_id:r.user?.id,p_reason:"관리자 조치"});if(i)throw g(u=>[...u,s]),i;const c=Array.isArray(n)?n[0]:n;if(!c.success)throw g(u=>[...u,s]),new Error(c.error);d.success(`${s.username}님이 블랙리스트에 추가되었습니다.`)}}catch(n){console.error("블랙리스트 처리 실패:",n),d.error(n.message||"블랙리스트 처리에 실패했습니다.")}finally{j(null)}};x.useEffect(()=>{S?.type==="user_registered"&&(console.log("🔔 새 회원 가입 알림 수신"),h(),d.info("새로운 회원 가입 신청이 있습니다."))},[S,h]);const b=L.filter(s=>{if(s.status==="blocked")return!1;const t=D===""||s.username?.toLowerCase().includes(D.toLowerCase())||s.nickname?.toLowerCase().includes(D.toLowerCase())||s.email?.toLowerCase().includes(D.toLowerCase())||s.phone?.includes(D)||s.bank_name?.toLowerCase().includes(D.toLowerCase())||s.bank_account?.includes(D)||s.balance?.toString().includes(D)||s.points?.toString().includes(D)||s.memo?.toLowerCase().includes(D.toLowerCase()),n=te==="all"||s.status===te;return t&&n}),X=L.filter(s=>s.status==="pending").slice(0,5),Re=[{key:"username",header:"아이디"},{key:"nickname",header:"닉네임"},{key:"referrer_info",header:"소속",cell:s=>e.jsx("span",{className:"text-sm text-slate-300",children:s.referrer?s.referrer.username:"미지정"})},{key:"status",header:"상태",cell:s=>s.status==="active"?e.jsx(w,{className:"px-3 py-1 bg-gradient-to-r from-emerald-500/20 to-teal-500/20 text-emerald-400 border border-emerald-500/50 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]",children:"● 승인됨"}):s.status==="pending"?e.jsx(w,{className:"px-3 py-1 bg-gradient-to-r from-orange-500/20 to-amber-500/20 text-orange-400 border border-orange-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]",children:"● 대기중"}):s.status==="suspended"?e.jsx(w,{className:"px-3 py-1 bg-gradient-to-r from-slate-500/20 to-gray-500/20 text-slate-400 border border-slate-500/50 rounded-full shadow-[0_0_10px_rgba(100,116,139,0.5)]",children:"● 차단됨"}):null},{key:"balance",header:"보유금",cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-cyan-400",children:[(s.balance||0).toLocaleString(),"원"]})},{key:"points",header:"포인트",cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-purple-400",children:[(s.points||0).toLocaleString(),"P"]})},{key:"vip_level",header:"레벨",cell:s=>{const t=s.vip_level||0;return t===0?e.jsx(w,{className:"px-3 py-1 bg-slate-700/50 text-slate-300 border border-slate-600/50 rounded-full",children:"○ Silver"}):t===1?e.jsx(w,{className:"px-3 py-1 bg-gradient-to-r from-yellow-500/20 to-amber-500/20 text-yellow-400 border border-yellow-500/50 rounded-full shadow-[0_0_10px_rgba(234,179,8,0.5)]",children:"⚡ Gold"}):t===2?e.jsx(w,{className:"px-3 py-1 bg-gradient-to-r from-orange-500/20 to-red-500/20 text-orange-400 border border-orange-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]",children:"⚡ Bronze"}):e.jsx(w,{className:"px-3 py-1 bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-400 border border-purple-500/50 rounded-full shadow-[0_0_10px_rgba(168,85,247,0.5)]",children:"⚡ VIP"})}},{key:"created_at",header:"가입일",cell:s=>{const t=new Date(s.created_at),n=t.getFullYear(),i=t.getMonth()+1,c=t.getDate();return e.jsxs("span",{className:"text-slate-400 text-sm",children:[n,". ",i,". ",c,"."]})}},{key:"last_login_at",header:"최근접속",cell:s=>{if(!s.last_login_at)return e.jsx("span",{className:"text-slate-500 text-sm",children:"미접속"});const t=new Date(s.last_login_at),n=t.getFullYear(),i=t.getMonth()+1,c=t.getDate();return e.jsxs("span",{className:"text-slate-400 text-sm",children:[n,". ",i,". ",c,"."]})}},{key:"is_online",header:"접속",cell:s=>s.is_online?e.jsx(w,{className:"bg-gradient-to-r from-green-500 to-emerald-500 text-white border-0 animate-pulse",children:"● 온라인"}):e.jsx(w,{className:"bg-slate-600 text-slate-300 border-0",children:"○ 오프라인"})},{key:"created_at_old",header:"가입일",cell:s=>new Date(s.created_at).toLocaleDateString("ko-KR")},{key:"actions",header:"관리",cell:s=>s.status==="pending"?e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{size:"sm",onClick:()=>Ce(s.id,s.username),disabled:T===s.id,className:"btn-premium-success",children:T===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(Ve,{className:"h-4 w-4 mr-1"}),"승인"]})}),e.jsx(M,{size:"sm",onClick:()=>P(s.id,s.username),disabled:T===s.id,className:"btn-premium-danger",children:T===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"h-4 w-4 mr-1"}),"거절"]})})]}):e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(M,{size:"sm",variant:"outline",onClick:()=>{V(s),ie(!0)},title:"상세 정보",children:e.jsx(Xe,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>$(s),className:"text-green-600 hover:text-green-700",title:"입금",children:e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>$e(s),className:"text-red-600 hover:text-red-700",title:"출금",children:e.jsx(Be,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>O(s),disabled:T===s.id,className:s.status==="suspended"?"text-blue-600 hover:text-blue-700":"text-orange-600 hover:text-orange-700",title:s.status==="suspended"?"차단 해제":"차단",children:T===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):s.status==="suspended"?e.jsx(qe,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>l(s),disabled:T===s.id,className:"text-red-800 hover:text-red-900",title:"블랙리스트 추가",children:T===s.id?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(Ee,{className:"h-4 w-4"})}),e.jsx(M,{size:"sm",variant:"outline",onClick:()=>{B(s),W(!0)},className:"text-red-600 hover:text-red-700",title:"회원 삭제",children:e.jsx(Ie,{className:"h-4 w-4"})})]})}];return C?e.jsx(ne,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"회원 관리"}),e.jsx("p",{className:"text-sm text-slate-400",children:"시스템에 등록된 회원들을 관리합니다."})]}),e.jsxs(M,{onClick:()=>f(!0),className:"btn-premium-primary",children:[e.jsx(cs,{className:"h-4 w-4 mr-2"}),"새 회원 생성"]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(me,{title:"전체 회원",value:L.length.toLocaleString(),subtitle:"↑ 등록 회원 수",icon:Ge,color:"purple"}),e.jsx(me,{title:"승인대기",value:X.length.toLocaleString(),subtitle:"대기 중인 회원",icon:Se,color:"amber"}),e.jsx(me,{title:"활성 회원",value:L.filter(s=>s.status==="active").length.toLocaleString(),subtitle:"정상 활동 회원",icon:qe,color:"green"}),e.jsx(me,{title:"온라인",value:L.filter(s=>s.is_online).length.toLocaleString(),subtitle:"실시간 접속자",icon:Ue,color:"cyan"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100 mb-1",children:"회원 목록"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["총 ",b.length.toLocaleString(),"명의 회원을 관리하고 있습니다"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(ds,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(ee,{placeholder:"아이디, 닉네임, 이메일, 전화번호, 은행정보, 잔고, 포인트, 메모 검색",className:"pl-10 input-premium",value:D,onChange:s=>le(s.target.value)})]}),e.jsxs(Ae,{value:te,onValueChange:v,children:[e.jsxs(Le,{className:"w-[160px] input-premium",children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),e.jsx(Te,{placeholder:"상태 필터"})]}),e.jsxs(Me,{className:"bg-slate-800 border-slate-700",children:[e.jsx(re,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),"전체"]})}),e.jsx(re,{value:"pending",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),"승인대기"]})}),e.jsx(re,{value:"active",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),"활성"]})}),e.jsx(re,{value:"suspended",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),"차단"]})})]})]})]})]}),e.jsx(ss,{columns:Re,data:b,searchable:!1,emptyMessage:D?"검색 결과가 없습니다.":"등록된 회원이 없습니다."})]}),e.jsx(we,{open:oe,onOpenChange:f,children:e.jsxs(ye,{className:"sm:max-w-[500px] bg-slate-900/90 backdrop-blur-md border-slate-700/60 shadow-2xl shadow-blue-500/20",children:[e.jsxs(_e,{children:[e.jsx(ve,{className:"text-xl text-slate-100 bg-gradient-to-r from-blue-400 to-cyan-400 bg-clip-text text-transparent",children:"새 회원 생성"}),e.jsx(ke,{className:"text-slate-400",children:"새로운 회원을 시스템에 등록합니다. 외부 API와 연동됩니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(se,{htmlFor:"username",className:"text-right text-slate-300",children:"아이디"}),e.jsx(ee,{id:"username",value:p.username,onChange:s=>q(t=>({...t,username:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:"회원 아이디 입력"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(se,{htmlFor:"nickname",className:"text-right text-slate-300",children:"닉네임"}),e.jsx(ee,{id:"nickname",value:p.nickname,onChange:s=>q(t=>({...t,nickname:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:"회원 닉네임 입력"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(se,{htmlFor:"password",className:"text-right text-slate-300",children:"비밀번호"}),e.jsx(ee,{id:"password",type:"password",value:p.password,onChange:s=>q(t=>({...t,password:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:"초기 비밀번호 입력"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(se,{className:"text-right text-slate-300",children:"은행명"}),e.jsxs(Ae,{value:p.bank_name||void 0,onValueChange:s=>q(t=>({...t,bank_name:s})),children:[e.jsx(Le,{className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",children:e.jsx(Te,{placeholder:"은행 선택"})}),e.jsx(Me,{className:"bg-slate-800 border-slate-700",children:Ns.map(s=>e.jsx(re,{value:s,className:"text-slate-200 focus:bg-slate-700 focus:text-slate-100",children:s},s))})]})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(se,{htmlFor:"bank_account",className:"text-right text-slate-300",children:"계좌번호"}),e.jsx(ee,{id:"bank_account",value:p.bank_account,onChange:s=>q(t=>({...t,bank_account:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:"계좌번호 입력"})]}),e.jsxs("div",{className:"grid grid-cols-4 items-center gap-4",children:[e.jsx(se,{htmlFor:"memo",className:"text-right text-slate-300",children:"메모"}),e.jsx(ee,{id:"memo",value:p.memo,onChange:s=>q(t=>({...t,memo:s.target.value})),className:"col-span-3 input-premium focus:border-blue-500/60 focus:ring-2 focus:ring-blue-500/20",placeholder:"관리자 메모"})]})]}),e.jsxs(Fe,{className:"gap-3",children:[e.jsx(M,{type:"button",variant:"outline",onClick:()=>f(!1),className:"bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-slate-700 hover:text-slate-100",children:"취소"}),e.jsx(M,{type:"submit",onClick:_,className:"btn-premium-primary",children:"회원 생성"})]})]})}),e.jsx(we,{open:pe,onOpenChange:W,children:e.jsxs(ye,{className:"sm:max-w-[425px] bg-slate-900/90 backdrop-blur-md border-slate-700/60 shadow-2xl shadow-red-500/20",children:[e.jsxs(_e,{children:[e.jsx(ve,{className:"text-xl text-slate-100",children:"회원 삭제 확인"}),e.jsxs(ke,{className:"text-slate-400",children:['정말로 회원 "',o?.username,'"을(를) 삭제하시겠습니까? 이 작업은 되돌릴 수 없습니다.']})]}),e.jsxs(Fe,{className:"gap-3",children:[e.jsx(M,{variant:"outline",onClick:()=>W(!1),disabled:Y,className:"bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-slate-700 hover:text-slate-100",children:"취소"}),e.jsx(M,{onClick:A,disabled:Y,className:"btn-premium-danger",children:Y?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"삭제 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ie,{className:"h-4 w-4 mr-2"}),"영구 삭제"]})})]})]})}),e.jsx(is,{open:ge,onOpenChange:s=>{y(s),s||a(null)},type:fe,targetType:"user",selectedTarget:G?{id:G.id,username:G.username,nickname:G.nickname,balance:G.balance||0}:null,onSubmit:ae,onTypeChange:K}),e.jsx(fs,{user:I,isOpen:he,onClose:()=>{ie(!1),V(null)}})]})}export{Rs as UserManagement,Rs as default};

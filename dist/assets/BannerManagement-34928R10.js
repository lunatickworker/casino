import{r as n,j as e}from"./react-core-CwM-CeLv.js";import{s as h,i as m,L as c,I as g,S as B,p as F,q as D,r as P,t as u,B as b,C as ee,a as se,b as ae,d as te,e as le}from"./index-B-OPgV84.js";import{T as re}from"./textarea-B58kONDf.js";import{D as ie}from"./DataTable-Cfqx9Gu8.js";import{A as ne,a as ce,b as de,c as oe,d as xe}from"./AdminDialog-DoQjEojI.js";import{k as i}from"./vendor-CQn7sZ7L.js";import{M as y}from"./MetricCard-Cd1WAiG1.js";import{P as me,I as A,m as E,U as ue,ab as q,ao as T,X as he,ag as pe,ap as ge,aa as be,a8 as je,O as fe}from"./lucide-icons-D2Y5yybo.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";function Fe({user:d}){const[p,G]=n.useState([]),[M,z]=n.useState(!1),[j,w]=n.useState(!1),[f,L]=n.useState(null),[O,_]=n.useState(!1),[C,U]=n.useState(!1),[o,v]=n.useState(null),[S,N]=n.useState(null),[l,r]=n.useState({title:"",content:"",image_url:"",banner_type:"popup",target_audience:"users",status:"active",display_order:0});n.useEffect(()=>{k()},[d.id]);const k=async()=>{z(!0);try{let s=h.from("banners").select("*").order("display_order",{ascending:!0});d.level>1&&(s=s.eq("partner_id",d.id));const{data:a,error:t}=await s;if(t)throw t;G(a||[])}catch(s){console.error("배너 로드 실패:",s),i.error("배너 목록을 불러오는데 실패했습니다.")}finally{z(!1)}},R=s=>{const a=s.target.files?.[0];if(!a)return;if(a.size>2*1024*1024){i.error("이미지 파일 크기는 2MB 이하여야 합니다.");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(a.type)){i.error("JPG, PNG, GIF, WebP 형식의 이미지만 업로드 가능합니다.");return}v(a);const x=new FileReader;x.onloadend=()=>{N(x.result)},x.readAsDataURL(a)},V=()=>{v(null),N(null),r(s=>({...s,image_url:""}))},H=async()=>{if(!o)return l.image_url||null;U(!0);try{const s=o.name.split(".").pop(),t=`${`${d.id}_${Date.now()}.${s}`}`,{error:x}=await h.storage.from("banner-images").upload(t,o,{cacheControl:"3600",upsert:!1});if(x)throw console.error("이미지 업로드 에러:",x),x;const{data:{publicUrl:Z}}=h.storage.from("banner-images").getPublicUrl(t);return Z}catch(s){return console.error("이미지 업로드 실패:",s),i.error("이미지 업로드에 실패했습니다."),null}finally{U(!1)}},W=async()=>{if(!l.title?.trim()){i.error("배너 제목을 입력하세요.");return}if(!l.content?.trim()){i.error("배너 내용을 입력하세요.");return}w(!0);try{let s=l.image_url;if(o){const t=await H();if(t)s=t;else{w(!1);return}}const a={...l,image_url:s,partner_id:d.id,updated_at:new Date().toISOString()};if(f){const{error:t}=await h.from("banners").update(a).eq("id",f);if(t)throw t;i.success("배너가 성공적으로 수정되었습니다.")}else{const{error:t}=await h.from("banners").insert({...a,created_at:new Date().toISOString()});if(t)throw t;i.success("배너가 성공적으로 생성되었습니다.")}I(),await k()}catch(s){console.error("배너 저장 실패:",s),i.error("배너 저장에 실패했습니다.")}finally{w(!1)}},J=async s=>{if(confirm("이 배너를 삭제하시겠습니까?"))try{const{error:a}=await h.from("banners").delete().eq("id",s);if(a)throw a;i.success("배너가 성공적으로 삭제되었습니다."),await k()}catch(a){console.error("배너 삭제 실패:",a),i.error("배너 삭제에 실패했습니다.")}},K=s=>{r({title:s.title,content:s.content,image_url:s.image_url,banner_type:s.banner_type,target_audience:s.target_audience,target_level:s.target_level,status:s.status,display_order:s.display_order,start_date:s.start_date,end_date:s.end_date}),L(s.id),v(null),N(s.image_url||null),_(!0)},I=()=>{r({title:"",content:"",image_url:"",banner_type:"popup",target_audience:"users",status:"active",display_order:0}),L(null),v(null),N(null),_(!1)},X=s=>{const a=window.open("","_blank","width=600,height=400");a&&a.document.write(`
        <html>
          <head>
            <title>배너 미리보기 - ${s.title}</title>
            <style>
              body { margin: 0; padding: 20px; font-family: sans-serif; background: #1e293b; }
              .banner-preview { 
                border: 2px solid #f97316; 
                padding: 20px; 
                max-width: 500px; 
                margin: 0 auto; 
                background: #0f172a; 
                color: #fff; 
                border-radius: 8px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.3);
              }
              .banner-title { 
                margin: 0 0 15px 0; 
                color: #f97316; 
                font-size: 18px;
                font-weight: bold;
                text-align: center;
              }
              .banner-content { 
                line-height: 1.6; 
                color: #e2e8f0;
              }
              .banner-image { 
                max-width: 100%; 
                height: auto; 
                margin: 10px 0; 
                border-radius: 4px;
              }
            </style>
          </head>
          <body>
            <div class="banner-preview">
              <h3 class="banner-title">★★★ ${s.title} ★★★</h3>
              ${s.image_url?`<img src="${s.image_url}" class="banner-image" />`:""}
              <div class="banner-content">${s.content}</div>
            </div>
          </body>
        </html>
      `)},Q=[{key:"title",title:"제목",sortable:!0,cell:s=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-medium truncate",children:s.title}),s.image_url&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"이미지 포함"})]})},{key:"banner_type",title:"타입",cell:s=>e.jsx(b,{variant:s.banner_type==="popup"?"default":"secondary",children:s.banner_type==="popup"?"팝업":"배너"})},{key:"target_audience",title:"대상",cell:s=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(b,{variant:"outline",children:s.target_audience==="all"?"전체":s.target_audience==="users"?"사용자":"파트너"}),s.target_level&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Level ",s.target_level]})]})},{key:"status",title:"상태",cell:s=>e.jsx(b,{variant:s.status==="active"?"default":"secondary",children:s.status==="active"?"활성":"비활성"})},{key:"display_order",title:"순서",sortable:!0},{key:"actions",title:"작업",cell:s=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(m,{onClick:()=>X(s),variant:"outline",size:"sm",title:"미리보기",children:e.jsx(E,{className:"h-4 w-4"})}),e.jsx(m,{onClick:()=>K(s),variant:"outline",size:"sm",title:"수정",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(m,{onClick:()=>J(s.id),variant:"outline",size:"sm",title:"삭제",children:e.jsx(fe,{className:"h-4 w-4"})})]})}],Y=p.filter(s=>s.status==="active").length,$=p.filter(s=>s.banner_type==="popup").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"배너 관리"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["사용자 페이지에 표시되는 배너를 관리합니다. (",d.level<=5?"총판 이상":"접근 제한",")"]})]}),d.level<=5&&e.jsxs(m,{onClick:()=>_(!0),className:"flex items-center gap-2",children:[e.jsx(me,{className:"h-4 w-4"}),"새 배너 만들기"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(y,{title:"전체 배너",value:p.length.toLocaleString(),subtitle:"등록된 배너",icon:A,color:"blue"}),e.jsx(y,{title:"활성 배너",value:Y.toLocaleString(),subtitle:"노출 중",icon:E,color:"green"}),e.jsx(y,{title:"팝업 배너",value:$.toLocaleString(),subtitle:"팝업 형식",icon:ue,color:"purple"}),e.jsx(y,{title:"일반 배너",value:(p.length-$).toLocaleString(),subtitle:"배너 형식",icon:q,color:"orange"})]}),e.jsx(ne,{open:O&&d.level<=5,onOpenChange:s=>!s&&I(),children:e.jsxs(ce,{className:"!max-w-[min(1600px,95vw)] w-[95vw] max-h-[85vh] overflow-y-auto glass-card p-0",children:[e.jsxs(de,{className:"pb-5 border-b border-slate-700/50 bg-gradient-to-r from-blue-500/10 to-purple-500/10 px-8 pt-6 rounded-t-lg sticky top-0 z-10",children:[e.jsxs(oe,{className:"flex items-center gap-3 text-2xl text-slate-50",children:[e.jsx("div",{className:"p-2.5 bg-blue-500/20 rounded-lg",children:e.jsx(A,{className:"h-7 w-7 text-blue-400"})}),f?"배너 수정":"새 배너 만들기"]}),e.jsx(xe,{className:"text-slate-300 mt-2 text-base",children:"16:9 비율로 최적화된 배너를 생성하여 사용자에게 효과적으로 공지사항을 전달하세요."})]}),e.jsxs("div",{className:"grid grid-cols-12 gap-6 px-8 py-6",children:[e.jsx("div",{className:"col-span-4 space-y-4",children:e.jsxs("div",{className:"space-y-4 p-5 border border-slate-700/50 rounded-xl bg-gradient-to-br from-slate-900/50 to-slate-800/30 shadow-lg",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx("div",{className:"h-1 w-8 bg-blue-500 rounded-full"}),e.jsx("h4",{className:"font-semibold text-slate-100",children:"기본 정보"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs(c,{htmlFor:"banner_title",className:"text-slate-200 flex items-center gap-2",children:[e.jsx(T,{className:"h-3.5 w-3.5 text-blue-400"}),"배너 제목 *"]}),e.jsx(g,{id:"banner_title",value:l.title||"",onChange:s=>r(a=>({...a,title:s.target.value})),placeholder:"눈에 띄는 제목을 입력하세요",className:"input-premium h-11 text-base border-slate-600 focus:border-blue-500 bg-slate-800/50"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{className:"text-slate-200",children:"배너 타입"}),e.jsxs(B,{value:l.banner_type,onValueChange:s=>r(a=>({...a,banner_type:s})),children:[e.jsx(F,{className:"h-11 bg-slate-800/50 border-slate-600 hover:border-blue-500 transition-colors",children:e.jsx(D,{})}),e.jsxs(P,{className:"bg-slate-900 border-slate-700",children:[e.jsx(u,{value:"popup",children:"🔔 팝업"}),e.jsx(u,{value:"banner",children:"📌 배너"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{className:"text-slate-200",children:"상태"}),e.jsxs(B,{value:l.status,onValueChange:s=>r(a=>({...a,status:s})),children:[e.jsx(F,{className:"h-11 bg-slate-800/50 border-slate-600 hover:border-blue-500 transition-colors",children:e.jsx(D,{})}),e.jsxs(P,{className:"bg-slate-900 border-slate-700",children:[e.jsx(u,{value:"active",children:"✅ 활성"}),e.jsx(u,{value:"inactive",children:"⏸️ 비활성"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{className:"text-slate-200",children:"대상"}),e.jsxs(B,{value:l.target_audience,onValueChange:s=>r(a=>({...a,target_audience:s})),children:[e.jsx(F,{className:"h-11 bg-slate-800/50 border-slate-600 hover:border-blue-500 transition-colors",children:e.jsx(D,{})}),e.jsxs(P,{className:"bg-slate-900 border-slate-700",children:[e.jsx(u,{value:"all",children:"👥 전체"}),e.jsx(u,{value:"users",children:"👤 사용자"}),e.jsx(u,{value:"partners",children:"🤝 파트너"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(c,{className:"text-slate-200",children:"표시 순서"}),e.jsx(g,{id:"display_order",type:"number",value:l.display_order||0,onChange:s=>r(a=>({...a,display_order:parseInt(s.target.value)})),placeholder:"0",className:"input-premium h-11 bg-slate-800/50 border-slate-600 focus:border-blue-500"})]})]}),e.jsxs("div",{className:"space-y-3 pt-3 border-t border-slate-700/30",children:[e.jsxs(c,{className:"text-slate-200 flex items-center gap-2",children:[e.jsx(q,{className:"h-3.5 w-3.5 text-blue-400"}),"노출 기간"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"start_date",className:"text-xs text-slate-400",children:"시작"}),e.jsx(g,{id:"start_date",type:"datetime-local",value:l.start_date||"",onChange:s=>r(a=>({...a,start_date:s.target.value})),className:"h-10 bg-slate-800/50 border-slate-600 text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"end_date",className:"text-xs text-slate-400",children:"종료"}),e.jsx(g,{id:"end_date",type:"datetime-local",value:l.end_date||"",onChange:s=>r(a=>({...a,end_date:s.target.value})),className:"h-10 bg-slate-800/50 border-slate-600 text-sm"})]})]})]})]})}),e.jsx("div",{className:"col-span-4 space-y-4",children:e.jsxs("div",{className:"space-y-4 p-5 border border-slate-700/50 rounded-xl bg-gradient-to-br from-slate-900/50 to-slate-800/30 shadow-lg h-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-8 bg-purple-500 rounded-full"}),e.jsx("h4",{className:"font-semibold text-slate-100",children:"배너 이미지"})]}),S&&e.jsxs(m,{type:"button",variant:"ghost",size:"sm",onClick:V,className:"h-8 text-xs text-red-400 hover:text-red-300 hover:bg-red-500/10",children:[e.jsx(he,{className:"h-4 w-4 mr-1"}),"제거"]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"p-3 bg-blue-500/10 border border-blue-500/20 rounded-lg",children:e.jsxs("p",{className:"text-xs text-blue-300 flex items-center gap-2",children:[e.jsx(pe,{className:"h-3.5 w-3.5"}),"권장 비율: 16:9 (예: 1920x1080px)"]})}),S?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"relative border-2 border-slate-600 rounded-xl overflow-hidden bg-slate-900 shadow-xl",children:[e.jsx("div",{className:"aspect-video flex items-center justify-center",children:e.jsx("img",{src:S,alt:"배너 미리보기",className:"max-w-full max-h-full object-contain"})}),e.jsx("div",{className:"absolute top-2 right-2",children:e.jsx(b,{variant:"secondary",className:"bg-green-500/90 text-white",children:"미리보기"})})]}),o&&e.jsxs("div",{className:"flex items-center justify-between p-3 bg-slate-800/50 rounded-lg border border-slate-700/50",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-300",children:[e.jsx(T,{className:"h-4 w-4 text-blue-400"}),e.jsx("span",{className:"text-sm truncate max-w-[180px]",children:o.name})]}),e.jsxs(b,{variant:"outline",className:"text-xs",children:[(o.size/1024).toFixed(0)," KB"]})]})]}):e.jsxs(c,{htmlFor:"banner_image_upload",className:"flex flex-col items-center justify-center w-full h-[280px] border-2 border-dashed border-slate-600 rounded-xl cursor-pointer hover:border-blue-500 hover:bg-blue-500/5 transition-all bg-slate-800/30 group",children:[e.jsxs("div",{className:"flex flex-col items-center gap-3",children:[e.jsx("div",{className:"p-4 bg-slate-700/50 rounded-full group-hover:bg-blue-500/20 transition-colors",children:e.jsx(ge,{className:"h-10 w-10 text-slate-400 group-hover:text-blue-400 transition-colors"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-slate-200 mb-1",children:e.jsx("span",{className:"font-semibold",children:"클릭하여 이미지 업로드"})}),e.jsx("p",{className:"text-xs text-slate-400",children:"또는 드래그 앤 드롭"})]}),e.jsx("div",{className:"px-4 py-2 bg-slate-700/30 rounded-full",children:e.jsx("p",{className:"text-xs text-slate-300",children:"JPG, PNG, GIF, WebP · 최대 2MB"})})]}),e.jsx(g,{id:"banner_image_upload",type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:R,className:"hidden"})]})]})]})}),e.jsx("div",{className:"col-span-4 space-y-4",children:e.jsxs("div",{className:"space-y-4 p-5 border border-slate-700/50 rounded-xl bg-gradient-to-br from-slate-900/50 to-slate-800/30 shadow-lg h-full flex flex-col",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-1 w-8 bg-green-500 rounded-full"}),e.jsx("h4",{className:"font-semibold text-slate-100",children:"배너 내용"})]}),e.jsxs("div",{className:"space-y-3 flex-1 flex flex-col",children:[e.jsxs(c,{htmlFor:"banner_content",className:"text-slate-200 flex items-center gap-2",children:[e.jsx(T,{className:"h-3.5 w-3.5 text-green-400"}),"내용 *"]}),e.jsx(re,{id:"banner_content",value:l.content||"",onChange:s=>r(a=>({...a,content:s.target.value})),placeholder:`배너에 표시될 내용을 입력하세요.

• HTML 태그를 사용할 수 있습니다
• 줄바꿈은 <br> 태그를 사용하세요
• 강조는 <strong> 태그를 사용하세요`,className:"flex-1 min-h-[320px] bg-slate-800/50 border-slate-600 focus:border-green-500 resize-none text-base leading-relaxed"}),e.jsx("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700/50",children:e.jsxs("p",{className:"text-xs text-slate-400 leading-relaxed",children:["💡 ",e.jsx("strong",{className:"text-slate-300",children:"사용 가능한 태그:"}),e.jsx("br",{}),"<p> <br> <strong> <em> <span> <div> <a> <ul> <li>"]})})]})]})})]}),e.jsxs("div",{className:"flex gap-4 pt-6 border-t border-slate-700/50 px-8 pb-6 bg-slate-900/30 sticky bottom-0 z-10",children:[e.jsxs(m,{onClick:W,disabled:j||C,className:"btn-premium-primary flex items-center gap-3 flex-1 h-12 text-base shadow-lg shadow-blue-500/20 hover:shadow-blue-500/40 transition-all",children:[e.jsx(be,{className:"h-5 w-5"}),C?"이미지 업로드 중...":f?j?"수정 중...":"배너 수정":j?"생성 중...":"배너 생성"]}),e.jsx(m,{onClick:I,variant:"outline",disabled:j||C,className:"border-slate-600 hover:bg-slate-700/50 h-12 px-8 text-base",children:"취소"})]})]})}),e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsx(ae,{children:"배너 목록"}),e.jsx(te,{children:"생성된 배너 목록을 확인하고 관리하세요."})]}),e.jsx(le,{children:e.jsx(ie,{data:p,columns:Q,loading:M,searchPlaceholder:"배너를 검색하세요..."})})]})]})}export{Fe as BannerManagement,Fe as default};

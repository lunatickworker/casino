import{r as m,j as e,E as b,S as P,x as B,y as M,z as O,D as A,w as c,I as V,t as x}from"./index-BWgbPZ4l.js";import{T as G}from"./textarea-tGH4Q6hM.js";import{P as H,a as R,b as W}from"./popover-BsdRP5n9.js";import{C as q,a as J,e as K,b as Q,c as U,d as X}from"./command-D2LDR3mL.js";import{A as Y,a as Z,b as _,c as ee,d as se,e as ae}from"./AdminDialog-CYGxI-kp.js";import{S as te}from"./search-BHxVGLMF.js";import{T as le}from"./trash-2-DnGlVhRm.js";function xe({open:y,onOpenChange:j,type:r,targetType:n,selectedTarget:h,targets:p=[],onSubmit:F,onTypeChange:$}){const[i,g]=m.useState(""),[d,t]=m.useState(""),[w,v]=m.useState(""),[k,S]=m.useState(!1),[N,C]=m.useState(!1),D=[{label:"1천",value:1e3},{label:"3천",value:3e3},{label:"5천",value:5e3},{label:"1만",value:1e4},{label:"3만",value:3e4},{label:"5만",value:5e4},{label:"100만",value:1e6},{label:"300만",value:3e6},{label:"500만",value:5e6},{label:"1000만",value:1e7}],l=h||p.find(s=>s.id===i),a=l?parseFloat(l.balance?.toString()||"0"):0,f=!!h,I=s=>{const u=parseFloat(d||"0")+s;if(r==="withdrawal"&&i&&u>a){x.error(`출금 금액이 보유금(${a.toLocaleString()}원)을 초과할 수 없습니다.`),t(a.toString());return}t(u.toString())},L=s=>{const o=parseFloat(s||"0");if(r==="withdrawal"&&i&&o>a){x.error(`출금 금액이 보유금(${a.toLocaleString()}원)을 초과할 수 없습니다.`),t(a.toString());return}t(s)},z=()=>{t("0")},T=()=>{l&&r==="withdrawal"&&t(a.toString())},E=async()=>{const s=h?.id||i;if(!s){x.error(`${n==="user"?"회원":"파트너"}를 선택해주세요.`);return}const o=parseFloat(d||"0");if(o<=0){x.error("금액을 입력해주세요.");return}if(r==="withdrawal"&&o>a){x.error(`출금 금액이 보유금(${a.toLocaleString()}원)을 초과할 수 없습니다.`);return}try{C(!0),await F({targetId:s,type:r,amount:o,memo:w}),f||g(""),t(""),v(""),j(!1)}catch(u){console.error("강제 입출금 실행 오류:",u)}finally{C(!1)}};return e.jsx(Y,{open:y,onOpenChange:s=>{s||(f||g(""),t(""),v("")),j(s)},children:e.jsxs(Z,{className:"bg-slate-900 border-slate-700 max-w-md",children:[e.jsxs(_,{children:[e.jsx(ee,{className:"text-white",children:"관리자 강제 입출금"}),e.jsx(se,{className:"text-slate-400",children:"회원의 잔액을 직접 조정합니다."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"text-slate-300",children:"거래 유형"}),e.jsxs(P,{value:r,onValueChange:s=>$(s),children:[e.jsx(B,{className:"bg-slate-800 border-slate-700 text-white",children:e.jsx(M,{})}),e.jsxs(O,{className:"bg-slate-800 border-slate-700",children:[e.jsx(A,{value:"deposit",children:"입금"}),e.jsx(A,{value:"withdrawal",children:"출금"})]})]})]}),!f&&e.jsxs("div",{className:"space-y-2",children:[e.jsxs(b,{className:"text-slate-300",children:[n==="user"?"회원":"파트너"," 선택"]}),e.jsxs(H,{open:k,onOpenChange:S,children:[e.jsx(R,{asChild:!0,children:e.jsxs(c,{variant:"outline",role:"combobox",className:"w-full justify-between bg-slate-800 border-slate-700 text-white hover:bg-slate-700",children:[i?`${l?.nickname} (${l?.username})`:`${n==="user"?"회원":"파트너"}을 선택하세요`,e.jsx(te,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(W,{className:"w-[400px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(q,{className:"bg-slate-800",children:[e.jsx(J,{placeholder:`${n==="user"?"회원":"파트너"} 검색...`,className:"text-white"}),e.jsxs(K,{children:[e.jsxs(Q,{className:"text-slate-400 py-6 text-center",children:[n==="user"?"회원":"파트너","을 찾을 수 없습니다."]}),e.jsx(U,{children:p.map(s=>e.jsx(X,{value:`${s.nickname} ${s.username} ${s.id}`,onSelect:()=>{g(s.id),S(!1)},className:"text-white hover:bg-slate-700 cursor-pointer",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"font-medium",children:s.nickname}),e.jsxs("span",{className:"text-sm text-slate-400",children:["(",s.username,")"]})]}),e.jsxs("div",{className:"text-sm text-cyan-400 mt-1",children:["잔액: ",parseFloat(s.balance?.toString()||"0").toLocaleString(),"원"]})]})},s.id))})]})]})})]})]}),l&&e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:["선택된 ",n==="user"?"회원":"파트너"]}),e.jsx("span",{className:"text-cyan-400 font-medium",children:l.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"현재 보유금"}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[a.toLocaleString(),"원"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"text-slate-300",children:"금액"}),e.jsx(V,{type:"text",value:d,onChange:s=>L(s.target.value),placeholder:"금액을 입력하세요",className:"bg-slate-800 border-slate-700 text-white"}),e.jsx("div",{className:"grid grid-cols-5 gap-2",children:D.map(s=>e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:()=>I(s.value),className:"bg-slate-700 border-slate-600 text-white hover:bg-slate-600 text-xs h-8",children:s.label},s.value))}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs(c,{type:"button",variant:"outline",size:"sm",onClick:z,className:"bg-red-900/20 border-red-500 text-red-400 hover:bg-red-900/40",children:[e.jsx(le,{className:"h-4 w-4 mr-2"}),"전액삭제"]}),r==="withdrawal"&&l&&e.jsx(c,{type:"button",variant:"outline",size:"sm",onClick:T,className:"bg-orange-900/20 border-orange-500 text-orange-400 hover:bg-orange-900/40",children:"전액출금"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"text-slate-300",children:"메모"}),e.jsx(G,{value:w,onChange:s=>v(s.target.value),placeholder:"메모를 입력하세요 (선택사항)",className:"bg-slate-800 border-slate-700 text-white resize-none",rows:3})]})]}),e.jsxs(ae,{className:"gap-2",children:[e.jsx(c,{variant:"outline",onClick:()=>j(!1),disabled:N,className:"border-slate-600 hover:bg-slate-700 text-white",children:"취소"}),e.jsx(c,{onClick:E,disabled:N||!h?.id&&!i||!d||parseFloat(d)<=0,className:"bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white",children:N?"처리중...":"실행"})]})]})})}export{xe as F};

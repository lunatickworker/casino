import{r as l,j as e}from"./react-core-CwM-CeLv.js";import{K as M,s as i,C as v,a as C,b as S,e as k,L as b,I as E,i as m,V as G,W as K,m as P,B as U}from"./index-Zxf-w_JS.js";import{T as W}from"./textarea-CBBumD45.js";import{k as n}from"./vendor-CQn7sZ7L.js";import{W as z,d as D,ag as O,P as Q,aB as V,ad as X,o as J,n as Y,R as Z,t as ee}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";function oe({user:a,onRouteChange:I}){const{sendMessage:A}=M(),[o,d]=l.useState(""),[x,f]=l.useState(""),[j,w]=l.useState(!1),[N,T]=l.useState([]),[B,y]=l.useState(!0),[$]=l.useState([1e3,3e3,5e3,1e4,3e4,5e4,1e5,3e5,5e5,1e6]),[u,q]=l.useState(0),h=async()=>{try{y(!0);const{data:t,error:s}=await i.from("transactions").select("*").eq("user_id",a.id).eq("transaction_type","deposit").order("created_at",{ascending:!1}).limit(10);if(s)throw s;T(t||[])}catch(t){console.error("ì…ê¸ˆ ë‚´ì—­ ì¡°íšŒ ì˜¤ë¥˜:",t),n.error("ì…ê¸ˆ ë‚´ì—­ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{y(!1)}},p=async()=>{try{const{data:t,error:s}=await i.from("users").select("balance").eq("id",a.id).single();if(s)throw s;q(parseFloat(t.balance)||0)}catch(t){console.error("ì”ê³  ì¡°íšŒ ì˜¤ë¥˜:",t)}},F=async t=>{if(t.preventDefault(),!o){n.error("ëª¨ë“  í•„ìˆ˜ í•­ëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}const s=parseFloat(o);if(s<1e4){n.error("ìµœì†Œ ì…ê¸ˆ ê¸ˆì•¡ì€ 10,000ì›ì…ë‹ˆë‹¤.");return}if(s>1e7){n.error("ìµœëŒ€ ì…ê¸ˆ ê¸ˆì•¡ì€ 10,000,000ì›ì…ë‹ˆë‹¤.");return}w(!0);try{await p();const r={user_id:a.id,partner_id:a.referrer_id||null,transaction_type:"deposit",amount:s,status:"pending",balance_before:u,balance_after:u,bank_name:"êµ­ë¯¼ì€í–‰",bank_account:"123456-78-901234",bank_holder:"GMSì¹´ì§€ë…¸",memo:x.trim()||null,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};console.log("ğŸ’° ì…ê¸ˆ ì‹ ì²­ ë°ì´í„°:",{...r,user_info:{id:a.id,username:a.username,referrer_id:a.referrer_id}});const{data:g,error:_}=await i.from("transactions").insert([r]).select().single();if(_)throw _;await A("deposit_request",{transaction_id:g.id,user_id:a.id,username:a.username,nickname:a.nickname,amount:s,bank_name:"êµ­ë¯¼ì€í–‰",bank_account:"123456-78-901234",depositor_name:"GMSì¹´ì§€ë…¸",memo:x.trim()||null,subject:`${a.nickname}ë‹˜ì˜ ì…ê¸ˆ ì‹ ì²­`,reference_type:"transaction",reference_id:g.id},3)&&console.log("âœ… ì…ê¸ˆ ìš”ì²­ ì•Œë¦¼ì´ ê´€ë¦¬ìì—ê²Œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤."),await i.from("activity_logs").insert([{actor_type:"user",actor_id:a.id,action:"deposit_request",target_type:"transaction",target_id:g.id,details:{amount:s,bank_name:"êµ­ë¯¼ì€í–‰",depositor_name:"GMSì¹´ì§€ë…¸"}}]),d(""),f(""),await h(),n.success(`ì…ê¸ˆ ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.
ê´€ë¦¬ì ìŠ¹ì¸ í›„ ì”ê³ ì— ë°˜ì˜ë©ë‹ˆë‹¤.`,{duration:4e3})}catch(r){console.error("âŒ ì…ê¸ˆ ì‹ ì²­ ì˜¤ë¥˜:",r),n.error(r.message||"ì…ê¸ˆ ì‹ ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{w(!1)}},R=t=>{const s=parseInt(o)||0;d((s+t).toString())},H=t=>{switch(t){case"pending":return{color:"bg-yellow-500",textColor:"text-yellow-400",icon:ee,label:"ìŠ¹ì¸ëŒ€ê¸°"};case"approved":return{color:"bg-blue-500",textColor:"text-blue-400",icon:Z,label:"ì²˜ë¦¬ì¤‘"};case"completed":return{color:"bg-green-500",textColor:"text-green-400",icon:Y,label:"ì™„ë£Œ"};case"rejected":return{color:"bg-red-500",textColor:"text-red-400",icon:J,label:"ê±°ì ˆ"};default:return{color:"bg-slate-500",textColor:"text-slate-400",icon:X,label:"ì•Œ ìˆ˜ ì—†ìŒ"}}},c=t=>new Intl.NumberFormat("ko-KR").format(t),L=t=>new Date(t).toLocaleString("ko-KR");return l.useEffect(()=>{h(),p();const t=i.channel(`deposit_updates_${a.id}`).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${a.id}`},s=>{if(console.log("ğŸ”„ ì…ê¸ˆ ìƒíƒœ ì—…ë°ì´íŠ¸ ìˆ˜ì‹ :",s),s.eventType==="UPDATE"||s.eventType==="INSERT"){const r=s.new;r.transaction_type==="deposit"&&(h(),r.status==="completed"?(p(),n.success(`ì…ê¸ˆì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!
ê¸ˆì•¡: â‚©${c(r.amount)}`,{duration:5e3})):r.status==="rejected"?n.error(`ì…ê¸ˆ ì‹ ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤.
ê¸ˆì•¡: â‚©${c(r.amount)}`,{duration:5e3}):r.status==="approved"&&n.info(`ì…ê¸ˆì´ ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì²˜ë¦¬ ì¤‘ì…ë‹ˆë‹¤.
ê¸ˆì•¡: â‚©${c(r.amount)}`,{duration:4e3}))}}).subscribe();return()=>t.unsubscribe()},[a.id]),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-white mb-2",children:"ì…ê¸ˆ ì‹ ì²­"}),e.jsx("p",{className:"text-slate-400",children:"ì•ˆì „í•˜ê³  ë¹ ë¥¸ ì…ê¸ˆ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì„¸ìš”"})]}),e.jsxs("div",{className:"flex items-center gap-4 bg-slate-800/50 rounded-lg px-4 py-2",children:[e.jsx(z,{className:"w-5 h-5 text-green-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm text-slate-300",children:"í˜„ì¬ ë³´ìœ ê¸ˆ"}),e.jsxs("div",{className:"text-lg font-bold text-green-400",children:["â‚©",c(u)]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(v,{className:"bg-slate-800/50 border-slate-700",children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center text-white",children:[e.jsx(D,{className:"w-5 h-5 mr-2 text-green-400"}),"ì…ê¸ˆ ì‹ ì²­"]})}),e.jsx(k,{children:e.jsxs("form",{onSubmit:F,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"amount",className:"text-slate-300",children:"ì…ê¸ˆ ê¸ˆì•¡ *"}),e.jsx(E,{id:"amount",type:"text",placeholder:"ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”",value:o,onChange:t=>{const s=t.target.value.replace(/[^0-9]/g,"");d(s)},className:"bg-slate-700/50 border-slate-600 text-white text-lg"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{className:"text-slate-300",children:"ë¹ ë¥¸ ì„ íƒ"}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[$.map(t=>e.jsxs(m,{type:"button",variant:"outline",size:"sm",onClick:()=>R(t),className:"whitespace-nowrap",children:["+",c(t),"ì›"]},t)),e.jsx(m,{type:"button",variant:"outline",size:"sm",onClick:()=>d(""),className:"whitespace-nowrap border-red-600 text-red-400 hover:bg-red-900/20",children:"ì‚­ì œ"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(b,{htmlFor:"memo",className:"text-slate-300",children:"ë©”ëª¨ (ì„ íƒ)"}),e.jsx(W,{id:"memo",placeholder:"ì¶”ê°€ ìš”ì²­ì‚¬í•­ì´ ìˆìœ¼ì‹œë©´ ì…ë ¥í•˜ì„¸ìš”",value:x,onChange:t=>f(t.target.value),className:"bg-slate-700/50 border-slate-600 text-white",rows:3})]}),e.jsxs(G,{className:"border-yellow-600 bg-yellow-900/20",children:[e.jsx(O,{className:"h-4 w-4 text-yellow-400"}),e.jsx(K,{className:"text-yellow-300",children:e.jsxs("div",{className:"space-y-1",children:[e.jsx("p",{children:"â€¢ ìµœì†Œ ì…ê¸ˆì•¡: 10,000ì› | ìµœëŒ€ ì…ê¸ˆì•¡: 10,000,000ì›"}),e.jsx("p",{children:"â€¢ ì…ê¸ˆìëª…ê³¼ ê³„ì¢Œ ì†Œìœ ìëª…ì´ ì¼ì¹˜í•´ì•¼ í•©ë‹ˆë‹¤"}),e.jsx("p",{children:"â€¢ ìŠ¹ì¸ê¹Œì§€ í‰ê·  5-10ë¶„ ì†Œìš”ë©ë‹ˆë‹¤"}),e.jsx("p",{children:"â€¢ ë¬¸ì˜ì‚¬í•­ì€ ê³ ê°ì„¼í„°ë¥¼ ì´ìš©í•´ì£¼ì„¸ìš”"})]})})]}),e.jsx(m,{type:"submit",disabled:j,className:"w-full bg-green-600 hover:bg-green-700 text-white py-3",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"ì‹ ì²­ ì²˜ë¦¬ ì¤‘..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Q,{className:"w-4 h-4 mr-2"}),"ì…ê¸ˆ ì‹ ì²­í•˜ê¸°"]})})]})})]})}),e.jsx("div",{children:e.jsxs(v,{className:"bg-slate-800/50 border-slate-700",children:[e.jsx(C,{children:e.jsxs(S,{className:"flex items-center text-white",children:[e.jsx(V,{className:"w-5 h-5 mr-2 text-blue-400"}),"ìµœê·¼ ì…ê¸ˆ ë‚´ì—­"]})}),e.jsx(k,{children:B?e.jsx("div",{className:"flex items-center justify-center py-8",children:e.jsx(P,{})}):N.length>0?e.jsxs("div",{className:"space-y-4",children:[N.map(t=>{const s=H(t.status),r=s.icon;return e.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(r,{className:`w-4 h-4 ${s.textColor}`}),e.jsx(U,{className:`${s.color} text-white`,children:s.label})]}),e.jsxs("span",{className:"text-lg font-bold text-white",children:["â‚©",c(t.amount)]})]}),e.jsxs("div",{className:"space-y-1 text-sm text-slate-400",children:[e.jsxs("p",{children:[t.bank_name," ",t.bank_account]}),e.jsx("p",{children:L(t.created_at)}),t.memo&&e.jsxs("p",{className:"text-slate-300",children:["ë©”ëª¨: ",t.memo]})]})]},t.id)}),e.jsx(m,{variant:"outline",onClick:()=>I("/user/profile"),className:"w-full",children:"ì „ì²´ ë‚´ì—­ ë³´ê¸°"})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx(D,{className:"w-12 h-12 text-slate-600 mx-auto mb-3"}),e.jsx("p",{className:"text-slate-400",children:"ì…ê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤"})]})})]})})]})]})}export{oe as UserDeposit};

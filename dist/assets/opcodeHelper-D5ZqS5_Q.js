import{s as a}from"./index-BWgbPZ4l.js";async function y(e){if(console.log("ğŸ” getAdminOpcode í˜¸ì¶œ:",{id:e.id,username:e.username,partner_type:e.partner_type,level:e.level,opcode:e.opcode,has_opcode:!!e.opcode,has_secret_key:!!e.secret_key,has_token:!!e.token,has_api_token:!!e.api_token}),e.partner_type==="system_admin"){const o=[],n=e.token||e.api_token;e.opcode&&e.secret_key&&n?(o.push({opcode:e.opcode,secretKey:e.secret_key,token:n,partnerId:e.id,partnerName:e.name||e.nickname||"ì‹œìŠ¤í…œê´€ë¦¬ì"}),console.log("âœ… ì‹œìŠ¤í…œê´€ë¦¬ì ë³¸ì¸ OPCODE ì¶”ê°€:",e.opcode)):console.warn("âš ï¸ ì‹œìŠ¤í…œê´€ë¦¬ì OPCODE ì •ë³´ ë¶ˆì™„ì „:",{opcode:e.opcode,secret_key:e.secret_key?"***":null,token:n?"***":null});const{data:c,error:r}=await a.from("partners").select("id, username, nickname, opcode, secret_key, api_token").eq("partner_type","head_office").not("opcode","is",null).not("secret_key","is",null).not("api_token","is",null);if(r&&console.error("âŒ ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ ì˜¤ë¥˜:",r),c&&c.length>0&&(c.forEach(t=>{o.push({opcode:t.opcode,secretKey:t.secret_key,token:t.api_token,partnerId:t.id,partnerName:t.nickname||t.username||`ëŒ€ë³¸ì‚¬-${t.id.slice(0,8)}`})}),console.log(`âœ… ëŒ€ë³¸ì‚¬ OPCODE ${c.length}ê°œ ì¶”ê°€`)),o.length===0)throw new Error("ì‚¬ìš© ê°€ëŠ¥í•œ OPCODEê°€ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œê´€ë¦¬ì ë˜ëŠ” ëŒ€ë³¸ì‚¬ì— OPCODEë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.");return console.log(`ğŸ“Š ì‹œìŠ¤í…œê´€ë¦¬ì ì´ ${o.length}ê°œ OPCODE ì‚¬ìš© ê°€ëŠ¥`),{opcodes:o,isSystemAdmin:!0}}if(e.partner_type==="head_office"){const o=e.token||e.api_token;if(!e.opcode||!e.secret_key||!o)throw new Error("ëŒ€ë³¸ì‚¬ ê³„ì •ì— OPCODE/Tokenì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");return console.log("âœ… ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ:",e.opcode),{opcode:e.opcode,secretKey:e.secret_key,token:o,partnerId:e.id,partnerName:e.nickname||e.username||"ë‚´ ì¡°ì§"}}const _=e.parent_chain||[];if(_.length===0){if(console.log("ğŸ” parent_chain ì—†ìŒ, parent_idë¡œ ëŒ€ë³¸ì‚¬ ì°¾ê¸° ì‹œì‘:",{admin_id:e.id,admin_username:e.username,admin_type:e.partner_type,parent_id:e.parent_id}),!e.parent_id)throw new Error(`${e.partner_type}ëŠ” ìƒìœ„ íŒŒíŠ¸ë„ˆê°€ í•„ìš”í•©ë‹ˆë‹¤. parent_idê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);let o=e.parent_id,n=0;const c=10;for(;o&&n<c;){console.log(`ğŸ” [ì‹œë„ ${n+1}] íŒŒíŠ¸ë„ˆ ì¡°íšŒ:`,o);const{data:r,error:t}=await a.from("partners").select("id, nickname, username, partner_type, level, opcode, secret_key, api_token, parent_id").eq("id",o).single();if(console.log(`ğŸ“Š [ì‹œë„ ${n+1}] ì¡°íšŒ ê²°ê³¼:`,{found:!!r,error:t?.message,partner_type:r?.partner_type,level:r?.level,has_opcode:!!r?.opcode,has_secret_key:!!r?.secret_key,has_api_token:!!r?.api_token,parent_id:r?.parent_id}),t)throw console.error("âŒ ìƒìœ„ íŒŒíŠ¸ë„ˆ ì¡°íšŒ DB ì˜¤ë¥˜:",t),new Error(`ìƒìœ„ íŒŒíŠ¸ë„ˆ ì¡°íšŒ ì‹¤íŒ¨: ${t.message}`);if(!r)throw new Error(`ìƒìœ„ íŒŒíŠ¸ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ID: ${o})`);if(r.partner_type==="head_office"){const p=r.api_token;if(!r.opcode||!r.secret_key||!p)throw console.error("âŒ ëŒ€ë³¸ì‚¬ OPCODE ì •ë³´ ë¶€ì¡±:",{partner_id:r.id,username:r.username,has_opcode:!!r.opcode,has_secret_key:!!r.secret_key,has_api_token:!!p}),new Error(`ìƒìœ„ ëŒ€ë³¸ì‚¬(${r.username})ì— OPCODE/Tokenì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);return console.log("âœ… ìƒìœ„ ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ ì„±ê³µ:",{partner_id:r.id,username:r.username,opcode:r.opcode}),{opcode:r.opcode,secretKey:r.secret_key,token:p,partnerId:r.id,partnerName:r.nickname||r.username||"ìƒìœ„ ëŒ€ë³¸ì‚¬"}}console.log(`â¬†ï¸ [ì‹œë„ ${n+1}] ${r.partner_type}ëŠ” ëŒ€ë³¸ì‚¬ ì•„ë‹˜, ìƒìœ„ë¡œ ì´ë™`),o=r.parent_id||null,n++}throw n>=c?new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ ì¡°íšŒ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ (ìµœëŒ€ 10íšŒ)"):new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒíŠ¸ë„ˆ ê³„ì¸µ êµ¬ì¡°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.")}const k=_[0],{data:s,error:l}=await a.from("partners").select("id, nickname, opcode, secret_key, api_token").eq("id",k).single();if(l||!s)throw console.error("ìƒìœ„ ëŒ€ë³¸ì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",l),new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const i=s.api_token;if(!s.opcode||!s.secret_key||!i)throw new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ì— OPCODE/Tokenì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");return console.log("âœ… ìƒìœ„ ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ (parent_chain):",s.opcode),{opcode:s.opcode,secretKey:s.secret_key,token:i,partnerId:s.id,partnerName:s.nickname||"ìƒìœ„ ëŒ€ë³¸ì‚¬"}}function u(e){return"opcodes"in e&&"isSystemAdmin"in e}export{y as getAdminOpcode,u as isMultipleOpcode};

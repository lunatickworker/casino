import{k as E,r as n,s as u,t as i,j as e,w as x,aK as F,H,U as ee,E as c,I as g,S as B,x as I,y as D,z as P,D as h,X as te,C as se,a as ae,b as le,d as re,e as ie,B as M}from"./index-DHLZKrSC.js";import{T as ne}from"./textarea-D3JOUlRQ.js";import{D as ce}from"./DataTable-BAIDb4XS.js";import{A as de,a as oe,b as me,c as xe,d as he}from"./AdminDialog-Ho0rn2DP.js";import{M as y}from"./MetricCard-DmGakNT9.js";import{P as ue}from"./plus-Co1dk4Al.js";import{C as pe}from"./calendar-Cxago4E6.js";import{S as ge}from"./save-DHB__jBH.js";import{S as je}from"./square-pen-Cp9XeVrS.js";import{T as fe}from"./trash-2-krsq29sW.js";import"./search-DGG3ycOS.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]],U=E("file-text",be);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ve=[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]],ye=E("upload",ve);function Me({user:d}){const[p,q]=n.useState([]),[A,T]=n.useState(!1),[j,N]=n.useState(!1),[f,z]=n.useState(null),[G,_]=n.useState(!1),[w,L]=n.useState(!1),[o,b]=n.useState(null),[C,v]=n.useState(null),[l,r]=n.useState({title:"",content:"",image_url:"",banner_type:"popup",target_audience:"users",status:"active",display_order:0});n.useEffect(()=>{S()},[d.id]);const S=async()=>{T(!0);try{let t=u.from("banners").select("*").order("display_order",{ascending:!0});d.level>1&&(t=t.eq("partner_id",d.id));const{data:s,error:a}=await t;if(a)throw a;q(s||[])}catch(t){console.error("배너 로드 실패:",t),i.error("배너 목록을 불러오는데 실패했습니다.")}finally{T(!1)}},V=t=>{const s=t.target.files?.[0];if(!s)return;if(s.size>2*1024*1024){i.error("이미지 파일 크기는 2MB 이하여야 합니다.");return}if(!["image/jpeg","image/png","image/gif","image/webp"].includes(s.type)){i.error("JPG, PNG, GIF, WebP 형식의 이미지만 업로드 가능합니다.");return}b(s);const m=new FileReader;m.onloadend=()=>{v(m.result)},m.readAsDataURL(s)},R=()=>{b(null),v(null),r(t=>({...t,image_url:""}))},O=async()=>{if(!o)return l.image_url||null;L(!0);try{const t=o.name.split(".").pop(),a=`${`${d.id}_${Date.now()}.${t}`}`,{error:m}=await u.storage.from("banner-images").upload(a,o,{cacheControl:"3600",upsert:!1});if(m)throw console.error("이미지 업로드 에러:",m),m;const{data:{publicUrl:Y}}=u.storage.from("banner-images").getPublicUrl(a);return Y}catch(t){return console.error("이미지 업로드 실패:",t),i.error("이미지 업로드에 실패했습니다."),null}finally{L(!1)}},W=async()=>{if(!l.title?.trim()){i.error("배너 제목을 입력하세요.");return}if(!l.content?.trim()){i.error("배너 내용을 입력하세요.");return}N(!0);try{let t=l.image_url;if(o){const a=await O();if(a)t=a;else{N(!1);return}}const s={...l,image_url:t,partner_id:d.id,updated_at:new Date().toISOString()};if(f){const{error:a}=await u.from("banners").update(s).eq("id",f);if(a)throw a;i.success("배너가 성공적으로 수정되었습니다.")}else{const{error:a}=await u.from("banners").insert({...s,created_at:new Date().toISOString()});if(a)throw a;i.success("배너가 성공적으로 생성되었습니다.")}k(),await S()}catch(t){console.error("배너 저장 실패:",t),i.error("배너 저장에 실패했습니다.")}finally{N(!1)}},J=async t=>{if(confirm("이 배너를 삭제하시겠습니까?"))try{const{error:s}=await u.from("banners").delete().eq("id",t);if(s)throw s;i.success("배너가 성공적으로 삭제되었습니다."),await S()}catch(s){console.error("배너 삭제 실패:",s),i.error("배너 삭제에 실패했습니다.")}},K=t=>{r({title:t.title,content:t.content,image_url:t.image_url,banner_type:t.banner_type,target_audience:t.target_audience,target_level:t.target_level,status:t.status,display_order:t.display_order,start_date:t.start_date,end_date:t.end_date}),z(t.id),b(null),v(t.image_url||null),_(!0)},k=()=>{r({title:"",content:"",image_url:"",banner_type:"popup",target_audience:"users",status:"active",display_order:0}),z(null),b(null),v(null),_(!1)},X=t=>{const s=window.open("","_blank","width=600,height=400");s&&s.document.write(`
        <html>
          <head>
            <title>배너 미리보기 - ${t.title}</title>
            <style>
              body { margin: 0; padding: 20px; font-family: sans-serif; background: #1e293b; }
              .banner-preview { 
                border: 2px solid #f97316; 
                padding: 20px; 
                max-width: 500px; 
                margin: 0 auto; 
                background: #0f172a; 
                color: #fff; 
                border-radius: 8px;
                box-shadow: 0 10px 25px rgba(0,0,0,0.3);
              }
              .banner-title { 
                margin: 0 0 15px 0; 
                color: #f97316; 
                font-size: 18px;
                font-weight: bold;
                text-align: center;
              }
              .banner-content { 
                line-height: 1.6; 
                color: #e2e8f0;
              }
              .banner-image { 
                max-width: 100%; 
                height: auto; 
                margin: 10px 0; 
                border-radius: 4px;
              }
            </style>
          </head>
          <body>
            <div class="banner-preview">
              <h3 class="banner-title">★★★ ${t.title} ★★★</h3>
              ${t.image_url?`<img src="${t.image_url}" class="banner-image" />`:""}
              <div class="banner-content">${t.content}</div>
            </div>
          </body>
        </html>
      `)},Z=[{key:"title",title:"제목",sortable:!0,cell:t=>e.jsxs("div",{className:"max-w-xs",children:[e.jsx("p",{className:"font-medium truncate",children:t.title}),t.image_url&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"이미지 포함"})]})},{key:"banner_type",title:"타입",cell:t=>e.jsx(M,{variant:t.banner_type==="popup"?"default":"secondary",children:t.banner_type==="popup"?"팝업":"배너"})},{key:"target_audience",title:"대상",cell:t=>e.jsxs("div",{className:"space-y-1",children:[e.jsx(M,{variant:"outline",children:t.target_audience==="all"?"전체":t.target_audience==="users"?"사용자":"파트너"}),t.target_level&&e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Level ",t.target_level]})]})},{key:"status",title:"상태",cell:t=>e.jsx(M,{variant:t.status==="active"?"default":"secondary",children:t.status==="active"?"활성":"비활성"})},{key:"display_order",title:"순서",sortable:!0},{key:"actions",title:"작업",cell:t=>e.jsxs("div",{className:"flex gap-2",children:[e.jsx(x,{onClick:()=>X(t),variant:"outline",size:"sm",title:"미리보기",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx(x,{onClick:()=>K(t),variant:"outline",size:"sm",title:"수정",children:e.jsx(je,{className:"h-4 w-4"})}),e.jsx(x,{onClick:()=>J(t.id),variant:"outline",size:"sm",title:"삭제",children:e.jsx(fe,{className:"h-4 w-4"})})]})}],Q=p.filter(t=>t.status==="active").length,$=p.filter(t=>t.banner_type==="popup").length;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"배너 관리"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["사용자 페이지에 표시되는 배너를 관리합니다. (",d.level<=5?"총판 이상":"접근 제한",")"]})]}),d.level<=5&&e.jsxs(x,{onClick:()=>_(!0),className:"flex items-center gap-2",children:[e.jsx(ue,{className:"h-4 w-4"}),"새 배너 만들기"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(y,{title:"전체 배너",value:p.length.toLocaleString(),subtitle:"등록된 배너",icon:F,color:"blue"}),e.jsx(y,{title:"활성 배너",value:Q.toLocaleString(),subtitle:"노출 중",icon:H,color:"green"}),e.jsx(y,{title:"팝업 배너",value:$.toLocaleString(),subtitle:"팝업 형식",icon:ee,color:"purple"}),e.jsx(y,{title:"일반 배너",value:(p.length-$).toLocaleString(),subtitle:"배너 형식",icon:pe,color:"orange"})]}),e.jsx(de,{open:G&&d.level<=5,onOpenChange:t=>!t&&k(),children:e.jsxs(oe,{className:"max-w-6xl max-h-[95vh] overflow-hidden glass-card",children:[e.jsxs(me,{className:"pb-3",children:[e.jsxs(xe,{className:"flex items-center gap-2 text-lg text-slate-100",children:[e.jsx(F,{className:"h-5 w-5 text-blue-400"}),f?"배너 수정":"새 배너 만들기"]}),e.jsx(he,{className:"text-sm text-slate-400",children:"직사각형 팝업 형태의 배너를 생성하여 사용자에게 공지사항을 전달하세요."})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"space-y-3 p-3 border border-slate-700/50 rounded-lg bg-slate-900/30",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-blue-400"}),"기본 정보"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_title",className:"text-xs text-slate-300",children:"배너 제목 *"}),e.jsx(g,{id:"banner_title",value:l.title||"",onChange:t=>r(s=>({...s,title:t.target.value})),placeholder:"배너 제목을 입력하세요",className:"input-premium h-9 text-sm"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_type",className:"text-xs text-slate-300",children:"배너 타입"}),e.jsxs(B,{value:l.banner_type,onValueChange:t=>r(s=>({...s,banner_type:t})),children:[e.jsx(I,{className:"h-9 text-sm bg-slate-800 border-slate-700",children:e.jsx(D,{})}),e.jsxs(P,{className:"bg-slate-900 border-slate-700",children:[e.jsx(h,{value:"popup",children:"팝업"}),e.jsx(h,{value:"banner",children:"배너"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_status",className:"text-xs text-slate-300",children:"상태"}),e.jsxs(B,{value:l.status,onValueChange:t=>r(s=>({...s,status:t})),children:[e.jsx(I,{className:"h-9 text-sm bg-slate-800 border-slate-700",children:e.jsx(D,{})}),e.jsxs(P,{className:"bg-slate-900 border-slate-700",children:[e.jsx(h,{value:"active",children:"활성"}),e.jsx(h,{value:"inactive",children:"비활성"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"target_audience",className:"text-xs text-slate-300",children:"대상"}),e.jsxs(B,{value:l.target_audience,onValueChange:t=>r(s=>({...s,target_audience:t})),children:[e.jsx(I,{className:"h-9 text-sm bg-slate-800 border-slate-700",children:e.jsx(D,{})}),e.jsxs(P,{className:"bg-slate-900 border-slate-700",children:[e.jsx(h,{value:"all",children:"전체"}),e.jsx(h,{value:"users",children:"사용자"}),e.jsx(h,{value:"partners",children:"파트너"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"display_order",className:"text-xs text-slate-300",children:"순서"}),e.jsx(g,{id:"display_order",type:"number",value:l.display_order||0,onChange:t=>r(s=>({...s,display_order:parseInt(t.target.value)})),placeholder:"0",className:"input-premium h-9 text-sm"})]})]})]}),e.jsxs("div",{className:"space-y-2 p-3 border border-slate-700/50 rounded-lg bg-slate-900/30",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(F,{className:"h-4 w-4 text-blue-400"}),"배너 이미지"]}),C&&e.jsxs(x,{type:"button",variant:"ghost",size:"sm",onClick:R,className:"h-7 text-xs text-red-400 hover:text-red-300",children:[e.jsx(te,{className:"h-3 w-3 mr-1"}),"제거"]})]}),C?e.jsxs("div",{className:"space-y-1",children:[e.jsx("div",{className:"border border-slate-600 rounded-lg p-2 bg-slate-800",children:e.jsx("img",{src:C,alt:"배너 미리보기",className:"max-w-full h-auto max-h-32 rounded mx-auto"})}),o&&e.jsxs("p",{className:"text-[10px] text-slate-400 text-center",children:[o.name," (",(o.size/1024).toFixed(0),"KB)"]})]}):e.jsxs(c,{htmlFor:"banner_image_upload",className:"flex flex-col items-center justify-center w-full h-36 border-2 border-dashed border-slate-600 rounded-lg cursor-pointer hover:border-blue-500 transition-colors bg-slate-800/50",children:[e.jsx(ye,{className:"h-8 w-8 mb-2 text-slate-400"}),e.jsx("p",{className:"text-xs text-slate-300 mb-1",children:e.jsx("span",{className:"font-semibold",children:"클릭하여 업로드"})}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"JPG, PNG, GIF, WebP (최대 2MB)"}),e.jsx(g,{id:"banner_image_upload",type:"file",accept:"image/jpeg,image/png,image/gif,image/webp",onChange:V,className:"hidden"})]})]})]}),e.jsx("div",{className:"space-y-3",children:e.jsxs("div",{className:"space-y-2 p-3 border border-slate-700/50 rounded-lg bg-slate-900/30 h-full",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-300 flex items-center gap-2",children:[e.jsx(U,{className:"h-4 w-4 text-blue-400"}),"배너 내용"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(c,{htmlFor:"banner_content",className:"text-xs text-slate-300",children:"내용 *"}),e.jsx(ne,{id:"banner_content",rows:14,value:l.content||"",onChange:t=>r(s=>({...s,content:t.target.value})),placeholder:"배너에 표시될 내용을 입력하세요. HTML 태그 사용 가능합니다.",className:"min-h-[280px] bg-slate-800 border-slate-700 text-sm resize-none"}),e.jsx("p",{className:"text-[10px] text-slate-400",children:"사용 가능: <p>, <br>, <strong>, <em>, <span>, <div>, <a>"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"start_date",className:"text-xs text-slate-300",children:"시작 일시"}),e.jsx(g,{id:"start_date",type:"datetime-local",value:l.start_date||"",onChange:t=>r(s=>({...s,start_date:t.target.value})),className:"h-8 text-xs bg-slate-800 border-slate-700"})]}),e.jsxs("div",{className:"space-y-1",children:[e.jsx(c,{htmlFor:"end_date",className:"text-xs text-slate-300",children:"종료 일시"}),e.jsx(g,{id:"end_date",type:"datetime-local",value:l.end_date||"",onChange:t=>r(s=>({...s,end_date:t.target.value})),className:"h-8 text-xs bg-slate-800 border-slate-700"})]})]})]})})]}),e.jsxs("div",{className:"flex gap-3 pt-3 border-t border-slate-700/50 mt-3",children:[e.jsxs(x,{onClick:W,disabled:j||w,className:"btn-premium-primary flex items-center gap-2 flex-1",children:[e.jsx(ge,{className:"h-4 w-4"}),w?"이미지 업로드 중...":f?j?"수정 중...":"배너 수정":j?"생성 중...":"배너 생성"]}),e.jsx(x,{onClick:k,variant:"outline",disabled:j||w,className:"border-slate-600 hover:bg-slate-700/50",children:"취소"})]})]})}),e.jsxs(se,{children:[e.jsxs(ae,{children:[e.jsx(le,{children:"배너 목록"}),e.jsx(re,{children:"생성된 배너 목록을 확인하고 관리하세요."})]}),e.jsx(ie,{children:e.jsx(ce,{data:p,columns:Z,loading:A,searchPlaceholder:"배너를 검색하세요..."})})]})]})}export{Me as BannerManagement,Me as default};

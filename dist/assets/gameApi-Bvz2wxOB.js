const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-Zxf-w_JS.js","assets/react-core-CwM-CeLv.js","assets/vendor-CQn7sZ7L.js","assets/radix-ui-SX2QAG6c.js","assets/lucide-icons-wLPRtdhM.js","assets/supabase-r6ABpEO8.js","assets/index-BVHCjfv2.css"])))=>i.map(i=>d[i]);
import{_ as T}from"./supabase-r6ABpEO8.js";import{s as p,G as I}from"./index-Zxf-w_JS.js";async function U(){const{data:o,error:n}=await p.from("game_providers").select("*").eq("status","active").order("type",{ascending:!0}).order("name",{ascending:!0});if(n)throw console.error("ì œê³µì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",n),n;console.log(`ğŸ® ì œê³µì‚¬ ì¡°íšŒ ê²°ê³¼: ${o?.length||0}ê°œ`);const a=o?.filter(r=>r.type==="slot").length||0,e=o?.filter(r=>r.type==="casino").length||0;if(console.log(`  ğŸ“Š ìŠ¬ë¡¯: ${a}ê°œ, ì¹´ì§€ë…¸: ${e}ê°œ`),a<30||e<10){console.log("âš ï¸ ì œê³µì‚¬ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ìë™ ì´ˆê¸°í™”ë¥¼ ì‹œë„í•©ë‹ˆë‹¤..."),await O();const{data:r,error:d}=await p.from("game_providers").select("*").eq("status","active").order("type",{ascending:!0}).order("name",{ascending:!0});if(!d&&r){const i=r.filter(l=>l.type==="slot").length,c=r.filter(l=>l.type==="casino").length;return console.log(`âœ… ì¬ì¡°íšŒ ê²°ê³¼ - ìŠ¬ë¡¯: ${i}ê°œ, ì¹´ì§€ë…¸: ${c}ê°œ`),r}}return o||[]}async function z(o,n){let a,e;typeof o=="string"?(a=o,e=n||{}):e=o||{},console.log("ğŸ” getGames í˜¸ì¶œ:",{partnerId:a,filters:e});let r;a?(r=p.from("games").select(`
        id,
        provider_id,
        name,
        type,
        status,
        image_url,
        demo_available,
        is_featured,
        priority,
        rtp,
        play_count,
        created_at,
        updated_at,
        game_providers!inner(
          id,
          name,
          type
        ),
        game_status_logs!left(
          status,
          priority,
          is_featured
        )
      `),r=r.or(`partner_id.eq.${a},partner_id.is.null`,{foreignTable:"game_status_logs"})):r=p.from("games").select(`
        id,
        provider_id,
        name,
        type,
        status,
        image_url,
        demo_available,
        is_featured,
        priority,
        rtp,
        play_count,
        created_at,
        updated_at,
        game_providers!inner(
          id,
          name,
          type
        )
      `),e?.type&&(r=r.eq("type",e.type),console.log("ğŸ” íƒ€ì… í•„í„° ì ìš©:",e.type)),e?.provider_id&&(r=r.eq("provider_id",e.provider_id),console.log("ğŸ” ì œê³µì‚¬ í•„í„° ì ìš©:",e.provider_id)),e?.search&&(r=r.ilike("name",`%${e.search}%`),console.log("ğŸ” ê²€ìƒ‰ í•„í„° ì ìš©:",e.search)),e?.status&&(r=r.eq("status",e.status),console.log("ğŸ” ìƒíƒœ í•„í„° ì ìš©:",e.status)),e?.type==="casino"?r=r.order("priority",{ascending:!1}).order("provider_id"):r=r.order("priority",{ascending:!1}).order("name");const{data:d,error:i}=await r;if(i)throw console.error("ê²Œì„ ì¡°íšŒ ì˜¤ë¥˜:",i),i;console.log(`ğŸ” DBì—ì„œ ì¡°íšŒëœ ${e?.type||"ì „ì²´"} ê²Œì„:`,{ì´ê°œìˆ˜:d?.length||0,í•„í„°:{type:e?.type,provider_id:e?.provider_id,status:e?.status,search:e?.search},ìƒ˜í”Œ:d?.slice(0,3).map(t=>({id:t.id,name:t.name,provider_id:t.provider_id,provider_name:t.game_providers?.name}))});const l=(d||[]).map(t=>{const m=Array.isArray(t.game_status_logs)?t.game_status_logs[0]:t.game_status_logs;return{id:t.id,provider_id:t.provider_id,name:t.name,type:t.type,status:m?.status||t.status,image_url:t.image_url,demo_available:t.demo_available,is_featured:m?.is_featured!==void 0?m.is_featured:t.is_featured||!1,priority:m?.priority!==void 0?m.priority:t.priority||0,rtp:t.rtp,play_count:t.play_count||0,created_at:t.created_at,updated_at:t.updated_at,provider_name:t.game_providers?.name||"ì•Œ ìˆ˜ ì—†ìŒ"}}).sort((t,m)=>m.priority!==t.priority?m.priority-t.priority:m.is_featured!==t.is_featured?m.is_featured?1:-1:e?.type==="casino"?t.provider_id-m.provider_id:t.name.localeCompare(m.name));return console.log(`âœ… ìµœì¢… ${e?.type||"ì „ì²´"} ê²Œì„:`,{ê°œìˆ˜:l.length,ì œê³µì‚¬ë³„_ë¶„í¬:l.reduce((t,m)=>(t[m.provider_name]=(t[m.provider_name]||0)+1,t),{}),ìƒìœ„_5ê°œ_ìš°ì„ ìˆœìœ„:l.slice(0,5).map(t=>({name:t.name,priority:t.priority}))}),l}async function L(o,n){const{error:a}=await p.from("games").update({status:n,updated_at:new Date().toISOString()}).eq("id",o);if(a)throw console.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:",a),a}async function x(o,n){console.log(`ğŸš€ Provider ${o} ë™ê¸°í™” ì‹œì‘`);const a=Date.now();let e=[];if(n&&n.length>0)e=n,console.log(`ğŸ“¥ ì œê³µëœ ê²Œì„ ë°ì´í„° ì‚¬ìš© - ì´ ${e.length}ê°œ ê²Œì„`);else{console.log(`ğŸ“¡ Provider ${o} API í˜¸ì¶œ ì‹œì‘`);const{investApi:_}=await T(async()=>{const{investApi:s}=await import("./index-Zxf-w_JS.js").then(u=>u._);return{investApi:s}},__vite__mapDeps([0,1,2,3,4,5,6])),{data:y,error:v}=await p.from("partners").select("opcode, secret_key").eq("level",1).order("created_at",{ascending:!0}).limit(1).maybeSingle();if(v||!y)throw console.error("âŒ ì‹œìŠ¤í…œ ê´€ë¦¬ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",v),new Error("ì‹œìŠ¤í…œ ê´€ë¦¬ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");try{const s=await _.getGameList(y.opcode,o,y.secret_key);if(s.error)if(console.error(`âŒ Provider ${o} API í˜¸ì¶œ ì‹¤íŒ¨:`,s.error),s.error.includes("ê²Œì„ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤")||s.error.includes("ì§€ì›í•˜ì§€ ì•ŠëŠ”")||s.error.includes("ì˜ëª»ëœ signature")||s.error.includes("provider not found")||s.status===404||s.status===400)console.log(`âš ï¸ Provider ${o}ëŠ” ê²Œì„ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ê±°ë‚˜ ì§€ì›í•˜ì§€ ì•ŠëŠ” ì œê³µì‚¬ì…ë‹ˆë‹¤.`),e=[];else throw new Error(s.error);else if(s.data?.RESULT===!0&&Array.isArray(s.data?.DATA))e=s.data.DATA,console.log(`âœ… Provider ${o} API ì‘ë‹µ: ${e.length}ê°œ ê²Œì„ (ì´ë¯¸ image_url ì •ê·œí™”ë¨)`);else if(s.data?.RESULT===!1){const u=s.data?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";if(console.log(`âš ï¸ Provider ${o} API ì‘ë‹µ: ê²Œì„ ë¦¬ìŠ¤íŠ¸ ì—†ìŒ - ${u}`),u.includes("ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤")||u.includes("no games")||u.includes("empty")||u.includes("ì—†ìŒ"))e=[];else throw new Error(`API ì˜¤ë¥˜: ${u}`)}else console.log(`âš ï¸ Provider ${o} ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ í˜•ì‹:`,s.data),e=[]}catch(s){console.error(`âŒ Provider ${o} API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜:`,s),e=[]}}console.log(`ğŸ“Š ë™ê¸°í™”í•  ê²Œì„ ìˆ˜: ${e.length}ê°œ`);const{data:r,error:d}=await p.from("game_providers").select("type").eq("id",o).maybeSingle();if(d||!r)throw console.error("ì œê³µì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",d),new Error(`ì œê³µì‚¬(ID: ${o}) ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);const i=r.type,{data:c,error:l}=await p.from("games").select("id, priority").eq("provider_id",o);if(l)throw console.error("ê¸°ì¡´ ê²Œì„ ì¡°íšŒ ì˜¤ë¥˜:",l),l;const t=new Set(c?.map(_=>_.id)||[]),m=c&&c.length>0?Math.max(...c.map(_=>_.priority||0)):0;console.log(`ğŸ“Š ê¸°ì¡´ ê²Œì„ ${t.size}ê°œ í™•ì¸ë¨, ìµœëŒ€ ìš°ì„ ìˆœìœ„: ${m}`);const h=[],b=new Date().toISOString(),w=100;for(let _=0;_<e.length;_+=w){const v=e.slice(_,_+w).map((s,u)=>{const D=parseInt(s.id||s.game_id||s.gameId||s.ID);if(!D||isNaN(D))return null;let A="";s.game_title&&typeof s.game_title=="string"&&s.game_title.trim()?A=s.game_title.trim():s.name&&typeof s.name=="string"&&s.name.trim()?A=s.name.trim():s.game_name&&typeof s.game_name=="string"&&s.game_name.trim()?A=s.game_name.trim():s.gameName&&typeof s.gameName=="string"&&s.gameName.trim()?A=s.gameName.trim():s.title&&typeof s.title=="string"&&s.title.trim()?A=s.title.trim():A=`Game ${D}`;const $=s.image_url||null,G=!!(s.demo_available||s.demoAvailable||s.demo);return{id:D,provider_id:o,name:A,type:i,status:"visible",image_url:$?String($):null,demo_available:G,created_at:b,updated_at:b,isExisting:t.has(D)}}).filter(s=>s!==null);h.push(...v)}console.log(`âœ… ì²˜ë¦¬ëœ ê²Œì„ ìˆ˜: ${h.length}ê°œ`);const g=h.filter(_=>!_.isExisting),E=h.filter(_=>_.isExisting);console.log(`ğŸ“ˆ ì‹ ê·œ ê²Œì„: ${g.length}ê°œ, ì—…ë°ì´íŠ¸ ëŒ€ìƒ: ${E.length}ê°œ`);let P=0,f=0;if(g.length>0){const _=g.map(({isExisting:v,...s},u)=>({...s,priority:m+g.length-u}));console.log(`ğŸ†• ì‹ ê·œ ê²Œì„ ìš°ì„ ìˆœìœ„ ë²”ìœ„: ${m+1} ~ ${m+g.length}`);const y=500;for(let v=0;v<_.length;v+=y){const s=_.slice(v,v+y),{error:u}=await p.from("games").insert(s);if(u)throw console.error(`ê²Œì„ ì¶”ê°€ ì˜¤ë¥˜ (ì²­í¬ ${Math.floor(v/y)+1}):`,u),u}P=g.length,console.log(`âœ… ${P}ê°œ ì‹ ê·œ ê²Œì„ ì¶”ê°€ ì™„ë£Œ (ìƒìœ„ ë…¸ì¶œ ì„¤ì •)`)}if(E.length>0){for(let y=0;y<E.length;y+=100){const s=E.slice(y,y+100).map(async D=>{const{isExisting:A,...$}=D,{error:G}=await p.from("games").update({name:$.name,image_url:$.image_url,demo_available:$.demo_available,updated_at:$.updated_at}).eq("id",$.id).eq("provider_id",o);return G?(console.error(`ê²Œì„ ${$.id} ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:`,G),!1):!0}),u=await Promise.all(s);f+=u.filter(Boolean).length}console.log(`âœ… ${f}ê°œ ê¸°ì¡´ ê²Œì„ ì—…ë°ì´íŠ¸ ì™„ë£Œ`)}const k=((Date.now()-a)/1e3).toFixed(1),q={newGames:P,updatedGames:f,totalGames:h.length};return console.log(`ğŸ¯ Provider ${o} ë™ê¸°í™” ì™„ë£Œ (${k}ì´ˆ):`,q),q}async function O(){console.log("ğŸ”§ ê²Œì„ ì œê³µì‚¬ ë°ì´í„° ì´ˆê¸°í™” ì‹œì‘...");const n=[{id:1,name:"ë§ˆì´í¬ë¡œê²Œì´ë°",type:"slot"},{id:17,name:"í”Œë ˆì´ì•¤ê³ ",type:"slot"},{id:20,name:"CQ9 ê²Œì´ë°",type:"slot"},{id:21,name:"ì œë„¤ì‹œìŠ¤ ê²Œì´ë°",type:"slot"},{id:22,name:"í•˜ë°”ë„¤ë¡œ",type:"slot"},{id:23,name:"ê²Œì„ì•„íŠ¸",type:"slot"},{id:27,name:"í”Œë ˆì´í…",type:"slot"},{id:38,name:"ë¸”ë£¨í”„ë¦°íŠ¸",type:"slot"},{id:39,name:"ë¶€ìš´ê³ ",type:"slot"},{id:40,name:"ë“œë¼êµ°ì†Œí”„íŠ¸",type:"slot"},{id:41,name:"ì—˜í¬ ìŠ¤íŠœë””ì˜¤",type:"slot"},{id:47,name:"ë“œë¦¼í…Œí¬",type:"slot"},{id:51,name:"ì¹¼ëŒë°” ê²Œì„ì¦ˆ",type:"slot"},{id:52,name:"ëª¨ë¹Œë¡¯",type:"slot"},{id:53,name:"ë…¸ë¦¬ë°‹ ì‹œí‹°",type:"slot"},{id:55,name:"OMI ê²Œì´ë°",type:"slot"},{id:56,name:"ì›í„°ì¹˜",type:"slot"},{id:59,name:"í”Œë ˆì´ìŠ¨",type:"slot"},{id:60,name:"í‘¸ì‰¬ ê²Œì´ë°",type:"slot"},{id:61,name:"í€µìŠ¤í•€",type:"slot"},{id:62,name:"RTG ìŠ¬ë¡¯",type:"slot"},{id:63,name:"ë¦¬ë³¼ë²„ ê²Œì´ë°",type:"slot"},{id:65,name:"ìŠ¬ë¡¯ë°€",type:"slot"},{id:66,name:"ìŠ¤í”¼ì–´í—¤ë“œ",type:"slot"},{id:70,name:"ì¬ë”í‚¥",type:"slot"},{id:72,name:"ìš°í›„ ê²Œì„ì¦ˆ",type:"slot"},{id:74,name:"ë¦´ë ‰ìŠ¤ ê²Œì´ë°",type:"slot"},{id:75,name:"ë„·ì—”íŠ¸",type:"slot"},{id:76,name:"ë ˆë“œíƒ€ì´ê±°",type:"slot"},{id:87,name:"PGì†Œí”„íŠ¸",type:"slot"},{id:88,name:"í”Œë ˆì´ìŠ¤íƒ€",type:"slot"},{id:90,name:"ë¹…íƒ€ì„ê²Œì´ë°",type:"slot"},{id:300,name:"í”„ë¼ê·¸ë§ˆí‹± í”Œë ˆì´",type:"slot"},{id:410,name:"ì—ë³¼ë£¨ì…˜ ê²Œì´ë°",type:"casino"},{id:77,name:"ë§ˆì´í¬ë¡œ ê²Œì´ë°",type:"casino"},{id:2,name:"Vivo ê²Œì´ë°",type:"casino"},{id:30,name:"ì•„ì‹œì•„ ê²Œì´ë°",type:"casino"},{id:78,name:"í”„ë¼ê·¸ë§ˆí‹±í”Œë ˆì´",type:"casino"},{id:86,name:"ì„¹ì‹œê²Œì´ë°",type:"casino"},{id:11,name:"ë¹„ë¹„ì•„ì´ì—”",type:"casino"},{id:28,name:"ë“œë¦¼ê²Œì„",type:"casino"},{id:89,name:"ì˜¤ë¦¬ì—”íƒˆê²Œì„",type:"casino"},{id:91,name:"ë³´íƒ€",type:"casino"},{id:44,name:"ì´ì£¼ê¸°",type:"casino"},{id:85,name:"í”Œë ˆì´í… ë¼ì´ë¸Œ",type:"casino"},{id:0,name:"ì œë„¤ëŸ´ ì¹´ì§€ë…¸",type:"casino"}].map(r=>({id:r.id,name:r.name,type:r.type,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),a=20;let e=0;for(let r=0;r<n.length;r+=a){const d=n.slice(r,r+a),{error:i}=await p.from("game_providers").upsert(d,{onConflict:"id",ignoreDuplicates:!1});i?console.error(`ì œê³µì‚¬ ë°°ì¹˜ ${Math.floor(r/a)+1} ì‚½ì… ì˜¤ë¥˜:`,i):e+=d.length}console.log(`âœ… ì œê³µì‚¬ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ: ${e}ê°œ ì²˜ë¦¬`)}async function R(){console.log("ğŸ° ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ ì´ˆê¸°í™” ì‹œì‘");const{data:o,error:n}=await p.from("game_providers").select("id, name").eq("type","casino");if(n){console.error("ì¹´ì§€ë…¸ ì œê³µì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",n);return}if(!o||o.length===0){console.log("ì¹´ì§€ë…¸ ì œê³µì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.");return}const a=[{id:41e4,provider_id:410,name:"ì—ë³¼ë£¨ì…˜ ê²Œì´ë° ë¡œë¹„"},{id:77060,provider_id:77,name:"ë§ˆì´í¬ë¡œ ê²Œì´ë° ë¡œë¹„"},{id:2029,provider_id:2,name:"Vivo ê²Œì´ë° ë¡œë¹„"},{id:3e4,provider_id:30,name:"ì•„ì‹œì•„ ê²Œì´ë° ë¡œë¹„"},{id:78001,provider_id:78,name:"í”„ë¼ê·¸ë§ˆí‹±í”Œë ˆì´ ë¡œë¹„"},{id:86001,provider_id:86,name:"ì„¹ì‹œê²Œì´ë° ë¡œë¹„"},{id:11e3,provider_id:11,name:"ë¹„ë¹„ì•„ì´ì—” ë¡œë¹„"},{id:28e3,provider_id:28,name:"ë“œë¦¼ê²Œì„ ë¡œë¹„"},{id:89e3,provider_id:89,name:"ì˜¤ë¦¬ì—”íƒˆê²Œì„ ë¡œë¹„"},{id:91e3,provider_id:91,name:"ë³´íƒ€ ë¡œë¹„"},{id:44006,provider_id:44,name:"ì´ì£¼ê¸° ë¡œë¹„"},{id:85036,provider_id:85,name:"í”Œë ˆì´í… ë¼ì´ë¸Œ ë¡œë¹„"},{id:0,provider_id:0,name:"ì œë„¤ëŸ´ ì¹´ì§€ë…¸ ë¡œë¹„"}],{data:e}=await p.from("games").select("id").eq("type","casino"),r=new Set(e?.map(i=>i.id)||[]),d=a.filter(i=>!r.has(i.id)&&o.some(c=>c.id===i.provider_id));if(d.length>0){const i=d.map(l=>({id:l.id,provider_id:l.provider_id,name:l.name,type:"casino",status:"visible",demo_available:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),{error:c}=await p.from("games").insert(i);c?console.error("ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ ì¶”ê°€ ì˜¤ë¥˜:",c):console.log(`âœ… ${d.length}ê°œ ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ ì¶”ê°€ ì™„ë£Œ`)}else console.log("âœ… ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ì´ ì´ë¯¸ ëª¨ë‘ ì¡´ì¬í•©ë‹ˆë‹¤.")}async function N(o,n,a,e,r,d,i,c){const{data:l,error:t}=await p.rpc("save_game_sync_result",{p_provider_id:o,p_opcode:n,p_sync_type:a,p_games_added:e,p_games_updated:r,p_games_removed:d,p_error_message:i,p_sync_duration:c});if(t)throw console.error("ë™ê¸°í™” ê²°ê³¼ ì €ì¥ ì˜¤ë¥˜:",t),t;return l}async function B(o,n,a,e,r=50,d=0){const{data:i,error:c}=await p.rpc("get_user_visible_games",{p_user_id:o,p_game_type:n,p_provider_id:a,p_search_term:e,p_limit:r,p_offset:d});if(c)throw console.error("ì‚¬ìš©ì ê²Œì„ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:",c),c;return i||[]}async function M(o,n,a,e,r){const{data:d,error:i}=await p.rpc("update_game_status_for_partner",{p_partner_id:o,p_game_id:n,p_status:a,p_priority:e,p_is_featured:r});if(i)throw console.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:",i),i;return d}async function C(o,n){try{console.log("ğŸ® ê²Œì„ ì‹¤í–‰ ìš”ì²­ ì‹œì‘:",{userId:o,gameId:n,userIdType:typeof o}),console.log("ğŸ” ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹œì‘:",{userId:o,userIdType:typeof o});const{data:a,error:e}=await p.from("users").select("username, balance").eq("id",o).single();if(console.log("ğŸ” ì‚¬ìš©ì ì¡°íšŒ ê²°ê³¼:",{userData:a,userError:e}),e)throw console.error("âŒ ì‚¬ìš©ì ì¡°íšŒ ì˜¤ë¥˜:",{error:e,message:e.message,details:e.details,hint:e.hint,code:e.code}),new Error(`ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${e.message}`);if(!a)throw console.error("âŒ ì‚¬ìš©ì ë°ì´í„° ì—†ìŒ:",{userId:o}),new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");console.log("ğŸ” OPCODE ì •ë³´ ì¡°íšŒ ì‹œì‘:",{userId:o});const{data:r,error:d}=await p.rpc("get_user_opcode_info",{user_id:o});console.log("ğŸ” OPCODE ì¡°íšŒ ê²°ê³¼:",{opcodeData:r,opcodeError:d});let i,c,l;if(d||!r||!r.success){console.error("âŒ OPCODE ì¡°íšŒ ì‹¤íŒ¨:",r?.error||d?.message),console.log("ğŸ”„ ì‹œìŠ¤í…œ ê´€ë¦¬ì OPCODEë¡œ fallback");const{data:S,error:k}=await p.from("partners").select("opcode, secret_key, api_token").eq("level",1).order("created_at",{ascending:!0}).limit(1).maybeSingle();if(k||!S)throw new Error("ì‹œìŠ¤í…œ OPCODE ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");if(!S.api_token)throw new Error("ì‹œìŠ¤í…œ ê´€ë¦¬ìì˜ API í† í°ì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. partners í…Œì´ë¸”ì—ì„œ api_tokenì„ ì„¤ì •í•˜ì„¸ìš”.");i=S.opcode,c=S.secret_key,l=S.api_token}else i=r.opcode,c=r.secret_key,l=r.api_token;const{username:t,balance:m}=a;if(!i||!c||!l)throw new Error("ê²Œì„ ì‹¤í–‰ì— í•„ìš”í•œ API ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");console.log("ğŸ“Š API í˜¸ì¶œ ì •ë³´:",{username:t,balance:m,opcode:i,secret_key:c?"***"+c.slice(-4):"null",token:l?"***"+l.slice(-4):"null"});const{data:h,error:b}=await p.from("games").select("id, name, external_game_id").eq("id",n).maybeSingle();if(b||!h)throw new Error("ê²Œì„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");let w=h.external_game_id;(!w||w===null||w==="")&&(w=h.id),console.log("ğŸ® investApi.launchGame í˜¸ì¶œ:",{opcode:i,username:t,token:l?"***"+l.slice(-4):"null",gameId:w,secret_key:c?"***"+c.slice(-4):"null"});const g=await I.launchGame(i,t,l,w,c);if(console.log("ğŸ® investApi.launchGame ê²°ê³¼:",g),!g.success)throw new Error(g.error||"ê²Œì„ ì‹¤í–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");const E=g.data?.game_url||g.data?.url||g.data?.launch_url||"";if(!E)throw console.error("âŒ ê²Œì„ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:",g),new Error(g.error||"ê²Œì„ ì‹¤í–‰ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");console.log("âœ… ê²Œì„ URL íšë“");const{data:P,error:f}=await p.rpc("save_game_launch_session",{p_user_id:o,p_game_id:n,p_opcode:i,p_launch_url:E,p_session_token:g.data?.token||null,p_balance_before:m||0});if(f){if(console.error("âŒ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì˜¤ë¥˜:",f),console.error("âŒ ì˜¤ë¥˜ ìƒì„¸:",{code:f.code,message:f.message,details:f.details,hint:f.hint}),f.message&&f.message.includes("30ì´ˆ"))return{success:!1,error:"ì ì‹œ í›„ì— ë‹¤ì‹œ ì‹œë„í•˜ì„¸ìš”. (ê²Œì„ ì‹¤í–‰ ëŒ€ê¸° ì‹œê°„)",sessionId:null}}else P==null?(console.error("âš ï¸ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨: sessionIdê°€ nullì…ë‹ˆë‹¤!"),console.error("âš ï¸ í•¨ìˆ˜ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì„¸ì…˜ IDê°€ nullì…ë‹ˆë‹¤."),console.error("âš ï¸ Supabase ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”: https://nzuzzmaiuybzyndptaba.supabase.co/project/_/logs/postgres-logs")):console.log("âœ… ê²Œì„ ì„¸ì…˜ ì €ì¥ ì™„ë£Œ:",P);return{success:!0,launchUrl:E,sessionId:P||null}}catch(a){console.error("âŒ ê²Œì„ ì‹¤í–‰ ì˜¤ë¥˜:",a);const e=a instanceof Error?a.message:"ê²Œì„ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";return console.error("ğŸ“ ë°˜í™˜í•  ì˜¤ë¥˜ ë©”ì‹œì§€:",e),{success:!1,error:e,sessionId:null}}finally{console.log("ğŸ”š ê²Œì„ ì‹¤í–‰ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ")}}async function V(o){console.log("ğŸ”„ ëª¨ë“  ì œê³µì‚¬ ê²Œì„ ë™ê¸°í™” ì‹œì‘");const n=[];try{const{data:a,error:e}=await p.from("game_providers").select("id, name, type").eq("type","slot").eq("status","active");if(e)throw e;const r=o||"system_admin";for(const l of a||[])try{console.log(`ğŸ® ${l.name} (ID: ${l.id}) ë™ê¸°í™” ì‹œì‘`);const t=await x(l.id);n.push({providerId:l.id,providerName:l.name,gamesAdded:t.newGames||0,gamesUpdated:t.updatedGames||0}),await new Promise(m=>setTimeout(m,1e3))}catch(t){console.error(`âŒ ${l.name} ë™ê¸°í™” ì‹¤íŒ¨:`,t),n.push({providerId:l.id,providerName:l.name,gamesAdded:0,gamesUpdated:0,error:t instanceof Error?t.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"})}const d=n.reduce((l,t)=>l+t.gamesAdded,0),i=n.reduce((l,t)=>l+t.gamesUpdated,0),c=n.filter(l=>l.error).length;return console.log("âœ… ì „ì²´ ë™ê¸°í™” ì™„ë£Œ"),console.log(`ğŸ“Š ê²°ê³¼: ì‹ ê·œ ${d}ê°œ, ì—…ë°ì´íŠ¸ ${i}ê°œ, ì‹¤íŒ¨ ${c}ê°œ`),{success:c===0,results:n}}catch(a){return console.error("âŒ ì „ì²´ ë™ê¸°í™” ì‹¤íŒ¨:",a),{success:!1,results:n}}}async function j(o,n,a,e,r,d){try{const{data:i,error:c}=await p.rpc("save_game_session",{p_session_id:o,p_user_id:n,p_username:a,p_game_id:e,p_provider_id:r,p_launch_url:d||null});return c?(console.error("âŒ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨:",c),null):(console.log("âœ… ê²Œì„ ì„¸ì…˜ ì €ì¥ ì™„ë£Œ:",i),i)}catch(i){return console.error("âŒ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì˜¤ë¥˜:",i),null}}async function F(o,n,a){try{const{data:e,error:r}=await p.rpc("update_game_session_status",{p_session_id:o,p_status:n,p_ended_at:a||null});return r?(console.error("âŒ ê²Œì„ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",r),!1):(console.log("âœ… ê²Œì„ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ:",{sessionId:o,status:n}),e)}catch(e){return console.error("âŒ ê²Œì„ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:",e),!1}}async function Q(o,n,a=0,e=!0,r){try{const{data:d,error:i}=await p.rpc("log_game_sync",{p_sync_type:o,p_provider_id:n||null,p_records_count:a,p_success:e,p_error_message:r||null});return i?(console.error("âŒ ê²Œì„ ë™ê¸°í™” ë¡œê·¸ ê¸°ë¡ ì‹¤íŒ¨:",i),null):d}catch(d){return console.error("âŒ ê²Œì„ ë™ê¸°í™” ë¡œê·¸ ê¸°ë¡ ì˜¤ë¥˜:",d),null}}const K={getProviders:U,getGames:z,updateGameStatus:L,syncGamesFromAPI:x,initializeGameProviders:O,initializeCasinoLobbyGames:R,saveSyncResult:N,getUserVisibleGames:B,updateGameStatusForPartner:M,generateGameLaunchUrl:C,launchGame:C,syncAllProviderGames:V,saveGameSession:j,updateGameSessionStatus:F,logGameSync:Q};export{K as g};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Dashboard-Bq0jA1yH.js","assets/react-core-CwM-CeLv.js","assets/MetricCard-CsJTrd1U.js","assets/vendor-CQn7sZ7L.js","assets/radix-ui-SX2QAG6c.js","assets/settlementCalculator-DRi6b7kQ.js","assets/lucide-icons-D2Y5yybo.js","assets/supabase-r6ABpEO8.js","assets/UserManagement-Bfn3pm9Y.js","assets/DataTable-jP3ekhN6.js","assets/AdminDialog-7uPhX_lI.js","assets/ForceTransactionModal-DPkxgd6b.js","assets/textarea-D86z_YN-.js","assets/popover-BUEAF9m7.js","assets/command-qH0WaQBW.js","assets/dialog-Dy2HfO9p.js","assets/BlacklistManagement-wf9Q-jC0.js","assets/PointManagement-4cmb0pOt.js","assets/OnlineUsers-CzOj6VzO.js","assets/PartnerConnectionStatus-IcbYEKQd.js","assets/PartnerManagement-CsegSQod.js","assets/PartnerTransactions-D7Qz5VdY.js","assets/PartnerCreation-Bx3cgWkd.js","assets/CommissionSettlement-CEna38lT.js","assets/calendar-DfPS5pKM.js","assets/IntegratedSettlement-BUN5pnc0.js","assets/TransactionManagement-CQuI4g1F.js","assets/TransactionApprovalManager-B7rLJ95a.js","assets/EnhancedGameManagement-CJ7k6hTo.js","assets/gameApi-BKZMYcdz.js","assets/BettingManagement-DBzXu_rY.js","assets/BettingHistory-bMw9eLtU.js","assets/CallCycle-CSfLhcWQ.js","assets/switch-lmEgFsZZ.js","assets/CustomerSupport-DxYzru5K.js","assets/Announcements-BFm2PjX3.js","assets/MessageCenter-BLyTPNeE.js","assets/SystemSettings-Cp0H1to_.js","assets/BannerManagement-BYBB0_AV.js","assets/MenuManagement-Bpd0mQm-.js","assets/ApiTester-DZwgM1Lb.js","assets/AutoSyncMonitor-DGeq4bwI.js","assets/UserCasino-BBAmrC39.js","assets/ImageWithFallback-BtTbULwC.js","assets/UserSlot-jeYrPEzm.js","assets/UserDeposit-DkievO7t.js","assets/UserWithdraw-CxLyhc04.js","assets/UserNotice-D6fKje6X.js","assets/collapsible-Bk9eB6pG.js","assets/UserSupport-CzixJL_v.js","assets/UserProfile-CplwMn73.js","assets/UserBettingHistory-CKMbqCEJ.js"])))=>i.map(i=>d[i]);
import{j as t,r as p,c as be,f as dr}from"./react-core-CwM-CeLv.js";import{z as ur,T as mr,t as St,i as At,j as Pe,k as D}from"./vendor-CQn7sZ7L.js";import{S as kt,b as pr,d as fr,e as gr,T as hr,f as xr,g as br,A as _r,h as wr,F as yr,i as Et,j as vr,k as jr,l as Nr,I as Sr,m as Ar,n as kr,L as Er,o as Ir,p as Cr,q as Dr,r as Tr,s as Or,V as Pr,t as Br,v as $r,w as Mr,x as Rr,y as Lr,z as Ur,B as zr,D as Fr,E as It,G as qr,H as Vr,J as Gr,K as Wr,M as Kr,N as Hr,Q as Yr}from"./radix-ui-SX2QAG6c.js";import{L as le,S as Ct,a as ce,R as it,M as Jr,I as Xr,b as K,A as G,c as J,B as Be,C as lt,T as ne,G as _e,d as Q,D as Se,e as xe,f as oe,U as de,g as $e,h as Qr,W as Dt,i as Zr,j as Te,k as es,l as ts,E as ct,m as dt,n as rs,o as ss,p as ut,q as Tt,H as as,r as Ot,s as mt}from"./lucide-icons-D2Y5yybo.js";import{c as Pt,_ as P}from"./supabase-r6ABpEO8.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))n(u);new MutationObserver(u=>{for(const m of u)if(m.type==="childList")for(const l of m.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function s(u){const m={};return u.integrity&&(m.integrity=u.integrity),u.referrerPolicy&&(m.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?m.credentials="include":u.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function n(u){if(u.ep)return;u.ep=!0;const m=s(u);fetch(u.href,m)}})();if(typeof window<"u"&&typeof console<"u"){const e=console.warn,r=console.error;console.warn=function(...s){const n=s[0];typeof n=="string"&&(n.includes("Multiple GoTrueClient instances")||n.includes("GoTrueClient"))||e.apply(console,s)},console.error=function(...s){const n=s[0];typeof n=="string"&&n.includes("Multiple GoTrueClient instances")||r.apply(console,s)}}const pt=({...e})=>{const{theme:r="system"}=ur();return t.jsx(mr,{theme:r,className:"toaster group",style:{"--normal-bg":"var(--popover)","--normal-text":"var(--popover-foreground)","--normal-border":"var(--border)"},...e})};function O(...e){return St(At(e))}function Me({className:e,...r}){return t.jsx("div",{"data-slot":"card",className:O("glass-card rounded-xl flex flex-col gap-6",e),...r})}function Re({className:e,...r}){return t.jsx("div",{"data-slot":"card-header",className:O("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 pt-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",e),...r})}function Le({className:e,...r}){return t.jsx("h4",{"data-slot":"card-title",className:O("leading-none text-slate-100",e),...r})}function Bt({className:e,...r}){return t.jsx("p",{"data-slot":"card-description",className:O("text-slate-400 text-sm",e),...r})}function Ue({className:e,...r}){return t.jsx("div",{"data-slot":"card-content",className:O("px-6 [&:last-child]:pb-6",e),...r})}const ze=Pe("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-all disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg:not([class*='size-'])]:size-4 shrink-0 [&_svg]:shrink-0 outline-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-white hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"border bg-background text-foreground hover:bg-accent hover:text-accent-foreground dark:bg-input/30 dark:border-input dark:hover:bg-input/50",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground dark:hover:bg-accent/50",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-9 px-4 py-2 has-[>svg]:px-3",sm:"h-8 rounded-md gap-1.5 px-3 has-[>svg]:px-2.5",lg:"h-10 rounded-md px-6 has-[>svg]:px-4",icon:"size-9 rounded-md"}},defaultVariants:{variant:"default",size:"default"}}),U=p.forwardRef(({className:e,variant:r,size:s,asChild:n=!1,...u},m)=>{const l=n?kt:"button";return t.jsx(l,{"data-slot":"button",className:O(ze({variant:r,size:s,className:e})),ref:m,...u})});U.displayName="Button";function z({className:e,type:r,...s}){return t.jsx("input",{type:r,"data-slot":"input",className:O("file:text-foreground placeholder:text-muted-foreground selection:bg-primary selection:text-primary-foreground dark:bg-input/30 border-input flex h-9 w-full min-w-0 rounded-md border px-3 py-1 text-base bg-input-background transition-[color,box-shadow] outline-none file:inline-flex file:h-7 file:border-0 file:bg-transparent file:text-sm file:font-medium disabled:pointer-events-none disabled:cursor-not-allowed disabled:opacity-50 md:text-sm","focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px]","aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive",e),...s})}function F({className:e,...r}){return t.jsx(pr,{"data-slot":"label",className:O("flex items-center gap-2 text-sm leading-none font-medium select-none group-data-[disabled=true]:pointer-events-none group-data-[disabled=true]:opacity-50 peer-disabled:cursor-not-allowed peer-disabled:opacity-50",e),...r})}function Y(...e){return St(At(e))}function te(e){return new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW",minimumFractionDigits:0}).format(e)}function ft(e){return new Intl.NumberFormat("ko-KR").format(e)}function Za(e){return{1:"ì‹œìŠ¤í…œê´€ë¦¬ì",2:"ëŒ€ë³¸ì‚¬",3:"ë³¸ì‚¬",4:"ë¶€ë³¸ì‚¬",5:"ì´íŒ",6:"ë§¤ì¥"}[e]||"ì•Œ ìˆ˜ ì—†ìŒ"}const W={get:e=>{try{const r=localStorage.getItem(e);return r?JSON.parse(r):null}catch{return null}},set:(e,r)=>{try{localStorage.setItem(e,JSON.stringify(r))}catch{}},remove:e=>{try{localStorage.removeItem(e)}catch{}}};function ns({size:e="md",className:r,text:s}){const n={sm:"h-4 w-4",md:"h-6 w-6",lg:"h-8 w-8"};return t.jsxs("div",{className:Y("flex items-center justify-center gap-2",r),children:[t.jsx(le,{className:Y("animate-spin",n[e])}),s&&t.jsx("span",{className:"text-sm text-muted-foreground",children:s})]})}function os({children:e}){return t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(le,{className:"h-4 w-4 animate-spin"}),e]})}const $t="nzuzzmaiuybzyndptaba",is="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56dXp6bWFpdXlienluZHB0YWJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTkyMDM5NDMsImV4cCI6MjA3NDc3OTk0M30.XLuJJG-KhlmRrFYsIZsF_iINbJ9iWPhJ3q4Cby1_WJU",ls=`https://${$t}.supabase.co`,cs=is;let Ae=null;const ds=()=>(Ae||(Ae=Pt(ls,cs,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storageKey:"sb-gms-main-client",storage:{getItem:e=>{try{return localStorage.getItem(e)}catch{return null}},setItem:(e,r)=>{try{localStorage.setItem(e,r)}catch{}},removeItem:e=>{try{localStorage.removeItem(e)}catch{}}}},db:{schema:"public"},global:{headers:{"X-Client-Info":"gms-main-client"}}})),Ae),j=ds(),Mt=p.createContext(null);function ve(){const e=p.useContext(Mt);if(!e)throw new Error("useAuth must be used within AuthProvider");return e}function us(){const[e,r]=p.useState({isAuthenticated:!1,user:null,token:null});p.useEffect(()=>{const l=W.get("auth_token"),a=W.get("auth_user");l&&a&&typeof a.level=="number"&&r({isAuthenticated:!0,user:a,token:l})},[]);const s=async(l,a)=>{try{const{data:i,error:o}=await j.rpc("partner_login",{p_username:l,p_password:a});if(o)return console.error("ë¡œê·¸ì¸ RPC ì˜¤ë¥˜:",o),{success:!1,error:`ë¡œê·¸ì¸ ì˜¤ë¥˜: ${o.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`};if(!i||i.length===0)return console.error("ë¡œê·¸ì¸ ì‹¤íŒ¨: ì‚¬ìš©ì ë°ì´í„° ì—†ìŒ"),{success:!1,error:"ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."};const d=i[0],x={id:d.id,username:d.username,nickname:d.nickname,partner_type:d.partner_type,level:d.level,parent_id:d.parent_id||void 0,status:d.status,balance:d.balance,opcode:d.opcode||void 0,secret_key:d.secret_key||void 0,api_token:d.api_token||void 0,commission_rolling:d.commission_rolling,commission_losing:d.commission_losing,withdrawal_fee:d.withdrawal_fee,last_login_at:d.last_login_at,created_at:d.created_at};console.log("âœ… íŒŒíŠ¸ë„ˆ ë¡œê·¸ì¸ ì„±ê³µ:",{id:x.id,username:x.username,partner_type:x.partner_type,level:x.level,has_opcode:!!x.opcode,has_secret_key:!!x.secret_key,has_api_token:!!x.api_token});const b={isAuthenticated:!0,user:x,token:`partner-token-${x.id}`};return r(b),W.set("auth_token",b.token),W.set("auth_user",x),{success:!0}}catch(i){return console.error("Login error:",i),{success:!1,error:"ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."}}};return{authState:e,login:s,logout:()=>{r({isAuthenticated:!1,user:null,token:null}),W.remove("auth_token"),W.remove("auth_user")},quickLogin:async()=>await s("smcdev11","smcdev11!"),checkAuth:async()=>{const l=W.get("auth_token"),a=W.get("auth_user");l&&a&&typeof a.level=="number"&&r({isAuthenticated:!0,user:a,token:l})}}}function ms({onLoginSuccess:e}){const[r,s]=p.useState(""),[n,u]=p.useState(""),[m,l]=p.useState(!1),{login:a}=ve(),i=async o=>{if(o.preventDefault(),!r.trim()||!n.trim()){D.error("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}l(!0);try{const d=await a(r.trim(),n);d.success?(D.success("ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤."),e()):D.error(d.error||"ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}catch{D.error("ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{l(!1)}};return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900 p-4",children:t.jsxs(Me,{className:"w-full max-w-md bg-slate-800/50 border-slate-700 shadow-2xl",children:[t.jsxs(Re,{className:"space-y-1 text-center",children:[t.jsx("div",{className:"flex justify-center mb-4",children:t.jsx(Ct,{className:"h-12 w-12 text-blue-400"})}),t.jsx(Le,{className:"text-2xl font-bold text-white",children:"GMS ê´€ë¦¬ì"}),t.jsx(Bt,{className:"text-slate-400",children:"ê²Œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ"})]}),t.jsx(Ue,{children:t.jsxs("div",{className:"space-y-4",children:[t.jsxs("div",{className:"space-y-1",children:[t.jsx("h3",{className:"text-white",children:"ê´€ë¦¬ì ë¡œê·¸ì¸"}),t.jsx("p",{className:"text-sm text-slate-400",children:"ê³„ì • ì •ë³´ë¥¼ ì…ë ¥í•˜ì—¬ ë¡œê·¸ì¸í•˜ì„¸ìš”"})]}),t.jsxs("form",{onSubmit:i,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{htmlFor:"username",className:"text-white",children:"ì•„ì´ë””"}),t.jsx(z,{id:"username",type:"text",value:r,onChange:o=>s(o.target.value),placeholder:"ê´€ë¦¬ì ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”",className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400",disabled:m})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{htmlFor:"password",className:"text-white",children:"ë¹„ë°€ë²ˆí˜¸"}),t.jsx(z,{id:"password",type:"password",value:n,onChange:o=>u(o.target.value),placeholder:"ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400",disabled:m})]}),t.jsx(U,{type:"submit",disabled:m,className:"w-full bg-slate-700 hover:bg-slate-600",children:m?t.jsx(os,{children:"ë¡œê·¸ì¸"}):"ë¡œê·¸ì¸"})]})]})}),t.jsxs("div",{className:"px-6 pb-6 text-center text-xs text-slate-500 space-y-1",children:[t.jsx("p",{children:"GMS v1.0 | í†µí•© ê²Œì„ ê´€ë¦¬ ì‹œìŠ¤í…œ"}),t.jsx("p",{children:"7ë‹¨ê³„ ê¶Œí•œ ì²´ê³„ | ì‹¤ì‹œê°„ ë°ì´í„° ë™ê¸°í™”"})]})]})})}const ke=768;function ps(){const[e,r]=p.useState(void 0);return p.useEffect(()=>{const s=window.matchMedia(`(max-width: ${ke-1}px)`),n=()=>{r(window.innerWidth<ke)};return s.addEventListener("change",n),r(window.innerWidth<ke),()=>s.removeEventListener("change",n)},[]),!!e}function H({delayDuration:e=0,...r}){return t.jsx(fr,{"data-slot":"tooltip-provider",delayDuration:e,...r})}function re({...e}){return t.jsx(H,{children:t.jsx(gr,{"data-slot":"tooltip",...e})})}function se({...e}){return t.jsx(hr,{"data-slot":"tooltip-trigger",...e})}function ae({className:e,sideOffset:r=0,children:s,...n}){return t.jsx(xr,{children:t.jsxs(br,{"data-slot":"tooltip-content",sideOffset:r,className:O("bg-primary text-primary-foreground animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 w-fit origin-(--radix-tooltip-content-transform-origin) rounded-md px-3 py-1.5 text-xs text-balance",e),...n,children:[s,t.jsx(_r,{className:"bg-primary fill-primary z-50 size-2.5 translate-y-[calc(-50%_-_2px)] rotate-45 rounded-[2px]"})]})})}const fs="sidebar_state",gs=3600*24*7,hs="16rem",xs="3rem",bs="b",_s=p.createContext(null);function ws({defaultOpen:e=!0,open:r,onOpenChange:s,className:n,style:u,children:m,...l}){const a=ps(),[i,o]=p.useState(!1),[d,x]=p.useState(e),b=r??d,N=p.useCallback(c=>{const g=typeof c=="function"?c(b):c;s?s(g):x(g),document.cookie=`${fs}=${g}; path=/; max-age=${gs}`},[s,b]),w=p.useCallback(()=>a?o(c=>!c):N(c=>!c),[a,N,o]);p.useEffect(()=>{const c=g=>{g.key===bs&&(g.metaKey||g.ctrlKey)&&(g.preventDefault(),w())};return window.addEventListener("keydown",c),()=>window.removeEventListener("keydown",c)},[w]);const y=b?"expanded":"collapsed",h=p.useMemo(()=>({state:y,open:b,setOpen:N,isMobile:a,openMobile:i,setOpenMobile:o,toggleSidebar:w}),[y,b,N,a,i,o,w]);return t.jsx(_s.Provider,{value:h,children:t.jsx(H,{delayDuration:0,children:t.jsx("div",{"data-slot":"sidebar-wrapper",style:{"--sidebar-width":hs,"--sidebar-width-icon":xs,...u},className:O("group/sidebar-wrapper has-data-[variant=inset]:bg-sidebar flex min-h-svh w-full",n),...l,children:m})})})}const gt={"/admin/dashboard":ce,"/admin/realtime":G,"/admin/users":de,"/admin/user-management":de,"/admin/blacklist":Ct,"/admin/points":ne,"/admin/online":G,"/admin/online-users":G,"/admin/online-status":G,"/admin/logs":Se,"/admin/head-office":oe,"/admin/partners/master":oe,"/admin/partners":oe,"/admin/partner-hierarchy":oe,"/admin/partner-transactions":Q,"/admin/partners/transactions":Q,"/admin/partner-online":G,"/admin/partners/status":G,"/admin/partner-dashboard":ce,"/admin/partners/dashboard":ce,"/admin/settlement":xe,"/admin/commission-settlement":xe,"/admin/settlement/commission":xe,"/admin/integrated-settlement":Se,"/admin/settlement/integrated":Se,"/admin/transactions":Q,"/admin/transaction-approval":Q,"/admin/games":_e,"/admin/game-lists":_e,"/admin/betting":ne,"/admin/betting-history":ne,"/admin/betting-management":ne,"/admin/call-cycle":it,"/admin/communication":J,"/admin/customer-service":lt,"/admin/support":lt,"/admin/announcements":Be,"/admin/messages":J,"/admin/settings":K,"/admin/system-settings":K,"/admin/system":G,"/admin/system-info":G,"/admin/api-tester":K,"/admin/banners":Xr,"/admin/menu-management":Jr,"/admin/auto-sync-monitor":it},ys=e=>{const r=e.toLowerCase();return r.includes("íšŒì›")?de:r.includes("íŒŒíŠ¸ë„ˆ")?oe:r.includes("ì •ì‚°")||r.includes("ê±°ë˜")?xe:r.includes("ê²Œì„")?_e:r.includes("ì»¤ë®¤")||r.includes("ë©”ì‹œì§€")?J:r.includes("ì‹œìŠ¤í…œ")||r.includes("ì„¤ì •")?K:K};function vs({user:e,className:r,onNavigate:s,currentRoute:n}){const[u,m]=p.useState([]),[l,a]=p.useState([]),[i,o]=p.useState(!0);p.useEffect(()=>{d()},[e.id]);const d=async()=>{if(e?.id){o(!0);try{const{data:w,error:y}=await j.rpc("get_partner_enabled_menus",{p_partner_id:e.id}),h={id:"dashboard",title:"ëŒ€ì‹œë³´ë“œ",icon:ce,path:"/admin/dashboard",minLevel:6};if(y||!w||w.length===0)a([h]);else{const g=x(w),k=g.some(v=>v.path==="/admin/dashboard");a(k?g:[h,...g])}}catch{a([{id:"dashboard",title:"ëŒ€ì‹œë³´ë“œ",icon:ce,path:"/admin/dashboard",minLevel:6}])}finally{o(!1)}}},x=w=>{const y=w.reduce((v,A)=>{const _=A.parent_menu||"root";return v[_]||(v[_]=[]),v[_].push(A),v},{}),h=(y.root||[]).sort((v,A)=>v.display_order-A.display_order),c={};Object.keys(y).forEach(v=>{if(v!=="root"){const A=y[v];c[v]=Math.min(...A.map(_=>_.display_order))}});const g=[];h.forEach(v=>{g.push({type:"single",order:v.display_order,item:{id:v.menu_id,title:v.menu_name,icon:gt[v.menu_path]||K,path:v.menu_path,minLevel:6}})});const k=new Set;return Object.keys(y).forEach(v=>{if(v!=="root"&&!k.has(v)){k.add(v);const _=y[v].sort((f,S)=>f.display_order-S.display_order).map(f=>({id:f.menu_id,title:f.menu_name,icon:gt[f.menu_path]||K,path:f.menu_path,minLevel:6,parent_menu:f.parent_menu||void 0}));g.push({type:"group",order:c[v]||999,item:{id:`group-${v}`,title:v,icon:ys(v),minLevel:6,children:_}})}}),g.sort((v,A)=>v.order-A.order).map(v=>v.item)},b=w=>{m(y=>y.includes(w)?y.filter(h=>h!==w):[...y,w])},N=(w,y=0)=>{const h=w.children&&w.children.length>0,c=u.includes(w.id),g=n===w.path,k=w.icon;return t.jsxs("div",{children:[t.jsxs("button",{onClick:()=>{h?b(w.id):w.path&&s&&s(w.path)},className:Y("w-full flex items-center gap-2 px-3 py-2.5 rounded-lg transition-all duration-200","text-sm group relative",g?"bg-gradient-to-r from-blue-600/20 to-purple-600/20 text-white border border-blue-500/30":"text-slate-300 hover:bg-slate-800/50 hover:text-white",y>0&&"ml-4"),children:[t.jsx(k,{className:Y("w-4 h-4 flex-shrink-0",g?"text-blue-400":"text-slate-400 group-hover:text-blue-400")}),t.jsx("span",{className:"flex-1 text-left truncate overflow-hidden text-ellipsis whitespace-nowrap",children:w.title}),h&&(c?t.jsx($e,{className:"w-4 h-4 text-slate-400 flex-shrink-0"}):t.jsx(Qr,{className:"w-4 h-4 text-slate-400 flex-shrink-0"}))]}),h&&c&&t.jsx("div",{className:"ml-2 mt-1 space-y-1",children:w.children.map(v=>N(v,y+1))})]},w.id)};return t.jsxs("div",{className:Y("flex flex-col h-full bg-[#0f1419] overflow-hidden",r),children:[t.jsx("div",{className:"p-4 border-b border-slate-700/50 flex-shrink-0",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"w-10 h-10 rounded-lg bg-gradient-to-br from-blue-500 to-purple-600 flex items-center justify-center flex-shrink-0",children:t.jsx("span",{className:"text-white font-bold text-lg",children:"G"})}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("h1",{className:"text-white font-bold truncate",children:"GMS"}),t.jsx("p",{className:"text-xs text-slate-400 truncate",children:e.nickname})]})]})}),t.jsx("div",{className:"flex-1 overflow-y-auto overflow-x-hidden p-3 space-y-1",children:i?t.jsxs("div",{className:"text-center py-8",children:[t.jsx("div",{className:"loading-premium mx-auto"}),t.jsx("p",{className:"text-xs text-slate-400 mt-2",children:"ë©”ë‰´ ë¡œë”© ì¤‘..."})]}):l.map(w=>N(w))}),t.jsx("div",{className:"p-3 border-t border-slate-700/50 flex-shrink-0",children:t.jsx("button",{onClick:()=>{window.history.pushState({},"","/user"),window.dispatchEvent(new Event("popstate"))},className:"w-full text-xs text-slate-500 hover:text-slate-300 text-center truncate transition-colors cursor-pointer",children:"GMS v1.0"})})]})}const js=Pe("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function Rt({className:e,variant:r,asChild:s=!1,...n}){const u=s?kt:"span";return t.jsx(u,{"data-slot":"badge",className:O(js({variant:r}),e),...n})}function Ns({className:e,...r}){return t.jsx(wr,{"data-slot":"avatar",className:O("relative flex size-10 shrink-0 overflow-hidden rounded-full",e),...r})}function Ss({className:e,...r}){return t.jsx(yr,{"data-slot":"avatar-fallback",className:O("bg-muted flex size-full items-center justify-center rounded-full",e),...r})}function Lt({...e}){return t.jsx(vr,{"data-slot":"dropdown-menu",...e})}const Fe=p.forwardRef(({...e},r)=>t.jsx(Et,{ref:r,"data-slot":"dropdown-menu-trigger",...e}));Fe.displayName=Et.displayName;function Ut({className:e,sideOffset:r=4,...s}){return t.jsx(jr,{children:t.jsx(Nr,{"data-slot":"dropdown-menu-content",sideOffset:r,className:O("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 z-50 max-h-(--radix-dropdown-menu-content-available-height) min-w-[8rem] origin-(--radix-dropdown-menu-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border p-1 shadow-md",e),...s})})}function ie({className:e,inset:r,variant:s="default",...n}){return t.jsx(Sr,{"data-slot":"dropdown-menu-item","data-inset":r,"data-variant":s,className:O("focus:bg-accent focus:text-accent-foreground data-[variant=destructive]:text-destructive data-[variant=destructive]:focus:bg-destructive/10 dark:data-[variant=destructive]:focus:bg-destructive/20 data-[variant=destructive]:focus:text-destructive data-[variant=destructive]:*:[svg]:!text-destructive [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 data-[inset]:pl-8 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...n})}function As({className:e,...r}){return t.jsx(Ar,{"data-slot":"dropdown-menu-separator",className:O("bg-border -mx-1 my-1 h-px",e),...r})}function zt(e){const r=new TextEncoder().encode(e),s=(c,g)=>c<<g|c>>>32-g,n=(c,g)=>{const k=(c&65535)+(g&65535);return(c>>16)+(g>>16)+(k>>16)<<16|k&65535},u=r.length,m=(u+8>>6)+1,l=new Array(m*16);for(let c=0;c<m*16;c++)l[c]=0;for(let c=0;c<u;c++)l[c>>2]|=r[c]<<c%4*8;l[u>>2]|=128<<u%4*8,l[m*16-2]=u*8;let a=1732584193,i=4023233417,o=2562383102,d=271733878;const x=(c,g,k,v,A,_)=>n(s(n(n(g,c),n(v,_)),A),k),b=(c,g,k,v,A,_,f)=>x(g&k|~g&v,c,g,A,_,f),N=(c,g,k,v,A,_,f)=>x(g&v|k&~v,c,g,A,_,f),w=(c,g,k,v,A,_,f)=>x(g^k^v,c,g,A,_,f),y=(c,g,k,v,A,_,f)=>x(k^(g|~v),c,g,A,_,f);for(let c=0;c<m*16;c+=16){const g=a,k=i,v=o,A=d;a=b(a,i,o,d,l[c],7,3614090360),d=b(d,a,i,o,l[c+1],12,3905402710),o=b(o,d,a,i,l[c+2],17,606105819),i=b(i,o,d,a,l[c+3],22,3250441966),a=b(a,i,o,d,l[c+4],7,4118548399),d=b(d,a,i,o,l[c+5],12,1200080426),o=b(o,d,a,i,l[c+6],17,2821735955),i=b(i,o,d,a,l[c+7],22,4249261313),a=b(a,i,o,d,l[c+8],7,1770035416),d=b(d,a,i,o,l[c+9],12,2336552879),o=b(o,d,a,i,l[c+10],17,4294925233),i=b(i,o,d,a,l[c+11],22,2304563134),a=b(a,i,o,d,l[c+12],7,1804603682),d=b(d,a,i,o,l[c+13],12,4254626195),o=b(o,d,a,i,l[c+14],17,2792965006),i=b(i,o,d,a,l[c+15],22,1236535329),a=N(a,i,o,d,l[c+1],5,4129170786),d=N(d,a,i,o,l[c+6],9,3225465664),o=N(o,d,a,i,l[c+11],14,643717713),i=N(i,o,d,a,l[c],20,3921069994),a=N(a,i,o,d,l[c+5],5,3593408605),d=N(d,a,i,o,l[c+10],9,38016083),o=N(o,d,a,i,l[c+15],14,3634488961),i=N(i,o,d,a,l[c+4],20,3889429448),a=N(a,i,o,d,l[c+9],5,568446438),d=N(d,a,i,o,l[c+14],9,3275163606),o=N(o,d,a,i,l[c+3],14,4107603335),i=N(i,o,d,a,l[c+8],20,1163531501),a=N(a,i,o,d,l[c+13],5,2850285829),d=N(d,a,i,o,l[c+2],9,4243563512),o=N(o,d,a,i,l[c+7],14,1735328473),i=N(i,o,d,a,l[c+12],20,2368359562),a=w(a,i,o,d,l[c+5],4,4294588738),d=w(d,a,i,o,l[c+8],11,2272392833),o=w(o,d,a,i,l[c+11],16,1839030562),i=w(i,o,d,a,l[c+14],23,4259657740),a=w(a,i,o,d,l[c+1],4,2763975236),d=w(d,a,i,o,l[c+4],11,1272893353),o=w(o,d,a,i,l[c+7],16,4139469664),i=w(i,o,d,a,l[c+10],23,3200236656),a=w(a,i,o,d,l[c+13],4,681279174),d=w(d,a,i,o,l[c],11,3936430074),o=w(o,d,a,i,l[c+3],16,3572445317),i=w(i,o,d,a,l[c+6],23,76029189),a=w(a,i,o,d,l[c+9],4,3654602809),d=w(d,a,i,o,l[c+12],11,3873151461),o=w(o,d,a,i,l[c+15],16,530742520),i=w(i,o,d,a,l[c+2],23,3299628645),a=y(a,i,o,d,l[c],6,4096336452),d=y(d,a,i,o,l[c+7],10,1126891415),o=y(o,d,a,i,l[c+14],15,2878612391),i=y(i,o,d,a,l[c+5],21,4237533241),a=y(a,i,o,d,l[c+12],6,1700485571),d=y(d,a,i,o,l[c+3],10,2399980690),o=y(o,d,a,i,l[c+10],15,4293915773),i=y(i,o,d,a,l[c+1],21,2240044497),a=y(a,i,o,d,l[c+8],6,1873313359),d=y(d,a,i,o,l[c+15],10,4264355552),o=y(o,d,a,i,l[c+6],15,2734768916),i=y(i,o,d,a,l[c+13],21,1309151649),a=y(a,i,o,d,l[c+4],6,4149444226),d=y(d,a,i,o,l[c+11],10,3174756917),o=y(o,d,a,i,l[c+2],15,718787259),i=y(i,o,d,a,l[c+9],21,3951481745),a=n(a,g),i=n(i,k),o=n(o,v),d=n(d,A)}const h=c=>{let g="";for(let k=0;k<=3;k++)g+=(c>>k*8&255).toString(16).padStart(2,"0");return g};return h(a)+h(i)+h(o)+h(d)}const ks="https://api.invest-ho.com",Ee="https://vi8282.com/proxy";function M(e,r){const s=e.join("")+r,n=zt(s);return console.log("ğŸ” Signature ìƒì„±:",{params:e,secretKey:"***"+r.slice(-4),combined_string_preview:s.substring(0,100)+(s.length>100?"...":""),combined_length:s.length,signature:n,validation:`md5(${e.join(" + ")} + secretKey)`,exact_formula:`md5("${e.join('" + "')}" + "***${r.slice(-4)}")`}),n}async function R(e,r="GET",s,n=2){let u=null;for(let l=0;l<=n;l++){l>0&&(console.log(`ğŸ”„ ì¬ì‹œë„ ${l}/${n}...`),await new Promise(a=>setTimeout(a,Math.min(1e3*Math.pow(2,l-1),5e3))));try{const a=`${ks}${e}`,i={url:a,method:r,headers:{"Content-Type":"application/json"},body:s};l===0&&console.log("ğŸŒ Proxy ì„œë²„ í˜¸ì¶œ:",{proxy_url:Ee,target_url:a,method:r,opcode:s?.opcode||"N/A"});const o=new AbortController,d=setTimeout(()=>o.abort(),3e4),x=await fetch(Ee,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json, text/plain, */*"},body:JSON.stringify(i),signal:o.signal,mode:"cors",credentials:"omit"});if(clearTimeout(d),console.log("ğŸ“¡ Proxy ì‘ë‹µ ìƒíƒœ:",{status:x.status,statusText:x.statusText,ok:x.ok,contentType:x.headers.get("content-type")}),!x.ok){let w="";try{w=await x.text()}catch{w=`ì‘ë‹µ ì½ê¸° ì‹¤íŒ¨ (${x.status})`}console.error("âŒ Proxy ì„œë²„ ì˜¤ë¥˜:",w);try{await j.from("api_sync_logs").insert({opcode:s?.opcode||"N/A",api_endpoint:e,sync_type:r,status:"error",error_message:`HTTP ${x.status}: ${w}`,response_data:{http_status:x.status}})}catch(y){console.warn("âš ï¸ api_sync_logs ê¸°ë¡ ì‹¤íŒ¨:",y)}if(x.status>=500&&l<n){u=new Error(`ì„œë²„ ì˜¤ë¥˜ (${x.status}): ${w}`);continue}return{data:null,error:`API í˜¸ì¶œ ì‹¤íŒ¨ (${x.status}): ${w}`,status:x.status}}let b;const N=await x.text();if(l===0&&console.log("ğŸ“„ Raw ì‘ë‹µ:",N.substring(0,500)+(N.length>500?"...":"")),!N.trim()){if(console.warn("âš ï¸ ë¹ˆ ì‘ë‹µ ìˆ˜ì‹ "),l<n){u=new Error("ë¹ˆ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤");continue}return{data:null,error:"ë¹ˆ ì‘ë‹µì„ ë°›ì•˜ìŠµë‹ˆë‹¤",status:x.status}}try{b=JSON.parse(N),b&&typeof b=="object"?b.DATA!==void 0&&b.DATA!==null&&!Array.isArray(b.DATA)&&typeof b.DATA!="object"&&(console.warn("âš ï¸ DATA í•„ë“œê°€ ì˜ˆìƒí•˜ì§€ ëª»í•œ íƒ€ì…:",typeof b.DATA),b.DATA=[]):(console.warn("âš ï¸ íŒŒì‹±ëœ ê²°ê³¼ê°€ ê°ì²´ê°€ ì•„ë‹˜:",typeof b),b={data:b,is_fallback:!0})}catch{console.log("ğŸ“ JSON íŒŒì‹± ì‹¤íŒ¨, í…ìŠ¤íŠ¸ë¡œ ì²˜ë¦¬:",N),b={text_response:N,is_text:!0}}console.log("âœ… Proxy ì‘ë‹µ íŒŒì‹± ì™„ë£Œ:",{type:typeof b,isArray:Array.isArray(b),keys:typeof b=="object"?Object.keys(b):null});try{await j.from("api_sync_logs").insert({opcode:s?.opcode||"N/A",api_endpoint:e,sync_type:r,status:"success",error_message:null,response_data:b})}catch(w){console.warn("âš ï¸ api_sync_logs ê¸°ë¡ ì‹¤íŒ¨:",w)}return{data:b,error:null,status:x.status}}catch(a){if(u=a,a instanceof Error){if(a.name==="AbortError"){if(console.error("âŒ API í˜¸ì¶œ íƒ€ì„ì•„ì›ƒ"),l<n)continue;return{data:null,error:"API í˜¸ì¶œ íƒ€ì„ì•„ì›ƒ (30ì´ˆ). Proxy ì„œë²„ê°€ ì‘ë‹µí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.",status:408}}if(a.message.includes("Failed to fetch")||a.message.includes("fetch")){if(console.error("âŒ ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜:",a.message),l<n)continue;return{data:null,error:`Proxy ì„œë²„(${Ee})ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•˜ì„¸ìš”.`,status:0}}}if(console.error("âŒ Invest API í˜¸ì¶œ ì˜¤ë¥˜:",a),l<n)continue}}const m=u instanceof Error?u.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";console.error("âŒ ëª¨ë“  ì¬ì‹œë„ ì‹¤íŒ¨:",m);try{await j.from("api_sync_logs").insert({opcode:s?.opcode||"N/A",api_endpoint:e,sync_type:r,status:"error",error_message:`ì¬ì‹œë„ ${n}íšŒ ì‹¤íŒ¨: ${m}`,response_data:null})}catch(l){console.warn("âš ï¸ api_sync_logs ê¸°ë¡ ì‹¤íŒ¨:",l)}return{data:null,error:`API í˜¸ì¶œ ì‹¤íŒ¨ (ì¬ì‹œë„ ${n}íšŒ): ${m}`,status:500}}async function Ft(e,r,s){const n=M([e,r],s);return await R("/api/account","POST",{opcode:e,username:r,signature:n})}async function qe(e,r,s,n){const u=M([e,r,s],n);return await R("/api/account/balance","GET",{opcode:e,username:r,token:s,signature:u})}async function Ve(e,r){const s=M([e],r);return await R("/api/account/balance","PATCH",{opcode:e,signature:s})}async function Ge(e,r,s,n,u){const m=Math.floor(n),l=M([e,r,s,m.toString()],u);return console.log("ğŸ’° ì…ê¸ˆ API í˜¸ì¶œ ì¤€ë¹„:",{opcode:e,username:r,token:"***"+s.slice(-4),amount:m,signature_params:[e,r,s,m.toString()].join(" + "),signature:l}),await R("/api/account/balance","POST",{opcode:e,username:r,token:s,amount:m,signature:l})}async function We(e,r,s,n,u){const m=Math.floor(n),l=M([e,r,s,m.toString()],u);return console.log("ğŸ’¸ ì¶œê¸ˆ API í˜¸ì¶œ ì¤€ë¹„:",{opcode:e,username:r,token:"***"+s.slice(-4),amount:m,signature_params:[e,r,s,m.toString()].join(" + "),signature:l}),await R("/api/account/balance","PUT",{opcode:e,username:r,token:s,amount:m,signature:l})}async function Ke(e,r,s,n){try{if(!e||!r||!s||!n){const a=[];return e||a.push("opcode"),r||a.push("username"),s||a.push("api_token"),n||a.push("secret_key"),console.error("âŒ [ë³´ìœ ê¸ˆ ì¡°íšŒ] í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½:",{opcode:e,username:r,hasToken:!!s,hasSecretKey:!!n,missing:a}),(!s||!n)&&(console.error(`ğŸ’¡ í•´ê²° ë°©ë²•: partners í…Œì´ë¸”ì—ì„œ opcode='${e}'ì¸ ë ˆì½”ë“œì— ë‹¤ìŒ ê°’ì„ ì„¤ì •í•˜ì„¸ìš”:`),console.error("   - api_token: Invest APIì—ì„œ ë°œê¸‰ë°›ì€ í† í°"),console.error("   - secret_key: Invest APIì—ì„œ ë°œê¸‰ë°›ì€ ì‹œí¬ë¦¿ í‚¤"),console.error(`SQL ì˜ˆì‹œ: UPDATE partners SET api_token = 'YOUR_TOKEN', secret_key = 'YOUR_SECRET' WHERE opcode = '${e}';`)),{success:!1,error:`í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½: ${a.join(", ")}`}}const u=M([e,r,s],n);console.log("ğŸ’° ë³´ìœ ê¸ˆ ì¡°íšŒ API í˜¸ì¶œ:",{opcode:e,username:r,token:"***"+s.slice(-4)});const m=await R("/api/account/balance","GET",{opcode:e,username:r,token:s,signature:u});if(m.error)return console.error("âŒ [ë³´ìœ ê¸ˆ ì¡°íšŒ] API ì˜¤ë¥˜:",m.error),{success:!1,error:m.error};console.log("ğŸ“Š [ë³´ìœ ê¸ˆ ì¡°íšŒ] API ì‘ë‹µ:",m.data);let l;return m.data&&(m.data.balance!==void 0&&m.data.balance!==null?l=Number(m.data.balance):m.data.amount!==void 0&&m.data.amount!==null?l=Number(m.data.amount):m.data.DATA?.balance!==void 0&&m.data.DATA.balance!==null?l=Number(m.data.DATA.balance):m.data.DATA?.amount!==void 0&&m.data.DATA.amount!==null?l=Number(m.data.DATA.amount):m.data.current_balance!==void 0&&m.data.current_balance!==null&&(l=Number(m.data.current_balance))),l!==void 0&&!isNaN(l)?(console.log(`âœ… [ë³´ìœ ê¸ˆ ì¡°íšŒ] ì„±ê³µ: ${r} = ${l}ì›`),{success:!0,balance:l}):(console.error("âŒ [ë³´ìœ ê¸ˆ ì¡°íšŒ] ì‘ë‹µì—ì„œ ì”ê³ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ:",m.data),{success:!1,error:"ë³´ìœ ê¸ˆ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤"})}catch(u){return console.error("âŒ [ë³´ìœ ê¸ˆ ì¡°íšŒ] ì˜¤ë¥˜:",u),{success:!1,error:u instanceof Error?u.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}async function qt(e,r){try{console.log(`ğŸ” [getUserBalance] partners í…Œì´ë¸” ì¡°íšŒ ì‹œì‘: opcode=${e}`);const{data:s,error:n}=await j.from("partners").select("api_token, secret_key, opcode, username").eq("opcode",e).single();return console.log("ğŸ” [getUserBalance] ì¡°íšŒ ê²°ê³¼:",{partner:s,configError:n,hasApiToken:!!s?.api_token,hasSecretKey:!!s?.secret_key}),n||!s?(console.error("âŒ [ë³´ìœ ê¸ˆ ì¡°íšŒ] partners ì¡°íšŒ ì‹¤íŒ¨:",{opcode:e,error:n,errorCode:n?.code,errorMessage:n?.message,errorDetails:n?.details}),{success:!1,error:`API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (opcode: ${e})`}):!s.api_token||!s.secret_key?(console.error("âŒ [ë³´ìœ ê¸ˆ ì¡°íšŒ] API ì„¤ì • ë¶ˆì™„ì „:",{opcode:e,username:s.username,hasApiToken:!!s.api_token,hasSecretKey:!!s.secret_key,apiTokenLength:s.api_token?.length||0,secretKeyLength:s.secret_key?.length||0}),{success:!1,error:"API ì„¤ì •ì´ ë¶ˆì™„ì „í•©ë‹ˆë‹¤"}):await Ke(e,r,s.api_token,s.secret_key)}catch(s){return console.error("âŒ [ë³´ìœ ê¸ˆ ì¡°íšŒ] ì˜¤ë¥˜:",s),{success:!1,error:s instanceof Error?s.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}}async function Vt(e,r,s,n,u){if(!s||!n||!u)return console.error("âŒ depositBalance: opcode, token, secretKey í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½"),{success:!1,error:"opcode, token, secretKeyëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤. opcodeHelper.getAdminOpcode()ë¡œ ì¡°íšŒí•˜ì„¸ìš”.",data:null};const m=await Ge(s,e,n,r,u);return{success:!m.error,error:m.error,data:m.data}}async function Gt(e,r,s,n,u){if(!s||!n||!u)return console.error("âŒ withdrawBalance: opcode, token, secretKey í•„ìˆ˜ íŒŒë¼ë¯¸í„° ëˆ„ë½"),{success:!1,error:"opcode, token, secretKeyëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤. opcodeHelper.getAdminOpcode()ë¡œ ì¡°íšŒí•˜ì„¸ìš”.",data:null};const m=await We(s,e,n,r,u);return{success:!m.error,error:m.error,data:m.data}}async function Wt(e,r,s,n,u){const m=M([e,r,s,n],u);return await R("/api/account/balance","VIEW",{opcode:e,username:r,date_from:s,date_to:n,signature:m})}async function je(e,r){const s=M([e],r);return console.log("ğŸ“Š ê¸°ë³¸ì •ë³´ ì¡°íšŒ API í˜¸ì¶œ:",{opcode:e,secretKey:"***"+r.slice(-4),signature:s}),await R("/api/info","GET",{opcode:e,signature:s})}function Es(e){if(e.game_image&&typeof e.game_image=="string"&&e.game_image.trim()){const s=e.game_image.trim();if(s.startsWith("http")||s.startsWith("//"))return s}const r=["image_url","imageUrl","img_url","thumbnail"];for(const s of r){const n=e[s];if(n&&typeof n=="string"&&n.trim()){const u=n.trim();if(u.startsWith("http")||u.startsWith("//"))return u}}return null}async function Kt(e,r,s){const n=M([e,r.toString()],s);console.log(`ğŸ“¡ ê²Œì„ ë¦¬ìŠ¤íŠ¸ API í˜¸ì¶œ ì‹œì‘ - Provider ID: ${r}`);const u=await R("/api/game/lists","GET",{opcode:e,provider_id:r,signature:n});if(u.data&&!u.error&&Array.isArray(u.data?.DATA)){const m=u.data.DATA[0];console.log(`ğŸ“Š Provider ${r} API ì‘ë‹µ:`,{ì´ê²Œì„ìˆ˜:u.data.DATA.length,ìƒ˜í”Œê²Œì„:m?{ì „ì²´í•„ë“œ:Object.keys(m),game_image:m.game_image,game_title:m.game_title||m.name}:null}),u.data.DATA=u.data.DATA.map(i=>{const o=Es(i);return{...i,image_url:o||i.image_url||null}});const l=u.data.DATA.filter(i=>i.image_url).length,a=u.data.DATA.length-l;console.log(`âœ… Provider ${r} ì´ë¯¸ì§€ ì •ê·œí™”:`,{ì´ê²Œì„:u.data.DATA.length,ì´ë¯¸ì§€ìˆìŒ:l,ì´ë¯¸ì§€ì—†ìŒ:a})}return u}async function Ht(e,r,s,n,u){console.log("ğŸ® ê²Œì„ ì‹¤í–‰ API í˜¸ì¶œ:",{opcode:e,username:r,gameId:n,endpoint:"/api/game/launch"});const m=M([e,r,s,n.toString()],u),l=await R("/api/game/launch","POST",{opcode:e,username:r,token:s,game:n,signature:m});if(console.log("ğŸ® ê²Œì„ ì‹¤í–‰ API ì‘ë‹µ:",{success:!l.error,data:l.data,error:l.error}),l.error)return{success:!1,error:l.error,data:null};let a="";const i=l.data;if(i){if(i.is_text&&i.text_response){const o=i.text_response.match(/https?:\/\/[^\s<>"]+/);a=o?o[0]:""}else if(!i.is_text)a=i.game_url||i.url||i.launch_url||i.gameUrl||i.DATA?.game_url||i.DATA?.url||"";else if(typeof i=="string"){const o=i.match(/https?:\/\/[^\s<>"]+/);a=o?o[0]:""}}if(!a){let o="ê²Œì„ ì‹¤í–‰ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.";return i&&!i.is_text&&typeof i=="object"&&(i.RESULT===!1&&(o=i.DATA?.message||i.message||o),i.code===0&&i.message&&(o=i.message)),{success:!1,error:o,data:i}}return{success:!0,error:null,data:{game_url:a,url:a,launch_url:a}}}async function He(e,r,s,n,u=1e3,m){const l=M([e,r,s,n.toString()],m);return console.log("ğŸ“Š getGameHistory í˜¸ì¶œ:",{opcode:e,year:r,month:s,index:n,limit:u,signature_formula:`md5(${e} + ${r} + ${s} + ${n} + ***${m.slice(-4)})`,signature:l}),await R("/api/game/historyindex","GET",{opcode:e,year:r,month:s,index:n,limit:u,signature:l})}async function Yt(e,r,s,n){const u=M([e,r,s.toString()],n);return await R("/api/game/detail","GET",{opcode:e,yyyymm:r,txid:s,signature:u})}const we={SLOT:{1:"ë§ˆì´í¬ë¡œê²Œì´ë°",17:"í”Œë ˆì´ì•¤ê³ ",20:"CQ9 ê²Œì´ë°",21:"ì œë„¤ì‹œìŠ¤ ê²Œì´ë°",22:"í•˜ë°”ë„¤ë¡œ",23:"ê²Œì„ì•„íŠ¸",27:"í”Œë ˆì´í…",38:"ë¸”ë£¨í”„ë¦°íŠ¸",39:"ë¶€ìš´ê³ ",40:"ë“œë¼êµ°ì†Œí”„íŠ¸",41:"ì—˜í¬ ìŠ¤íŠœë””ì˜¤",47:"ë“œë¦¼í…Œí¬",51:"ì¹¼ëŒë°” ê²Œì„ì¦ˆ",52:"ëª¨ë¹Œë¡¯",53:"ë…¸ë¦¬ë°‹ ì‹œí‹°",55:"OMI ê²Œì´ë°",56:"ì›í„°ì¹˜",59:"í”Œë ˆì´ìŠ¨",60:"í‘¸ì‰¬ ê²Œì´ë°",61:"í€µìŠ¤í•€",62:"RTG ìŠ¬ë¡¯",63:"ë¦¬ë³¼ë²„ ê²Œì´ë°",65:"ìŠ¬ë¡¯ë°€",66:"ìŠ¤í”¼ì–´í—¤ë“œ",70:"ì¬ë”í‚¥",72:"ìš°í›„ ê²Œì„ì¦ˆ",74:"ë¦´ë ‰ìŠ¤ ê²Œì´ë°",75:"ë„·ì—”íŠ¸",76:"ë ˆë“œíƒ€ì´ê±°",87:"PGì†Œí”„íŠ¸",88:"í”Œë ˆì´ìŠ¤íƒ€",90:"ë¹…íƒ€ì„ê²Œì´ë°",300:"í”„ë¼ê·¸ë§ˆí‹± í”Œë ˆì´"},CASINO:{41e4:"ì—ë³¼ë£¨ì…˜ ê²Œì´ë°",77060:"ë§ˆì´í¬ë¡œ ê²Œì´ë°",2029:"Vivo ê²Œì´ë°",3e4:"ì•„ì‹œì•„ ê²Œì´ë°",78001:"í”„ë¼ê·¸ë§ˆí‹±í”Œë ˆì´",86001:"ì„¹ì‹œê²Œì´ë°",11e3:"ë¹„ë¹„ì•„ì´ì—”",28e3:"ë“œë¦¼ê²Œì„",89e3:"ì˜¤ë¦¬ì—”íƒˆê²Œì„",91e3:"ë³´íƒ€",44006:"ì´ì£¼ê¸°",85036:"í”Œë ˆì´í… ë¼ì´ë¸Œ",0:"ì œë„¤ëŸ´ ì¹´ì§€ë…¸"}};function Jt(e){return Math.floor(e/1e3)}function Xt(e,r=!0){return(r?we.SLOT:we.CASINO)[e]||`Unknown Provider (${e})`}function Ye(e){if(!e)return{isValid:!1,error:"API ì‘ë‹µì´ ì—†ìŠµë‹ˆë‹¤"};if(e.is_text&&e.text_response){const r=e.text_response.includes("http"),s=e.text_response.toLowerCase().includes("error");if(r&&!s)return{isValid:!0};if(s)return{isValid:!1,error:`API ì˜¤ë¥˜: ${e.text_response.substring(0,200)}`};if(/balance|amount|success/i.test(e.text_response))return{isValid:!0}}if(!e.is_text){if(e.RESULT===!1){const r=e.DATA?.message||e.message||"ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤";return r.includes("ê²Œì„ê¸°ë¡ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")||r.includes("ê¸°ë¡ì´ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")||r.includes("no data")||e.code===400?{isValid:!0,isNoData:!0,error:r}:{isValid:!1,error:r}}if(e.error_code||e.ERROR){const r=e.error_code||e.ERROR;return{isValid:!1,error:{1001:"OPCODEê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤",1002:"ì„œëª…(Signature)ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤",1003:"ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",1004:"ì”ê³ ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤",1005:"ê²Œì„ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",1006:"ì œê³µì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤",2001:"API ì„œë²„ ë‚´ë¶€ ì˜¤ë¥˜",2002:"ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì˜¤ë¥˜",3001:"ìš”ì²­ íŒŒë¼ë¯¸í„° ì˜¤ë¥˜"}[r]||`API ì˜¤ë¥˜ (${r}): ${e.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}`}}if(e.RESULT===!0||e.success===!0||e.DATA)return{isValid:!0}}return{isValid:!0}}function Qt(e,r){if(!e)return 0;if(console.log("ğŸ’° ì”ê³  ì¶”ì¶œ ì‹œë„:",{response:typeof e,username:r}),e.is_text&&e.text_response){const n=e.text_response.match(/\d+(?:\.\d+)?/g);if(n&&n.length>0){const u=n.map(l=>parseFloat(l)),m=Math.max(...u);return console.log("ğŸ“Š í…ìŠ¤íŠ¸ì—ì„œ ì¶”ì¶œëœ ì”ê³ :",m),m}}if(!e.is_text){if(!e||typeof e!="object")return console.warn("âš ï¸ ìœ íš¨í•˜ì§€ ì•Šì€ JSON ì‘ë‹µ:",e),0;try{if(e.balance!==void 0&&e.balance!==null){const s=parseFloat(e.balance);if(!isNaN(s))return s}if(e.amount!==void 0&&e.amount!==null){const s=parseFloat(e.amount);if(!isNaN(s))return s}if(e.current_balance!==void 0&&e.current_balance!==null){const s=parseFloat(e.current_balance);if(!isNaN(s))return s}}catch(s){return console.error("âŒ JSON ì”ê³  íŒŒì‹± ì˜¤ë¥˜:",s),0}if(e.DATA)try{if(Array.isArray(e.DATA)){if(r)try{const s=e.DATA.find(n=>n?.username===r);if(s){if(s.balance!==void 0&&s.balance!==null){const n=parseFloat(s.balance);if(!isNaN(n))return n}if(s.amount!==void 0&&s.amount!==null){const n=parseFloat(s.amount);if(!isNaN(n))return n}if(s.current_balance!==void 0&&s.current_balance!==null){const n=parseFloat(s.current_balance);if(!isNaN(n))return n}}}catch(s){return console.warn("âš ï¸ ë°°ì—´ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜:",s),0}else if(e.DATA[0]){const s=e.DATA[0];if(s.balance!==void 0&&s.balance!==null){const n=parseFloat(s.balance);if(!isNaN(n))return n}if(s.amount!==void 0&&s.amount!==null){const n=parseFloat(s.amount);if(!isNaN(n))return n}if(s.current_balance!==void 0&&s.current_balance!==null){const n=parseFloat(s.current_balance);if(!isNaN(n))return n}}}if(typeof e.DATA=="object"){if(e.DATA.balance!==void 0&&e.DATA.balance!==null){const s=parseFloat(e.DATA.balance);if(!isNaN(s))return s}if(e.DATA.amount!==void 0&&e.DATA.amount!==null){const s=parseFloat(e.DATA.amount);if(!isNaN(s))return s}if(e.DATA.current_balance!==void 0&&e.DATA.current_balance!==null){const s=parseFloat(e.DATA.current_balance);if(!isNaN(s))return s}if(Array.isArray(e.DATA.users)&&r)try{const s=e.DATA.users.find(n=>n?.username===r);if(s){if(s.balance!==void 0&&s.balance!==null){const n=parseFloat(s.balance);if(!isNaN(n))return n}if(s.amount!==void 0&&s.amount!==null){const n=parseFloat(s.amount);if(!isNaN(n))return n}if(s.current_balance!==void 0&&s.current_balance!==null){const n=parseFloat(s.current_balance);if(!isNaN(n))return n}}}catch(s){return console.warn("âš ï¸ users ë°°ì—´ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜:",s),0}}}catch(s){return console.error("âŒ DATA ë¸”ë¡ íŒŒì‹± ì˜¤ë¥˜:",s),0}if(Array.isArray(e)&&r)try{const s=e.find(n=>n?.username===r);if(s){if(s.balance!==void 0&&s.balance!==null){const n=parseFloat(s.balance);if(!isNaN(n))return n}if(s.amount!==void 0&&s.amount!==null){const n=parseFloat(s.amount);if(!isNaN(n))return n}if(s.current_balance!==void 0&&s.current_balance!==null){const n=parseFloat(s.current_balance);if(!isNaN(n))return n}}}catch(s){return console.warn("âš ï¸ ì§ì ‘ ë°°ì—´ ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜:",s),0}}return console.log("âš ï¸ ì”ê³ ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ, 0 ë°˜í™˜"),0}async function Je(e){const{data:r,error:s}=await j.from("partners").select("opcode, secret_key, api_token").eq("id",e).single();if(s||!r)throw new Error("íŒŒíŠ¸ë„ˆ API ì„¤ì •ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");if(!r.opcode||!r.secret_key||!r.api_token)throw new Error("íŒŒíŠ¸ë„ˆ API ì„¤ì •ì´ ë¶ˆì™„ì „í•©ë‹ˆë‹¤.");return{opcode:r.opcode,secret_key:r.secret_key,token:r.api_token}}async function Zt(e,r="GET",s,n=3,u=1e3){let m=null;for(let l=1;l<=n;l++)try{const a=await R(e,r,s),i=Ye(a.data);return i.isValid?a:{data:null,error:i.error,status:a.status}}catch(a){m=a instanceof Error?a.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜",l<n&&(console.warn(`API í˜¸ì¶œ ì‹¤íŒ¨ (ì‹œë„ ${l}/${n}), ${u}ms í›„ ì¬ì‹œë„:`,m),await new Promise(i=>setTimeout(i,u*l)))}return{data:null,error:`API í˜¸ì¶œ ì‹¤íŒ¨ (${n}íšŒ ì‹œë„ í›„): ${m}`,status:500}}async function er(e,r=5,s=1e3){const n=[];for(let u=0;u<e.length;u+=r){const m=e.slice(u,u+r);(await Promise.allSettled(m.map(a=>a()))).forEach((a,i)=>{a.status==="fulfilled"?n.push(a.value):(console.error(`ë°°ì¹˜ API í˜¸ì¶œ ì‹¤íŒ¨ (ì¸ë±ìŠ¤ ${u+i}):`,a.reason),n.push(null))}),u+r<e.length&&await new Promise(a=>setTimeout(a,s))}return n}const Xe=new Map;function tr(e,r,s){Xe.set(e,{opcode:e,secretKey:r,token:s})}function rr(e){return Xe.get(e)}function sr(){Xe.clear()}const Qe={createAccount:Ft,getAccountBalance:qe,getAllAccountBalances:Ve,depositToAccount:Ge,withdrawFromAccount:We,getAccountHistory:Wt,getInfo:je,getGameList:Kt,launchGame:Ht,getGameHistory:He,getGameDetail:Yt,getUserBalance:qt,getApiConfig:Je,depositBalance:Vt,withdrawBalance:Gt,generateSignature:M,createSignature:M,callInvestApi:R,callInvestApiWithRetry:Zt,validateApiResponse:Ye,extractBalanceFromResponse:Qt,batchApiCalls:er,cacheOpcodeConfig:tr,getCachedOpcodeConfig:rr,clearOpcodeConfigCache:sr,getProviderIdFromGameId:Jt,getProviderName:Xt,GAME_PROVIDERS:we},Is=Object.freeze(Object.defineProperty({__proto__:null,GAME_PROVIDERS:we,batchApiCalls:er,cacheOpcodeConfig:tr,callInvestApi:R,callInvestApiWithRetry:Zt,clearOpcodeConfigCache:sr,createAccount:Ft,depositBalance:Vt,depositToAccount:Ge,extractBalanceFromResponse:Qt,generateSignature:M,getAccountBalance:qe,getAccountHistory:Wt,getAllAccountBalances:Ve,getApiConfig:Je,getCachedOpcodeConfig:rr,getGameDetail:Yt,getGameHistory:He,getGameList:Kt,getInfo:je,getProviderIdFromGameId:Jt,getProviderName:Xt,getUserBalance:qt,getUserBalanceWithConfig:Ke,investApi:Qe,launchGame:Ht,md5Hash:zt,validateApiResponse:Ye,withdrawBalance:Gt,withdrawFromAccount:We},Symbol.toStringTag,{value:"Module"})),ar=p.createContext(null);function Cs(){const e=p.useContext(ar);if(!e)throw new Error("useBalance must be used within BalanceProvider");return e}function Ds({user:e,children:r}){const[s,n]=p.useState(0),[u,m]=p.useState(!1),[l,a]=p.useState(null),[i,o]=p.useState(null),d=p.useRef(!1);p.useCallback(async()=>{if(e?.id){console.log("ğŸ’¾ [Balance] DBì—ì„œ ì´ˆê¸° ë³´ìœ ê¸ˆ ë¡œë“œ:",{partner_id:e.id,nickname:e.nickname,level:e.level});try{const{data:N,error:w}=await j.from("partners").select("balance").eq("id",e.id).single();if(w){console.error("âŒ [Balance] DB ì¡°íšŒ ì‹¤íŒ¨:",w),a(w.message);return}const y=N?.balance||0;console.log("âœ… [Balance] DB ë¡œë“œ ì™„ë£Œ:",y),n(y),o(new Date),a(null)}catch(N){console.error("âŒ [Balance] DB ì¡°íšŒ ì˜¤ë¥˜:",N),a(N.message||"DB ì¡°íšŒ ì˜¤ë¥˜")}}},[e]);const x=p.useCallback(async()=>{if(!e?.id)return;let N,w,y;try{const{getAdminOpcode:h,isMultipleOpcode:c}=await P(async()=>{const{getAdminOpcode:k,isMultipleOpcode:v}=await Promise.resolve().then(()=>Ms);return{getAdminOpcode:k,isMultipleOpcode:v}},void 0);console.log("ğŸ” [Balance] ìƒìœ„ ëŒ€ë³¸ì‚¬ opcode ì¡°íšŒ ì‹œì‘");const g=await h(e);if(c(g)){if(g.opcodes.length===0){const k="ì‚¬ìš© ê°€ëŠ¥í•œ OPCODEê°€ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œ ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.";throw new Error(k)}N=g.opcodes[0].opcode,w=g.opcodes[0].secretKey,y=g.opcodes[0].token,console.log("âœ… [Balance] ì‹œìŠ¤í…œê´€ë¦¬ì - ì²« ë²ˆì§¸ opcode ì‚¬ìš©:",N)}else N=g.opcode,w=g.secretKey,y=g.token,console.log("âœ… [Balance] ìƒìœ„ ëŒ€ë³¸ì‚¬ opcode ì¡°íšŒ ì„±ê³µ:",N)}catch(h){console.error("âŒ [Balance] opcode ì¡°íšŒ ì‹¤íŒ¨:",h);const c=`ìƒìœ„ ëŒ€ë³¸ì‚¬ API ì„¤ì • ì¡°íšŒ ì‹¤íŒ¨: ${h.message}`;a(c),D.error(c,{duration:5e3});return}if(d.current){console.log("â³ [Balance] ì´ë¯¸ ë™ê¸°í™” ì¤‘...");return}d.current=!0,m(!0);try{const h=e.level===1||e.level===2,c=h?"/api/info":"/api/account/balance";console.log(`ğŸ“¡ [Balance] API ${c} í˜¸ì¶œ ì‹œì‘:`,{partner_id:e.id,level:e.level,opcode:N});const g=Date.now();let k;if(h)k=await je(N,w);else{const{getAllAccountBalances:S}=await P(async()=>{const{getAllAccountBalances:E}=await Promise.resolve().then(()=>Is);return{getAllAccountBalances:E}},void 0);k=await S(N,w)}const v=Date.now()-g;if(await j.from("api_sync_logs").insert({opcode:N,api_endpoint:c,sync_type:"manual_balance_sync",status:k.error?"failed":"success",request_data:{opcode:N,partner_id:e.id,partner_nickname:e.nickname},response_data:k.error?{error:k.error}:k.data,duration_ms:v,error_message:k.error||null}),k.error){console.error("âŒ [Balance] API í˜¸ì¶œ ì‹¤íŒ¨:",k.error),a(k.error),D.error(`API ë™ê¸°í™” ì‹¤íŒ¨: ${k.error}`);return}const A=k.data;let _=0;if(console.log("ğŸ“Š [Balance] API ì‘ë‹µ:",JSON.stringify(A,null,2)),h){if(A){if(typeof A=="object"&&!A.is_text)A.RESULT===!0&&A.DATA?_=parseFloat(A.DATA.balance||0):A.balance!==void 0&&(_=parseFloat(A.balance||0));else if(A.is_text&&A.text_response){const S=A.text_response.match(/balance["'\s:]+(\\d+\\.?\\d*)/i);S&&(_=parseFloat(S[1]))}}}else if(A&&typeof A=="object"&&!A.is_text)if(A.RESULT===!0&&Array.isArray(A.DATA)){const S=A.DATA.find(E=>E.username===e.nickname);if(S)_=parseFloat(S.balance||0),console.log("âœ… [Balance] API ì‘ë‹µì—ì„œ username ì°¾ìŒ:",{username:e.nickname,balance:_});else{console.log("âš ï¸ [Balance] API ì‘ë‹µì— username ì—†ìŒ - DBì—ì„œ í˜„ì¬ ë³´ìœ ê¸ˆ ì¡°íšŒ:",{username:e.nickname,total_records:A.DATA.length});const{data:E}=await j.from("partners").select("balance").eq("id",e.id).single();if(E){const C=E.balance||0;n(C),o(new Date),console.log("âœ… [Balance] DBì—ì„œ í˜„ì¬ ë³´ìœ ê¸ˆ ì¡°íšŒ ì™„ë£Œ:",C)}return}}else A.balance!==void 0&&(_=parseFloat(A.balance||0));console.log("ğŸ’° [Balance] íŒŒì‹±ëœ ë³´ìœ ê¸ˆ:",_);const{error:f}=await j.from("partners").update({balance:_,updated_at:new Date().toISOString()}).eq("id",e.id);if(f)console.error("âŒ [Balance] DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",f),a(f.message),D.error("ë³´ìœ ê¸ˆ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");else{console.log("âœ… [Balance] DB ì—…ë°ì´íŠ¸ ì™„ë£Œ");const S=s;S!==_&&await j.from("partner_balance_logs").insert({partner_id:e.id,balance_before:S,balance_after:_,amount:_-S,transaction_type:"admin_adjustment",processed_by:e.id,memo:`API ${c} ë™ê¸°í™”`}),n(_),o(new Date),a(null),console.log("âœ… [Balance] í™”ë©´ ì—…ë°ì´íŠ¸ ì™„ë£Œ:",_),D.success(`ë³´ìœ ê¸ˆ ë™ê¸°í™” ì™„ë£Œ: â‚©${_.toLocaleString()}`)}}catch(h){console.error("âŒ [Balance] API ë™ê¸°í™” ì˜¤ë¥˜:",h),a(h.message||"API ë™ê¸°í™” ì˜¤ë¥˜"),D.error(`ë™ê¸°í™” ì˜¤ë¥˜: ${h.message}`)}finally{d.current=!1,m(!1)}},[e,s]),b=p.useCallback(async()=>{e?.id&&await x()},[e,x]);return p.useEffect(()=>{e?.id&&(console.log("ğŸ”„ [Balance] ì´ˆê¸°í™”:",{partner_id:e.id,nickname:e.nickname,level:e.level,has_opcode:!!e.opcode,has_secret_key:!!e.secret_key}),console.log("ğŸ“¡ [Balance] ë¡œê·¸ì¸ ì‹œ ìë™ ë™ê¸°í™” ì‹œì‘ (ìƒìœ„ ëŒ€ë³¸ì‚¬ opcode ì‚¬ìš©)"),x())},[e?.id]),p.useEffect(()=>{if(!e?.id)return;console.log("ğŸ”” [Balance] Realtime êµ¬ë… ì‹œì‘:",e.id);const N=j.channel(`partner_balance_${e.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners",filter:`id=eq.${e.id}`},w=>{const y=parseFloat(w.new?.balance)||0,h=parseFloat(w.old?.balance)||0;if(console.log("ğŸ’° [Balance] Realtime ì—…ë°ì´íŠ¸ ê°ì§€:",{old:h,new:y,change:y-h}),n(y),o(new Date),a(null),h!==0&&Math.abs(y-h)>.01){const c=y-h,g=c>0?`+â‚©${c.toLocaleString()}`:`-â‚©${Math.abs(c).toLocaleString()}`;D.info(`ë³´ìœ ê¸ˆ ë³€ê²½: ${g} (í˜„ì¬: â‚©${y.toLocaleString()})`)}}).subscribe();return()=>{console.log("ğŸ”• [Balance] Realtime êµ¬ë… í•´ì œ:",e.id),j.removeChannel(N)}},[e?.id]),t.jsx(ar.Provider,{value:{balance:s,loading:u,error:l,lastSyncTime:i,syncBalance:b},children:r})}function Ts({user:e,wsConnected:r,onToggleSidebar:s,onRouteChange:n,currentRoute:u}){const{logout:m}=ve(),{balance:l,loading:a,error:i,lastSyncTime:o}=Cs();if(!e)return t.jsx("div",{className:"w-full px-6 py-3.5 h-[72px] flex items-center border-b border-slate-200 bg-white/95",children:t.jsx("div",{className:"flex items-center justify-between w-full",children:t.jsx("div",{className:"flex items-center gap-4",children:t.jsx("span",{className:"text-sm text-muted-foreground",children:"ë¡œë”© ì¤‘..."})})})});const[d,x]=p.useState({total_users:0,total_balance:0,daily_deposit:0,daily_withdrawal:0,daily_net_deposit:0,casino_betting:0,slot_betting:0,total_betting:0,online_users:0,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0}),[b,N]=p.useState(0);p.useEffect(()=>{const g=async()=>{try{console.log("ğŸ“Š í—¤ë” í†µê³„ ì¡°íšŒ ì‹œì‘ (ê³„ì¸µ í•„í„°ë§):",{id:e.id,level:e.level});const _=new Date,f=540*60*1e3,S=new Date(_.getTime()+f),E=new Date(S.getFullYear(),S.getMonth(),S.getDate()),C=new Date(E.getTime()-f).toISOString();let I=[];if(e.level===1){const{data:L}=await j.from("users").select("id");I=L?.map(q=>q.id)||[],console.log("ğŸ”‘ [ì‹œìŠ¤í…œê´€ë¦¬ì] ì „ì²´ ì‚¬ìš©ì ì¡°íšŒ:",I.length)}else{const{data:L,error:q}=await j.rpc("get_hierarchical_partners",{p_partner_id:e.id});q&&console.error("âŒ í•˜ìœ„ íŒŒíŠ¸ë„ˆ ì¡°íšŒ ì‹¤íŒ¨:",q);const at=[e.id,...L?.map(ee=>ee.id)||[]];console.log("ğŸ”‘ [ì¡°íšŒ ëŒ€ìƒ íŒŒíŠ¸ë„ˆ] ì´",at.length,"ê°œ:",{ìì‹ :e.id,í•˜ìœ„íŒŒíŠ¸ë„ˆìˆ˜:L?.length||0});const{data:he,error:nt}=await j.from("users").select("id, username, referrer_id").in("referrer_id",at);if(nt&&console.error("âŒ ì†Œì† ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨:",nt),I=he?.map(ee=>ee.id)||[],console.log("ğŸ”‘ [ì†Œì† ì‚¬ìš©ì] ì´",I.length,"ëª…",I.length===0?"(ì •ìƒ: ì•„ì§ ì‚¬ìš©ìê°€ ì—†ìŒ)":""),he&&he.length>0){const ee=he.reduce((Ne,ot)=>(Ne[ot.referrer_id]=(Ne[ot.referrer_id]||0)+1,Ne),{});console.log("ğŸ“Š [íŒŒíŠ¸ë„ˆë³„ ì‚¬ìš©ì ë¶„í¬]:",ee)}}if(I.length===0){console.log("â„¹ï¸ ì†Œì†ëœ ì‚¬ìš©ìê°€ ì—†ìŠµë‹ˆë‹¤. 0ìœ¼ë¡œ í†µê³„ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤."),x(L=>({...L,daily_deposit:0,daily_withdrawal:0,daily_net_deposit:0,online_users:0,pending_approvals:0,pending_messages:0,pending_deposits:0,pending_withdrawals:0})),N(0);return}const{data:T,error:B}=await j.from("transactions").select("amount").in("transaction_type",["deposit","admin_deposit"]).eq("status","completed").gte("created_at",C).in("user_id",I);B&&console.error("âŒ ì…ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",B);const $=T?.reduce((L,q)=>L+Number(q.amount),0)||0,{data:V,error:Z}=await j.from("transactions").select("amount").in("transaction_type",["withdrawal","admin_withdrawal"]).eq("status","completed").gte("created_at",C).in("user_id",I);Z&&console.error("âŒ ì¶œê¸ˆ ì¡°íšŒ ì‹¤íŒ¨:",Z);const X=V?.reduce((L,q)=>L+Number(q.amount),0)||0,{count:pe}=await j.from("users").select("id",{count:"exact",head:!0}).eq("is_online",!0).in("id",I),fe=I.length,{count:ge}=await j.from("users").select("id",{count:"exact",head:!0}).eq("status","pending").in("id",I),{count:et}=await j.from("messages").select("id",{count:"exact",head:!0}).in("status",["unread","read"]).eq("message_type","normal").eq("receiver_type","partner").is("parent_id",null),{count:tt}=await j.from("transactions").select("id",{count:"exact",head:!0}).eq("transaction_type","deposit").eq("status","pending").in("user_id",I),{count:rt}=await j.from("transactions").select("id",{count:"exact",head:!0}).eq("transaction_type","withdrawal").eq("status","pending").in("user_id",I),{data:cr}=await j.from("users").select("balance").in("id",I),st=cr?.reduce((L,q)=>L+Number(q.balance||0),0)||0;console.log("ğŸ’° í—¤ë” ì…ì¶œê¸ˆ (ê³„ì¸µ í•„í„°ë§):",{ì´ì”ê³ :st,ì…ê¸ˆ:$,ì¶œê¸ˆ:X,ìˆœì…ì¶œê¸ˆ:$-X,ì˜¨ë¼ì¸:pe||0,ì „ì²´íšŒì›:fe||0,ì†Œì†ì‚¬ìš©ììˆ˜:I.length}),console.log("ğŸ”” í—¤ë” ì‹¤ì‹œê°„ ì•Œë¦¼ (ì§ì ‘ ê³„ì‚°):",{ê°€ì…ìŠ¹ì¸:ge||0,ê³ ê°ë¬¸ì˜:et||0,ì…ê¸ˆìš”ì²­:tt||0,ì¶œê¸ˆìš”ì²­:rt||0}),x(L=>({...L,total_balance:st,daily_deposit:$,daily_withdrawal:X,daily_net_deposit:$-X,online_users:pe||0,pending_approvals:ge||0,pending_messages:et||0,pending_deposits:tt||0,pending_withdrawals:rt||0})),N(fe||0),console.log("âœ… í—¤ë” í†µê³„ ì—…ë°ì´íŠ¸ ì™„ë£Œ (ê³„ì¸µ í•„í„°ë§ ì ìš©)")}catch(_){console.error("âŒ í—¤ë” í†µê³„ ë¡œë“œ ì‹¤íŒ¨:",_)}};g(),console.log("ğŸ”” í—¤ë” Realtime êµ¬ë… ì‹œì‘:",e.id);const k=j.channel("header_transactions").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},_=>{if(console.log("ğŸ’° [í—¤ë” ì•Œë¦¼] transactions ë³€ê²½ ê°ì§€:",_.eventType),g(),_.eventType==="INSERT"&&_.new){const f=_.new;f.status==="pending"&&(f.transaction_type==="deposit"?D.info("ìƒˆë¡œìš´ ì…ê¸ˆ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤.",{description:`ê¸ˆì•¡: â‚©${Number(f.amount).toLocaleString()} | íšŒì›: ${f.user_id}`,duration:1e4,action:{label:"í™•ì¸",onClick:()=>{n&&n("/admin/transactions#deposit-request")}}}):f.transaction_type==="withdrawal"&&D.warning("ìƒˆë¡œìš´ ì¶œê¸ˆ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤.",{description:`ê¸ˆì•¡: â‚©${Number(f.amount).toLocaleString()} | íšŒì›: ${f.user_id}`,duration:1e4,action:{label:"í™•ì¸",onClick:()=>{n&&n("/admin/transactions#withdrawal-request")}}}))}}).subscribe(),v=j.channel("header_users").on("postgres_changes",{event:"*",schema:"public",table:"users"},_=>{console.log("ğŸ”” [í—¤ë” ì•Œë¦¼] users ë³€ê²½ ê°ì§€ (ê°€ì…ìŠ¹ì¸):",_.eventType),g(),_.eventType==="INSERT"&&_.new&&_.new.status==="pending"&&D.info("ìƒˆë¡œìš´ ê°€ì… ì‹ ì²­ì´ ìˆìŠµë‹ˆë‹¤.",{description:`íšŒì› ì•„ì´ë””: ${_.new.username}`,duration:8e3})}).subscribe(),A=j.channel("header_messages").on("postgres_changes",{event:"*",schema:"public",table:"messages"},_=>{if(console.log("ğŸ”” [í—¤ë” ì•Œë¦¼] messages ë³€ê²½ ê°ì§€ (ê³ ê°ë¬¸ì˜):",_.eventType),g(),_.eventType==="INSERT"&&_.new){const f=_.new;f.message_type==="normal"&&f.sender_type==="user"&&f.receiver_type==="partner"&&!f.parent_id&&D.info("ìƒˆë¡œìš´ ê³ ê° ë¬¸ì˜ê°€ ìˆìŠµë‹ˆë‹¤.",{description:`ì œëª©: ${f.subject||"ë¬¸ì˜"}`,duration:8e3,action:{label:"í™•ì¸",onClick:()=>{n&&n("/admin/customer-service")}}})}}).subscribe();return()=>{console.log("ğŸ”• í—¤ë” Realtime êµ¬ë… í•´ì œ"),j.removeChannel(k),j.removeChannel(v),j.removeChannel(A)}},[e.id]);const[w,y]=p.useState({all_betting:0,large_betting:0,high_win:0,suspicious:0});p.useEffect(()=>{const g=j.channel("betting_alerts").on("postgres_changes",{event:"INSERT",schema:"public",table:"game_records"},k=>{const v=k.new;y(_=>({..._,all_betting:_.all_betting+1})),v.bet_amount&&parseFloat(v.bet_amount)>=1e5&&(y(_=>({..._,large_betting:_.large_betting+1})),D.warning(`ëŒ€ëŸ‰ ë² íŒ… ë°œìƒ: ${te(parseFloat(v.bet_amount))}`,{duration:5e3,action:{label:"í™•ì¸",onClick:()=>{n&&n("/admin/online-users")}}})),v.win_amount&&parseFloat(v.win_amount)>=5e5&&(y(_=>({..._,high_win:_.high_win+1})),D.info(`ê³ ì•¡ ë‹¹ì²¨ ë°œìƒ: ${te(parseFloat(v.win_amount))}`,{duration:5e3,action:{label:"í™•ì¸",onClick:()=>{n&&n("/admin/online-users")}}}));const A=v.win_amount&&v.bet_amount?parseFloat(v.win_amount)/parseFloat(v.bet_amount):0;A>10&&(y(_=>({..._,suspicious:_.suspicious+1})),D.error(`ì˜ì‹¬ íŒ¨í„´ ê°ì§€: ìŠ¹ë¥  ${(A*100).toFixed(0)}%`,{duration:5e3,action:{label:"í™•ì¸",onClick:()=>{n&&n("/admin/online-users")}}}))}).subscribe();return()=>{j.removeChannel(g)}},[n]);const h=()=>{m(),D.success("ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.")},c=()=>{n&&(n("/admin/online-users"),y({all_betting:0,large_betting:0,high_win:0,suspicious:0}),D.info("ì˜¨ë¼ì¸ ì‚¬ìš©ì í˜„í™© í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤."))};return t.jsx("div",{className:"w-full border-b border-slate-800/50 bg-gradient-to-r from-slate-900 via-slate-800 to-slate-900",children:t.jsx("div",{className:"px-6 py-3",children:t.jsxs("div",{className:"flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:`px-3 py-1.5 rounded-lg bg-gradient-to-br from-purple-500/20 to-violet-500/20 border border-purple-500/30 hover:scale-102 transition-all ${a?"animate-pulse":""}`,children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Dt,{className:"h-4 w-4 text-purple-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[9px] text-purple-300 font-medium",children:"ë³´ìœ ê¸ˆ"}),t.jsx("div",{className:"text-sm font-bold text-white",children:a?"...":te(l||0)})]})]})}),t.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-gradient-to-br from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 hover:scale-102 transition-all cursor-pointer",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ne,{className:"h-4 w-4 text-cyan-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[9px] text-cyan-300 font-medium",children:"ì´ ì…ê¸ˆ"}),t.jsx("div",{className:"text-sm font-bold text-white",children:te(d.daily_deposit)})]})]})}),t.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-gradient-to-br from-orange-500/20 to-red-500/20 border border-orange-500/30 hover:scale-102 transition-all cursor-pointer",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(Zr,{className:"h-4 w-4 text-orange-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[9px] text-orange-300 font-medium",children:"ì´ ì¶œê¸ˆ"}),t.jsx("div",{className:"text-sm font-bold text-white",children:te(d.daily_withdrawal)})]})]})}),t.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-gradient-to-br from-slate-500/20 to-gray-500/20 border border-slate-500/30 hover:scale-102 transition-all cursor-pointer",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(de,{className:"h-4 w-4 text-slate-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[9px] text-slate-300 font-medium",children:"ì´ íšŒì›"}),t.jsx("div",{className:"text-sm font-bold text-white",children:ft(b)})]})]})}),t.jsx("div",{className:"px-3 py-1.5 rounded-lg bg-gradient-to-br from-emerald-500/20 to-teal-500/20 border border-emerald-500/30 hover:scale-102 transition-all cursor-pointer",children:t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(de,{className:"h-4 w-4 text-emerald-400"}),t.jsxs("div",{children:[t.jsx("div",{className:"text-[9px] text-emerald-300 font-medium",children:"ì˜¨ë¼ì¸"}),t.jsxs("div",{className:"text-sm font-bold text-white",children:[ft(d.online_users),"ëª…"]})]})]})})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(H,{children:t.jsxs(re,{children:[t.jsx(se,{asChild:!0,children:t.jsxs("div",{className:"px-2 py-1.5 rounded-lg bg-gradient-to-br from-cyan-500/20 to-blue-500/20 border border-cyan-500/30 hover:scale-105 transition-all cursor-pointer min-w-[60px]",onClick:()=>n?.("/admin/users"),children:[t.jsx("div",{className:"text-[9px] text-cyan-300 font-medium text-center",children:"ê°€ì…ìŠ¹ì¸"}),t.jsx("div",{className:"text-base font-bold text-white text-center",children:d.pending_approvals})]})}),t.jsx(ae,{children:"ê°€ì…ìŠ¹ì¸ ëŒ€ê¸° ì¤‘"})]})}),t.jsx(H,{children:t.jsxs(re,{children:[t.jsx(se,{asChild:!0,children:t.jsxs("div",{className:"px-2 py-1.5 rounded-lg bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/30 hover:scale-105 transition-all cursor-pointer min-w-[60px]",onClick:()=>n?.("/admin/customer-service"),children:[t.jsx("div",{className:"text-[9px] text-purple-300 font-medium text-center",children:"ê³ ê°ë¬¸ì˜"}),t.jsx("div",{className:"text-base font-bold text-white text-center",children:d.pending_messages})]})}),t.jsx(ae,{children:"ê³ ê°ë¬¸ì˜ ëŒ€ê¸° ì¤‘"})]})}),t.jsx(H,{children:t.jsxs(re,{children:[t.jsx(se,{asChild:!0,children:t.jsxs("div",{className:"px-2 py-1.5 rounded-lg bg-gradient-to-br from-emerald-500/20 to-teal-500/20 border border-emerald-500/30 hover:scale-105 transition-all cursor-pointer min-w-[60px]",onClick:()=>n?.("/admin/transactions#deposit-request"),children:[t.jsx("div",{className:"text-[9px] text-emerald-300 font-medium text-center",children:"ì…ê¸ˆìš”ì²­"}),t.jsx("div",{className:"text-base font-bold text-white text-center",children:d.pending_deposits})]})}),t.jsx(ae,{children:"ì…ê¸ˆìš”ì²­ ëŒ€ê¸° ì¤‘"})]})}),t.jsx(H,{children:t.jsxs(re,{children:[t.jsx(se,{asChild:!0,children:t.jsxs("div",{className:"px-2 py-1.5 rounded-lg bg-gradient-to-br from-orange-500/20 to-red-500/20 border border-orange-500/30 hover:scale-105 transition-all cursor-pointer min-w-[60px]",onClick:()=>n?.("/admin/transactions#withdrawal-request"),children:[t.jsx("div",{className:"text-[9px] text-orange-300 font-medium text-center",children:"ì¶œê¸ˆìš”ì²­"}),t.jsx("div",{className:"text-base font-bold text-white text-center",children:d.pending_withdrawals})]})}),t.jsx(ae,{children:"ì¶œê¸ˆìš”ì²­ ëŒ€ê¸° ì¤‘"})]})}),t.jsx("div",{className:"w-px h-8 bg-slate-700"}),t.jsx(H,{children:t.jsxs(re,{children:[t.jsx(se,{asChild:!0,children:t.jsxs(U,{variant:"ghost",size:"sm",className:"relative h-9 w-9 p-0 hover:bg-slate-700",onClick:c,children:[t.jsx(Be,{className:"h-5 w-5 text-slate-300"}),w.large_betting+w.high_win+w.suspicious>0&&t.jsx(Rt,{className:"absolute -top-1 -right-1 h-5 min-w-[20px] px-1 rounded-full text-[10px] bg-rose-500 hover:bg-rose-600 animate-pulse border-0",children:w.large_betting+w.high_win+w.suspicious>99?"99+":w.large_betting+w.high_win+w.suspicious})]})}),t.jsx(ae,{children:t.jsxs("div",{className:"space-y-1 text-xs",children:[t.jsxs("p",{children:["ê³ ë°°íŒ…: ",w.large_betting,"ê±´"]}),t.jsxs("p",{children:["ê³ ë‹¹ì²¨: ",w.high_win,"ê±´"]}),t.jsxs("p",{children:["ì˜ì‹¬íŒ¨í„´: ",w.suspicious,"ê±´"]})]})})]})}),t.jsx("div",{className:"w-px h-8 bg-slate-700"}),t.jsxs(Lt,{children:[t.jsx(Fe,{asChild:!0,children:t.jsx(U,{variant:"ghost",size:"sm",className:"h-9 w-9 p-0 rounded-full hover:bg-slate-700",children:t.jsx(Ns,{className:"h-8 w-8",children:t.jsx(Ss,{className:"bg-gradient-to-br from-cyan-500 to-blue-500 text-white font-semibold text-sm",children:e.nickname.charAt(0).toUpperCase()})})})}),t.jsxs(Ut,{align:"end",className:"w-48 bg-slate-800 border-slate-700",children:[t.jsxs("div",{className:"px-2 py-2 border-b border-slate-700",children:[t.jsx("p",{className:"text-sm font-semibold text-slate-100",children:e.nickname}),t.jsx("p",{className:"text-xs text-slate-400",children:e.username}),t.jsx("p",{className:"text-xs text-slate-500 mt-0.5",children:"ê´€ë¦¬ì ê³„ì •"})]}),t.jsxs(ie,{onClick:h,className:"text-rose-400 cursor-pointer hover:bg-slate-700",children:[t.jsx(Te,{className:"h-4 w-4 mr-2"}),"ë¡œê·¸ì•„ì›ƒ"]})]})]})]})]})})})}const Os=`https://${$t}.supabase.co`,Ps="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im56dXp6bWFpdXlienluZHB0YWJhIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc1OTIwMzk0MywiZXhwIjoyMDc0Nzc5OTQzfQ.ITQXw1UhEdqMvTNcWFi1WJVO4npUDCCG7G96EkjQMhI";let Ie=null;const Ce={},Bs=()=>(Ie||(Ie=Pt(Os,Ps,{auth:{persistSession:!1,autoRefreshToken:!1,detectSessionInUrl:!1,storageKey:"sb-admin-service-role-key",storage:{getItem:e=>Ce[e]||null,setItem:(e,r)=>{Ce[e]=r},removeItem:e=>{delete Ce[e]}}},db:{schema:"public"},global:{headers:{"X-Client-Info":"gms-service-role-admin"}}})),Ie),$s=Bs();async function ue(e){if(console.log("ğŸ” getAdminOpcode í˜¸ì¶œ:",{id:e.id,username:e.username,partner_type:e.partner_type,level:e.level,opcode:e.opcode,has_opcode:!!e.opcode,has_secret_key:!!e.secret_key,has_token:!!e.token,has_api_token:!!e.api_token}),e.partner_type==="system_admin"){const l=[],a=e.token||e.api_token;e.opcode&&e.secret_key&&a?(l.push({opcode:e.opcode,secretKey:e.secret_key,token:a,partnerId:e.id,partnerName:e.name||e.nickname||"ì‹œìŠ¤í…œê´€ë¦¬ì"}),console.log("âœ… ì‹œìŠ¤í…œê´€ë¦¬ì ë³¸ì¸ OPCODE ì¶”ê°€:",e.opcode)):console.warn("âš ï¸ ì‹œìŠ¤í…œê´€ë¦¬ì OPCODE ì •ë³´ ë¶ˆì™„ì „:",{opcode:e.opcode,secret_key:e.secret_key?"***":null,token:a?"***":null});let i=null,o=null;try{const d=await j.from("partners").select("id, username, nickname, opcode, secret_key, api_token").eq("partner_type","head_office").not("opcode","is",null).not("secret_key","is",null).not("api_token","is",null);i=d.data,o=d.error,o&&console.error("âŒ ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ ì˜¤ë¥˜:",{message:o.message,details:o.details,hint:o.hint,code:o.code})}catch(d){console.error("âŒ âŒ ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ ì˜¤ë¥˜:",{message:d.message||String(d),stack:d.stack,type:d.constructor.name})}if(i&&i.length>0&&(i.forEach(d=>{l.push({opcode:d.opcode,secretKey:d.secret_key,token:d.api_token,partnerId:d.id,partnerName:d.nickname||d.username||`ëŒ€ë³¸ì‚¬-${d.id.slice(0,8)}`})}),console.log(`âœ… ëŒ€ë³¸ì‚¬ OPCODE ${i.length}ê°œ ì¶”ê°€`)),l.length===0)throw new Error("ì‚¬ìš© ê°€ëŠ¥í•œ OPCODEê°€ ì—†ìŠµë‹ˆë‹¤. ì‹œìŠ¤í…œê´€ë¦¬ì ë˜ëŠ” ëŒ€ë³¸ì‚¬ì— OPCODEë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.");return console.log(`ğŸ“Š ì‹œìŠ¤í…œê´€ë¦¬ì ì´ ${l.length}ê°œ OPCODE ì‚¬ìš© ê°€ëŠ¥`),{opcodes:l,isSystemAdmin:!0}}if(e.partner_type==="head_office"){const l=e.token||e.api_token;if(!e.opcode||!e.secret_key||!l)throw new Error("ëŒ€ë³¸ì‚¬ ê³„ì •ì— OPCODE/Tokenì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");return console.log("âœ… ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ:",e.opcode),{opcode:e.opcode,secretKey:e.secret_key,token:l,partnerId:e.id,partnerName:e.nickname||e.username||"ë‚´ ì¡°ì§"}}const r=e.parent_chain||[];if(r.length===0){if(console.log("ğŸ” parent_chain ì—†ìŒ, parent_idë¡œ ëŒ€ë³¸ì‚¬ ì°¾ê¸° ì‹œì‘:",{admin_id:e.id,admin_username:e.username,admin_type:e.partner_type,parent_id:e.parent_id}),!e.parent_id)throw new Error(`${e.partner_type}ëŠ” ìƒìœ„ íŒŒíŠ¸ë„ˆê°€ í•„ìš”í•©ë‹ˆë‹¤. parent_idê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);let l=e.parent_id,a=0;const i=10;for(;l&&a<i;){console.log(`ğŸ” [ì‹œë„ ${a+1}] íŒŒíŠ¸ë„ˆ ì¡°íšŒ:`,l);const{data:o,error:d}=await j.from("partners").select("id, nickname, username, partner_type, level, opcode, secret_key, api_token, parent_id").eq("id",l).single();if(console.log(`ğŸ“Š [ì‹œë„ ${a+1}] ì¡°íšŒ ê²°ê³¼:`,{found:!!o,error:d?.message,partner_type:o?.partner_type,level:o?.level,has_opcode:!!o?.opcode,has_secret_key:!!o?.secret_key,has_api_token:!!o?.api_token,parent_id:o?.parent_id}),d)throw console.error("âŒ ìƒìœ„ íŒŒíŠ¸ë„ˆ ì¡°íšŒ DB ì˜¤ë¥˜:",d),new Error(`ìƒìœ„ íŒŒíŠ¸ë„ˆ ì¡°íšŒ ì‹¤íŒ¨: ${d.message}`);if(!o)throw new Error(`ìƒìœ„ íŒŒíŠ¸ë„ˆë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤ (ID: ${l})`);if(o.partner_type==="head_office"){const x=o.api_token;if(!o.opcode||!o.secret_key||!x)throw console.error("âŒ ëŒ€ë³¸ì‚¬ OPCODE ì •ë³´ ë¶€ì¡±:",{partner_id:o.id,username:o.username,has_opcode:!!o.opcode,has_secret_key:!!o.secret_key,has_api_token:!!x}),new Error(`ìƒìœ„ ëŒ€ë³¸ì‚¬(${o.username})ì— OPCODE/Tokenì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`);return console.log("âœ… ìƒìœ„ ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ ì„±ê³µ:",{partner_id:o.id,username:o.username,opcode:o.opcode}),{opcode:o.opcode,secretKey:o.secret_key,token:x,partnerId:o.id,partnerName:o.nickname||o.username||"ìƒìœ„ ëŒ€ë³¸ì‚¬"}}console.log(`â¬†ï¸ [ì‹œë„ ${a+1}] ${o.partner_type}ëŠ” ëŒ€ë³¸ì‚¬ ì•„ë‹˜, ìƒìœ„ë¡œ ì´ë™`),l=o.parent_id||null,a++}throw a>=i?new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ ì¡°íšŒ ì‹œë„ íšŸìˆ˜ ì´ˆê³¼ (ìµœëŒ€ 10íšŒ)"):new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. íŒŒíŠ¸ë„ˆ ê³„ì¸µ êµ¬ì¡°ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.")}const s=r[0],{data:n,error:u}=await j.from("partners").select("id, nickname, opcode, secret_key, api_token").eq("id",s).single();if(u||!n)throw console.error("ìƒìœ„ ëŒ€ë³¸ì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",u),new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const m=n.api_token;if(!n.opcode||!n.secret_key||!m)throw new Error("ìƒìœ„ ëŒ€ë³¸ì‚¬ì— OPCODE/Tokenì´ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.");return console.log("âœ… ìƒìœ„ ëŒ€ë³¸ì‚¬ OPCODE ì¡°íšŒ (parent_chain):",n.opcode),{opcode:n.opcode,secretKey:n.secret_key,token:m,partnerId:n.id,partnerName:n.nickname||"ìƒìœ„ ëŒ€ë³¸ì‚¬"}}function me(e){return"opcodes"in e&&"isSystemAdmin"in e}const Ms=Object.freeze(Object.defineProperty({__proto__:null,getAdminOpcode:ue,isMultipleOpcode:me},Symbol.toStringTag,{value:"Module"})),Oe=async e=>{try{console.log("ğŸ” [SESSION-AUTO-END] ë¹„í™œì„± ì„¸ì…˜ í™•ì¸ ì‹œì‘");const r=new Date(Date.now()-6e4).toISOString(),{data:s,error:n}=await $s.from("game_launch_sessions").update({status:"auto_ended",ended_at:new Date().toISOString()}).eq("status","active").lt("last_activity_at",r).select("id, user_id, session_id, last_activity_at");if(n){console.error("âŒ [SESSION-AUTO-END] ì˜¤ë¥˜:",n);return}if(s&&s.length>0){console.log(`ğŸ”„ [SESSION-AUTO-END] ${s.length}ê°œ ì„¸ì…˜ auto_ended`);for(const o of s)console.log(`   ğŸ“ ì„¸ì…˜ ID: ${o.session_id}, User: ${o.user_id}, ë§ˆì§€ë§‰ í™œë™: ${o.last_activity_at}`),await Ls(o.user_id,e)}else console.log("âœ… [SESSION-AUTO-END] ì¢…ë£Œí•  ë¹„í™œì„± ì„¸ì…˜ ì—†ìŒ");return}catch(r){console.error("âŒ [SESSION-CHECK] ë¬´í™œë™ ì„¸ì…˜ í™•ì¸ ì˜¤ë¥˜:",r)}},ye=async(e,r,s,n,u)=>{try{console.log(`ğŸ“¡ [BETTING-SYNC] OPCODE ${e} ì²˜ë¦¬ ì‹œì‘`);const{data:m}=await j.from("game_records").select("external_txid").eq("partner_id",s).order("external_txid",{ascending:!1}).limit(1).single(),l=m?.external_txid||0;console.log(`ğŸ“ [BETTING-SYNC] OPCODE ${e} ë§ˆì§€ë§‰ id (index): ${l}`);const a=await He(e,n,u,l,4e3,r);if(a.error||!a.data){console.log(`âš ï¸ [BETTING-SYNC] OPCODE ${e} API ì‹¤íŒ¨`);return}let i=[];if(a.data.DATA&&Array.isArray(a.data.DATA)?i=a.data.DATA:Array.isArray(a.data)&&(i=a.data),i.length===0){console.log(`â„¹ï¸ [BETTING-SYNC] OPCODE ${e} ìƒˆë¡œìš´ ë°ì´í„° ì—†ìŒ`);return}if(console.log(`ğŸ“Š [BETTING-SYNC] OPCODE ${e}: ${i.length}ê±´ (id ${l} ì´í›„)`),i.length>0){const c=i.map(v=>typeof v.id=="number"?v.id:parseInt(v.id||"0",10)),g=Math.max(...c),k=Math.min(...c);console.log(`   ğŸ“ id ë²”ìœ„: ${k} ~ ${g} (unique ê°’)`)}const{data:o}=await j.from("users").select("id, username, referrer_id"),d=new Map;o&&o.forEach(c=>{d.set(c.username,{id:c.id,referrer_id:c.referrer_id})}),console.log(`   ğŸ‘¥ ì „ì²´ íšŒì› ìˆ˜: ${d.size}ëª…`);let x=0,b=0;const N=[...i].sort((c,g)=>{const k=typeof c.id=="number"?c.id:parseInt(c.id||"0",10);return(typeof g.id=="number"?g.id:parseInt(g.id||"0",10))-k});let w=0,y=0,h=0;for(const c of N)try{const g=c.username;if(!g){w++;continue}const k=d.get(g);if(!k){y++;continue}const v=c.id;if(!v){h++;continue}const A=typeof v=="number"?v:parseInt(v.toString(),10);if(isNaN(A)){h++;continue}const _=parseFloat(c.bet||c.bet_amount||"0"),f=parseFloat(c.win||c.win_amount||"0"),S=parseFloat(c.balance||c.balance_after||"0"),E=S-(f-_),I=(c.create_at||c.played_at||c.created_at||new Date().toISOString()).replace(/[+-]\d{2}:\d{2}$/,"").replace("Z",""),B=new Date(new Date(I).getTime()+540*60*1e3).toISOString().replace("Z","+09:00"),{error:$}=await j.from("game_records").insert({partner_id:s,external_txid:A,username:g,user_id:k.id,game_id:c.game_id||c.game,provider_id:c.provider_id||Math.floor((c.game_id||c.game||41e4)/1e3),game_title:c.game_title||null,provider_name:c.provider_name||null,bet_amount:_,win_amount:f,balance_before:E,balance_after:S,played_at:B});$?$.code==="23505"?b++:console.error(`   âŒ INSERT ì‹¤íŒ¨ (external_txid: ${A}):`,$):x++}catch(g){console.error("   âŒ ë ˆì½”ë“œ ì²˜ë¦¬ ì˜¤ë¥˜:",g)}if((w>0||y>0||h>0)&&console.log(`   âš ï¸ ê±´ë„ˆë›´ ë°ì´í„°: username ì—†ìŒ ${w}ê±´, user ë§¤ì¹­ ì‹¤íŒ¨ ${y}ê±´, id ì—†ìŒ ${h}ê±´`),console.log(`âœ… [BETTING-SYNC] OPCODE ${e} ì™„ë£Œ: ì„±ê³µ ${x}ê±´, ì¤‘ë³µ ${b}ê±´`),x>0){console.log(`   ğŸ’¾ ì‹ ê·œ ë² íŒ… ${x}ê±´ì´ DBì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);const{data:c,error:g}=await j.from("game_records").select("id, external_txid, username, partner_id").eq("partner_id",s).order("external_txid",{ascending:!1}).limit(3);!g&&c&&c.length>0?console.log(`   ğŸ” DB í™•ì¸: ìµœê·¼ ì €ì¥ëœ ${c.length}ê±´`,c):g?console.error("   âŒ DB í™•ì¸ ì˜¤ë¥˜:",g):console.warn(`   âš ï¸ DBì—ì„œ ë°ì´í„°ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤! partner_id: ${s}`),await Oe(s)}}catch(m){console.error(`âŒ [BETTING-SYNC] OPCODE ${e} ì˜¤ë¥˜:`,m)}};async function en(e){const r=new Date,s=r.getFullYear().toString(),n=(r.getMonth()+1).toString();console.log("ğŸ”„ [BETTING-FORCE-SYNC] ê°•ì œ ë™ê¸°í™” ì‹œì‘",{year:s,month:n});try{const u=await ue(e);if(me(u)){const m=new Map;for(const l of u.opcodes)m.has(l.opcode)||m.set(l.opcode,l);for(const[,l]of m)await ye(l.opcode,l.secretKey,l.partnerId,s,n)}else await ye(u.opcode,u.secretKey,u.partnerId,s,n);console.log("âœ… [BETTING-FORCE-SYNC] ê°•ì œ ë™ê¸°í™” ì™„ë£Œ")}catch(u){throw console.error("âŒ [BETTING-FORCE-SYNC] ì˜¤ë¥˜:",u),u}}function Rs({user:e}){const r=p.useRef(!1),s=p.useRef(null),n=async()=>{if(!r.current)try{r.current=!0;const u=new Date,m=u.getFullYear().toString(),l=(u.getMonth()+1).toString();console.log("ğŸ² [BETTING-SYNC] ì‹œì‘",{year:m,month:l});const a=await ue(e);if(me(a)){const i=new Map;for(const o of a.opcodes)i.has(o.opcode)||i.set(o.opcode,o);for(const[,o]of i)await ye(o.opcode,o.secretKey,o.partnerId,m,l)}else await ye(a.opcode,a.secretKey,a.partnerId,m,l);console.log("âœ… [BETTING-SYNC] ì™„ë£Œ")}catch(u){console.error("âŒ [BETTING-SYNC] ì˜¤ë¥˜:",u)}finally{r.current=!1}};return p.useEffect(()=>(console.log("ğŸ¯ [BETTING-SYNC] ìë™ ë™ê¸°í™” ì‹œì‘"),s.current&&(clearInterval(s.current),s.current=null),n(),Oe(e.id),s.current=setInterval(()=>{console.log("â° [BETTING-SYNC] 30ì´ˆ íƒ€ì´ë¨¸ ì‹¤í–‰:",new Date().toISOString()),n(),Oe(e.id)},3e4),()=>{console.log("ğŸ›‘ [BETTING-SYNC] ìë™ ë™ê¸°í™” ì¤‘ì§€"),s.current&&(clearInterval(s.current),s.current=null)}),[]),null}const Ls=async(e,r)=>{try{console.log(`ğŸ”„ [BALANCE-SYNC] ì„¸ì…˜ ì¢…ë£Œ ì‹œ ì‚¬ìš©ì ë³´ìœ ê¸ˆ ë™ê¸°í™” ì‹œì‘: user_id=${e}`);const{data:s,error:n}=await j.from("users").select("username").eq("id",e).single();if(n||!s){console.error(`âŒ [BALANCE-SYNC] ì‚¬ìš©ì ì •ë³´ ì—†ìŒ: user_id=${e}`);return}const u=await Je(r);if(!u){console.error(`âŒ [BALANCE-SYNC] API ì„¤ì • ì •ë³´ ì—†ìŒ: partner_id=${r}`);return}const m=await Ke(u.opcode,s.username,u.token,u.secret_key);if(!m.success||m.balance===void 0){console.error(`âŒ [BALANCE-SYNC] ì‚¬ìš©ì ë³´ìœ ê¸ˆ ì¡°íšŒ ì‹¤íŒ¨: ${m.error}`);return}const l=m.balance;console.log(`   ğŸ“ ì‚¬ìš©ì ë³´ìœ ê¸ˆ: ${l}`);const{error:a}=await j.from("users").update({balance:l}).eq("id",e);a?console.error(`âŒ [BALANCE-SYNC] ë³´ìœ ê¸ˆ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨: user_id=${e}, partner_id=${r}`,a):console.log(`âœ… [BALANCE-SYNC] ë³´ìœ ê¸ˆ ì—…ë°ì´íŠ¸ ì„±ê³µ: user_id=${e}, partner_id=${r}`)}catch(s){console.error(`âŒ [BALANCE-SYNC] ì˜¤ë¥˜: user_id=${e}, partner_id=${r}`,s)}};function Us({user:e}){const r=p.useRef(!1),s=p.useRef(0),n=p.useRef(null),u=p.useRef(!1),m=p.useRef(0),l=p.useRef(null);return p.useEffect(()=>{const a=async()=>{const o=Date.now(),d=o-m.current;if(d<25e3){console.log("â¸ï¸ [OnlineBalanceSync] ë„ˆë¬´ ë¹ ë¥¸ í˜¸ì¶œ ë°©ì§€:",{timeSinceLastSync:Math.floor(d/1e3)+"ì´ˆ"});return}if(u.current){console.log("â¸ï¸ [OnlineBalanceSync] ì´ë¯¸ ë™ê¸°í™” ì¤‘...");return}try{u.current=!0,m.current=o,console.log("ğŸŸ¢ [OnlineBalanceSync] ì˜¨ë¼ì¸ ì‚¬ìš©ì ë™ê¸°í™” ì‹œì‘:",{timestamp:new Date().toISOString()});const x=await ue(e);let b,N,w;if(me(x)){if(x.opcodes.length===0){console.error("âŒ [OnlineBalanceSync] ì‚¬ìš© ê°€ëŠ¥í•œ OPCODE ì—†ìŒ");return}b=x.opcodes[0].opcode,N=x.opcodes[0].secretKey,w=x.opcodes[0].token||""}else b=x.opcode,N=x.secretKey,w=x.token||"";const{data:y,error:h}=await j.from("users").select("id, username, balance").eq("is_online",!0);if(h){console.error("âŒ [OnlineBalanceSync] ì˜¨ë¼ì¸ ì‚¬ìš©ì ì¡°íšŒ ì‹¤íŒ¨:",h);return}if(!y||y.length===0){console.log("â„¹ï¸ [OnlineBalanceSync] ì˜¨ë¼ì¸ ì‚¬ìš©ì ì—†ìŒ");return}console.log(`ğŸ“Š [OnlineBalanceSync] ${y.length}ëª…ì˜ ì˜¨ë¼ì¸ ì‚¬ìš©ì ë°œê²¬`);let c=0,g=0;for(const k of y){const v=k.username;if(!v||!w){console.warn("âš ï¸ [OnlineBalanceSync] username ë˜ëŠ” token ì—†ìŒ:",{username:v});continue}try{const A=await qe(b,v,w,N);if(A.error){console.error(`âŒ [OnlineBalanceSync] API í˜¸ì¶œ ì‹¤íŒ¨ (${v}):`,A.error);continue}const _=A.data;let f=0;if(_){if(typeof _=="object"&&!_.is_text)_.RESULT===!0&&_.DATA?f=parseFloat(_.DATA.balance||0):_.balance!==void 0&&(f=parseFloat(_.balance||0));else if(_.is_text&&_.text_response){const I=_.text_response.match(/balance[\\"'\\s:]+(\\d+\\.?\\d*)/i);I&&(f=parseFloat(I[1]))}}const{data:S}=await j.from("users").select("balance_sync_call_count").eq("username",v).single(),C=(S?.balance_sync_call_count||0)+1;console.log(`âœ… [OnlineBalanceSync] ë³´ìœ ê¸ˆ ì—…ë°ì´íŠ¸ (${v}):`,{new_balance:f,call_count:C,will_logout:C>=60}),C>=60?(console.log(`ğŸšª [OnlineBalanceSync] 30ë¶„ ê²½ê³¼ (60íšŒ í˜¸ì¶œ) - ê°•ì œ ë¡œê·¸ì•„ì›ƒ (${v}):`,{call_count:C,duration:"30ë¶„"}),await j.from("users").update({balance:f,is_online:!1,balance_sync_call_count:0,updated_at:new Date().toISOString()}).eq("username",v),g++):await j.from("users").update({balance:f,balance_sync_call_count:C,updated_at:new Date().toISOString()}).eq("username",v),c++}catch(A){console.error(`âŒ [OnlineBalanceSync] ì²˜ë¦¬ ì˜¤ë¥˜ (${v}):`,A)}}console.log("âœ… [OnlineBalanceSync] ì˜¨ë¼ì¸ ì‚¬ìš©ì ë™ê¸°í™” ì™„ë£Œ:",{total_online:y.length,success_count:c,logout_count:g})}catch(x){console.error("âŒ [OnlineBalanceSync] ë™ê¸°í™” ì˜¤ë¥˜:",x)}finally{u.current=!1}};console.log("ğŸŸ¢ [OnlineBalanceSync] ì˜¨ë¼ì¸ ì‚¬ìš©ì ë™ê¸°í™” ì‹œì‘ (30ì´ˆ ê°„ê²©, 10ì´ˆ í›„ ì‹œì‘)"),l.current&&(clearInterval(l.current),l.current=null);const i=setTimeout(()=>{a(),l.current=setInterval(()=>{console.log("â° [OnlineBalanceSync] 30ì´ˆ íƒ€ì´ë¨¸ ì‹¤í–‰:",new Date().toISOString()),a()},3e4)},1e4);return()=>{console.log("ğŸ›‘ [OnlineBalanceSync] ë™ê¸°í™” ì¤‘ì§€"),clearTimeout(i),l.current&&(clearInterval(l.current),l.current=null)}},[]),p.useEffect(()=>{const a=async()=>{const i=Date.now(),o=i-s.current;if(o<25e3){console.log("â¸ï¸ [BalanceSync] ë„ˆë¬´ ë¹ ë¥¸ í˜¸ì¶œ ë°©ì§€:",{timeSinceLastSync:Math.floor(o/1e3)+"ì´ˆ"});return}if(r.current){console.log("â¸ï¸ [BalanceSync] ì´ë¯¸ ë™ê¸°í™” ì¤‘...");return}try{r.current=!0,s.current=i,console.log("ğŸ”„ [BalanceSync] ìë™ ë™ê¸°í™” ì‹œì‘:",{partner_id:e.id,username:e.username,level:e.level,timestamp:new Date().toISOString()});const d=await ue(e);let x,b,N;if(me(d)){if(d.opcodes.length===0){console.error("âŒ [BalanceSync] ì‚¬ìš© ê°€ëŠ¥í•œ OPCODE ì—†ìŒ");return}x=d.opcodes[0].opcode,b=d.opcodes[0].secretKey,N=d.opcodes[0].partnerId}else x=d.opcode,b=d.secretKey,N=d.partnerId;if(e.level===1){console.log("ğŸ“¡ [BalanceSync] GET /api/info í˜¸ì¶œ (level 1)");const y=await je(x,b);if(y.error){console.error("âŒ [BalanceSync] API í˜¸ì¶œ ì‹¤íŒ¨:",y.error);return}const h=y.data;let c=0;if(h){if(typeof h=="object"&&!h.is_text)h.RESULT===!0&&h.DATA?c=parseFloat(h.DATA.balance||0):h.balance!==void 0&&(c=parseFloat(h.balance||0));else if(h.is_text&&h.text_response){const g=h.text_response.match(/balance[\"'\s:]+(\\d+\\.?\\d*)/i);g&&(c=parseFloat(g[1]))}}await j.from("partners").update({balance:c,updated_at:new Date().toISOString()}).eq("id",N),console.log("âœ… [BalanceSync] ë³´ìœ ê¸ˆ ë™ê¸°í™” ì™„ë£Œ:",{partner_id:N,new_balance:c})}else{console.log("ğŸ“¡ [BalanceSync] PATCH /api/account/balance í˜¸ì¶œ (level 2~7)");const y=await Ve(x,b);if(y.error){console.error("âŒ [BalanceSync] API í˜¸ì¶œ ì‹¤íŒ¨:",y.error);return}const h=y.data;let c=[];if(h&&typeof h=="object"&&!h.is_text&&(h.RESULT===!0&&h.DATA&&Array.isArray(h.DATA)?c=h.DATA:Array.isArray(h)&&(c=h)),c.length===0){console.log("â„¹ï¸ [BalanceSync] ì—…ë°ì´íŠ¸í•  ì”ê³  ë°ì´í„° ì—†ìŒ");return}console.log(`ğŸ“Š [BalanceSync] ${c.length}ê±´ì˜ ì”ê³  ì •ë³´ ìˆ˜ì‹ `);let g=0,k=0,v=0;for(const A of c){const _=A.username||A.user_id||A.id,f=parseFloat(A.balance||A.amount||0);if(!_||_===""){v++;continue}const{data:S,error:E}=await j.from("users").update({balance:f,updated_at:new Date().toISOString()}).eq("username",_).select("id");!E&&S&&S.length>0&&g++;const{data:C,error:I}=await j.from("partners").update({balance:f,updated_at:new Date().toISOString()}).eq("username",_).select("id");!I&&C&&C.length>0&&k++}console.log("âœ… [BalanceSync] ì”ê³  ë™ê¸°í™” ì™„ë£Œ:",{total_records:c.length,users_updated:g,partners_updated:k,skipped_no_username:v})}}catch(d){console.error("âŒ [BalanceSync] ë™ê¸°í™” ì˜¤ë¥˜:",d)}finally{r.current=!1}};return console.log("ğŸ¯ [BalanceSync] ìë™ ë™ê¸°í™” ì‹œì‘ (30ì´ˆ ê°„ê²©):",{partner_id:e.id,username:e.username,timestamp:new Date().toISOString()}),n.current&&(clearInterval(n.current),n.current=null),a(),n.current=setInterval(()=>{console.log("â° [BalanceSync] 30ì´ˆ íƒ€ì´ë¨¸ ì‹¤í–‰:",new Date().toISOString()),a()},3e4),()=>{console.log("ğŸ›‘ [BalanceSync] ìë™ ë™ê¸°í™” ì¤‘ì§€:",{partner_id:e.id,timestamp:new Date().toISOString()}),n.current&&(clearInterval(n.current),n.current=null)}},[]),null}function zs({children:e}){const r=us();return t.jsx(Mt.Provider,{value:r,children:e})}const nr=p.createContext(null);function Ze(){const e=p.useContext(nr);if(!e)throw new Error("useWebSocketContext must be used within a WebSocketProvider");return e}const ht=be.memo(({children:e})=>{const r=p.useRef(null),s=p.useRef(),n=p.useRef(),u=p.useRef(),m=p.useRef(0),l=999,a=p.useRef(!1),i=p.useRef(!0),o=p.useRef(new Set),d=3e4,[x,b]=p.useState(!1),[N,w]=p.useState([]),[y,h]=p.useState(null),[c,g]=p.useState("disconnected"),k=p.useCallback(()=>{i.current&&(n.current&&clearTimeout(n.current),n.current=window.setTimeout(()=>{if(i.current)if(r.current?.readyState===WebSocket.OPEN)try{r.current.send(JSON.stringify({type:"ping",timestamp:new Date().toISOString()})),console.log("ğŸ’“ Heartbeat ping ì „ì†¡"),k()}catch(E){console.error("âŒ Heartbeat ì „ì†¡ ì‹¤íŒ¨:",E),i.current&&A()}else console.log("ğŸ”„ Heartbeat ì²´í¬: ì—°ê²° ëŠê¹€ ê°ì§€"),i.current&&A()},d))},[]),v=p.useCallback(()=>{n.current&&(clearTimeout(n.current),n.current=void 0)},[]),A=p.useCallback(()=>{if(i.current){if(window.location.hostname==="localhost"||window.location.hostname==="127.0.0.1"){console.log("ğŸ”§ ë¡œì»¬ ê°œë°œ í™˜ê²½ - WebSocket ì˜¤í”„ë¼ì¸ ëª¨ë“œ (ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ì‘ë™)"),g("disconnected"),b(!1);return}if(!(a.current||r.current?.readyState===WebSocket.OPEN)){if(m.current>=l){console.warn("WebSocket ìµœëŒ€ ì¬ì—°ê²° ì‹œë„ ì´ˆê³¼"),g("disconnected");return}a.current=!0,g("connecting"),u.current&&clearTimeout(u.current),r.current&&(r.current.close(),r.current=null);try{const E="wss://vi8282.com/ws";console.log("ğŸ”Œ WebSocket ì„œë²„ ì—°ê²° ì‹œë„:",E);const C=new WebSocket(E);r.current=C,u.current=window.setTimeout(()=>{i.current&&C.readyState===WebSocket.CONNECTING&&(console.log("âš ï¸ WebSocket ì„œë²„ ì‘ë‹µ ì—†ìŒ - ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜ (ëª¨ë“  ê¸°ëŠ¥ ì •ìƒ ì‘ë™)"),C.close(),a.current=!1,g("disconnected"),m.current=l)},5e3),C.onopen=()=>{if(i.current){console.log("âœ… WebSocket ì„œë²„ì— ì„±ê³µì ìœ¼ë¡œ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤"),u.current&&clearTimeout(u.current),a.current=!1,b(!0),g("connected"),m.current=0,k();try{const I={type:"auth",data:{client_type:"admin",timestamp:new Date().toISOString()},timestamp:new Date().toISOString()};C.send(JSON.stringify(I))}catch(I){console.error("âš ï¸ WebSocket ì¸ì¦ ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:",I)}}},C.onmessage=I=>{try{if(typeof I.data!="string"||!I.data.trim())return;let T;try{const B=JSON.parse(I.data);if(typeof B=="object"&&B!==null){if(T={type:B.type||"unknown",data:B.data||B,timestamp:B.timestamp||new Date().toISOString()},B.type==="pong")return}else throw new Error("Invalid JSON structure")}catch{T={type:"text",data:I.data,timestamp:new Date().toISOString()}}if(w(B=>[...B.slice(-49),T]),h(T),T.type==="pong"){console.log("ğŸ’“ Heartbeat pong ìˆ˜ì‹ ");return}o.current.size>0&&o.current.forEach(B=>{try{B(T)}catch($){console.error("âš ï¸ WebSocket ë©”ì‹œì§€ í•¸ë“¤ëŸ¬ ì˜¤ë¥˜:",$)}}),T.type==="balance_update"&&typeof window<"u"&&window.updateUserBalance&&T.data?.new_balance&&window.updateUserBalance(T.data.new_balance),T.type==="partner_balance_updated"&&console.log("ğŸ’° [WebSocket] íŒŒíŠ¸ë„ˆ ë³´ìœ ê¸ˆ ì—…ë°ì´íŠ¸ ê°ì§€:",T.data),["game_session_start","game_session_end","balance_update"].includes(T.type)&&typeof window<"u"&&window.gameMonitorMessageHandler&&window.gameMonitorMessageHandler(T),T.type==="force_close_game"&&typeof window<"u"&&((window.openGameWindows||[]).forEach($=>{$&&!$.closed&&$.close()}),window.gameTab&&!window.gameTab.closed&&window.gameTab.close(),T.data?.message&&typeof window<"u"&&window.showToast&&window.showToast("error",T.data.message),console.log("ğŸš« ê²Œì„ ê°•ì œ ì¢…ë£Œ:",T.data))}catch(T){console.error("WebSocket ë©”ì‹œì§€ ì²˜ë¦¬ ì˜¤ë¥˜:",T)}},C.onclose=I=>{if(i.current)if(m.current===0&&console.log("WebSocket ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤ - ì˜¤í”„ë¼ì¸ ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤."),u.current&&clearTimeout(u.current),v(),a.current=!1,b(!1),g("disconnected"),I.code!==1e3&&I.code!==1001&&i.current){const $=Math.min(2e3*Math.pow(1.5,m.current),3e4);console.log(`ğŸ”„ WebSocket ì¬ì—°ê²° ì‹œë„ (${m.current+1}íšŒ) - ${Math.round($/1e3)}ì´ˆ í›„`),s.current=window.setTimeout(()=>{i.current&&(m.current+=1,A())},$)}else(I.code===1e3||I.code===1001)&&(console.log("âœ… WebSocket ì •ìƒ ì¢…ë£Œ"),g("disconnected"))},C.onerror=I=>{i.current&&(console.log("âš ï¸ WebSocket ì—ëŸ¬ ë°œìƒ - Realtimeìœ¼ë¡œ ë°±ì—… ì‘ë™ ì¤‘"),a.current=!1,g("error"))}}catch(E){console.error("âŒ WebSocket ì—°ê²° ì‹¤íŒ¨:",E),a.current=!1,g("error"),i.current&&(s.current=window.setTimeout(()=>{i.current&&(m.current+=1,A())},5e3))}}}},[k]),_=p.useCallback(()=>{v(),s.current&&(clearTimeout(s.current),s.current=void 0),n.current&&(clearTimeout(n.current),n.current=void 0),u.current&&(clearTimeout(u.current),u.current=void 0),r.current&&(r.current.close(1e3,"Manual disconnect"),r.current=null),a.current=!1,b(!1),g("disconnected"),m.current=0},[v]),f=p.useCallback((E,C)=>{if(r.current?.readyState===WebSocket.OPEN){const I={type:E,data:C,timestamp:new Date().toISOString()};try{return r.current.send(JSON.stringify(I)),!0}catch(T){return console.error("ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:",T),!1}}return!1},[]);p.useEffect(()=>(i.current=!0,A(),()=>{i.current=!1,v(),s.current&&clearTimeout(s.current),n.current&&clearTimeout(n.current),u.current&&clearTimeout(u.current),r.current&&(r.current.close(1e3,"Component unmount"),r.current=null)}),[A,v]),p.useEffect(()=>{const E=()=>{i.current&&document.visibilityState==="visible"&&!x&&!a.current&&(console.log("ğŸ“± í˜ì´ì§€ í™œì„±í™” - WebSocket ì¬ì—°ê²° ì‹œë„"),m.current=0,A())},C=()=>{i.current&&!x&&!a.current&&(console.log("ğŸŒ ë„¤íŠ¸ì›Œí¬ ë³µêµ¬ - WebSocket ì¬ì—°ê²° ì‹œë„"),m.current=0,A())},I=()=>{i.current&&(console.log("ğŸ“¡ ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€ - ì˜¤í”„ë¼ì¸ ëª¨ë“œ"),g("disconnected"),r.current&&r.current.close())};return document.addEventListener("visibilitychange",E),window.addEventListener("online",C),window.addEventListener("offline",I),()=>{document.removeEventListener("visibilitychange",E),window.removeEventListener("online",C),window.removeEventListener("offline",I)}},[x,A]);const S=be.useMemo(()=>({connected:x,messages:N,sendMessage:f,connect:A,disconnect:_,lastMessage:y,connectionState:c}),[x,N,f,A,_,y,c]);return t.jsx(nr.Provider,{value:S,children:e})});function Fs({children:e,currentRoute:r,onNavigate:s}){const{authState:n}=ve(),{connected:u}=Ze(),[m,l]=p.useState(!0);if(!n.user)return t.jsx("div",{className:"min-h-screen flex items-center justify-center bg-[#0a0e1a]",children:t.jsxs("div",{className:"text-center space-y-4",children:[t.jsx("div",{className:"loading-premium mx-auto"}),t.jsx("p",{className:"text-slate-300",children:"ë¡œë”© ì¤‘..."})]})});const a=n.user;return t.jsxs(ws,{children:[t.jsx(Rs,{user:a}),t.jsx(Us,{user:a}),t.jsxs("div",{className:"h-screen flex w-full overflow-hidden bg-[#0a0e1a]",children:[t.jsx("div",{className:Y("fixed left-0 top-0 h-screen transition-all duration-300 z-40","bg-[#0f1419]/95 backdrop-blur-xl border-r border-slate-700/50 shadow-xl",m?"w-64":"w-16"),children:t.jsx(vs,{user:a,onNavigate:s,currentRoute:r,className:"h-full"})}),t.jsxs("div",{className:Y("flex-1 flex flex-col h-screen overflow-hidden transition-all duration-300",m?"ml-64":"ml-16"),children:[t.jsx("header",{className:"sticky top-0 z-30 bg-[#0f1419]/90 backdrop-blur-lg border-b border-slate-700/50 shadow-sm",children:t.jsx(Ts,{user:a,wsConnected:u,onToggleSidebar:()=>l(!m),onRouteChange:s,currentRoute:r})}),t.jsx("main",{className:"flex-1 p-6 overflow-y-auto bg-[#0a0e1a]",children:t.jsx("div",{className:"max-w-[1600px] mx-auto space-y-6",children:e})})]})]})]})}const De=p.lazy(()=>P(()=>import("./Dashboard-Bq0jA1yH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>({default:e.Dashboard}))),qs=p.lazy(()=>P(()=>import("./UserManagement-Bfn3pm9Y.js"),__vite__mapDeps([8,1,9,6,10,4,3,7,2,11,12,13,14,15])).then(e=>({default:e.UserManagement}))),Vs=p.lazy(()=>P(()=>import("./BlacklistManagement-wf9Q-jC0.js"),__vite__mapDeps([16,1,3,4,2,6,7])).then(e=>({default:e.BlacklistManagement}))),Gs=p.lazy(()=>P(()=>import("./PointManagement-4cmb0pOt.js"),__vite__mapDeps([17,7,1,3,4,9,6,10,12,14,15,13,2])).then(e=>({default:e.PointManagement}))),Ws=p.lazy(()=>P(()=>import("./OnlineUsers-CzOj6VzO.js"),__vite__mapDeps([18,1,9,6,3,4,10,2,7])).then(e=>({default:e.OnlineUsers}))),xt=p.lazy(()=>P(()=>import("./PartnerConnectionStatus-IcbYEKQd.js"),__vite__mapDeps([19,1,9,6,2,3,4,7])).then(e=>({default:e.PartnerConnectionStatus}))),Ks=p.lazy(()=>P(()=>import("./PartnerManagement-CsegSQod.js"),__vite__mapDeps([20,7,1,3,4,10,2,21,9,6,11,12,13,14,15])).then(e=>({default:e.PartnerManagement}))),Hs=p.lazy(()=>P(()=>import("./PartnerCreation-Bx3cgWkd.js"),__vite__mapDeps([22,1,12,9,6,3,4,7])).then(e=>({default:e.PartnerCreation}))),Ys=p.lazy(()=>P(()=>import("./PartnerTransactions-D7Qz5VdY.js"),__vite__mapDeps([21,1,9,6,3,4,2,7])).then(e=>({default:e.PartnerTransactions}))),Js=p.lazy(()=>P(()=>import("./CommissionSettlement-CEna38lT.js"),__vite__mapDeps([23,1,13,4,3,24,6,2,5,7])).then(e=>({default:e.CommissionSettlement}))),Xs=p.lazy(()=>P(()=>import("./IntegratedSettlement-BUN5pnc0.js"),__vite__mapDeps([25,1,13,4,3,24,6,2,5,7])).then(e=>({default:e.IntegratedSettlement}))),Qs=p.lazy(()=>P(()=>import("./TransactionManagement-CQuI4g1F.js"),__vite__mapDeps([26,1,12,10,4,3,14,15,6,13,9,2,7])).then(e=>({default:e.TransactionManagement}))),Zs=p.lazy(()=>P(()=>import("./TransactionApprovalManager-B7rLJ95a.js"),__vite__mapDeps([27,1,15,4,3,6,7])).then(e=>({default:e.TransactionApprovalManager}))),ea=p.lazy(()=>P(()=>import("./EnhancedGameManagement-CJ7k6hTo.js"),__vite__mapDeps([28,1,9,6,3,4,29,7,2])).then(e=>({default:e.EnhancedGameManagement}))),ta=p.lazy(()=>P(()=>import("./BettingManagement-DBzXu_rY.js"),__vite__mapDeps([30,7,1,3,4,9,6])).then(e=>({default:e.BettingManagement}))),bt=p.lazy(()=>P(()=>import("./BettingHistory-bMw9eLtU.js"),__vite__mapDeps([31,1,9,6,3,4,2,7])).then(e=>({default:e.BettingHistory}))),ra=p.lazy(()=>P(()=>import("./CallCycle-CSfLhcWQ.js"),__vite__mapDeps([32,1,33,4,3,6,7])).then(e=>({default:e.CallCycle}))),sa=p.lazy(()=>P(()=>import("./CustomerSupport-DxYzru5K.js"),__vite__mapDeps([34,1,12,10,4,3,6,7])).then(e=>({default:e.CustomerSupport}))),aa=p.lazy(()=>P(()=>import("./Announcements-BFm2PjX3.js"),__vite__mapDeps([35,1,12,9,6,10,4,3,33,7])).then(e=>({default:e.Announcements}))),na=p.lazy(()=>P(()=>import("./MessageCenter-BLyTPNeE.js"),__vite__mapDeps([36,1,12,9,6,10,4,3,7])).then(e=>({default:e.MessageCenter}))),_t=p.lazy(()=>P(()=>import("./SystemSettings-Cp0H1to_.js"),__vite__mapDeps([37,7,1,3,4,33,6])).then(e=>({default:e.SystemSettings}))),oa=p.lazy(()=>P(()=>import("./BannerManagement-BYBB0_AV.js"),__vite__mapDeps([38,1,12,9,6,10,4,3,2,7])).then(e=>({default:e.BannerManagement}))),ia=p.lazy(()=>P(()=>import("./MenuManagement-Bpd0mQm-.js"),__vite__mapDeps([39,1,33,4,3,6,7])).then(e=>({default:e.MenuManagement}))),la=p.lazy(()=>P(()=>import("./ApiTester-DZwgM1Lb.js"),__vite__mapDeps([40,1,3,4,6,7])).then(e=>({default:e.ApiTester}))),ca=p.lazy(()=>P(()=>import("./AutoSyncMonitor-DGeq4bwI.js"),__vite__mapDeps([41,1,4,3,2,6,7])).then(e=>({default:e.AutoSyncMonitor})));function da({currentRoute:e,user:r}){const s=()=>{switch(e){case"/admin/dashboard":case"/admin/realtime":return t.jsx(De,{user:r});case"/admin/users":case"/admin/user-management":return t.jsx(qs,{});case"/admin/blacklist":return t.jsx(Vs,{});case"/admin/points":return t.jsx(Gs,{});case"/admin/online":case"/admin/online-users":return t.jsx(Ws,{user:r});case"/admin/online-status":return t.jsx(xt,{user:r});case"/admin/logs":return t.jsx(bt,{user:r});case"/admin/head-office":case"/admin/partners/master":return t.jsx(Hs,{user:r});case"/admin/partners":case"/admin/partner-hierarchy":return t.jsx(Ks,{});case"/admin/partner-transactions":case"/admin/partners/transactions":return t.jsx(Ys,{});case"/admin/partner-online":case"/admin/partners/status":case"/admin/partner-connection-status":return t.jsx(xt,{user:r});case"/admin/partner-dashboard":case"/admin/partners/dashboard":return t.jsx(De,{user:r});case"/admin/settlement":case"/admin/commission-settlement":case"/admin/settlement/commission":return t.jsx(Js,{user:r});case"/admin/integrated-settlement":case"/admin/settlement/integrated":return t.jsx(Xs,{user:r});case"/admin/transactions":return t.jsx(Qs,{user:r});case"/admin/transaction-approval":return t.jsx(Zs,{user:r});case"/admin/games":case"/admin/game-lists":return t.jsx(ea,{user:r});case"/admin/betting":case"/admin/betting-history":return t.jsx(bt,{user:r});case"/admin/betting-management":return t.jsx(ta,{user:r});case"/admin/call-cycle":return t.jsx(ra,{user:r});case"/admin/communication":case"/admin/customer-service":case"/admin/support":return t.jsx(sa,{user:r});case"/admin/announcements":return t.jsx(aa,{user:r});case"/admin/messages":return t.jsx(na,{user:r});case"/admin/settings":case"/admin/system-settings":return t.jsx(_t,{user:r});case"/admin/system":case"/admin/system-info":return t.jsx(_t,{user:r,initialTab:"info"});case"/admin/api-tester":return t.jsx(la,{user:r});case"/admin/banners":return t.jsx(oa,{user:r});case"/admin/menu-management":return t.jsx(ia,{user:r});case"/admin/auto-sync-monitor":return t.jsx(ca,{});default:return t.jsx(De,{user:r})}};return t.jsx(p.Suspense,{fallback:t.jsx(ns,{size:"lg",text:"í˜ì´ì§€ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...",className:"min-h-screen"}),children:s()})}const ua=Pe("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function ma({className:e,variant:r,...s}){return t.jsx("div",{"data-slot":"alert",role:"alert",className:O(ua({variant:r}),e),...s})}function pa({className:e,...r}){return t.jsx("div",{"data-slot":"alert-description",className:O("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",e),...r})}function fa({className:e,...r}){return t.jsx(kr,{"data-slot":"tabs",className:O("flex flex-col gap-2",e),...r})}function ga({className:e,...r}){return t.jsx(Er,{"data-slot":"tabs-list",className:O("bg-muted text-muted-foreground inline-flex h-9 w-fit items-center justify-center rounded-xl p-[3px] flex",e),...r})}function wt({className:e,...r}){return t.jsx(Ir,{"data-slot":"tabs-trigger",className:O("data-[state=active]:bg-card dark:data-[state=active]:text-foreground focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:outline-ring dark:data-[state=active]:border-input dark:data-[state=active]:bg-input/30 text-foreground dark:text-muted-foreground inline-flex h-[calc(100%-1px)] flex-1 items-center justify-center gap-1.5 rounded-xl border border-transparent px-2 py-1 text-sm font-medium whitespace-nowrap transition-[color,box-shadow] focus-visible:ring-[3px] focus-visible:outline-1 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...r})}function yt({className:e,...r}){return t.jsx(Cr,{"data-slot":"tabs-content",className:O("flex-1 outline-none",e),...r})}function ha({...e}){return t.jsx(Dr,{"data-slot":"select",...e})}function xa({...e}){return t.jsx(Pr,{"data-slot":"select-value",...e})}function ba({className:e,size:r="default",children:s,...n}){return t.jsxs(Tr,{"data-slot":"select-trigger","data-size":r,className:O("border-input data-[placeholder]:text-muted-foreground [&_svg:not([class*='text-'])]:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 dark:hover:bg-input/50 flex w-full items-center justify-between gap-2 rounded-md border bg-input-background px-3 py-2 text-sm whitespace-nowrap transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 data-[size=default]:h-9 data-[size=sm]:h-8 *:data-[slot=select-value]:line-clamp-1 *:data-[slot=select-value]:flex *:data-[slot=select-value]:items-center *:data-[slot=select-value]:gap-2 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4",e),...n,children:[s,t.jsx(Or,{asChild:!0,children:t.jsx($e,{className:"size-4 opacity-50"})})]})}function _a({className:e,children:r,position:s="popper",...n}){return t.jsx(Br,{children:t.jsxs($r,{"data-slot":"select-content",className:O("bg-popover text-popover-foreground data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2 relative z-50 max-h-(--radix-select-content-available-height) min-w-[8rem] origin-(--radix-select-content-transform-origin) overflow-x-hidden overflow-y-auto rounded-md border shadow-md",s==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:s,...n,children:[t.jsx(ya,{}),t.jsx(Mr,{className:O("p-1",s==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)] scroll-my-1"),children:r}),t.jsx(va,{})]})})}function wa({className:e,children:r,...s}){return t.jsxs(Rr,{"data-slot":"select-item",className:O("focus:bg-accent focus:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex w-full cursor-default items-center gap-2 rounded-sm py-1.5 pr-8 pl-2 text-sm outline-hidden select-none data-[disabled]:pointer-events-none data-[disabled]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4 *:[span]:last:flex *:[span]:last:items-center *:[span]:last:gap-2",e),...s,children:[t.jsx("span",{className:"absolute right-2 flex size-3.5 items-center justify-center",children:t.jsx(Lr,{children:t.jsx(es,{className:"size-4"})})}),t.jsx(Ur,{children:r})]})}function ya({className:e,...r}){return t.jsx(zr,{"data-slot":"select-scroll-up-button",className:O("flex cursor-default items-center justify-center py-1",e),...r,children:t.jsx(ts,{className:"size-4"})})}function va({className:e,...r}){return t.jsx(Fr,{"data-slot":"select-scroll-down-button",className:O("flex cursor-default items-center justify-center py-1",e),...r,children:t.jsx($e,{className:"size-4"})})}const ja=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const r=Math.random()*16|0;return(e==="x"?r:r&3|8).toString(16)});function Na({onLoginSuccess:e}){const[r,s]=p.useState("login"),[n,u]=p.useState({username:"",password:""}),[m,l]=p.useState({username:"",nickname:"",password:"",email:"",phone:"",bank_name:"",bank_account:"",bank_holder:"",referrer_username:""}),[a,i]=p.useState(!1),[o,d]=p.useState(!1),[x,b]=p.useState(null),[N,w]=p.useState([]),[y,h]=p.useState({status:"idle",message:""});p.useEffect(()=>{(async()=>{try{const{data:f,error:S}=await j.from("banks").select("*").eq("is_active",!0).order("bank_name");if(S)throw S;w(f||[])}catch(f){console.error("ì€í–‰ ëª©ë¡ ë¡œë“œ ì˜¤ë¥˜:",f)}})()},[]);const c=_=>{const{name:f,value:S}=_.target;u(E=>({...E,[f]:S})),x&&b(null)},g=_=>{const{name:f,value:S}=_.target;l(E=>({...E,[f]:S})),x&&b(null)},k=async _=>{if(!_.trim()){h({status:"idle",message:""});return}h({status:"checking",message:"í™•ì¸ ì¤‘..."});try{const{data:f,error:S}=await j.from("users").select("id").eq("nickname",_.trim()).limit(1);if(S)throw S;f&&f.length>0?h({status:"unavailable",message:"ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤."}):h({status:"available",message:"ì‚¬ìš© ê°€ëŠ¥í•œ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤."})}catch(f){console.error("ë‹‰ë„¤ì„ ì²´í¬ ì˜¤ë¥˜:",f),h({status:"unavailable",message:"í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}},v=async _=>{if(_.preventDefault(),!n.username.trim()||!n.password.trim()){b("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}i(!0),b(null);try{console.log("ğŸ” ì‚¬ìš©ì ë¡œê·¸ì¸ ì‹œë„:",n.username.trim());const{data:f,error:S}=await j.rpc("user_login",{p_username:n.username.trim(),p_password:n.password});if(console.log("ğŸ” ë¡œê·¸ì¸ RPC ì‘ë‹µ:",{data:f,error:S}),S)throw console.error("âŒ ë¡œê·¸ì¸ RPC ì—ëŸ¬:",S),S;if(!f||f.length===0){console.warn("âš ï¸ ë¡œê·¸ì¸ ì‹¤íŒ¨: ì‚¬ìš©ìë¥¼ ì°¾ì„ ìˆ˜ ì—†ê±°ë‚˜ ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŒ"),b("ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.");return}const E=f[0];if(console.log("âœ… ë¡œê·¸ì¸ ì„±ê³µ:",{username:E.username,nickname:E.nickname,status:E.status,vip_level:E.vip_level}),E.status==="blocked"){console.warn("âš ï¸ ì°¨ë‹¨ëœ ê³„ì •:",E.username),b("ì°¨ë‹¨ëœ ê³„ì •ì…ë‹ˆë‹¤. ê³ ê°ì„¼í„°ì— ë¬¸ì˜í•´ì£¼ì„¸ìš”.");return}if(E.status==="pending"){console.warn("âš ï¸ ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ê³„ì •:",E.username),b("ìŠ¹ì¸ ëŒ€ê¸° ì¤‘ì¸ ê³„ì •ì…ë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.");return}const C=navigator.userAgent.toLowerCase();let I="PC";(C.includes("mobile")||C.includes("android")||C.includes("iphone")||C.includes("ipod")||C.includes("blackberry")||C.includes("windows phone")||C.includes("iemobile")||C.includes("opera mini")||C.includes("ipad")||C.includes("tablet"))&&(I="Mobile");const T={user_id:E.id,session_token:ja(),ip_address:null,device_info:{userAgent:navigator.userAgent,platform:navigator.platform,language:navigator.language,device:I}},{error:B}=await j.from("user_sessions").insert([T]);B&&console.error("ì„¸ì…˜ ìƒì„± ì˜¤ë¥˜:",B),await j.from("users").update({is_online:!0,last_login_at:new Date().toISOString(),device_info:T.device_info}).eq("id",E.id),await j.from("activity_logs").insert([{actor_type:"user",actor_id:E.id,action:"login",details:{username:E.username,login_time:new Date().toISOString()}}]),localStorage.setItem("user_session",JSON.stringify(E)),D.success(`${E.nickname}ë‹˜, í™˜ì˜í•©ë‹ˆë‹¤!`),e(E)}catch(f){console.error("ë¡œê·¸ì¸ ì˜¤ë¥˜:",f),b(f.message||"ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),D.error("ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{i(!1)}},A=async _=>{if(_.preventDefault(),!m.username.trim()){b("ì•„ì´ë””ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if(!m.nickname.trim()){b("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if(y.status!=="available"){b("ë‹‰ë„¤ì„ ì¤‘ë³µ í™•ì¸ì„ ì™„ë£Œí•´ì£¼ì„¸ìš”.");return}if(!m.password.trim()){b("ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}if(!m.referrer_username.trim()){b("ì¶”ì²œì¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}i(!0),b(null);try{const{data:f,error:S}=await j.from("partners").select("id").eq("username",m.referrer_username.trim()).maybeSingle();if(S){console.error("ì¶”ì²œì¸ ì¡°íšŒ ì—ëŸ¬:",S),b("ì¶”ì²œì¸ ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");return}if(!f){b("ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì¶”ì²œì¸ì…ë‹ˆë‹¤.");return}const{data:E,error:C}=await j.from("users").insert([{username:m.username.trim(),nickname:m.nickname.trim(),password_hash:m.password,email:m.email.trim()||null,phone:m.phone.trim()||null,bank_name:m.bank_name||null,bank_account:m.bank_account.trim()||null,bank_holder:m.bank_holder.trim()||null,referrer_id:f.id,status:"pending",balance:0,points:0}]).select("id, username").single();if(C){C.code==="23505"?C.message.includes("username")?b("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ì•„ì´ë””ì…ë‹ˆë‹¤."):C.message.includes("nickname")?b("ì´ë¯¸ ì‚¬ìš© ì¤‘ì¸ ë‹‰ë„¤ì„ì…ë‹ˆë‹¤."):b("ì¤‘ë³µëœ ì •ë³´ê°€ ìˆìŠµë‹ˆë‹¤."):b(C.message||"íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");return}if(!E){b("íšŒì›ê°€ì… ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.");return}try{console.log("ğŸ”— Invest API ê³„ì • ìƒì„± ì‹œë„:",m.username.trim());const{data:I,error:T}=await j.rpc("get_user_opcode",{user_id:E.id});if(T)console.error("âŒ OPCODE ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",T),D.warning("íšŒì›ê°€ì…ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ê²Œì„ ê³„ì • ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.");else if(!I||I.length===0)console.error("âŒ OPCODE ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŒ (ëª¨ë“  ìƒìœ„ íŒŒíŠ¸ë„ˆ í™•ì¸ ì™„ë£Œ)"),D.warning("íšŒì›ê°€ì…ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ê²Œì„ ê³„ì • ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.");else{const{opcode:B,secret_key:$}=I[0];console.log("âœ… OPCODE ì •ë³´ ì¡°íšŒ ì„±ê³µ:",{opcode:B});const V=await Qe.createAccount(B,m.username.trim(),$);V.error?(console.error("âŒ Invest API ê³„ì • ìƒì„± ì‹¤íŒ¨:",V.error),D.warning("íšŒì›ê°€ì…ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ê²Œì„ ê³„ì • ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.")):(console.log("âœ… Invest API ê³„ì • ìƒì„± ì„±ê³µ:",V.data),await j.from("activity_logs").insert([{actor_type:"user",actor_id:E.id,action:"api_account_creation",details:{username:m.username.trim(),success:!0,api_response:V.data}}]),D.success("íšŒì›ê°€ì… ë° ê²Œì„ ê³„ì •ì´ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"))}}catch(I){console.error("âŒ Invest API ê³„ì • ìƒì„± ì˜ˆì™¸:",I);try{await j.from("activity_logs").insert([{actor_type:"user",actor_id:E.id,action:"api_account_creation",details:{username:m.username.trim(),success:!1,error:I instanceof Error?I.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"}}])}catch(T){console.error("ë¡œê·¸ ê¸°ë¡ ì‹¤íŒ¨:",T)}D.warning("íšŒì›ê°€ì…ì€ ì™„ë£Œë˜ì—ˆì§€ë§Œ ê²Œì„ ê³„ì • ì—°ë™ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.")}s("login"),u(I=>({...I,username:m.username})),l({username:"",nickname:"",password:"",email:"",phone:"",bank_name:"",bank_account:"",bank_holder:"",referrer_username:""}),h({status:"idle",message:""})}catch(f){console.error("íšŒì›ê°€ì… ì˜¤ë¥˜:",f),b(f.message||"íšŒì›ê°€ì… ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."),D.error("íšŒì›ê°€ì…ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{i(!1)}};return t.jsx("div",{className:"min-h-screen flex items-center justify-center casino-gradient-bg p-4",children:t.jsxs("div",{className:"w-full max-w-md",children:[t.jsxs("div",{className:"text-center mb-8",children:[t.jsx("h1",{className:"text-5xl font-bold gold-text neon-glow mb-2 tracking-wide",children:"VIP CASINO"}),t.jsx("p",{className:"text-yellow-300/80 text-lg tracking-wider",children:"LUXURY GAMING EXPERIENCE"})]}),t.jsxs(Me,{className:"luxury-card border-2 border-yellow-600/40 shadow-2xl backdrop-blur-sm",children:[t.jsxs(Re,{className:"space-y-1 pb-4",children:[t.jsx(Le,{className:"text-2xl text-center gold-text neon-glow",children:"VIP ë¡œê·¸ì¸"}),t.jsx(Bt,{className:"text-center text-yellow-300/80",children:"VIP ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ì„¸ìš”"})]}),t.jsxs(Ue,{className:"space-y-4",children:[t.jsxs(fa,{value:r,onValueChange:s,className:"w-full",children:[t.jsxs(ga,{className:"grid w-full grid-cols-2 bg-black/50 mb-6 border border-yellow-600/30",children:[t.jsx(wt,{value:"login",className:"text-yellow-200 data-[state=active]:bg-gradient-to-r data-[state=active]:from-yellow-600 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:font-bold data-[state=active]:shadow-lg",children:"VIP ë¡œê·¸ì¸"}),t.jsx(wt,{value:"register",className:"text-yellow-200 data-[state=active]:bg-gradient-to-r data-[state=active]:from-yellow-600 data-[state=active]:to-amber-600 data-[state=active]:text-white data-[state=active]:font-bold data-[state=active]:shadow-lg",children:"VIP ê°€ì…"})]}),t.jsx(yt,{value:"login",className:"space-y-4",children:t.jsxs("form",{onSubmit:v,className:"space-y-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{htmlFor:"login-username",className:"text-yellow-300 font-semibold",children:"VIP ì•„ì´ë””"}),t.jsx(z,{id:"login-username",name:"username",type:"text",placeholder:"VIP ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:n.username,onChange:c,disabled:a,className:"bg-black/50 border-yellow-600/30 text-white placeholder:text-yellow-200/50 focus:border-yellow-500 focus:ring-yellow-500/20"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{htmlFor:"login-password",className:"text-slate-300",children:"ë¹„ë°€ë²ˆí˜¸"}),t.jsxs("div",{className:"relative",children:[t.jsx(z,{id:"login-password",name:"password",type:o?"text":"password",placeholder:"ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:n.password,onChange:c,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500 pr-10"}),t.jsx("button",{type:"button",onClick:()=>d(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300",children:o?t.jsx(ct,{className:"w-4 h-4"}):t.jsx(dt,{className:"w-4 h-4"})})]})]}),t.jsx(U,{type:"submit",disabled:a,className:"w-full bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white py-3",children:a?t.jsxs(t.Fragment,{children:[t.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"ë¡œê·¸ì¸ ì¤‘..."]}):"ë¡œê·¸ì¸"})]})}),t.jsx(yt,{value:"register",className:"space-y-4",children:t.jsxs("form",{onSubmit:A,className:"space-y-4",children:[t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsxs(F,{htmlFor:"register-username",className:"text-slate-300",children:["ì•„ì´ë”” ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsx(z,{id:"register-username",name:"username",type:"text",placeholder:"ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:m.username,onChange:g,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(F,{htmlFor:"register-nickname",className:"text-slate-300",children:["ë‹‰ë„¤ì„ ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(z,{id:"register-nickname",name:"nickname",type:"text",placeholder:"ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”",value:m.nickname,onChange:_=>{g(_),_.target.value.trim()&&k(_.target.value)},disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500 pr-10"}),y.status==="checking"&&t.jsx(le,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 animate-spin text-slate-400"}),y.status==="available"&&t.jsx(rs,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-green-400"}),y.status==="unavailable"&&t.jsx(ss,{className:"absolute right-3 top-1/2 -translate-y-1/2 w-4 h-4 text-red-400"})]}),y.message&&t.jsx("p",{className:`text-sm ${y.status==="available"?"text-green-400":"text-red-400"}`,children:y.message})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(F,{htmlFor:"register-password",className:"text-slate-300",children:["ë¹„ë°€ë²ˆí˜¸ ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsxs("div",{className:"relative",children:[t.jsx(z,{id:"register-password",name:"password",type:o?"text":"password",placeholder:"ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:m.password,onChange:g,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500 pr-10"}),t.jsx("button",{type:"button",onClick:()=>d(!o),className:"absolute right-3 top-1/2 -translate-y-1/2 text-slate-400 hover:text-slate-300",children:o?t.jsx(ct,{className:"w-4 h-4"}):t.jsx(dt,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{htmlFor:"register-email",className:"text-slate-300",children:"ì´ë©”ì¼"}),t.jsx(z,{id:"register-email",name:"email",type:"email",placeholder:"ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”",value:m.email,onChange:g,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500"})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{htmlFor:"register-phone",className:"text-slate-300",children:"ì—°ë½ì²˜"}),t.jsx(z,{id:"register-phone",name:"phone",type:"tel",placeholder:"ì—°ë½ì²˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:m.phone,onChange:g,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsx(F,{className:"text-slate-300",children:"ì€í–‰ ì •ë³´"}),t.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-2",children:[t.jsxs(ha,{value:m.bank_name,onValueChange:_=>l(f=>({...f,bank_name:_})),children:[t.jsx(ba,{className:"bg-slate-700/50 border-slate-600 text-white",children:t.jsx(xa,{placeholder:"ì€í–‰ ì„ íƒ"})}),t.jsx(_a,{className:"bg-slate-700 border-slate-600",children:N.map(_=>t.jsx(wa,{value:_.bank_name,className:"text-white",children:_.bank_name},_.id))})]}),t.jsx(z,{name:"bank_account",placeholder:"ê³„ì¢Œë²ˆí˜¸",value:m.bank_account,onChange:g,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500"}),t.jsx(z,{name:"bank_holder",placeholder:"ì˜ˆê¸ˆì£¼ëª…",value:m.bank_holder,onChange:g,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500"})]})]}),t.jsxs("div",{className:"space-y-2",children:[t.jsxs(F,{htmlFor:"register-referrer",className:"text-slate-300",children:["ì¶”ì²œì¸ ",t.jsx("span",{className:"text-red-400",children:"*"})]}),t.jsx(z,{id:"register-referrer",name:"referrer_username",type:"text",placeholder:"ì¶”ì²œì¸ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”",value:m.referrer_username,onChange:g,disabled:a,className:"bg-slate-700/50 border-slate-600 text-white placeholder:text-slate-400 focus:border-blue-500"})]}),t.jsx(U,{type:"submit",disabled:a||y.status!=="available",className:"w-full bg-gradient-to-r from-yellow-500 to-orange-600 hover:from-yellow-600 hover:to-orange-700 text-white py-3",children:a?t.jsxs(t.Fragment,{children:[t.jsx(le,{className:"w-4 h-4 mr-2 animate-spin"}),"íšŒì›ê°€ì… ì¤‘..."]}):"íšŒì›ê°€ì…"})]})})]}),x&&t.jsx(ma,{className:"border-red-600 bg-red-900/20",children:t.jsx(pa,{className:"text-red-400",children:x})})]})]}),t.jsxs("div",{className:"text-center mt-8 text-sm text-slate-400",children:[t.jsx("p",{children:"Â© 2025 GMS Casino. All rights reserved."}),t.jsx("p",{className:"mt-2 text-slate-500",children:"ì•ˆì „í•˜ê³  ê³µì •í•œ ê²Œì„ í™˜ê²½ì„ ì œê³µí•©ë‹ˆë‹¤."})]})]})})}function Sa({...e}){return t.jsx(qr,{"data-slot":"alert-dialog",...e})}function Aa({...e}){return t.jsx(Yr,{"data-slot":"alert-dialog-portal",...e})}const or=p.forwardRef(({className:e,...r},s)=>t.jsx(It,{ref:s,"data-slot":"alert-dialog-overlay",className:O("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",e),...r}));or.displayName=It.displayName;function ka({className:e,...r}){return t.jsxs(Aa,{children:[t.jsx(or,{}),t.jsx(Vr,{"data-slot":"alert-dialog-content",className:O("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",e),...r})]})}function Ea({className:e,...r}){return t.jsx("div",{"data-slot":"alert-dialog-header",className:O("flex flex-col gap-2 text-center sm:text-left",e),...r})}function Ia({className:e,...r}){return t.jsx("div",{"data-slot":"alert-dialog-footer",className:O("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",e),...r})}function Ca({className:e,...r}){return t.jsx(Gr,{"data-slot":"alert-dialog-title",className:O("text-lg font-semibold",e),...r})}function Da({className:e,...r}){return t.jsx(Wr,{"data-slot":"alert-dialog-description",className:O("text-muted-foreground text-sm",e),...r})}function Ta({className:e,...r}){return t.jsx(Hr,{className:O(ze(),e),...r})}function Oa({className:e,...r}){return t.jsx(Kr,{className:O(ze({variant:"outline"}),e),...r})}function Pa(){const e=Ze();return{connected:e.connected,messages:e.messages,sendMessage:e.sendMessage,connect:e.connect,disconnect:e.disconnect,lastMessage:e.lastMessage,connectionState:e.connectionState}}const vt=[{path:"/user/casino",label:"ì¹´ì§€ë…¸",icon:_e},{path:"/user/slot",label:"ìŠ¬ë¡¯",icon:Tt},{path:"/user/betting-history",label:"ë² íŒ…ë‚´ì—­",icon:as},{path:"/user/deposit",label:"ì…ê¸ˆì‹ ì²­",icon:Q},{path:"/user/withdraw",label:"ì¶œê¸ˆì‹ ì²­",icon:Ot},{path:"/user/notice",label:"ê³µì§€ì‚¬í•­",icon:J},{path:"/user/support",label:"ê³ ê°ì„¼í„°",icon:J},{path:"/user/profile",label:"ë‚´ì •ë³´",icon:K}];function Ba({user:e,currentRoute:r,onRouteChange:s,onLogout:n}){const[u,m]=p.useState({balance:0,points:0}),[l,a]=p.useState(0),[i,o]=p.useState(!1);Pa();const d=async()=>{try{const{data:h,error:c}=await j.from("users").select("balance, points").eq("id",e.id).single();if(c)throw c;h&&m({balance:parseFloat(h.balance)||0,points:parseFloat(h.points)||0})}catch(h){console.error("ì”ê³  ì¡°íšŒ ì˜¤ë¥˜:",h)}};p.useEffect(()=>{d(),console.log("ğŸ”” ë³´ìœ ê¸ˆ ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘:",e.id);const h=j.channel(`user_balance_unified_${e.id}`).on("postgres_changes",{event:"UPDATE",schema:"public",table:"users",filter:`id=eq.${e.id}`},c=>{console.log("ğŸ’° [users í…Œì´ë¸”] ë³´ìœ ê¸ˆ ë³€ê²½ ê°ì§€:",c);const g=c.new;m({balance:parseFloat(g.balance)||0,points:parseFloat(g.points)||0})}).on("postgres_changes",{event:"*",schema:"public",table:"transactions",filter:`user_id=eq.${e.id}`},c=>{console.log("ğŸ’³ [transactions í…Œì´ë¸”] ì…ì¶œê¸ˆ ì´ë²¤íŠ¸ ê°ì§€:",c),d()}).subscribe();return()=>{console.log("ğŸ”• ë³´ìœ ê¸ˆ ì‹¤ì‹œê°„ êµ¬ë… í•´ì œ:",e.id),j.removeChannel(h)}},[e.id]);const x=async()=>{if(u.points<=0){D.error("ì „í™˜í•  í¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.");return}try{const h=u.points,{error:c}=await j.from("users").update({points:0,balance:u.balance+h}).eq("id",e.id);if(c)throw c;await j.from("point_transactions").insert([{user_id:e.id,transaction_type:"convert_to_balance",amount:h,points_before:u.points,points_after:0,memo:"í¬ì¸íŠ¸ë¥¼ ë³´ìœ ê¸ˆìœ¼ë¡œ ì „í™˜"}]),await j.from("transactions").insert([{user_id:e.id,transaction_type:"point_conversion",amount:h,status:"completed",balance_before:u.balance,balance_after:u.balance+h,memo:"í¬ì¸íŠ¸ ì „í™˜"}]),await d(),o(!1),D.success(`${h.toLocaleString()}Pê°€ ë³´ìœ ê¸ˆìœ¼ë¡œ ì „í™˜ë˜ì—ˆìŠµë‹ˆë‹¤.`)}catch(h){console.error("í¬ì¸íŠ¸ ì „í™˜ ì˜¤ë¥˜:",h),D.error(h.message||"í¬ì¸íŠ¸ ì „í™˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},b=async()=>{try{const{count:h,error:c}=await j.from("messages").select("*",{count:"exact",head:!0}).eq("receiver_type","user").eq("receiver_id",e.id).eq("status","unread");if(c)throw c;a(h||0)}catch(h){console.error("ì½ì§€ ì•Šì€ ë©”ì‹œì§€ ìˆ˜ ì¡°íšŒ ì˜¤ë¥˜:",h)}};p.useEffect(()=>{b(),typeof window<"u"&&(window.updateUserBalance=c=>{m(g=>({...g,balance:c}))});const h=j.channel("user_message_updates").on("postgres_changes",{event:"*",schema:"public",table:"messages",filter:`receiver_id=eq.${e.id}`},()=>{b()}).subscribe();return()=>{h.unsubscribe()}},[e.id]);const N=h=>new Intl.NumberFormat("ko-KR").format(h),y=(h=>h>=5?{label:"DIAMOND",color:"bg-purple-600"}:h>=4?{label:"PLATINUM",color:"bg-gray-400"}:h>=3?{label:"GOLD",color:"bg-yellow-500"}:h>=2?{label:"SILVER",color:"bg-gray-300"}:h>=1?{label:"BRONZE",color:"bg-orange-400"}:{label:"MEMBER",color:"bg-slate-500"})(e.vip_level||0);return t.jsxs(t.Fragment,{children:[t.jsxs("header",{className:"fixed top-0 left-0 right-0 z-50 bg-black/90 backdrop-blur-md border-b border-yellow-600/30 shadow-2xl",children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-yellow-500 to-transparent opacity-60"}),t.jsx("div",{className:"container mx-auto px-3 sm:px-4 max-w-full",children:t.jsxs("div",{className:"flex items-center justify-between h-20 lg:h-20 min-w-0",children:[t.jsxs("div",{className:"flex items-center gap-2 sm:gap-3 flex-shrink-0",children:[t.jsxs("button",{onClick:()=>{window.history.pushState({},"","/admin"),window.dispatchEvent(new Event("popstate"))},className:"relative w-14 h-14 sm:w-16 sm:h-16 rounded-xl overflow-hidden golden-border cursor-pointer hover:opacity-80 transition-opacity",children:[t.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-yellow-500 via-red-600 to-yellow-500"}),t.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:t.jsx(ut,{className:"w-8 h-8 sm:w-9 sm:h-9 text-white drop-shadow-lg relative z-10"})})]}),t.jsxs("div",{className:"hidden sm:block",children:[t.jsx("div",{className:"text-2xl sm:text-3xl gold-text neon-glow tracking-wide",children:"VIP CASINO"}),t.jsx("div",{className:"text-sm sm:text-base text-yellow-400 tracking-widest uppercase",children:"LUXURY EXPERIENCE"})]})]}),t.jsx("nav",{className:"hidden lg:flex items-center space-x-3 flex-shrink-0",children:vt.map(h=>{const c=h.icon,g=r===h.path;return t.jsxs(U,{variant:"ghost",onClick:()=>s(h.path),className:`
                      relative px-4 lg:px-6 py-3 lg:py-3.5 transition-all duration-300 whitespace-nowrap
                      ${g?"bg-gradient-to-r from-yellow-600 to-red-600 text-white shadow-lg shadow-yellow-500/50 border border-yellow-400/50":"text-yellow-200/80 hover:text-yellow-100 hover:bg-yellow-900/20 border border-transparent hover:border-yellow-600/30"}
                    `,children:[t.jsx(c,{className:`w-5 h-5 lg:w-6 lg:h-6 mr-2.5 ${g?"drop-shadow-lg":""}`}),t.jsx("span",{className:"text-base lg:text-lg",children:h.label}),g&&t.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-0.5 bg-gradient-to-r from-transparent via-yellow-300 to-transparent"})]},h.path)})}),t.jsxs("div",{className:"hidden lg:flex items-center space-x-2 lg:space-x-3 flex-shrink-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 lg:space-x-3 luxury-card rounded-xl px-2 lg:px-4 py-2 lg:py-2.5",children:[t.jsxs("div",{className:"flex items-center space-x-1 lg:space-x-2 group cursor-pointer",children:[t.jsx("div",{className:"p-1 lg:p-1.5 rounded-lg bg-gradient-to-br from-green-500 to-emerald-600 shadow-lg shadow-green-500/30",children:t.jsx(Dt,{className:"w-3 h-3 lg:w-4 lg:h-4 text-white"})}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-[10px] text-yellow-400/70 tracking-wide",children:"BALANCE"}),t.jsxs("div",{className:"text-sm text-green-400",children:["â‚©",N(u.balance)]})]})]}),t.jsx("div",{className:"w-px h-8 lg:h-10 bg-gradient-to-b from-transparent via-yellow-600/50 to-transparent"}),t.jsxs("button",{onClick:()=>o(!0),className:"flex items-center space-x-1 lg:space-x-2 cursor-pointer group hover:scale-105 transition-transform",children:[t.jsx("div",{className:"p-1 lg:p-1.5 rounded-lg bg-gradient-to-br from-yellow-500 to-amber-600 shadow-lg shadow-yellow-500/30",children:t.jsx(Tt,{className:"w-3 h-3 lg:w-4 lg:h-4 text-white"})}),t.jsxs("div",{className:"text-right",children:[t.jsx("div",{className:"text-[10px] text-yellow-400/70 tracking-wide",children:"POINTS"}),t.jsxs("div",{className:"text-sm text-yellow-400",children:[N(u.points),"P"]})]})]})]}),t.jsxs(Lt,{children:[t.jsx(Fe,{asChild:!0,children:t.jsxs(U,{variant:"ghost",className:"flex items-center space-x-2 text-yellow-100 hover:text-white hover:bg-yellow-900/20 border border-transparent hover:border-yellow-600/30 luxury-card px-3 py-2 min-w-0",children:[t.jsxs("div",{className:"flex items-center space-x-2 min-w-0",children:[t.jsxs(Rt,{className:`vip-badge ${y.color} text-white px-2.5 py-1 border border-yellow-400/30`,children:[t.jsx(ut,{className:"w-3 h-3 mr-1 drop-shadow-lg"}),t.jsx("span",{className:"tracking-wide text-sm",children:y.label})]}),t.jsx("span",{className:"text-yellow-100 text-sm truncate max-w-20",children:e.nickname})]}),t.jsx(mt,{className:"w-4 h-4 flex-shrink-0"})]})}),t.jsxs(Ut,{className:"w-56 luxury-card border-yellow-600/30",align:"end",children:[t.jsxs(ie,{onClick:()=>s("/user/profile"),className:"text-yellow-100 hover:text-white hover:bg-yellow-900/30 cursor-pointer",children:[t.jsx(mt,{className:"w-4 h-4 mr-2"}),"ë‚´ ì •ë³´"]}),t.jsxs(ie,{onClick:()=>s("/user/deposit"),className:"text-green-400 hover:text-green-300 hover:bg-green-900/30 cursor-pointer",children:[t.jsx(Q,{className:"w-4 h-4 mr-2"}),"ì…ê¸ˆì‹ ì²­"]}),t.jsxs(ie,{onClick:()=>s("/user/withdraw"),className:"text-red-400 hover:text-red-300 hover:bg-red-900/30 cursor-pointer",children:[t.jsx(Ot,{className:"w-4 h-4 mr-2"}),"ì¶œê¸ˆì‹ ì²­"]}),t.jsx(As,{className:"bg-yellow-600/30"}),t.jsxs(ie,{onClick:n,className:"text-red-400 hover:text-red-300 hover:bg-red-900/30 cursor-pointer",children:[t.jsx(Te,{className:"w-4 h-4 mr-2"}),"ë¡œê·¸ì•„ì›ƒ"]})]})]})]}),t.jsxs("div",{className:"lg:hidden flex items-center gap-1.5 sm:gap-2 flex-shrink-0",children:[t.jsx(U,{variant:"ghost",size:"sm",onClick:()=>s("/user/support"),className:"p-1.5 sm:p-2 text-yellow-100 hover:text-white hover:bg-yellow-900/20",children:t.jsx(J,{className:"w-8 h-8 sm:w-9 sm:h-9"})}),t.jsx(U,{variant:"ghost",size:"sm",onClick:()=>s("/user/notice"),className:"p-1.5 sm:p-2 text-yellow-100 hover:text-white hover:bg-yellow-900/20",children:t.jsx(Be,{className:"w-8 h-8 sm:w-9 sm:h-9"})}),t.jsxs("div",{className:"flex flex-col items-end px-2 py-1.5 rounded-lg bg-black/40",children:[t.jsx("div",{className:"text-sm sm:text-base text-yellow-400/70 tracking-wide",children:"ë³´ìœ ê¸ˆ"}),t.jsxs("div",{className:"text-lg sm:text-xl text-green-400 whitespace-nowrap",children:["â‚©",N(u.balance)]})]}),t.jsxs("button",{onClick:()=>o(!0),className:"flex flex-col items-end px-2 py-1.5 rounded-lg bg-black/40 hover:bg-yellow-900/20 transition-colors",children:[t.jsx("div",{className:"text-sm sm:text-base text-yellow-400/70 tracking-wide",children:"í¬ì¸íŠ¸"}),t.jsxs("div",{className:"text-lg sm:text-xl text-yellow-400 whitespace-nowrap",children:[N(u.points),"P"]})]}),t.jsx(U,{variant:"ghost",size:"sm",onClick:n,className:"p-1.5 sm:p-2 text-red-400 hover:text-red-300 hover:bg-red-900/20",children:t.jsx(Te,{className:"w-8 h-8 sm:w-9 sm:h-9"})})]})]})})]}),t.jsxs("div",{className:"lg:hidden fixed bottom-0 left-0 right-0 z-50 bg-black/95 backdrop-blur-md border-t border-yellow-600/30 shadow-2xl overflow-hidden",children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-500 to-transparent"}),t.jsx("div",{className:"flex items-center justify-around py-4 px-1 safe-area-bottom overflow-y-hidden",children:vt.slice(0,5).map(h=>{const c=h.icon,g=r===h.path;return t.jsxs(U,{variant:"ghost",size:"sm",onClick:()=>s(h.path),className:`
                  flex flex-col items-center justify-center gap-1.5 px-1 py-6 relative flex-1                  
                  ${g?"text-yellow-400":"text-yellow-200/70 hover:text-yellow-100"}
                `,children:[t.jsx(c,{className:`w-11 h-11 sm:w-11 sm:h-11 flex-shrink-0 ${g?"drop-shadow-[0_0_12px_rgba(250,204,21,1)]":""}`}),t.jsx("span",{className:`text-sm sm:text-sm leading-tight text-center ${g?"neon-glow":""} whitespace-nowrap px-1`,children:h.label}),g&&t.jsx("div",{className:"absolute top-0 left-1/2 transform -translate-x-1/2 w-12 h-1.5 bg-gradient-to-r from-transparent via-yellow-400 to-transparent rounded-full"})]},h.path)})})]}),t.jsx(Sa,{open:i,onOpenChange:o,children:t.jsxs(ka,{className:"bg-slate-800 border-slate-700",children:[t.jsxs(Ea,{children:[t.jsx(Ca,{className:"text-white",children:"í¬ì¸íŠ¸ ì „í™˜"}),t.jsx(Da,{className:"text-slate-300",children:u.points>0?t.jsxs(t.Fragment,{children:["ë³´ìœ í•˜ì‹  ",t.jsxs("span",{className:"text-yellow-400 font-bold",children:[N(u.points),"P"]}),"ë¥¼ ë³´ìœ ê¸ˆìœ¼ë¡œ ì „í™˜í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"]}):t.jsx("span",{className:"text-slate-400",children:"ì „í™˜ ê°€ëŠ¥í•œ í¬ì¸íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤."})})]}),t.jsxs(Ia,{children:[t.jsx(Oa,{className:"bg-slate-700 text-white hover:bg-slate-600 border-slate-600",children:u.points>0?"ì·¨ì†Œ":"í™•ì¸"}),u.points>0&&t.jsx(Ta,{onClick:x,className:"bg-blue-600 text-white hover:bg-blue-700",children:"ì „í™˜í•˜ê¸°"})]})]})})]})}function $a({userId:e}){const[r,s]=p.useState(null),[n,u]=p.useState(!1),m=async()=>{try{const{data:a,error:i}=await j.from("messages").select("*").eq("receiver_type","user").eq("receiver_id",e).eq("sender_type","partner").eq("status","unread").is("parent_id",null).order("created_at",{ascending:!1}).limit(1).single();if(i&&i.code!=="PGRST116"){console.error("ë©”ì‹œì§€ ì¡°íšŒ ì˜¤ë¥˜:",i);return}a&&(s(a),u(!0))}catch(a){console.error("ë©”ì‹œì§€ í™•ì¸ ì˜¤ë¥˜:",a)}};p.useEffect(()=>{console.log("ğŸ”” ì‚¬ìš©ì ë©”ì‹œì§€ íŒì—… ì‹¤ì‹œê°„ êµ¬ë… ì‹œì‘:",e),m();const a=j.channel("user_message_popup").on("postgres_changes",{event:"INSERT",schema:"public",table:"messages",filter:`receiver_id=eq.${e}`},i=>{console.log("ğŸ“¨ ìƒˆ ë©”ì‹œì§€ ë„ì°©:",i);const o=i.new;o.sender_type==="partner"&&o.receiver_type==="user"&&!o.parent_id&&(s(o),u(!0))}).subscribe();return()=>{console.log("ğŸ”• ì‚¬ìš©ì ë©”ì‹œì§€ íŒì—… êµ¬ë… í•´ì œ"),j.removeChannel(a)}},[e]);const l=async()=>{if(r)try{const{error:a}=await j.from("messages").update({status:"read",read_at:new Date().toISOString()}).eq("id",r.id);if(a)throw a;D.success("ë©”ì‹œì§€ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤."),u(!1),s(null),setTimeout(()=>{m()},500)}catch(a){console.error("ë©”ì‹œì§€ ì½ìŒ ì²˜ë¦¬ ì˜¤ë¥˜:",a),D.error("ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}};return!n||!r?null:t.jsx("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center bg-black/70 backdrop-blur-sm animate-in fade-in duration-300",children:t.jsxs(Me,{className:"w-full max-w-lg mx-4 bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 border-2 border-yellow-500/50 shadow-2xl shadow-yellow-500/20",children:[t.jsx(Re,{className:"border-b border-yellow-500/30 bg-gradient-to-r from-yellow-600/20 to-red-600/20",children:t.jsx("div",{className:"flex items-center justify-between",children:t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"p-2 rounded-lg bg-gradient-to-br from-yellow-500 to-amber-600 shadow-lg",children:t.jsx(J,{className:"w-6 h-6 text-white"})}),t.jsxs("div",{children:[t.jsx(Le,{className:"text-xl text-white font-bold",children:"ğŸ“¢ ê´€ë¦¬ì ë©”ì‹œì§€"}),t.jsx("p",{className:"text-xs text-yellow-300 mt-1",children:new Date(r.created_at).toLocaleString("ko-KR")})]})]})})}),t.jsxs(Ue,{className:"pt-6 pb-6",children:[t.jsxs("div",{className:"mb-4",children:[t.jsx("div",{className:"text-sm text-yellow-400 font-medium mb-2",children:"ì œëª©"}),t.jsx("div",{className:"text-lg text-white font-semibold bg-slate-800/50 p-3 rounded-lg border border-slate-700",children:r.subject})]}),t.jsxs("div",{className:"mb-6",children:[t.jsx("div",{className:"text-sm text-yellow-400 font-medium mb-2",children:"ë‚´ìš©"}),t.jsx("div",{className:"text-base text-slate-200 bg-slate-800/50 p-4 rounded-lg border border-slate-700 min-h-[120px] whitespace-pre-wrap",children:r.content})]}),t.jsx("div",{className:"flex justify-end",children:t.jsx(U,{onClick:l,className:"bg-gradient-to-r from-yellow-600 to-red-600 hover:from-yellow-700 hover:to-red-700 text-white font-bold px-8 py-6 text-lg shadow-lg shadow-yellow-500/30 border border-yellow-400/50",children:"í™•ì¸"})}),t.jsx("div",{className:"mt-4 p-3 bg-blue-500/10 border border-blue-500/30 rounded-lg",children:t.jsx("p",{className:"text-xs text-blue-300 text-center",children:"ğŸ’¡ ë©”ì‹œì§€ë¥¼ í™•ì¸í•˜ì‹œë ¤ë©´ 'í™•ì¸' ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”."})})]})]})})}function Ma({user:e,currentRoute:r,onRouteChange:s,onLogout:n,children:u}){const m=p.useRef(new Set);p.useEffect(()=>(window.forceCloseGameWindow=a=>{const i=window.gameWindows,o=i?.get(a);return o&&!o.closed?(o.close(),i.delete(a),!0):!1},()=>{delete window.forceCloseGameWindow}),[]);const l=async a=>{if(m.current.has(a)){console.log(`âš ï¸ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] ì´ë¯¸ ì§„í–‰ ì¤‘: ì„¸ì…˜ ${a}`);return}try{m.current.add(a),console.log(`ğŸ’° [ë³´ìœ ê¸ˆ ë™ê¸°í™”] ì‹œì‘: ì„¸ì…˜ ${a}`),console.log(`ğŸ” [ë³´ìœ ê¸ˆ ë™ê¸°í™”] ì„¸ì…˜ ì¡°íšŒ ì‹œì‘: sessionId=${a}`);const{data:i,error:o}=await j.from("game_launch_sessions").select(`
          user_id,
          users(
            username,
            referrer_id,
            partners:referrer_id(opcode, api_token, secret_key, username)
          )
        `).eq("id",a).single();if(console.log("ğŸ” [ë³´ìœ ê¸ˆ ë™ê¸°í™”] ì„¸ì…˜ ì¡°íšŒ ê²°ê³¼:",{session:i,sessionError:o,hasUsers:!!i?.users}),o||!i||!i.users){console.error("âŒ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] ì„¸ì…˜ ì¡°íšŒ ì‹¤íŒ¨:",{sessionId:a,error:o,errorCode:o?.code,errorMessage:o?.message});return}const d=i.users.username,x=i.users.partners;if(console.log("ğŸ” [ë³´ìœ ê¸ˆ ë™ê¸°í™”] íŒŒì‹±ëœ ë°ì´í„°:",{username:d,partner:x,referrer_id:i.users.referrer_id}),!d){console.error("âŒ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] username ì—†ìŒ");return}if(!x||!x.opcode){console.error("âŒ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] partner ì •ë³´ ì—†ìŒ",{username:d,sessionId:a,referrer_id:i.users.referrer_id,partner:x});return}if(!x.api_token||!x.secret_key){console.error("âŒ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] API ì„¤ì • ë¶ˆì™„ì „",{opcode:x.opcode,hasApiToken:!!x.api_token,hasSecretKey:!!x.secret_key,apiTokenLength:x.api_token?.length||0,secretKeyLength:x.secret_key?.length||0}),console.error(`ğŸ’¡ í•´ê²° ë°©ë²•: partners í…Œì´ë¸”ì—ì„œ opcode='${x.opcode}'ì¸ ë ˆì½”ë“œì— api_tokenê³¼ secret_keyë¥¼ ì„¤ì •í•˜ì„¸ìš”.`),console.error(`SQL: UPDATE partners SET api_token = 'YOUR_TOKEN', secret_key = 'YOUR_SECRET' WHERE opcode = '${x.opcode}';`);return}console.log(`ğŸ’° [ë³´ìœ ê¸ˆ ì¡°íšŒ] API í˜¸ì¶œ: ${d} (opcode: ${x.opcode})`);const b=await Qe.getUserBalanceWithConfig(x.opcode,d,x.api_token,x.secret_key);if(b.success&&b.balance!==void 0){const{error:N}=await j.from("users").update({balance:b.balance,last_synced_at:new Date().toISOString()}).eq("id",i.user_id);N?console.error("âŒ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] DB ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",N):console.log(`âœ… [ë³´ìœ ê¸ˆ ë™ê¸°í™”] ì™„ë£Œ: ${d} = ${b.balance}ì›`)}else console.error("âŒ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] API ì¡°íšŒ ì‹¤íŒ¨:",b.error)}catch(i){console.error("âŒ [ë³´ìœ ê¸ˆ ë™ê¸°í™”] ì˜¤ë¥˜:",i)}finally{m.current.delete(a)}};return p.useEffect(()=>{if(!e?.id)return;console.log("ğŸš€ [ì„¸ì…˜ ê°ì§€] ì‹œì‘");const a=j.channel("user_session_monitor").on("postgres_changes",{event:"UPDATE",schema:"public",table:"game_launch_sessions",filter:`user_id=eq.${e.id}`},async i=>{const{new:o,old:d}=i;d?.status==="active"&&["ended","force_ended","auto_ended"].includes(o.status)&&(console.log("ğŸ›‘ [ì„¸ì…˜ ì¢…ë£Œ]",o.id,o.status),window.forceCloseGameWindow?.(o.id)&&o.status==="force_ended"?D.error("ê´€ë¦¬ìì— ì˜í•´ ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."):o.status==="auto_ended"&&D.info("4ë¶„ê°„ ë² íŒ…ì´ ì—†ì–´ ê²Œì„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."),await l(o.id))}).subscribe();return()=>{j.removeChannel(a)}},[e?.id]),p.useEffect(()=>{if(!e?.id)return;console.log("ğŸ‘¤ [ì˜¨ë¼ì¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§] ì‹œì‘:",e.id);const a=j.channel("user_online_status_monitor").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users",filter:`id=eq.${e.id}`},async i=>{const{new:o,old:d}=i;d?.is_online===!0&&o?.is_online===!1&&(console.log("âš ï¸ [ìë™ ë¡œê·¸ì•„ì›ƒ] 60íšŒ ë³´ìœ ê¸ˆ ì¡°íšŒ ì´ˆê³¼ë¡œ ì˜¤í”„ë¼ì¸ ì „í™˜ ê°ì§€"),console.log("ğŸšª [ìë™ ë¡œê·¸ì•„ì›ƒ] ì‹¤í–‰"),n())}).subscribe();return()=>{console.log("ğŸ‘¤ [ì˜¨ë¼ì¸ ìƒíƒœ ëª¨ë‹ˆí„°ë§] ì¢…ë£Œ"),j.removeChannel(a)}},[e?.id,n]),p.useEffect(()=>(window.syncBalanceAfterGame=async a=>{try{console.log("ğŸ”„ [ê²Œì„ì°½ ë‹«í˜] ì„¸ì…˜ ì¢…ë£Œ:",a);const{error:i}=await j.from("game_launch_sessions").update({status:"ended",ended_at:new Date().toISOString()}).eq("id",a).eq("status","active");if(i){console.error("âŒ [ì„¸ì…˜ ì¢…ë£Œ ì˜¤ë¥˜]:",i);return}await l(a)}catch(i){console.error("âŒ [ê²Œì„ì°½ ë‹«í˜ ì˜¤ë¥˜]:",i)}},()=>{delete window.syncBalanceAfterGame,m.current.clear()}),[e.id]),t.jsxs("div",{className:"min-h-screen casino-gradient-bg overflow-x-hidden",children:[t.jsx("div",{className:"absolute top-0 left-0 right-0 h-96 bg-gradient-to-b from-yellow-500/10 via-red-500/5 to-transparent pointer-events-none"}),t.jsx(Ba,{user:e,currentRoute:r,onRouteChange:s,onLogout:n}),t.jsx($a,{userId:e.id}),t.jsx("main",{className:"relative pb-32 lg:pb-4 pt-20 lg:pt-20 overflow-x-hidden",children:t.jsx("div",{className:"container mx-auto px-3 sm:px-4 lg:px-6 py-6 relative z-10 max-w-full",children:u})}),t.jsx("div",{className:"fixed bottom-0 left-0 right-0 h-32 bg-gradient-to-t from-black/50 to-transparent pointer-events-none z-0"})]})}const jt=p.lazy(()=>P(()=>import("./UserCasino-BBAmrC39.js"),__vite__mapDeps([42,1,43,6,3,4,29,7])).then(e=>({default:e.UserCasino}))),Ra=p.lazy(()=>P(()=>import("./UserSlot-jeYrPEzm.js"),__vite__mapDeps([44,1,43,6,3,4,29,7])).then(e=>({default:e.UserSlot}))),La=p.lazy(()=>P(()=>import("./UserDeposit-DkievO7t.js"),__vite__mapDeps([45,1,12,3,4,6,7])).then(e=>({default:e.UserDeposit}))),Ua=p.lazy(()=>P(()=>import("./UserWithdraw-CxLyhc04.js"),__vite__mapDeps([46,1,12,15,4,3,6,7])).then(e=>({default:e.UserWithdraw}))),za=p.lazy(()=>P(()=>import("./UserNotice-D6fKje6X.js"),__vite__mapDeps([47,1,15,4,3,6,48,7])).then(e=>({default:e.UserNotice}))),Fa=p.lazy(()=>P(()=>import("./UserSupport-CzixJL_v.js"),__vite__mapDeps([49,1,12,15,4,3,6,48,7])).then(e=>({default:e.UserSupport}))),qa=p.lazy(()=>P(()=>import("./UserProfile-CplwMn73.js"),__vite__mapDeps([50,1,15,4,3,6,7])).then(e=>({default:e.UserProfile}))),Va=p.lazy(()=>P(()=>import("./UserBettingHistory-CKMbqCEJ.js"),__vite__mapDeps([51,1,3,4,6,7])).then(e=>({default:e.UserBettingHistory}))),Ga=()=>t.jsx("div",{className:"flex items-center justify-center p-8",children:t.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-400"})}),ir=p.memo(({currentRoute:e,user:r,onRouteChange:s})=>{const n=()=>{switch(e){case"/user/casino":return t.jsx(jt,{user:r,onRouteChange:s});case"/user/slot":return t.jsx(Ra,{user:r,onRouteChange:s});case"/user/deposit":return t.jsx(La,{user:r,onRouteChange:s});case"/user/withdraw":return t.jsx(Ua,{user:r,onRouteChange:s});case"/user/notice":return t.jsx(za,{user:r,onRouteChange:s});case"/user/support":return t.jsx(Fa,{user:r,onRouteChange:s});case"/user/profile":return t.jsx(qa,{user:r,onRouteChange:s});case"/user/betting-history":return t.jsx(Va,{user:r});default:return t.jsx(jt,{user:r,onRouteChange:s})}};return t.jsx(p.Suspense,{fallback:t.jsx(Ga,{}),children:n()})});ir.displayName="UserRoutes";const lr=p.createContext(null);function tn(){const e=p.useContext(lr);if(!e)throw new Error("useMessageQueue must be used within a MessageQueueProvider");return e}const Nt=be.memo(({children:e,userType:r,userId:s})=>{const{sendMessage:n,lastMessage:u}=Ze(),[m,l]=p.useState([]),[a,i]=p.useState([]),[o,d]=p.useState(0),[x,b]=p.useState(!1),[N,w]=p.useState(null),y=p.useCallback(async()=>{if(r==="admin")try{const{data:f,error:S}=await j.from("message_queue").select("*").eq("status","pending").lte("scheduled_at",new Date().toISOString()).order("priority",{ascending:!0}).order("created_at",{ascending:!0}).limit(50);if(S)throw S;l(f||[])}catch(f){console.error("ëŒ€ê¸° ë©”ì‹œì§€ ì¡°íšŒ ì‹¤íŒ¨:",f)}},[r]),h=p.useCallback(async()=>{try{const{data:f,error:S}=await j.from("realtime_notifications").select("*").eq("recipient_type",r).eq("recipient_id",s).order("created_at",{ascending:!1}).limit(20);if(S)throw S;i(f||[]);const E=(f||[]).filter(C=>C.status!=="read").length;d(E)}catch(f){console.error("ì•Œë¦¼ ì¡°íšŒ ì‹¤íŒ¨:",f)}},[r,s]),c=p.useCallback(async(f,S,E=5)=>{try{if(!f||typeof f!="string")return console.error("Invalid message type:",f),!1;const C=f.includes("request")?"admin":"user",I=S.target_user_id||s,{data:T,error:B}=await j.rpc("add_to_message_queue",{p_message_type:f,p_sender_type:r,p_sender_id:s,p_target_type:C,p_target_id:I,p_subject:S.subject||`${f} ë©”ì‹œì§€`,p_message_data:S,p_reference_type:S.reference_type||null,p_reference_id:S.reference_id||null,p_priority:E});if(B)throw B;return n(f,{...S,queue_id:T,sender:{type:r,id:s},timestamp:new Date().toISOString()}),!0}catch(C){return console.error("ë©”ì‹œì§€ ì „ì†¡ ì‹¤íŒ¨:",C),!1}},[r,s,n]),g=p.useCallback(async()=>{if(!(r!=="admin"||x)){b(!0);try{const{data:f,error:S}=await j.rpc("process_message_queue");if(S)throw S;const E=f?.[0]?.processed_count||0;E>0&&(D.success(`${E}ê°œì˜ ë©”ì‹œì§€ë¥¼ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.`),await y(),await h()),w(new Date)}catch(f){console.error("ë©”ì‹œì§€ ì²˜ë¦¬ ì‹¤íŒ¨:",f),D.error("ë©”ì‹œì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}finally{b(!1)}}},[r,x,y,h]),k=p.useCallback(async f=>{try{const{error:S}=await j.rpc("mark_notification_as_read",{p_notification_id:f,p_recipient_id:s});if(S)throw S;i(E=>E.map(C=>C.id===f?{...C,status:"read",read_at:new Date().toISOString()}:C)),d(E=>Math.max(0,E-1))}catch(S){console.error("ì•Œë¦¼ ì½ìŒ ì²˜ë¦¬ ì‹¤íŒ¨:",S)}},[s]),v=p.useCallback(async()=>{try{const f=a.filter(S=>S.status!=="read");for(const S of f)await k(S.id);D.success("ëª¨ë“  ì•Œë¦¼ì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.")}catch(f){console.error("ì•Œë¦¼ ì¼ê´„ ì²˜ë¦¬ ì‹¤íŒ¨:",f),D.error("ì•Œë¦¼ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.")}},[a,k]);p.useEffect(()=>{if(!u)return;let f,S;if(u.type&&typeof u.type=="object"&&u.type.type)f=u.type.type,S=u.type.data||u.data||{};else if(typeof u.type=="string")f=u.type,S=u.data||{};else{console.error("Invalid message structure received:",u);return}if(!f||typeof f!="string"){console.error("Invalid message type received:",{messageType:f,messageData:S,lastMessage:u});return}if(console.log("ğŸ“¨ WebSocket ë©”ì‹œì§€ ìˆ˜ì‹  (ì •ê·œí™”ë¨):",{type:f,data:S}),(f.includes("request")||f.includes("approved")||f.includes("rejected")||f.includes("processed")||f.includes("completed"))&&(r==="admin"&&f.includes("request")||r==="user"&&(S.target_user_id===s||S.username===s))){const C=f.includes("request"),I=f.includes("approved")||f.includes("completed")||f.includes("processed")&&S.action==="approve"?"success":f.includes("rejected")||f.includes("processed")&&S.action==="reject"?"error":"info",T=f.includes("deposit")?"ì…ê¸ˆ ì•Œë¦¼":f.includes("withdrawal")?"ì¶œê¸ˆ ì•Œë¦¼":f.includes("transaction_processed")?"ê±°ë˜ ì²˜ë¦¬ ì•Œë¦¼":"ê±°ë˜ ì•Œë¦¼";let B="";if(f==="transaction_processed"){const{action:$,amount:V,newBalance:Z,processedBy:X}=S,pe=$==="approve"?"ìŠ¹ì¸":"ê±°ì ˆ",fe=V?`â‚©${Number(V).toLocaleString()}`:"",ge=Z!==void 0?`ì”ê³ : â‚©${Number(Z).toLocaleString()}`:"";B=`${pe}ë˜ì—ˆìŠµë‹ˆë‹¤. ${fe} ${ge} (ì²˜ë¦¬ì: ${X||"ì‹œìŠ¤í…œ"})`}I==="success"?D.success(T,{description:B||S.message||"ì²˜ë¦¬ê°€ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."}):I==="error"?D.error(T,{description:B||S.message||"ìš”ì²­ì´ ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤."}):D.info(T,{description:B||S.message||"ìƒˆë¡œìš´ ìš”ì²­ì´ ìˆìŠµë‹ˆë‹¤.",duration:C?8e3:4e3}),setTimeout(()=>{h(),r==="admin"&&y()},500)}},[u,r,s,h,y]),p.useEffect(()=>{const f=j.channel("user-notifications").on("postgres_changes",{event:"*",schema:"public",table:"realtime_notifications",filter:`recipient_type=eq.${r}`},E=>{E.new&&E.new.recipient_id===s&&h()}).subscribe();let S=null;return r==="admin"&&(S=j.channel("admin-message-queue").on("postgres_changes",{event:"*",schema:"public",table:"message_queue"},()=>{y()}).subscribe()),()=>{f.unsubscribe(),S&&S.unsubscribe()}},[r,s,h,y]),p.useEffect(()=>{h(),r==="admin"&&y()},[h,y,r]),p.useEffect(()=>{if(r!=="admin")return;const f=setInterval(()=>{m.length>0&&!x&&g()},6e4);return()=>clearInterval(f)},[r,m.length,x,g]);const A={pendingMessages:m,sendMessage:c,processMessages:g,notifications:a,unreadCount:o,markAsRead:k,clearAllNotifications:v,isProcessing:x,lastProcessed:N},_=be.useMemo(()=>A,[m,c,g,a,o,k,v,x,N]);return t.jsx(lr.Provider,{value:_,children:e})});function Wa(){const{authState:e,logout:r}=ve(),[,s]=p.useState({});p.useEffect(()=>{const o=()=>s({});return window.addEventListener("popstate",o),()=>window.removeEventListener("popstate",o)},[]);const n=o=>{window.history.pushState({},"",o),s({})},u=window.location.pathname;if(u==="/"||u==="")return window.history.replaceState({},"","/user"),window.location.pathname="/user",null;const m=u.startsWith("/user"),l=u.startsWith("/admin");if(m){const o=u,d=localStorage.getItem("user_session");let x=null;try{d&&(x=JSON.parse(d))}catch(w){console.error("ì‚¬ìš©ì ì„¸ì…˜ íŒŒì‹± ì˜¤ë¥˜:",w),localStorage.removeItem("user_session")}const b=!!x,N=async()=>{if(!x?.id){localStorage.removeItem("user_session"),window.history.replaceState({},"","/user"),s({});return}try{console.log("ğŸ”“ ì‚¬ìš©ì ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì‹œì‘:",x.id);const{error:w}=await j.from("users").update({is_online:!1,updated_at:new Date().toISOString()}).eq("id",x.id);w?console.error("âŒ is_online ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:",w):console.log("âœ… is_online = false ì—…ë°ì´íŠ¸ ì™„ë£Œ");const{error:y}=await j.from("user_sessions").update({is_active:!1,logout_at:new Date().toISOString()}).eq("user_id",x.id).eq("is_active",!0);y?console.error("âŒ user_sessions ì¢…ë£Œ ì˜¤ë¥˜:",y):console.log("âœ… user_sessions ì¢…ë£Œ ì™„ë£Œ"),console.log("â„¹ï¸ game_launch_sessionsëŠ” ê²Œì„ì°½ ë‹«í˜ ì‹œì—ë§Œ ì¢…ë£Œë¨ (ë¡œê·¸ì•„ì›ƒ ì‹œ ìœ ì§€)"),await j.from("activity_logs").insert([{actor_type:"user",actor_id:x.id,action:"logout",details:{username:x.username,logout_time:new Date().toISOString()}}]),console.log("âœ… ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì™„ë£Œ")}catch(w){console.error("âŒ ë¡œê·¸ì•„ì›ƒ ì²˜ë¦¬ ì˜¤ë¥˜:",w)}finally{localStorage.removeItem("user_session"),window.history.replaceState({},"","/user"),s({})}};return t.jsxs(t.Fragment,{children:[b?t.jsx(ht,{children:t.jsx(Nt,{userType:"user",userId:x.id,children:t.jsx(Ma,{user:x,currentRoute:o,onRouteChange:n,onLogout:N,children:t.jsx(ir,{currentRoute:o,user:x,onRouteChange:n})})})}):t.jsx(Na,{onLoginSuccess:w=>{localStorage.setItem("user_session",JSON.stringify(w)),window.history.replaceState({},"","/user/casino"),s({})}}),t.jsx(pt,{position:"top-right"})]})}const a=l&&u!=="/admin"&&u!=="/admin/"?u:"/admin/dashboard",i=e.isAuthenticated&&e.user;return t.jsxs(t.Fragment,{children:[i?t.jsx(ht,{children:t.jsx(Ds,{user:e.user,children:t.jsx(Nt,{userType:"admin",userId:e.user.id,children:t.jsx(Fs,{currentRoute:a,onNavigate:n,children:t.jsx(da,{currentRoute:a,user:e.user})})})})}):t.jsx(ms,{onLoginSuccess:()=>{window.history.replaceState({},"","/admin/dashboard"),s({})}}),t.jsx(pt,{position:"top-right"})]})}function Ka(){return t.jsx(zs,{children:t.jsx(Wa,{})})}dr.createRoot(document.getElementById("root")).render(t.jsx(Ka,{}));export{Ms as $,Qt as A,Rt as B,Me as C,$s as D,Je as E,Ke as F,Qe as G,O as H,z as I,ze as J,tn as K,F as L,Pa as M,Lt as N,Fe as O,Ut as P,ie as Q,He as R,ha as S,fa as T,en as U,ma as V,pa as W,we as X,M as Y,R as Z,Is as _,Re as a,Le as b,Y as c,Bt as d,Ue as e,ft as f,Za as g,te as h,U as i,ga as j,wt as k,yt as l,ns as m,ve as n,Ze as o,ba as p,xa as q,_a as r,j as s,wa as t,Cs as u,Ft as v,ue as w,me as x,Vt as y,Gt as z};

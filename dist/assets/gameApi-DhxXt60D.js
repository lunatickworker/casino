const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DBZ0Cn5g.js","assets/index-lVTNIJQg.css"])))=>i.map(i=>d[i]);
import{k as T,s as p,a2 as x,_ as U}from"./index-DBZ0Cn5g.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],K=T("star",z);async function I(){const{data:r,error:n}=await p.from("game_providers").select("*").eq("status","active").order("type",{ascending:!0}).order("name",{ascending:!0});if(n)throw console.error("ì œê³µì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",n),n;console.log(`ğŸ® ì œê³µì‚¬ ì¡°íšŒ ê²°ê³¼: ${r?.length||0}ê°œ`);const i=r?.filter(t=>t.type==="slot").length||0,e=r?.filter(t=>t.type==="casino").length||0;if(console.log(`  ğŸ“Š ìŠ¬ë¡¯: ${i}ê°œ, ì¹´ì§€ë…¸: ${e}ê°œ`),i<30||e<10){console.log("âš ï¸ ì œê³µì‚¬ ë°ì´í„°ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ìë™ ì´ˆê¸°í™”ë¥¼ ì‹œë„í•©ë‹ˆë‹¤..."),await O();const{data:t,error:l}=await p.from("game_providers").select("*").eq("status","active").order("type",{ascending:!0}).order("name",{ascending:!0});if(!l&&t){const a=t.filter(s=>s.type==="slot").length,d=t.filter(s=>s.type==="casino").length;return console.log(`âœ… ì¬ì¡°íšŒ ê²°ê³¼ - ìŠ¬ë¡¯: ${a}ê°œ, ì¹´ì§€ë…¸: ${d}ê°œ`),t}}return r||[]}async function L(r,n){let i,e;if(typeof r=="string"?(i=r,e=n||{}):e=r||{},console.log("ğŸ” getGames í˜¸ì¶œ:",{partnerId:i,filters:e}),i){const{data:s,error:m}=await p.rpc("get_games_with_partner_settings",{p_partner_id:i,p_game_type:e?.type||null,p_provider_id:e?.provider_id?parseInt(e.provider_id.toString()):null,p_search_term:e?.search||null,p_limit:1e4,p_offset:0});if(m)throw console.error("íŒŒíŠ¸ë„ˆë³„ ê²Œì„ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:",m),m;return console.log("âœ… íŒŒíŠ¸ë„ˆë³„ ê²Œì„ ì¡°íšŒ ì™„ë£Œ:",s?.length||0),(s||[]).map(c=>({id:c.id,provider_id:c.provider_id,name:c.name,type:c.type,status:c.custom_status||c.status,image_url:c.image_url,demo_available:c.demo_available,is_featured:c.custom_is_featured!==null&&c.custom_is_featured!==void 0?c.custom_is_featured:c.is_featured,priority:c.custom_priority!==null&&c.custom_priority!==void 0?c.custom_priority:c.priority,rtp:c.rtp,play_count:c.play_count,created_at:c.created_at,updated_at:c.updated_at,provider_name:c.provider_name}))}let t=p.from("games").select(`
      id,
      provider_id,
      name,
      type,
      status,
      image_url,
      demo_available,
      is_featured,
      priority,
      rtp,
      play_count,
      created_at,
      updated_at,
      game_providers!inner(
        id,
        name,
        type
      )
    `);e?.type&&(t=t.eq("type",e.type),t=t.eq("game_providers.type",e.type),console.log("ğŸ” íƒ€ì… í•„í„° ì ìš©:",e.type)),e?.provider_id&&(t=t.eq("provider_id",e.provider_id),console.log("ğŸ” ì œê³µì‚¬ í•„í„° ì ìš©:",e.provider_id)),e?.search&&(t=t.ilike("name",`%${e.search}%`),console.log("ğŸ” ê²€ìƒ‰ í•„í„° ì ìš©:",e.search)),e?.status&&(t=t.eq("status",e.status),console.log("ğŸ” ìƒíƒœ í•„í„° ì ìš©:",e.status)),e?.type==="casino"?t=t.order("provider_id"):t=t.order("name");const{data:l,error:a}=await t;if(a)throw console.error("ê²Œì„ ì¡°íšŒ ì˜¤ë¥˜:",a),a;console.log(`ğŸ” DBì—ì„œ ì¡°íšŒëœ ${e?.type||"ì „ì²´"} ê²Œì„:`,{ì´ê°œìˆ˜:l?.length||0,ìƒ˜í”Œ:l?.slice(0,3)});const d=(l||[]).map(s=>({id:s.id,provider_id:s.provider_id,name:s.name,type:s.type,status:s.status,image_url:s.image_url,demo_available:s.demo_available,is_featured:s.is_featured||!1,priority:s.priority||0,rtp:s.rtp,play_count:s.play_count||0,created_at:s.created_at,updated_at:s.updated_at,provider_name:s.game_providers?.name||"ì•Œ ìˆ˜ ì—†ìŒ"}));return console.log(`ğŸ” ìµœì¢… ${e?.type||"ì „ì²´"} ê²Œì„ ìˆ˜:`,d.length),d}async function N(r,n){const{error:i}=await p.from("games").update({status:n,updated_at:new Date().toISOString()}).eq("id",r);if(i)throw console.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:",i),i}async function C(r,n){console.log(`ğŸš€ Provider ${r} ë™ê¸°í™” ì‹œì‘`);const i=Date.now();let e=[];if(n&&n.length>0)e=n,console.log(`ğŸ“¥ ì œê³µëœ ê²Œì„ ë°ì´í„° ì‚¬ìš© - ì´ ${e.length}ê°œ ê²Œì„`);else{console.log(`ğŸ“¡ Provider ${r} API í˜¸ì¶œ ì‹œì‘`);const{investApi:_}=await U(async()=>{const{investApi:o}=await import("./index-DBZ0Cn5g.js").then(u=>u.a$);return{investApi:o}},__vite__mapDeps([0,1])),{data:g,error:f}=await p.from("partners").select("opcode, secret_key").eq("level",1).order("created_at",{ascending:!0}).limit(1).maybeSingle();if(f||!g)throw console.error("âŒ ì‹œìŠ¤í…œ ê´€ë¦¬ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨:",f),new Error("ì‹œìŠ¤í…œ ê´€ë¦¬ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");try{const o=await _.getGameList(g.opcode,r,g.secret_key);if(o.error)if(console.error(`âŒ Provider ${r} API í˜¸ì¶œ ì‹¤íŒ¨:`,o.error),o.error.includes("ê²Œì„ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤")||o.error.includes("ì§€ì›í•˜ì§€ ì•ŠëŠ”")||o.error.includes("ì˜ëª»ëœ signature")||o.error.includes("provider not found")||o.status===404||o.status===400)console.log(`âš ï¸ Provider ${r}ëŠ” ê²Œì„ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ê±°ë‚˜ ì§€ì›í•˜ì§€ ì•ŠëŠ” ì œê³µì‚¬ì…ë‹ˆë‹¤.`),e=[];else throw new Error(o.error);else if(o.data?.RESULT===!0&&Array.isArray(o.data?.DATA))e=o.data.DATA,console.log(`âœ… Provider ${r} API ì‘ë‹µ: ${e.length}ê°œ ê²Œì„ (ì´ë¯¸ image_url ì •ê·œí™”ë¨)`);else if(o.data?.RESULT===!1){const u=o.data?.message||"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";if(console.log(`âš ï¸ Provider ${r} API ì‘ë‹µ: ê²Œì„ ë¦¬ìŠ¤íŠ¸ ì—†ìŒ - ${u}`),u.includes("ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤")||u.includes("no games")||u.includes("empty")||u.includes("ì—†ìŒ"))e=[];else throw new Error(`API ì˜¤ë¥˜: ${u}`)}else console.log(`âš ï¸ Provider ${r} ì˜ˆìƒì¹˜ ëª»í•œ ì‘ë‹µ í˜•ì‹:`,o.data),e=[]}catch(o){console.error(`âŒ Provider ${r} API í˜¸ì¶œ ì¤‘ ì˜¤ë¥˜:`,o),e=[]}}console.log(`ğŸ“Š ë™ê¸°í™”í•  ê²Œì„ ìˆ˜: ${e.length}ê°œ`);const{data:t,error:l}=await p.from("game_providers").select("type").eq("id",r).maybeSingle();if(l||!t)throw console.error("ì œê³µì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",l),new Error(`ì œê³µì‚¬(ID: ${r}) ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`);const a=t.type,{data:d,error:s}=await p.from("games").select("id").eq("provider_id",r);if(s)throw console.error("ê¸°ì¡´ ê²Œì„ ì¡°íšŒ ì˜¤ë¥˜:",s),s;const m=new Set(d?.map(_=>_.id)||[]);console.log(`ğŸ“Š ê¸°ì¡´ ê²Œì„ ${m.size}ê°œ í™•ì¸ë¨`);const c=[],P=new Date().toISOString(),A=100;for(let _=0;_<e.length;_+=A){const f=e.slice(_,_+A).map((o,u)=>{const D=parseInt(o.id||o.game_id||o.gameId||o.ID);if(!D||isNaN(D))return null;let b="";o.game_title&&typeof o.game_title=="string"&&o.game_title.trim()?b=o.game_title.trim():o.name&&typeof o.name=="string"&&o.name.trim()?b=o.name.trim():o.game_name&&typeof o.game_name=="string"&&o.game_name.trim()?b=o.game_name.trim():o.gameName&&typeof o.gameName=="string"&&o.gameName.trim()?b=o.gameName.trim():o.title&&typeof o.title=="string"&&o.title.trim()?b=o.title.trim():b=`Game ${D}`;const $=o.image_url||null,k=!!(o.demo_available||o.demoAvailable||o.demo);return{id:D,provider_id:r,name:b,type:a,status:"visible",image_url:$?String($):null,demo_available:k,created_at:P,updated_at:P,isExisting:m.has(D)}}).filter(o=>o!==null);c.push(...f)}console.log(`âœ… ì²˜ë¦¬ëœ ê²Œì„ ìˆ˜: ${c.length}ê°œ`);const h=c.filter(_=>!_.isExisting),y=c.filter(_=>_.isExisting);console.log(`ğŸ“ˆ ì‹ ê·œ ê²Œì„: ${h.length}ê°œ, ì—…ë°ì´íŠ¸ ëŒ€ìƒ: ${y.length}ê°œ`);let E=0,w=0;if(h.length>0){const _=h.map(({isExisting:f,...o})=>o),g=500;for(let f=0;f<_.length;f+=g){const o=_.slice(f,f+g),{error:u}=await p.from("games").insert(o);if(u)throw console.error(`ê²Œì„ ì¶”ê°€ ì˜¤ë¥˜ (ì²­í¬ ${Math.floor(f/g)+1}):`,u),u}E=h.length,console.log(`âœ… ${E}ê°œ ì‹ ê·œ ê²Œì„ ì¶”ê°€ ì™„ë£Œ`)}if(y.length>0){for(let g=0;g<y.length;g+=100){const o=y.slice(g,g+100).map(async D=>{const{isExisting:b,...$}=D,{error:k}=await p.from("games").update({name:$.name,image_url:$.image_url,demo_available:$.demo_available,updated_at:$.updated_at}).eq("id",$.id).eq("provider_id",r);return k?(console.error(`ê²Œì„ ${$.id} ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:`,k),!1):!0}),u=await Promise.all(o);w+=u.filter(Boolean).length}console.log(`âœ… ${w}ê°œ ê¸°ì¡´ ê²Œì„ ì—…ë°ì´íŠ¸ ì™„ë£Œ`)}const S=((Date.now()-i)/1e3).toFixed(1),G={newGames:E,updatedGames:w,totalGames:c.length};return console.log(`ğŸ¯ Provider ${r} ë™ê¸°í™” ì™„ë£Œ (${S}ì´ˆ):`,G),G}async function O(){console.log("ğŸ”§ ê²Œì„ ì œê³µì‚¬ ë°ì´í„° ì´ˆê¸°í™” ì‹œì‘...");const n=[{id:1,name:"ë§ˆì´í¬ë¡œê²Œì´ë°",type:"slot"},{id:17,name:"í”Œë ˆì´ì•¤ê³ ",type:"slot"},{id:20,name:"CQ9 ê²Œì´ë°",type:"slot"},{id:21,name:"ì œë„¤ì‹œìŠ¤ ê²Œì´ë°",type:"slot"},{id:22,name:"í•˜ë°”ë„¤ë¡œ",type:"slot"},{id:23,name:"ê²Œì„ì•„íŠ¸",type:"slot"},{id:27,name:"í”Œë ˆì´í…",type:"slot"},{id:38,name:"ë¸”ë£¨í”„ë¦°íŠ¸",type:"slot"},{id:39,name:"ë¶€ìš´ê³ ",type:"slot"},{id:40,name:"ë“œë¼êµ°ì†Œí”„íŠ¸",type:"slot"},{id:41,name:"ì—˜í¬ ìŠ¤íŠœë””ì˜¤",type:"slot"},{id:47,name:"ë“œë¦¼í…Œí¬",type:"slot"},{id:51,name:"ì¹¼ëŒë°” ê²Œì„ì¦ˆ",type:"slot"},{id:52,name:"ëª¨ë¹Œë¡¯",type:"slot"},{id:53,name:"ë…¸ë¦¬ë°‹ ì‹œí‹°",type:"slot"},{id:55,name:"OMI ê²Œì´ë°",type:"slot"},{id:56,name:"ì›í„°ì¹˜",type:"slot"},{id:59,name:"í”Œë ˆì´ìŠ¨",type:"slot"},{id:60,name:"í‘¸ì‰¬ ê²Œì´ë°",type:"slot"},{id:61,name:"í€µìŠ¤í•€",type:"slot"},{id:62,name:"RTG ìŠ¬ë¡¯",type:"slot"},{id:63,name:"ë¦¬ë³¼ë²„ ê²Œì´ë°",type:"slot"},{id:65,name:"ìŠ¬ë¡¯ë°€",type:"slot"},{id:66,name:"ìŠ¤í”¼ì–´í—¤ë“œ",type:"slot"},{id:70,name:"ì¬ë”í‚¥",type:"slot"},{id:72,name:"ìš°í›„ ê²Œì„ì¦ˆ",type:"slot"},{id:74,name:"ë¦´ë ‰ìŠ¤ ê²Œì´ë°",type:"slot"},{id:75,name:"ë„·ì—”íŠ¸",type:"slot"},{id:76,name:"ë ˆë“œíƒ€ì´ê±°",type:"slot"},{id:87,name:"PGì†Œí”„íŠ¸",type:"slot"},{id:88,name:"í”Œë ˆì´ìŠ¤íƒ€",type:"slot"},{id:90,name:"ë¹…íƒ€ì„ê²Œì´ë°",type:"slot"},{id:300,name:"í”„ë¼ê·¸ë§ˆí‹± í”Œë ˆì´",type:"slot"},{id:410,name:"ì—ë³¼ë£¨ì…˜ ê²Œì´ë°",type:"casino"},{id:77,name:"ë§ˆì´í¬ë¡œ ê²Œì´ë°",type:"casino"},{id:2,name:"Vivo ê²Œì´ë°",type:"casino"},{id:30,name:"ì•„ì‹œì•„ ê²Œì´ë°",type:"casino"},{id:78,name:"í”„ë¼ê·¸ë§ˆí‹±í”Œë ˆì´",type:"casino"},{id:86,name:"ì„¹ì‹œê²Œì´ë°",type:"casino"},{id:11,name:"ë¹„ë¹„ì•„ì´ì—”",type:"casino"},{id:28,name:"ë“œë¦¼ê²Œì„",type:"casino"},{id:89,name:"ì˜¤ë¦¬ì—”íƒˆê²Œì„",type:"casino"},{id:91,name:"ë³´íƒ€",type:"casino"},{id:44,name:"ì´ì£¼ê¸°",type:"casino"},{id:85,name:"í”Œë ˆì´í… ë¼ì´ë¸Œ",type:"casino"},{id:0,name:"ì œë„¤ëŸ´ ì¹´ì§€ë…¸",type:"casino"}].map(t=>({id:t.id,name:t.name,type:t.type,status:"active",created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),i=20;let e=0;for(let t=0;t<n.length;t+=i){const l=n.slice(t,t+i),{error:a}=await p.from("game_providers").upsert(l,{onConflict:"id",ignoreDuplicates:!1});a?console.error(`ì œê³µì‚¬ ë°°ì¹˜ ${Math.floor(t/i)+1} ì‚½ì… ì˜¤ë¥˜:`,a):e+=l.length}console.log(`âœ… ì œê³µì‚¬ ë°ì´í„° ì´ˆê¸°í™” ì™„ë£Œ: ${e}ê°œ ì²˜ë¦¬`)}async function R(){console.log("ğŸ° ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ ì´ˆê¸°í™” ì‹œì‘");const{data:r,error:n}=await p.from("game_providers").select("id, name").eq("type","casino");if(n){console.error("ì¹´ì§€ë…¸ ì œê³µì‚¬ ì¡°íšŒ ì˜¤ë¥˜:",n);return}if(!r||r.length===0){console.log("ì¹´ì§€ë…¸ ì œê³µì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.");return}const i=[{id:41e4,provider_id:410,name:"ì—ë³¼ë£¨ì…˜ ê²Œì´ë° ë¡œë¹„"},{id:77060,provider_id:77,name:"ë§ˆì´í¬ë¡œ ê²Œì´ë° ë¡œë¹„"},{id:2029,provider_id:2,name:"Vivo ê²Œì´ë° ë¡œë¹„"},{id:3e4,provider_id:30,name:"ì•„ì‹œì•„ ê²Œì´ë° ë¡œë¹„"},{id:78001,provider_id:78,name:"í”„ë¼ê·¸ë§ˆí‹±í”Œë ˆì´ ë¡œë¹„"},{id:86001,provider_id:86,name:"ì„¹ì‹œê²Œì´ë° ë¡œë¹„"},{id:11e3,provider_id:11,name:"ë¹„ë¹„ì•„ì´ì—” ë¡œë¹„"},{id:28e3,provider_id:28,name:"ë“œë¦¼ê²Œì„ ë¡œë¹„"},{id:89e3,provider_id:89,name:"ì˜¤ë¦¬ì—”íƒˆê²Œì„ ë¡œë¹„"},{id:91e3,provider_id:91,name:"ë³´íƒ€ ë¡œë¹„"},{id:44006,provider_id:44,name:"ì´ì£¼ê¸° ë¡œë¹„"},{id:85036,provider_id:85,name:"í”Œë ˆì´í… ë¼ì´ë¸Œ ë¡œë¹„"},{id:0,provider_id:0,name:"ì œë„¤ëŸ´ ì¹´ì§€ë…¸ ë¡œë¹„"}],{data:e}=await p.from("games").select("id").eq("type","casino"),t=new Set(e?.map(a=>a.id)||[]),l=i.filter(a=>!t.has(a.id)&&r.some(d=>d.id===a.provider_id));if(l.length>0){const a=l.map(s=>({id:s.id,provider_id:s.provider_id,name:s.name,type:"casino",status:"visible",demo_available:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString()})),{error:d}=await p.from("games").insert(a);d?console.error("ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ ì¶”ê°€ ì˜¤ë¥˜:",d):console.log(`âœ… ${l.length}ê°œ ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ ì¶”ê°€ ì™„ë£Œ`)}else console.log("âœ… ì¹´ì§€ë…¸ ë¡œë¹„ ê²Œì„ì´ ì´ë¯¸ ëª¨ë‘ ì¡´ì¬í•©ë‹ˆë‹¤.")}async function B(r,n,i,e,t,l,a,d){const{data:s,error:m}=await p.rpc("save_game_sync_result",{p_provider_id:r,p_opcode:n,p_sync_type:i,p_games_added:e,p_games_updated:t,p_games_removed:l,p_error_message:a,p_sync_duration:d});if(m)throw console.error("ë™ê¸°í™” ê²°ê³¼ ì €ì¥ ì˜¤ë¥˜:",m),m;return s}async function M(r,n,i,e,t=50,l=0){const{data:a,error:d}=await p.rpc("get_user_visible_games",{p_user_id:r,p_game_type:n,p_provider_id:i,p_search_term:e,p_limit:t,p_offset:l});if(d)throw console.error("ì‚¬ìš©ì ê²Œì„ ëª©ë¡ ì¡°íšŒ ì˜¤ë¥˜:",d),d;return a||[]}async function V(r,n,i,e,t){const{data:l,error:a}=await p.rpc("update_game_status_for_partner",{p_partner_id:r,p_game_id:n,p_status:i,p_priority:e,p_is_featured:t});if(a)throw console.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:",a),a;return l}async function q(r,n){try{console.log("ğŸ® ê²Œì„ ì‹¤í–‰ ìš”ì²­ ì‹œì‘:",{userId:r,gameId:n,userIdType:typeof r}),console.log("ğŸ” ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹œì‘:",{userId:r,userIdType:typeof r});const{data:i,error:e}=await p.from("users").select("username, balance").eq("id",r).single();if(console.log("ğŸ” ì‚¬ìš©ì ì¡°íšŒ ê²°ê³¼:",{userData:i,userError:e}),e)throw console.error("âŒ ì‚¬ìš©ì ì¡°íšŒ ì˜¤ë¥˜:",{error:e,message:e.message,details:e.details,hint:e.hint,code:e.code}),new Error(`ì‚¬ìš©ì ì •ë³´ ì¡°íšŒ ì‹¤íŒ¨: ${e.message}`);if(!i)throw console.error("âŒ ì‚¬ìš©ì ë°ì´í„° ì—†ìŒ:",{userId:r}),new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");console.log("ğŸ” OPCODE ì •ë³´ ì¡°íšŒ ì‹œì‘:",{userId:r});const{data:t,error:l}=await p.rpc("get_user_opcode_info",{user_id:r});console.log("ğŸ” OPCODE ì¡°íšŒ ê²°ê³¼:",{opcodeData:t,opcodeError:l});let a,d,s;if(l||!t||!t.success){console.error("âŒ OPCODE ì¡°íšŒ ì‹¤íŒ¨:",t?.error||l?.message),console.log("ğŸ”„ ì‹œìŠ¤í…œ ê´€ë¦¬ì OPCODEë¡œ fallback");const{data:S,error:G}=await p.from("partners").select("opcode, secret_key").eq("level",1).order("created_at",{ascending:!0}).limit(1).maybeSingle();if(G||!S)throw new Error("ì‹œìŠ¤í…œ OPCODE ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");a=S.opcode,d=S.secret_key,s="153b28230ef1c40c11ff526e9da93e2b"}else a=t.opcode,d=t.secret_key,s=t.api_token;const{username:m,balance:c}=i;if(!a||!d||!s)throw new Error("ê²Œì„ ì‹¤í–‰ì— í•„ìš”í•œ API ì •ë³´ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.");console.log("ğŸ“Š API í˜¸ì¶œ ì •ë³´:",{username:m,balance:c,opcode:a,secret_key:d?"***"+d.slice(-4):"null",token:s?"***"+s.slice(-4):"null"});const{data:P,error:A}=await p.from("games").select("id, name, external_game_id").eq("id",n).maybeSingle();if(A||!P)throw new Error("ê²Œì„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");let h=P.external_game_id;(!h||h===null||h==="")&&(h=P.id),console.log("ğŸ® investApi.launchGame í˜¸ì¶œ:",{opcode:a,username:m,token:s?"***"+s.slice(-4):"null",gameId:h,secret_key:d?"***"+d.slice(-4):"null"});const y=await x.launchGame(a,m,s,h,d);if(console.log("ğŸ® investApi.launchGame ê²°ê³¼:",y),!y.success)throw new Error(y.error||"ê²Œì„ ì‹¤í–‰ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");const E=y.data?.game_url||y.data?.url||y.data?.launch_url||"";if(!E)throw console.error("âŒ ê²Œì„ URLì„ ì°¾ì„ ìˆ˜ ì—†ìŒ:",y),new Error(y.error||"ê²Œì„ ì‹¤í–‰ URLì„ ë°›ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.");console.log("âœ… ê²Œì„ URL íšë“:",E),console.log("ğŸ’¾ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì‹œì‘:",{userId:r,gameId:n,opcode:a,balance:c});const{data:w,error:v}=await p.rpc("save_game_launch_session",{p_user_id:r,p_game_id:n,p_opcode:a,p_launch_url:E,p_session_token:y.data?.token||null,p_balance_before:c||0});if(v){if(console.error("âŒ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì˜¤ë¥˜:",v),console.error("âŒ ì˜¤ë¥˜ ìƒì„¸:",{code:v.code,message:v.message,details:v.details,hint:v.hint}),v.message&&v.message.includes("30ì´ˆ"))return{success:!1,error:v.message,sessionId:null}}else if(w==null)console.error("âš ï¸ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨: sessionIdê°€ nullì…ë‹ˆë‹¤!"),console.error("âš ï¸ í•¨ìˆ˜ê°€ ì—ëŸ¬ë¥¼ ë°˜í™˜í•˜ì§€ ì•Šì•˜ì§€ë§Œ ì„¸ì…˜ IDê°€ nullì…ë‹ˆë‹¤."),console.error("âš ï¸ Supabase ë¡œê·¸ë¥¼ í™•ì¸í•˜ì„¸ìš”: https://nzuzzmaiuybzyndptaba.supabase.co/project/_/logs/postgres-logs");else if(console.log("âœ… ê²Œì„ ì„¸ì…˜ ì €ì¥ ì„±ê³µ! Session ID:",w),typeof window.startSessionMonitor=="function")try{window.startSessionMonitor(w,r),console.log("ğŸ¯ ì„¸ì…˜ ëª¨ë‹ˆí„°ë§ ì‹œì‘ ìš”ì²­ ì™„ë£Œ")}catch(S){console.error("âš ï¸ ì„¸ì…˜ ëª¨ë‹ˆí„°ë§ ì‹œì‘ ì˜¤ë¥˜:",S)}return{success:!0,launchUrl:E,sessionId:w||null}}catch(i){console.error("âŒ ê²Œì„ ì‹¤í–‰ ì˜¤ë¥˜:",i);const e=i instanceof Error?i.message:"ê²Œì„ ì‹¤í–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";return console.error("ğŸ“ ë°˜í™˜í•  ì˜¤ë¥˜ ë©”ì‹œì§€:",e),{success:!1,error:e,sessionId:null}}finally{console.log("ğŸ”š ê²Œì„ ì‹¤í–‰ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ")}}async function j(r){console.log("ğŸ”„ ëª¨ë“  ì œê³µì‚¬ ê²Œì„ ë™ê¸°í™” ì‹œì‘");const n=[];try{const{data:i,error:e}=await p.from("game_providers").select("id, name, type").eq("type","slot").eq("status","active");if(e)throw e;const t=r||"system_admin";for(const s of i||[])try{console.log(`ğŸ® ${s.name} (ID: ${s.id}) ë™ê¸°í™” ì‹œì‘`);const m=await C(s.id);n.push({providerId:s.id,providerName:s.name,gamesAdded:m.newGames||0,gamesUpdated:m.updatedGames||0}),await new Promise(c=>setTimeout(c,1e3))}catch(m){console.error(`âŒ ${s.name} ë™ê¸°í™” ì‹¤íŒ¨:`,m),n.push({providerId:s.id,providerName:s.name,gamesAdded:0,gamesUpdated:0,error:m instanceof Error?m.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜"})}const l=n.reduce((s,m)=>s+m.gamesAdded,0),a=n.reduce((s,m)=>s+m.gamesUpdated,0),d=n.filter(s=>s.error).length;return console.log("âœ… ì „ì²´ ë™ê¸°í™” ì™„ë£Œ"),console.log(`ğŸ“Š ê²°ê³¼: ì‹ ê·œ ${l}ê°œ, ì—…ë°ì´íŠ¸ ${a}ê°œ, ì‹¤íŒ¨ ${d}ê°œ`),{success:d===0,results:n}}catch(i){return console.error("âŒ ì „ì²´ ë™ê¸°í™” ì‹¤íŒ¨:",i),{success:!1,results:n}}}async function F(r,n,i,e,t,l){try{const{data:a,error:d}=await p.rpc("save_game_session",{p_session_id:r,p_user_id:n,p_username:i,p_game_id:e,p_provider_id:t,p_launch_url:l||null});return d?(console.error("âŒ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì‹¤íŒ¨:",d),null):(console.log("âœ… ê²Œì„ ì„¸ì…˜ ì €ì¥ ì™„ë£Œ:",a),a)}catch(a){return console.error("âŒ ê²Œì„ ì„¸ì…˜ ì €ì¥ ì˜¤ë¥˜:",a),null}}async function Q(r,n,i){try{const{data:e,error:t}=await p.rpc("update_game_session_status",{p_session_id:r,p_status:n,p_ended_at:i||null});return t?(console.error("âŒ ê²Œì„ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",t),!1):(console.log("âœ… ê²Œì„ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì™„ë£Œ:",{sessionId:r,status:n}),e)}catch(e){return console.error("âŒ ê²Œì„ ì„¸ì…˜ ìƒíƒœ ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:",e),!1}}async function H(r,n,i=0,e=!0,t){try{const{data:l,error:a}=await p.rpc("log_game_sync",{p_sync_type:r,p_provider_id:n||null,p_records_count:i,p_success:e,p_error_message:t||null});return a?(console.error("âŒ ê²Œì„ ë™ê¸°í™” ë¡œê·¸ ê¸°ë¡ ì‹¤íŒ¨:",a),null):l}catch(l){return console.error("âŒ ê²Œì„ ë™ê¸°í™” ë¡œê·¸ ê¸°ë¡ ì˜¤ë¥˜:",l),null}}const W={getProviders:I,getGames:L,updateGameStatus:N,syncGamesFromAPI:C,initializeGameProviders:O,initializeCasinoLobbyGames:R,saveSyncResult:B,getUserVisibleGames:M,updateGameStatusForPartner:V,generateGameLaunchUrl:q,launchGame:q,syncAllProviderGames:j,saveGameSession:F,updateGameSessionStatus:Q,logGameSync:H};export{K as S,W as g};

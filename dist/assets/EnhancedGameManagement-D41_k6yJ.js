import{r as i,j as e}from"./react-core-CwM-CeLv.js";import{M as ne,i as b,C as ie,a as ce,b as oe,e as de,T as me,j as ue,k as F,I as xe,S as H,p as K,q as Q,r as W,t as v,B as G,N as he,O as fe,P as pe,Q as $}from"./index-XNFiaZD4.js";import{D as je}from"./DataTable-CpNEyjEM.js";import{k as m}from"./vendor-CQn7sZ7L.js";import{g as N}from"./gameApi-3VMNuz_n.js";import{M as k}from"./MetricCard-gDtl4jB5.js";import{Z as ge,R as P,m as T,E as A,z as D,ai as z,G as J,K as be,N as ve,aj as Ne}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";function Ee({user:f}){const[u,X]=i.useState("casino"),[x,R]=i.useState([]),[h,Y]=i.useState([]),[y,w]=i.useState(!1),[d,E]=i.useState(""),[l,S]=i.useState("all"),[c,M]=i.useState("all"),[p,I]=i.useState(new Set),[g,B]=i.useState(!1),[ee,V]=i.useState([]),[se,U]=i.useState(!1),{sendMessage:q,isConnected:O}=ne(),L=i.useMemo(()=>x.filter(s=>!(s.type!==u||d&&!s.name.toLowerCase().includes(d.toLowerCase())&&!s.provider_name?.toLowerCase().includes(d.toLowerCase())||l!=="all"&&s.provider_id.toString()!==l||c!=="all"&&s.status!==c)),[x,u,d,l,c]);i.useEffect(()=>{ae()},[]),i.useEffect(()=>{O&&q({type:"subscribe",channel:"game_status_updates",userId:f.id})},[O,f.id]);const ae=async()=>{try{w(!0);const s=await N.getProviders();Y(s),await N.initializeCasinoLobbyGames(),await j("casino")}catch(s){console.error("ì´ˆê¸° ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",s),m.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{w(!1)}},j=async s=>{try{w(!0);const t=s||u,a={type:t==="casino"?"casino":"slot"};l!=="all"&&(a.provider_id=parseInt(l),console.log("ğŸ” ì œê³µì‚¬ í•„í„° ì ìš©:",l,"â†’",a.provider_id)),c!=="all"&&(a.status=c,console.log("ğŸ” ìƒíƒœ í•„í„° ì ìš©:",c)),d.trim()&&(a.search=d.trim(),console.log("ğŸ” ê²€ìƒ‰ì–´ í•„í„° ì ìš©:",d.trim())),console.log("ğŸ® EnhancedGameManagement - loadGames í˜¸ì¶œ:",{gameType:t,partnerId:f.id,filters:a});const r=await N.getGames(f.id,a);console.log("ğŸ® EnhancedGameManagement - ë¡œë“œëœ ê²Œì„:",{ì „ì²´ê°œìˆ˜:r.length,íƒ­:t,ì œê³µì‚¬í•„í„°:l!=="all"?l:"ì „ì²´",ìƒ˜í”Œ:r.slice(0,5).map(n=>({id:n.id,name:n.name,provider_id:n.provider_id,provider_name:n.provider_name,type:n.type}))}),R(r);const o=r.filter(n=>!(l!=="all"&&n.provider_id.toString()!==l||c!=="all"&&n.status!==c||d&&!n.name.toLowerCase().includes(d.toLowerCase()))).length;console.log("âœ… í•„í„°ë§ í›„ í‘œì‹œë  ê²Œì„ ìˆ˜:",o)}catch(t){console.error("ê²Œì„ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",t),m.error("ê²Œì„ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{w(!1)}},te=async s=>{X(s),S("all"),M("all"),E(""),await j(s)};i.useEffect(()=>{const s=setTimeout(()=>{h.length>0&&!g&&p.size===0&&j()},300);return()=>clearTimeout(s)},[d,c]),i.useEffect(()=>{h.length>0&&!g&&p.size===0&&j()},[l]);const C=async(s,t,a,r)=>{try{await N.updateGameStatusForPartner(f.id,s,t,a,r),q({type:"game_status_update",partnerId:f.id,gameId:s,status:t,priority:a,isFeatured:r,updatedBy:f.id}),R(o=>o.map(n=>n.id===s?{...n,status:t,priority:a||n.priority,is_featured:r||n.is_featured}:n)),m.success("ê²Œì„ ìƒíƒœê°€ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.")}catch(o){console.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨:",o),m.error("ê²Œì„ ìƒíƒœ ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}},Z=async s=>{const t=h.find(a=>a.id===s);if(!t){m.error("ì œê³µì‚¬ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(t.type==="casino"){m.info("ì¹´ì§€ë…¸ëŠ” ë¡œë¹„ ì§„ì… ë°©ì‹ìœ¼ë¡œ ê²Œì„ ëª©ë¡ì´ ì—†ìŠµë‹ˆë‹¤.");return}if(p.has(s)){m.warning("ì´ë¯¸ ë™ê¸°í™”ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");return}I(a=>new Set([...a,s]));try{console.log(`ğŸ”„ ${t.name} (ID: ${s}) ë™ê¸°í™” ì‹œì‘`);const a=await N.syncGamesFromAPI(s);a.newGames===0&&a.updatedGames===0&&a.totalGames===0?m.info(`${t.name}: ê²Œì„ ë¦¬ìŠ¤íŠ¸ê°€ ì—†ê±°ë‚˜ ì§€ì›í•˜ì§€ ì•ŠëŠ” ì œê³µì‚¬ì…ë‹ˆë‹¤.`,{description:"ì¹´ì§€ë…¸ ì œê³µì‚¬ëŠ” ë¡œë¹„ ì§„ì… ë°©ì‹ì„ ì‚¬ìš©í•˜ê±°ë‚˜, ì¼ë¶€ ìŠ¬ë¡¯ ì œê³µì‚¬ëŠ” ê²Œì„ ëª©ë¡ì„ ì œê³µí•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤."}):(m.success(`${t.name} ë™ê¸°í™” ì™„ë£Œ: ì‹ ê·œ ${a.newGames}ê°œ, ì—…ë°ì´íŠ¸ ${a.updatedGames}ê°œ`,{description:`ì´ ${a.totalGames}ê°œ ê²Œì„ ì²˜ë¦¬ë¨`}),console.log(`âœ… ë™ê¸°í™” ì™„ë£Œ, ì œê³µì‚¬ í•„í„° ìë™ ì„¤ì •: ${s}`),S(s.toString())),await j()}catch(a){console.error(`${t.name} ë™ê¸°í™” ì‹¤íŒ¨:`,a);const r=a instanceof Error?a.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜";m.error(`${t.name} ë™ê¸°í™” ì‹¤íŒ¨`,{description:r})}finally{I(a=>{const r=new Set(a);return r.delete(s),r})}},le=async()=>{if(g){m.warning("ì´ë¯¸ ì „ì²´ ë™ê¸°í™”ê°€ ì§„í–‰ ì¤‘ì…ë‹ˆë‹¤.");return}B(!0),V([]),U(!0);try{const s=await N.syncAllProviderGames();V(s.results);const t=s.results.reduce((o,n)=>o+n.gamesAdded,0),a=s.results.reduce((o,n)=>o+n.gamesUpdated,0),r=s.results.filter(o=>o.error).length;s.success?m.success(`ì „ì²´ ë™ê¸°í™” ì™„ë£Œ: ì‹ ê·œ ${t}ê°œ, ì—…ë°ì´íŠ¸ ${a}ê°œ`):m.warning(`ë™ê¸°í™” ì™„ë£Œ (ì¼ë¶€ ì‹¤íŒ¨): ì‹ ê·œ ${t}ê°œ, ì—…ë°ì´íŠ¸ ${a}ê°œ, ì‹¤íŒ¨ ${r}ê°œ`),await j()}catch(s){console.error("ì „ì²´ ë™ê¸°í™” ì‹¤íŒ¨:",s),m.error("ì „ì²´ ë™ê¸°í™”ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{B(!1)}},_=i.useMemo(()=>({visible:x.filter(s=>s.status==="visible"&&s.type===u).length,hidden:x.filter(s=>s.status==="hidden"&&s.type===u).length,maintenance:x.filter(s=>s.status==="maintenance"&&s.type===u).length,featured:x.filter(s=>s.is_featured&&s.type===u).length}),[x,u]),re=[{header:"ê²Œì„ ì •ë³´",accessor:"name",cell:s=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsxs("div",{className:"relative w-12 h-12 flex-shrink-0",children:[s.image_url?e.jsx("img",{src:s.image_url,alt:s.name,className:"w-full h-full rounded-lg object-cover bg-slate-100 dark:bg-slate-800",onError:t=>{const a=t.target;a.style.display="none";const r=a.parentElement;if(r&&!r.querySelector(".game-image-placeholder")){const o=document.createElement("div");o.className="game-image-placeholder w-full h-full rounded-lg text-xs",o.textContent="ğŸ®",r.appendChild(o)}}}):e.jsx("div",{className:"game-image-placeholder w-full h-full rounded-lg text-xs",children:"ğŸ®"}),s.is_featured&&e.jsx(z,{className:"absolute -top-1 -right-1 w-4 h-4 text-yellow-500 fill-current"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"font-medium truncate",children:s.name}),e.jsxs("div",{className:"text-sm text-muted-foreground truncate",children:[s.provider_name," ",s.rtp&&`â€¢ RTP ${s.rtp}%`]})]})]})},{header:"ìƒíƒœ",accessor:"status",cell:s=>{const a={visible:{label:"ë…¸ì¶œ",variant:"default",icon:T},hidden:{label:"ë¹„ë…¸ì¶œ",variant:"secondary",icon:A},maintenance:{label:"ì ê²€ì¤‘",variant:"destructive",icon:D}}[s.status],r=a?.icon||T;return e.jsxs(G,{variant:a?.variant||"default",className:"gap-1",children:[e.jsx(r,{className:"w-3 h-3"}),a?.label||s.status]})}},{header:"ìš°ì„ ìˆœìœ„",accessor:"priority",cell:s=>e.jsx("div",{className:"text-center font-mono",children:s.priority||0})},{header:"í”Œë ˆì´ ìˆ˜",accessor:"play_count",cell:s=>e.jsx("div",{className:"text-center",children:s.play_count?.toLocaleString()||0})},{header:"ì•¡ì…˜",accessor:"actions",cell:s=>e.jsxs(he,{children:[e.jsx(fe,{asChild:!0,children:e.jsx(b,{variant:"ghost",size:"sm",children:e.jsx(Ne,{className:"w-4 h-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsxs($,{onClick:()=>C(s.id,"visible"),children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"ë…¸ì¶œí•˜ê¸°"]}),e.jsxs($,{onClick:()=>C(s.id,"hidden"),children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),"ìˆ¨ê¸°ê¸°"]}),e.jsxs($,{onClick:()=>C(s.id,"maintenance"),children:[e.jsx(D,{className:"w-4 h-4 mr-2"}),"ì ê²€ì¤‘ìœ¼ë¡œ ì„¤ì •"]}),e.jsxs($,{onClick:()=>C(s.id,s.status,s.priority,!s.is_featured),children:[e.jsx(z,{className:"w-4 h-4 mr-2"}),s.is_featured?"ì¶”ì²œ í•´ì œ":"ì¶”ì²œ ì„¤ì •"]})]})]})}];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"ê²Œì„ ê´€ë¦¬"}),e.jsx("p",{className:"text-sm text-slate-400",children:"ê²Œì„ ëª©ë¡ ë™ê¸°í™” ë° ìƒíƒœ ê´€ë¦¬"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(b,{onClick:le,disabled:g,className:"btn-premium-primary",children:[e.jsx(ge,{className:"w-4 h-4 mr-2"}),g?"ë™ê¸°í™” ì¤‘...":"ì „ì²´ ë™ê¸°í™”"]}),e.jsx(b,{onClick:()=>j(),disabled:y,variant:"outline",className:"border-slate-600 hover:bg-slate-700",children:e.jsx(P,{className:`w-4 h-4 ${y?"animate-spin":""}`})})]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-2 lg:grid-cols-4",children:[e.jsx(k,{title:"ë…¸ì¶œ ê²Œì„",value:_.visible.toLocaleString(),subtitle:"í™œì„±í™”ëœ ê²Œì„",icon:T,color:"green"}),e.jsx(k,{title:"ë¹„ë…¸ì¶œ ê²Œì„",value:_.hidden.toLocaleString(),subtitle:"ìˆ¨ê¹€ ì²˜ë¦¬ë¨",icon:A,color:"platinum"}),e.jsx(k,{title:"ì ê²€ì¤‘",value:_.maintenance.toLocaleString(),subtitle:"ì ê²€ ìƒíƒœ",icon:D,color:"red"}),e.jsx(k,{title:"ì¶”ì²œ ê²Œì„",value:_.featured.toLocaleString(),subtitle:"ì¶”ì²œ ì„¤ì •ë¨",icon:z,color:"amber"})]}),se&&e.jsxs(ie,{children:[e.jsx(ce,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(oe,{children:"ë™ê¸°í™” ê²°ê³¼"}),e.jsx(b,{variant:"ghost",size:"sm",onClick:()=>U(!1),children:"âœ•"})]})}),e.jsx(de,{children:e.jsx("div",{className:"space-y-2",children:ee.map(s=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-lg border ${s.error?"bg-red-50 border-red-200":"bg-green-50 border-green-200"}`,children:[e.jsx("span",{className:"font-medium",children:s.providerName}),e.jsx("div",{className:"text-sm",children:s.error?e.jsxs("span",{className:"text-red-600",children:["ì‹¤íŒ¨: ",s.error]}):e.jsxs("span",{className:"text-green-600",children:["ì‹ ê·œ ",s.gamesAdded,"ê°œ, ì—…ë°ì´íŠ¸ ",s.gamesUpdated,"ê°œ"]})})]},s.providerId))})})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsx("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:e.jsxs("div",{children:[e.jsxs("h2",{className:"text-xl font-semibold text-slate-100 flex items-center gap-2",children:[e.jsx(J,{className:"h-5 w-5 text-blue-400"}),"ê²Œì„ ëª©ë¡"]}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:"ê²Œì„ ì œê³µì‚¬ë³„ ê²Œì„ ëª©ë¡ ê´€ë¦¬ ë° ìƒíƒœ ì„¤ì •"})]})}),e.jsxs(me,{value:u,onValueChange:te,children:[e.jsxs(ue,{className:"grid w-full grid-cols-2 bg-slate-800/50 p-1 rounded-xl mb-6 border border-slate-700/50",children:[e.jsx(F,{value:"casino",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-purple-600 data-[state=active]:to-pink-600 data-[state=active]:text-white data-[state=active]:shadow-[0_0_20px_rgba(168,85,247,0.5)] rounded-lg transition-all duration-300 font-semibold",children:"ğŸ° ì¹´ì§€ë…¸"}),e.jsx(F,{value:"slot",className:"data-[state=active]:bg-gradient-to-r data-[state=active]:from-blue-600 data-[state=active]:to-cyan-600 data-[state=active]:text-white data-[state=active]:shadow-[0_0_20px_rgba(59,130,246,0.5)] rounded-lg transition-all duration-300 font-semibold",children:"ğŸ² ìŠ¬ë¡¯"})]}),e.jsxs("div",{className:"mt-6 space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-slate-400 w-4 h-4"}),e.jsx(xe,{placeholder:"ê²Œì„ëª… ë˜ëŠ” ì œê³µì‚¬ëª…ìœ¼ë¡œ ê²€ìƒ‰...",value:d,onChange:s=>E(s.target.value),className:"pl-10 input-premium"})]})}),e.jsxs(H,{value:l,onValueChange:S,children:[e.jsx(K,{className:"w-full sm:w-56 bg-slate-800/50 border-slate-600 text-slate-200",children:e.jsx(Q,{placeholder:"ì œê³µì‚¬ ì„ íƒ",children:l==="all"?"ëª¨ë“  ì œê³µì‚¬":h.find(s=>s.id.toString()===l)?.name||"ì œê³µì‚¬ ì„ íƒ"})}),e.jsxs(W,{children:[e.jsx(v,{value:"all",children:e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("span",{children:"ğŸŒ ëª¨ë“  ì œê³µì‚¬"})})}),h.filter(s=>s.type===(u==="casino"?"casino":"slot")).map(s=>{const t=x.filter(a=>a.provider_id===s.id&&a.type===u).length;return e.jsx(v,{value:s.id.toString(),children:e.jsxs("div",{className:"flex items-center justify-between gap-2",children:[e.jsx("span",{children:s.name}),t>0&&e.jsxs("span",{className:"text-xs text-slate-500",children:["(",t,"ê°œ)"]})]})},s.id)})]})]}),e.jsxs(H,{value:c,onValueChange:M,children:[e.jsx(K,{className:"w-full sm:w-32 bg-slate-800/50 border-slate-600",children:e.jsx(Q,{placeholder:"ìƒíƒœ"})}),e.jsxs(W,{children:[e.jsx(v,{value:"all",children:"ëª¨ë“  ìƒíƒœ"}),e.jsx(v,{value:"visible",children:"ë…¸ì¶œ"}),e.jsx(v,{value:"hidden",children:"ë¹„ë…¸ì¶œ"}),e.jsx(v,{value:"maintenance",children:"ì ê²€ì¤‘"})]})]})]}),(l!=="all"||c!=="all"||d)&&e.jsxs("div",{className:"flex flex-wrap items-center gap-2 p-3 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-lg border border-blue-500/30",children:[e.jsx("span",{className:"text-sm font-medium text-slate-300",children:"ğŸ” í˜„ì¬ í•„í„°:"}),l!=="all"&&e.jsxs(G,{variant:"default",className:"gap-1 bg-blue-600 hover:bg-blue-700",children:[e.jsx(ve,{className:"w-3 h-3"}),h.find(s=>s.id.toString()===l)?.name||"ì œê³µì‚¬",e.jsx("button",{onClick:()=>S("all"),className:"ml-1 hover:text-white",children:"âœ•"})]}),c!=="all"&&e.jsxs(G,{variant:"secondary",className:"gap-1",children:[c==="visible"&&"ë…¸ì¶œ",c==="hidden"&&"ë¹„ë…¸ì¶œ",c==="maintenance"&&"ì ê²€ì¤‘",e.jsx("button",{onClick:()=>M("all"),className:"ml-1 hover:text-white",children:"âœ•"})]}),d&&e.jsxs(G,{variant:"outline",className:"gap-1 border-slate-500",children:["ê²€ìƒ‰: ",d,e.jsx("button",{onClick:()=>E(""),className:"ml-1 hover:text-white",children:"âœ•"})]}),e.jsxs("span",{className:"text-xs text-slate-400",children:[L.length,"ê°œ ê²Œì„ í‘œì‹œ ì¤‘"]})]}),u==="slot"&&e.jsxs("div",{className:"flex flex-wrap gap-2 p-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[e.jsx("div",{className:"text-sm text-slate-400 mb-2 w-full",children:"ì œê³µì‚¬ë³„ ê²Œì„ ë™ê¸°í™”:"}),h.filter(s=>s.type==="slot").map(s=>{const t=x.filter(a=>a.provider_id===s.id&&a.type==="slot").length;return e.jsxs(b,{size:"sm",variant:"outline",onClick:()=>Z(s.id),disabled:p.has(s.id)||g,className:"gap-1 border-slate-600 hover:bg-slate-700",children:[e.jsx(P,{className:`w-3 h-3 ${p.has(s.id)?"animate-spin":""}`}),s.name,t>0&&e.jsxs("span",{className:"text-xs text-slate-400",children:["(",t,")"]})]},s.id)})]}),L.length===0&&!y&&e.jsxs("div",{className:"flex flex-col items-center justify-center py-16 px-4 bg-slate-800/30 rounded-lg border border-slate-700/50",children:[e.jsx(J,{className:"w-16 h-16 text-slate-600 mb-4"}),e.jsx("h3",{className:"text-lg font-semibold text-slate-300 mb-2",children:l!=="all"?`${h.find(s=>s.id.toString()===l)?.name||"ì„ íƒí•œ ì œê³µì‚¬"} ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤`:"ê²Œì„ì´ ì—†ìŠµë‹ˆë‹¤"}),e.jsx("p",{className:"text-sm text-slate-400 text-center max-w-md mb-6",children:l!=="all"?"í•´ë‹¹ ì œê³µì‚¬ì˜ ê²Œì„ì„ ë™ê¸°í™”í•˜ë ¤ë©´ ìœ„ì˜ ë™ê¸°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ì„¸ìš”.":"ì œê³µì‚¬ë¥¼ ì„ íƒí•˜ê³  ë™ê¸°í™” ë²„íŠ¼ì„ í´ë¦­í•˜ì—¬ ê²Œì„ì„ ë¶ˆëŸ¬ì˜¤ì„¸ìš”."}),l!=="all"&&u==="slot"&&e.jsxs(b,{onClick:()=>Z(parseInt(l)),disabled:p.has(parseInt(l)),className:"btn-premium-primary",children:[e.jsx(P,{className:`w-4 h-4 mr-2 ${p.has(parseInt(l))?"animate-spin":""}`}),h.find(s=>s.id.toString()===l)?.name," ë™ê¸°í™”"]})]}),e.jsx(je,{data:L,columns:re,loading:y,enableSearch:!1,emptyMessage:""})]})]})]})]})}export{Ee as EnhancedGameManagement,Ee as default};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-5VwzyDkW.js","assets/index-CRI4nD1u.css"])))=>i.map(i=>d[i]);
import{k as W,q as rs,v as ts,u as as,r as u,j as e,L as ns,V as Te,w as f,E as _,F as ae,I as G,T as os,i as is,S as cs,x as ls,y as ds,z as ms,D as M,s as m,t as n,_ as Q,B as ps}from"./index-5VwzyDkW.js";import{D as us}from"./DataTable-4wEQnOdr.js";import{A as ne,f as oe,a as ie,b as ce,c as le,d as de,e as me}from"./AdminDialog-BMxgE0TQ.js";import{T as pe}from"./textarea-AMWZFZq5.js";import{C as ue,a as xe,b as he,c as ge,d as fe}from"./command-8AREgxhB.js";import{P as je,a as ve,b as _e}from"./popover-Bs1GvV7q.js";import{M as H}from"./MetricCard-C0tW78RF.js";import{S as xs}from"./search-CYltF_Pd.js";import"./dialog-DCIniOsA.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]],Be=W("arrow-right-left",hs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"m7 15 5 5 5-5",key:"1hf1tw"}],["path",{d:"m7 9 5-5 5 5",key:"sgt6xg"}]],be=W("chevrons-up-down",gs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 12h8",key:"1wcyev"}]],Me=W("circle-minus",fs);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["rect",{x:"3",y:"8",width:"18",height:"4",rx:"1",key:"bkv52"}],["path",{d:"M12 8v13",key:"1c76mn"}],["path",{d:"M19 12v7a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2v-7",key:"6wjy6b"}],["path",{d:"M7.5 8a2.5 2.5 0 0 1 0-5A4.8 8 0 0 1 12 8a4.8 8 0 0 1 4.5-5 2.5 2.5 0 0 1 0 5",key:"1ihvrl"}]],ye=W("gift",js),vs={earn:"적립",use:"회수",convert_to_balance:"보유금전환",admin_adjustment:"지급"};function Cs(){const{authState:h}=rs(),{connected:Y,sendMessage:N}=ts(),{balance:S,syncBalance:_s}=as(),[F,we]=u.useState([]),[j,Fe]=u.useState([]),[y,i]=u.useState(!0),[D,Ue]=u.useState(""),[U,Re]=u.useState("all"),[qe,Ne]=u.useState(!1),[Ve,Se]=u.useState(!1),[Ke,Pe]=u.useState(!1),[o,P]=u.useState(""),[C,R]=u.useState(""),[I,q]=u.useState(""),[L,V]=u.useState(""),[A,k]=u.useState(""),[Ae,ke]=u.useState(!1),[De,Ce]=u.useState(!1),[Ie,Le]=u.useState(!1),K=async()=>{try{i(!0);let s=m.from("point_transactions").select(`
          *,
          users:user_id (
            username,
            nickname
          ),
          partners:partner_id (
            nickname
          )
        `);if(h.user?.level&&h.user.level>1){const{data:l}=await m.from("users").select("id").eq("referrer_id",h.user.id),g=l?.map(v=>v.id)||[];if(g.length>0)s=s.in("user_id",g);else{we([]),i(!1);return}}const{data:t,error:c}=await s.order("created_at",{ascending:!1}).limit(1e3);if(c)throw c;const d=t?.map(l=>({...l,user_username:l.users?.username||"",user_nickname:l.users?.nickname||"",partner_nickname:l.partners?.nickname||""}))||[];we(d)}catch(s){console.error("포인트 거래 내역 조회 오류:",s),n.error("포인트 거래 내역을 불러오는데 실패했습니다.")}finally{i(!1)}},z=async()=>{try{let s=m.from("users").select("id, username, nickname, points, balance").eq("status","active");h.user?.level&&h.user.level>1&&(s=s.eq("referrer_id",h.user.id));const{data:t,error:c}=await s.order("username");if(c)throw c;Fe(t||[])}catch(s){console.error("사용자 목록 조회 오류:",s)}},J=[10,30,50,70,100,200,300,400],ze=s=>{const t=parseFloat(C)||0;R((t+s).toString())},Ge=s=>{const t=parseFloat(L)||0;V((t+s).toString())},Qe=s=>{const t=parseFloat(I)||0;q((t+s).toString())},He=()=>{R("")},We=()=>{q("")},Ye=()=>{V("")},Je=async()=>{try{if(!o||!C||parseFloat(C)<=0){n.error("사용자와 유효한 포인트 금액을 입력해주세요.");return}const s=parseFloat(C);if(s>S){n.error(`보유금이 부족합니다. 현재 보유금: ${S.toLocaleString()}원`);return}i(!0);const{data:t,error:c}=await m.from("users").select("*").eq("id",o).single();if(c){n.error(`사용자 정보 조회 실패: ${c.message}`),i(!1);return}const d=t.points||0;console.log("🎁 [포인트 지급] 외부 API 호출 시작");let l,g,v,b;try{if(!t.referrer_id)throw new Error("사용자의 소속 파트너(referrer_id)가 설정되지 않았습니다.");const{data:r,error:a}=await m.from("partners").select("*").eq("id",t.referrer_id).single();if(a||!r)throw new Error(`소속 파트너 조회 실패: ${a?.message||"파트너를 찾을 수 없습니다."}`);console.log("✅ [포인트 지급] 소속 파트너 조회:",{partner_id:r.id,partner_username:r.username,partner_type:r.partner_type});const{getAdminOpcode:Z,isMultipleOpcode:ee}=await Q(async()=>{const{getAdminOpcode:se,isMultipleOpcode:re}=await import("./index-5VwzyDkW.js").then(te=>te.b3);return{getAdminOpcode:se,isMultipleOpcode:re}},__vite__mapDeps([0,1])),p=await Z(r);if(ee(p)){if(p.opcodes.length===0)throw new Error("사용 가능한 OPCODE가 없습니다. 시스템 관리자에게 문의하세요.");l=p.opcodes[0].opcode,g=p.opcodes[0].secretKey,v=p.opcodes[0].token}else l=p.opcode,g=p.secretKey,v=p.token;b=t.username.replace(/^btn_/,""),console.log("✅ [포인트 지급] API 설정 조회 완료:",{opcode:l,apiUsername:b})}catch(r){const a=`상위 대본사 API 설정 조회 실패: ${r.message}`;console.error("❌ [포인트 지급]",a),n.error(a,{duration:5e3,description:"API 설정을 확인하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}const{depositToAccount:$}=await Q(async()=>{const{depositToAccount:r}=await import("./index-5VwzyDkW.js").then(a=>a.b2);return{depositToAccount:r}},__vite__mapDeps([0,1]));let x;try{x=await $(l,b,v,s,g)}catch(r){const a=`외부 API 호출 실패: ${r.message}`;console.error("❌ [포인트 지급]",a),n.error(a,{duration:7e3,description:"네트워크 오류 또는 API 서버 문제입니다. 잠시 후 다시 시도하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(console.log("📡 [포인트 지급] API 응답:",x),x.error){const r=`외부 API 오류: ${x.error}`;console.error("❌ [포인트 지급]",r),n.error(r,{duration:7e3,description:"API 서버에서 오류가 발생했습니다. 시스템 관리자에게 문의하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(x.data){const r=x.data;if(r.RESULT===!1){const a=r.DATA?.message||r.message||"외부 API 처리 실패";console.error("❌ [포인트 지급] API 응답 에러:",a),n.error(`외부 API 오류: ${a}`,{duration:7e3,description:"외부 시스템에서 요청을 거부했습니다. DB는 업데이트되지 않았습니다."}),i(!1);return}if(r.is_text&&r.text_response){const a=r.text_response.toLowerCase();if(a.includes("error")||a.includes("실패")||a.includes("초과")){console.error("❌ [포인트 지급] API 텍스트 응답 에러:",r.text_response),n.error(`외부 API 오류: ${r.text_response}`,{duration:7e3,description:"DB는 업데이트되지 않았습니다."}),i(!1);return}}}console.log("✅ [포인트 지급] 외부 API 성공 - DB 업데이트 시작");const E=d+s,{error:O}=await m.from("users").update({points:E,updated_at:new Date().toISOString()}).eq("id",o);if(O){console.error("❌ [포인트 지급] DB 업데이트 실패:",O),n.error("DB 업데이트 실패. 외부 API는 성공했지만 내부 DB 동기화에 문제가 발생했습니다. 시스템 관리자에게 문의하세요.",{duration:1e4}),i(!1);return}const w=S-s,{error:T}=await m.from("partners").update({balance:w,updated_at:new Date().toISOString()}).eq("id",h.user?.id);if(T){console.error("❌ [포인트 지급] 관리자 보유금 업데이트 실패:",T),n.error("관리자 보유금 업데이트 실패. 시스템 관리자에게 문의하세요."),i(!1);return}await m.from("partner_balance_logs").insert({partner_id:h.user?.id,balance_before:S,balance_after:w,amount:-s,transaction_type:"admin_adjustment",processed_by:h.user?.id,memo:`포인트 지급: ${t.username} (${t.nickname})`});const{data:X,error:B}=await m.from("point_transactions").insert([{user_id:o,partner_id:h.user?.id,transaction_type:"admin_adjustment",amount:s,points_before:d,points_after:E,memo:A||"관리자 포인트 지급"}]).select().single();B&&console.error("❌ [포인트 지급] 거래내역 생성 실패:",B),n.success(`${s.toLocaleString()}P가 지급되었습니다. (보유금: ${w.toLocaleString()}원)`,{duration:3e3,icon:"🎁"}),Ne(!1),P(""),R(""),k(""),console.log("✅ [포인트 지급] 보유금 실시간 업데이트 대기 중..."),Y&&N&&N({type:"points_given",data:{transaction:X}}),K(),z()}catch(s){console.error("❌ [포인트 지급] 예상치 못한 오류:",s),n.error("포인트 지급에 실패했습니다.")}finally{i(!1)}},Xe=async()=>{try{if(!o||!I||parseFloat(I)<=0){n.error("사용자와 유효한 포인트 금액을 입력해주세요.");return}i(!0);const s=parseFloat(I),{data:t,error:c}=await m.from("users").select("*").eq("id",o).single();if(c){n.error(`사용자 정보 조회 실패: ${c.message}`),i(!1);return}const d=t.points||0;if(d<s){n.error(`회수할 포인트가 부족합니다. 현재 포인트: ${d.toLocaleString()}P`),i(!1);return}console.log("🔄 [포인트 회수] 외부 API 호출 시작");let l,g,v,b;try{if(!t.referrer_id)throw new Error("사용자의 소속 파트너(referrer_id)가 설정되지 않았습니다.");const{data:r,error:a}=await m.from("partners").select("*").eq("id",t.referrer_id).single();if(a||!r)throw new Error(`소속 파트너 조회 실패: ${a?.message||"파트너를 찾을 수 없습니다."}`);console.log("✅ [포인트 회수] 소속 파트너 조회:",{partner_id:r.id,partner_username:r.username,partner_type:r.partner_type});const{getAdminOpcode:Z,isMultipleOpcode:ee}=await Q(async()=>{const{getAdminOpcode:se,isMultipleOpcode:re}=await import("./index-5VwzyDkW.js").then(te=>te.b3);return{getAdminOpcode:se,isMultipleOpcode:re}},__vite__mapDeps([0,1])),p=await Z(r);if(ee(p)){if(p.opcodes.length===0)throw new Error("사용 가능한 OPCODE가 없습니다. 시스템 관리자에게 문의하세요.");l=p.opcodes[0].opcode,g=p.opcodes[0].secretKey,v=p.opcodes[0].token}else l=p.opcode,g=p.secretKey,v=p.token;b=t.username.replace(/^btn_/,""),console.log("✅ [포인트 회수] API 설정 조회 완료:",{opcode:l,apiUsername:b})}catch(r){const a=`상위 대본사 API 설정 조회 실패: ${r.message}`;console.error("❌ [포인트 회수]",a),n.error(a,{duration:5e3,description:"API 설정을 확인하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}const{withdrawFromAccount:$}=await Q(async()=>{const{withdrawFromAccount:r}=await import("./index-5VwzyDkW.js").then(a=>a.b2);return{withdrawFromAccount:r}},__vite__mapDeps([0,1]));let x;try{x=await $(l,b,v,s,g)}catch(r){const a=`외부 API 호출 실패: ${r.message}`;console.error("❌ [포인트 회수]",a),n.error(a,{duration:7e3,description:"네트워크 오류 또는 API 서버 문제입니다. 잠시 후 다시 시도하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(console.log("📡 [포인트 회수] API 응답:",x),x.error){const r=`외부 API 오류: ${x.error}`;console.error("❌ [포인트 회수]",r),n.error(r,{duration:7e3,description:"API 서버에서 오류가 발생했습니다. 시스템 관리자에게 문의하세요. DB는 업데이트되지 않았습니다."}),i(!1);return}if(x.data){const r=x.data;if(r.RESULT===!1){const a=r.DATA?.message||r.message||"외부 API 처리 실패";console.error("❌ [포인트 회수] API 응답 에러:",a),n.error(`외부 API 오류: ${a}`,{duration:7e3,description:"외부 시스템에서 요청을 거부했습니다. DB는 업데이트되지 않았습니다."}),i(!1);return}if(r.is_text&&r.text_response){const a=r.text_response.toLowerCase();if(a.includes("error")||a.includes("실패")||a.includes("초과")){console.error("❌ [포인트 회수] API 텍스트 응답 에러:",r.text_response),n.error(`외부 API 오류: ${r.text_response}`,{duration:7e3,description:"DB는 업데이트되지 않았습니다."}),i(!1);return}}}console.log("✅ [포인트 회수] 외부 API 성공 - DB 업데이트 시작");const E=d-s,{error:O}=await m.from("users").update({points:E,updated_at:new Date().toISOString()}).eq("id",o);if(O){console.error("❌ [포인트 회수] DB 업데이트 실패:",O),n.error("DB 업데이트 실패. 외부 API는 성공했지만 내부 DB 동기화에 문제가 발생했습니다. 시스템 관리자에게 문의하세요.",{duration:1e4}),i(!1);return}const w=S+s,{error:T}=await m.from("partners").update({balance:w,updated_at:new Date().toISOString()}).eq("id",h.user?.id);if(T){console.error("❌ [포인트 회수] 관리자 보유금 업데이트 실패:",T),n.error("관리자 보유금 업데이트 실패. 시스템 관리자에게 문의하세요."),i(!1);return}await m.from("partner_balance_logs").insert({partner_id:h.user?.id,balance_before:S,balance_after:w,amount:s,transaction_type:"admin_adjustment",processed_by:h.user?.id,memo:`포인트 회수: ${t.username} (${t.nickname})`});const{data:X,error:B}=await m.from("point_transactions").insert([{user_id:o,partner_id:h.user?.id,transaction_type:"use",amount:s,points_before:d,points_after:E,memo:A||"관리자 포인트 회수"}]).select().single();B&&console.error("❌ [포인트 회수] 거래내역 생성 실패:",B),n.success(`${s.toLocaleString()}P가 회수되었습니다. (보유금: ${w.toLocaleString()}원)`,{duration:3e3,icon:"🔄"}),Se(!1),P(""),q(""),k(""),console.log("✅ [포인트 회수] 보유금 실시간 업데이트 대기 중..."),Y&&N&&N({type:"points_recovered",data:{transaction:X}}),K(),z()}catch(s){console.error("❌ [포인트 회수] 예상치 못한 오류:",s),n.error("포인트 회수에 실패했습니다.")}finally{i(!1)}},Ze=async()=>{try{if(!o||!L||parseFloat(L)<=0){n.error("사용자와 유효한 전환 금액을 입력해주세요.");return}i(!0);const s=parseFloat(L),{data:t,error:c}=await m.from("users").select("points, balance").eq("id",o).single();if(c)throw c;const d=t.points||0,l=t.balance||0;if(d<s){n.error("보유 포인트가 부족합니다.");return}const g=d-s,v=l+s,{error:b}=await m.from("users").update({points:g,balance:v,updated_at:new Date().toISOString()}).eq("id",o);if(b)throw b;const{data:$,error:x}=await m.from("point_transactions").insert([{user_id:o,partner_id:h.user?.id,transaction_type:"convert_to_balance",amount:s,points_before:d,points_after:g,memo:A||"포인트 -> 보유금 전환"}]).select().single();if(x)throw x;n.success(`${s.toLocaleString()}P가 보유금으로 전환되었습니다.`),Pe(!1),P(""),V(""),k(""),Y&&N&&N({type:"points_converted",data:{transaction:$}}),K(),z()}catch(s){console.error("포인트 전환 오류:",s),n.error("포인트 전환에 실패했습니다.")}finally{i(!1)}},$e=F.filter(s=>{const t=s.user_username.toLowerCase().includes(D.toLowerCase())||s.user_nickname.toLowerCase().includes(D.toLowerCase())||s.memo.toLowerCase().includes(D.toLowerCase()),c=U==="all"||s.transaction_type===U;return t&&c}),es=[{key:"user_username",header:"아이디"},{key:"user_nickname",header:"닉네임"},{key:"transaction_type",header:"거래유형",cell:s=>{const t=s.transaction_type,c={earn:"px-3 py-1 bg-gradient-to-r from-emerald-500/20 to-teal-500/20 text-emerald-400 border border-emerald-500/50 rounded-full shadow-[0_0_10px_rgba(16,185,129,0.5)]",use:"px-3 py-1 bg-gradient-to-r from-rose-500/20 to-red-500/20 text-rose-400 border border-rose-500/50 rounded-full shadow-[0_0_10px_rgba(244,63,94,0.5)]",convert_to_balance:"px-3 py-1 bg-gradient-to-r from-blue-500/20 to-cyan-500/20 text-blue-400 border border-blue-500/50 rounded-full shadow-[0_0_10px_rgba(59,130,246,0.5)]",admin_adjustment:"px-3 py-1 bg-gradient-to-r from-amber-500/20 to-orange-500/20 text-amber-400 border border-amber-500/50 rounded-full shadow-[0_0_10px_rgba(251,146,60,0.5)]"};return e.jsx(ps,{className:c[t],children:vs[t]})}},{key:"amount",header:"금액",cell:s=>{const t=s.amount,c=s.transaction_type,d=c==="earn"||c==="admin_adjustment";return e.jsxs("span",{className:`font-mono font-semibold ${d?"text-emerald-400":"text-rose-400"}`,children:[d?"+":"-",Math.abs(t).toLocaleString(),"P"]})}},{key:"points_before",header:"이전 포인트",cell:s=>e.jsxs("span",{className:"font-mono text-slate-400",children:[s.points_before.toLocaleString(),"P"]})},{key:"points_after",header:"변경 후 포인트",cell:s=>e.jsxs("span",{className:"font-mono font-semibold text-amber-400",children:[s.points_after.toLocaleString(),"P"]})},{key:"memo",header:"메모",cell:s=>e.jsx("div",{className:"max-w-[200px] truncate text-slate-400",title:s.memo,children:s.memo})},{key:"partner_nickname",header:"처리자",cell:s=>e.jsx("span",{className:"text-cyan-400",children:s.partner_nickname})},{key:"created_at",header:"처리시간",cell:s=>{const t=new Date(s.created_at),c=t.getFullYear(),d=t.getMonth()+1,l=t.getDate(),g=t.getHours().toString().padStart(2,"0"),v=t.getMinutes().toString().padStart(2,"0");return e.jsxs("span",{className:"text-slate-400 text-sm",children:[c,". ",d,". ",l,". ",g,":",v]})}}],Ee=F.filter(s=>s.transaction_type==="earn"||s.transaction_type==="admin_adjustment").reduce((s,t)=>s+t.amount,0),Oe=F.filter(s=>s.transaction_type==="use"||s.transaction_type==="convert_to_balance").reduce((s,t)=>s+t.amount,0),ss=j.reduce((s,t)=>s+(t.points||0),0);return u.useEffect(()=>{K(),z()},[]),y&&F.length===0?e.jsx(ns,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsxs("h1",{className:"text-2xl font-bold text-slate-100 flex items-center gap-2",children:[e.jsx(Te,{className:"h-6 w-6 text-amber-400"}),"포인트 관리"]}),e.jsx("p",{className:"text-muted-foreground",children:"사용자 포인트 지급, 회수 및 잔고 전환을 관리합니다."})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(ne,{open:qe,onOpenChange:Ne,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-warning",children:[e.jsx(ye,{className:"h-4 w-4 mr-2"}),"포인트 지급"]})}),e.jsxs(ie,{className:"sm:max-w-[550px]",children:[e.jsxs(ce,{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(ye,{className:"h-5 w-5 text-orange-500"}),"포인트 지급"]}),e.jsx(de,{children:"사용자에게 포인트를 지급합니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"user",children:"사용자"}),e.jsxs(je,{open:Ae,onOpenChange:ke,children:[e.jsx(ve,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":Ae,className:"justify-between input-premium h-10",children:[o?j.find(s=>s.id===o)?.username+" ("+j.find(s=>s.id===o)?.nickname+") - "+(j.find(s=>s.id===o)?.points||0).toLocaleString()+"P":"아이디, 닉네임, 메모 검색",e.jsx(be,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(_e,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(ue,{className:"bg-slate-800",children:[e.jsx(xe,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(he,{className:"text-slate-400 py-6 text-center text-sm",children:"사용자를 찾을 수 없습니다."}),e.jsx(ge,{className:"max-h-64 overflow-auto",children:j.map(s=>e.jsxs(fe,{value:`${s.username} ${s.nickname}`,onSelect:()=>{P(s.id),ke(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:`mr-2 h-4 w-4 ${o===s.id?"opacity-100 text-orange-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[s.points.toLocaleString(),"P"]})})]},s.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{htmlFor:"amount",children:"포인트"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:He,className:"h-7 px-2 text-xs text-slate-400 hover:text-orange-400 hover:bg-orange-500/10",children:"전체삭제"})]}),e.jsx(G,{id:"amount",type:"number",value:C,onChange:s=>R(s.target.value),className:"input-premium",placeholder:"지급할 포인트 입력"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{className:"text-slate-400 text-sm",children:"단축 지급 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:J.map(s=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>ze(s),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]",children:["+",s,"P"]},s))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"memo",children:"메모"}),e.jsx(pe,{id:"memo",value:A,onChange:s=>k(s.target.value),className:"input-premium min-h-[80px]",placeholder:"지급 사유 입력 (선택사항)"})]})]}),e.jsx(me,{children:e.jsx(f,{type:"submit",onClick:Je,disabled:y,className:"btn-premium-warning w-full",children:y?"처리 중...":"포인트 지급"})})]})]}),e.jsxs(ne,{open:Ve,onOpenChange:Se,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-danger",children:[e.jsx(Me,{className:"h-4 w-4 mr-2"}),"포인트 회수"]})}),e.jsxs(ie,{className:"sm:max-w-[550px]",children:[e.jsxs(ce,{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"h-5 w-5 text-red-500"}),"포인트 회수"]}),e.jsx(de,{children:"사용자로부터 포인트를 회수합니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"recover_user",children:"사용자"}),e.jsxs(je,{open:De,onOpenChange:Ce,children:[e.jsx(ve,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":De,className:"justify-between input-premium h-10",children:[o?j.find(s=>s.id===o)?.username+" ("+j.find(s=>s.id===o)?.nickname+") - "+(j.find(s=>s.id===o)?.points||0).toLocaleString()+"P":"아이디, 닉네임으로 검색",e.jsx(be,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(_e,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(ue,{className:"bg-slate-800",children:[e.jsx(xe,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(he,{className:"text-slate-400 py-6 text-center text-sm",children:"사용자를 찾을 수 없습니다."}),e.jsx(ge,{className:"max-h-64 overflow-auto",children:j.filter(s=>s.points>0).map(s=>e.jsxs(fe,{value:`${s.username} ${s.nickname}`,onSelect:()=>{P(s.id),Ce(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:`mr-2 h-4 w-4 ${o===s.id?"opacity-100 text-red-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[s.points.toLocaleString(),"P"]})})]},s.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{htmlFor:"recover_amount",children:"회수 포인트"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:We,className:"h-7 px-2 text-xs text-slate-400 hover:text-red-400 hover:bg-red-500/10",children:"전체삭제"})]}),e.jsx(G,{id:"recover_amount",type:"number",value:I,onChange:s=>q(s.target.value),className:"input-premium",placeholder:"회수할 포인트 입력"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{className:"text-slate-400 text-sm",children:"단축 회수 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:J.map(s=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Qe(s),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]",children:["+",s,"P"]},s))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"recover_memo",children:"메모"}),e.jsx(pe,{id:"recover_memo",value:A,onChange:s=>k(s.target.value),className:"input-premium min-h-[80px]",placeholder:"회수 사유 입력 (선택사항)"})]})]}),e.jsx(me,{children:e.jsx(f,{type:"submit",onClick:Xe,disabled:y,className:"btn-premium-danger w-full",children:y?"처리 중...":"포인트 회수"})})]})]}),e.jsxs(ne,{open:Ke,onOpenChange:Pe,children:[e.jsx(oe,{asChild:!0,children:e.jsxs(f,{className:"btn-premium-primary",children:[e.jsx(Be,{className:"h-4 w-4 mr-2"}),"보유금 전환"]})}),e.jsxs(ie,{className:"sm:max-w-[550px]",children:[e.jsxs(ce,{children:[e.jsxs(le,{className:"flex items-center gap-2",children:[e.jsx(Be,{className:"h-5 w-5 text-blue-500"}),"포인트 → 보유금 전환"]}),e.jsx(de,{children:"사용자의 포인트를 게임 보유금으로 전환합니다."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"convert_user",children:"사용자"}),e.jsxs(je,{open:Ie,onOpenChange:Le,children:[e.jsx(ve,{asChild:!0,children:e.jsxs(f,{variant:"outline",role:"combobox","aria-expanded":Ie,className:"justify-between input-premium h-10",children:[o?j.find(s=>s.id===o)?.username+" ("+j.find(s=>s.id===o)?.nickname+") - "+(j.find(s=>s.id===o)?.points||0).toLocaleString()+"P":"아이디, 닉네임으로 검색",e.jsx(be,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(_e,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(ue,{className:"bg-slate-800",children:[e.jsx(xe,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsx(he,{className:"text-slate-400 py-6 text-center text-sm",children:"사용자를 찾을 수 없습니다."}),e.jsx(ge,{className:"max-h-64 overflow-auto",children:j.filter(s=>s.points>0).map(s=>e.jsxs(fe,{value:`${s.username} ${s.nickname}`,onSelect:()=>{P(s.id),Le(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:`mr-2 h-4 w-4 ${o===s.id?"opacity-100 text-blue-500":"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-amber-400 font-mono",children:[s.points.toLocaleString(),"P"]})})]},s.id))})]})})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(_,{htmlFor:"convert_amount",children:"전환금액"}),e.jsx(f,{type:"button",variant:"ghost",size:"sm",onClick:Ye,className:"h-7 px-2 text-xs text-slate-400 hover:text-blue-400 hover:bg-blue-500/10",children:"전체삭제"})]}),e.jsx(G,{id:"convert_amount",type:"number",value:L,onChange:s=>V(s.target.value),className:"input-premium",placeholder:"전환할 포인트 입력"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{className:"text-slate-400 text-sm",children:"단축 전환 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:J.map(s=>e.jsxs(f,{type:"button",variant:"outline",onClick:()=>Ge(s),className:"h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 hover:bg-blue-500/20 hover:border-blue-500/60 hover:text-blue-400 hover:shadow-[0_0_15px_rgba(59,130,246,0.3)]",children:["+",s,"P"]},s))})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(_,{htmlFor:"convert_memo",children:"메모"}),e.jsx(pe,{id:"convert_memo",value:A,onChange:s=>k(s.target.value),className:"input-premium min-h-[80px]",placeholder:"전환 사유 입력 (선택사항)"})]})]}),e.jsx(me,{children:e.jsx(f,{type:"submit",onClick:Ze,disabled:y,className:"btn-premium-primary w-full",children:y?"처리 중...":"보유금으로 전환"})})]})]})]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-4",children:[e.jsx(H,{title:"총 지급 포인트",value:`${Ee.toLocaleString()}P`,subtitle:"누적 지급",icon:os,color:"green"}),e.jsx(H,{title:"총 사용 포인트",value:`${Oe.toLocaleString()}P`,subtitle:"누적 사용",icon:is,color:"red"}),e.jsx(H,{title:"시스템 내 포인트",value:`${ss.toLocaleString()}P`,subtitle:"현재 보유",icon:Te,color:"orange"}),e.jsx(H,{title:"순 포인트",value:`${(Ee-Oe).toLocaleString()}P`,subtitle:"지급 - 사용",icon:ye,color:"purple"})]}),e.jsxs("div",{className:"glass-card rounded-xl p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6 pb-4 border-b border-slate-700/50",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-slate-100 mb-1",children:"포인트 거래 내역"}),e.jsxs("p",{className:"text-sm text-slate-400",children:["총 ",$e.length.toLocaleString(),"건의 거래 내역"]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("div",{className:"relative w-96",children:[e.jsx(xs,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(G,{placeholder:"아이디, 닉네임, 메모 검색",className:"pl-10 input-premium",value:D,onChange:s=>Ue(s.target.value)})]}),e.jsxs(cs,{value:U,onValueChange:Re,children:[e.jsx(ls,{className:"w-[180px] input-premium",children:e.jsx(ds,{placeholder:"거래유형 필터"})}),e.jsxs(ms,{className:"bg-slate-800 border-slate-700",children:[e.jsx(M,{value:"all",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-slate-500"}),"전체 유형"]})}),e.jsx(M,{value:"earn",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-emerald-500"}),"적립"]})}),e.jsx(M,{value:"use",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-rose-500"}),"사용"]})}),e.jsx(M,{value:"convert_to_balance",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-blue-500"}),"보유금전환"]})}),e.jsx(M,{value:"admin_adjustment",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-2 h-2 rounded-full bg-amber-500"}),"관리자조정"]})})]})]})]})]}),e.jsx(us,{columns:es,data:$e,searchable:!1,loading:y,emptyMessage:D||U!=="all"?"검색 결과가 없습니다.":"거래 내역이 없습니다."})]})]})}export{Cs as PointManagement,Cs as default};

import{r as o,j as e}from"./react-core-CwM-CeLv.js";import{M as B,s as H,I as R,i as w,C as L,e as X,B as W}from"./index-Cn1S8-JW.js";import{G as Y,I as F}from"./ImageWithFallback-B0TTlR8N.js";import{k as c}from"./vendor-CQn7sZ7L.js";import{g as y}from"./gameApi-BHu3aNHh.js";import{p as f,U as T,F as E,K as Z,v as J,Z as Q,av as K,aw as O,ai as ee,ax as se,am as ae,t as te}from"./lucide-icons-wLPRtdhM.js";import"./radix-ui-SX2QAG6c.js";import"./supabase-r6ABpEO8.js";const re=[{id:"all",name:"전체",icon:f,gradient:"from-yellow-500 to-amber-600"},{id:"evolution",name:"에볼루션",icon:J,gradient:"from-red-500 to-red-600"},{id:"pragmatic",name:"프라그마틱",icon:Q,gradient:"from-blue-500 to-blue-600"},{id:"baccarat",name:"바카라",icon:K,gradient:"from-purple-500 to-purple-600"},{id:"blackjack",name:"블랙잭",icon:O,gradient:"from-green-500 to-green-600"},{id:"roulette",name:"룰렛",icon:E,gradient:"from-orange-500 to-orange-600"}];function pe({user:m,onRouteChange:le}){const[d,b]=o.useState("all"),[p,j]=o.useState("all"),[u,N]=o.useState(""),[$,z]=o.useState([]),[M,U]=o.useState([]),[_,x]=o.useState(!1),[h,k]=o.useState(null),{sendMessage:C,isConnected:I}=B();o.useEffect(()=>{V()},[]),o.useEffect(()=>{I&&C({type:"subscribe",channel:"casino_status_updates",userId:m.id})},[I,m.id]),o.useEffect(()=>{v()},[d,p]);const V=async()=>{try{x(!0);let t=(await y.getProviders()).filter(a=>a.type==="casino");t.length<10&&(t=[{id:410,name:"에볼루션 게이밍",type:"casino",status:"active"},{id:77,name:"마이크로 게이밍",type:"casino",status:"active"},{id:2,name:"Vivo 게이밍",type:"casino",status:"active"},{id:30,name:"아시아 게이밍",type:"casino",status:"active"},{id:78,name:"프라그마틱플레이",type:"casino",status:"active"},{id:86,name:"섹시게이밍",type:"casino",status:"active"},{id:11,name:"비비아이엔",type:"casino",status:"active"},{id:28,name:"드림게임",type:"casino",status:"active"},{id:89,name:"오리엔탈게임",type:"casino",status:"active"},{id:91,name:"보타",type:"casino",status:"active"},{id:44,name:"이주기",type:"casino",status:"active"},{id:85,name:"플레이텍 라이브",type:"casino",status:"active"},{id:0,name:"제네럴 카지노",type:"casino",status:"active"}]),U(t),await v()}catch{c.error("데이터를 불러오는데 실패했습니다.")}finally{x(!1)}},v=async()=>{try{x(!0);let s;try{s=await y.getUserVisibleGames(m.id,"casino",d!=="all"?parseInt(d):void 0,void 0,100,0)}catch(a){console.error("RPC 함수 호출 실패, 직접 조회로 fallback:",a);let r=H.from("games").select(`
            id,
            provider_id,
            name,
            type,
            status,
            image_url,
            demo_available,
            is_featured,
            priority,
            rtp,
            play_count,
            created_at,
            updated_at,
            game_providers!inner(
              id,
              name,
              type
            )
          `).eq("type","casino").eq("status","visible").eq("game_providers.status","active");d!=="all"&&(r=r.eq("provider_id",parseInt(d)));const{data:i,error:g}=await r.order("priority",{ascending:!1}).limit(100);if(g)throw g;s=i?.map(l=>({game_id:l.id,provider_id:l.provider_id,provider_name:l.game_providers.name,game_name:l.name,game_type:l.type,image_url:l.image_url,is_featured:l.is_featured,status:l.status,priority:l.priority||0}))||[]}const t=s.sort((a,r)=>a.is_featured&&!r.is_featured?-1:!a.is_featured&&r.is_featured?1:r.priority-a.priority);z(t)}catch(s){console.error("❌ 카지노 게임 로드 실패:",s),c.error("카지노 게���을 불러오는데 실패했습니다.")}finally{x(!1)}},D=async s=>{if(h!==s.game_id){k(s.game_id);try{console.log("🎮 카지노 게임 실행 시작:",{userId:m.id,gameId:s.game_id,gameName:s.game_name});const t=await y.generateGameLaunchUrl(m.id,s.game_id);if(t.success&&t.launchUrl){const a=t.sessionId;console.log("🎮 카지노 게임 실행:",a);const r=window.open(t.launchUrl,"_blank","width=1920,height=1080,scrollbars=yes,resizable=yes,fullscreen=yes");if(!r)c.error("팝업이 차단되었습니다. 팝업 허용 후 다시 시도해주세요."),a&&typeof a=="number"?window.endGameSession?.(a):console.warn("⚠️ 게임 실행 실패, 하지만 sessionId가 없음:",a);else if(c.success(`${s.game_name} VIP 카지노에 입장했습니다.`),a&&typeof a=="number"&&(window.gameWindows||(window.gameWindows=new Map),window.gameWindows.set(a,r),console.log("📝 카지노 게임창 등록:",a)),C({type:"casino_entered",userId:m.id,gameId:s.game_id,providerName:s.provider_name,sessionId:a,timestamp:new Date().toISOString()}),a&&typeof a=="number"){window.gameWindowCheckers||(window.gameWindowCheckers=new Map);let i=!1;const g=async()=>{if(i)return;i=!0,console.log("🎮 카지노 게임 창 종료 감지:",a);const n=window.gameWindowCheckers?.get(a);n&&(clearInterval(n),window.gameWindowCheckers?.delete(a)),window.gameWindows?.delete(a),console.log("🧹 카지노 게임창 참조 삭제:",a),console.log("💰 잔고 동기화 시작:",a),window.syncBalanceAfterGame?.(a)};let l=0;const A=setInterval(()=>{l++,console.log(`🔍 [${l}] 게임창 체크 중... sessionId:${a}`);try{r.closed&&(console.log(`✅ [${l}] 게임창 닫힘 확인!`),g())}catch(n){console.log(`⚠️ [${l}] 체크 에러:`,n)}},300);window.gameWindowCheckers.set(a,A);const G=()=>{console.log("👁️ 포커스 이벤트 - 게임창 확인");try{r.closed&&(console.log("✅ 포커스 이벤트에서 게임창 닫힘 확인!"),window.removeEventListener("focus",G),g())}catch(n){console.log("⚠️ 포커스 체크 에러:",n)}};window.addEventListener("focus",G);const P=()=>{if(document.visibilityState==="visible"){console.log("👁️ 탭 활성화 - 게임창 확인");try{r.closed&&(console.log("✅ 탭 활성화에서 게임창 닫힘 확인!"),document.removeEventListener("visibilitychange",P),g())}catch(n){console.log("⚠️ 가시성 체크 에러:",n)}}};document.addEventListener("visibilitychange",P),console.log("✅ 카지노 게임창 다중 감지 시작:",a)}}else c.dismiss(`game-loading-${s.game_id}`),console.error("❌ 카지노 게임 실행 실패:",t.error),c.error(`카지노 입장 실패: ${t.error||"알 수 없는 오류가 발생했습니다."}`)}catch(t){c.dismiss(`game-loading-${s.game_id}`),console.error("❌ 카지노 실행 예외 발생:",t),c.error(`카지노 입장 중 오류: ${t instanceof Error?t.message:"시스템 오류가 발생했습니다."}`)}finally{k(null)}}},q=s=>s.image_url&&s.image_url.trim()&&s.image_url!=="null"?s.image_url:null,S=$.filter(s=>{const t=u===""||s.game_name.toLowerCase().includes(u.toLowerCase())||s.provider_name.toLowerCase().includes(u.toLowerCase());let a=!0;if(p!=="all"){const r=s.game_name.toLowerCase(),i=s.provider_name.toLowerCase();switch(p){case"evolution":a=i.includes("evolution")||i.includes("에볼루션");break;case"pragmatic":a=i.includes("pragmatic")||i.includes("프라그마틱");break;case"baccarat":a=r.includes("baccarat")||r.includes("바카라");break;case"blackjack":a=r.includes("blackjack")||r.includes("블랙잭")||r.includes("black jack");break;case"roulette":a=r.includes("roulette")||r.includes("룰렛");break;default:a=!0}}return t&&a});return e.jsxs("div",{className:"relative min-h-screen overflow-x-hidden",children:[e.jsx("div",{className:"absolute inset-0 z-0",style:{backgroundImage:"linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.8)), url('https://images.unsplash.com/photo-1680191741548-1a9321688cc3?crop=entropy&cs=tinysrgb&fit=max&fm=jpg&ixid=M3w3Nzg4Nzd8MHwxfHNlYXJjaHwxfHxsdXh1cnklMjBjYXNpbm8lMjBpbnRlcmlvciUyMGJhY2tncm91bmR8ZW58MXx8fHwxNzU5NzIwMzYzfDA&ixlib=rb-4.1.0&q80&w=1080&utm_source=figma&utm_medium=referral')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed"}}),e.jsxs("div",{className:"relative z-10 space-y-8 p-4 sm:p-6 lg:p-8",children:[e.jsxs("div",{className:"text-center space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-center gap-4 mb-6",children:[e.jsx(f,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"}),e.jsx("h1",{className:"text-6xl lg:text-7xl font-bold gold-text neon-glow",children:"VIP 라이브 카지노"}),e.jsx(f,{className:"w-16 h-16 text-yellow-400 drop-shadow-[0_0_20px_rgba(250,204,21,0.8)]"})]}),e.jsx("p",{className:"text-3xl text-yellow-100 tracking-wide",children:"세계 최고의 딜러와 함께하는 프리미엄 게임 경험"}),e.jsxs("div",{className:"flex items-center justify-center gap-6 text-yellow-300/80 text-lg",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 bg-red-500 rounded-full animate-pulse"}),e.jsx("span",{children:"실시간 라이브"})]}),e.jsx("div",{className:"w-px h-6 bg-yellow-600/50"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(T,{className:"w-5 h-5"}),e.jsx("span",{children:"24시간 운영"})]}),e.jsx("div",{className:"w-px h-6 bg-yellow-600/50"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{className:"w-5 h-5"}),e.jsx("span",{children:"VIP 전용"})]})]})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row gap-5 items-center justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-xl",children:[e.jsx(Z,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 w-6 h-6 text-yellow-400"}),e.jsx(R,{type:"text",placeholder:"게임 검색...",value:u,onChange:s=>N(s.target.value),className:"pl-12 h-14 text-lg bg-black/50 border-yellow-600/30 text-white placeholder:text-yellow-200/50 focus:border-yellow-500"})]}),e.jsx("div",{className:"flex flex-wrap gap-3",children:re.map(s=>{const t=s.icon,a=p===s.id;return e.jsxs(w,{variant:"ghost",onClick:()=>j(s.id),className:`
                    relative px-6 py-4 text-lg font-bold transition-all duration-300
                    ${a?`bg-gradient-to-r ${s.gradient} text-white shadow-lg shadow-yellow-500/50 scale-105`:"text-yellow-200/80 hover:text-yellow-100 hover:bg-yellow-900/20 border border-transparent hover:border-yellow-600/30"}
                  `,children:[e.jsx(t,{className:"w-5 h-5 mr-2"}),s.name,a&&e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-transparent via-yellow-300 to-transparent"})]},s.id)})})]}),e.jsx("div",{className:"hidden lg:block luxury-card rounded-3xl p-8 border-2 border-yellow-600/20",children:e.jsx(Y,{selectedProvider:d,onProviderChange:b,gameType:"casino",providers:M})}),_?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:Array.from({length:8}).map((s,t)=>e.jsxs(L,{className:"luxury-card animate-pulse border-yellow-600/20",children:[e.jsx("div",{className:"aspect-[4/3] bg-gradient-to-br from-slate-700 to-slate-800 rounded-t-xl"}),e.jsxs(X,{className:"p-4 space-y-3",children:[e.jsx("div",{className:"h-5 bg-gradient-to-r from-yellow-600/20 to-yellow-400/20 rounded"}),e.jsx("div",{className:"h-4 bg-gradient-to-r from-yellow-600/20 to-yellow-400/20 rounded w-2/3"})]})]},t))}):e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:S.map(s=>e.jsx(L,{className:`luxury-card group cursor-pointer border-2 border-yellow-600/20 hover:border-yellow-500/60 transition-all game-card-hover overflow-hidden ${h===s.game_id?"opacity-50":""}`,onClick:()=>D(s),children:e.jsxs("div",{className:"aspect-[4/3] relative overflow-hidden",children:[e.jsx(F,{src:q(s),alt:s.game_name,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent"}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsxs(W,{className:"bg-red-500 text-white border-0 animate-pulse shadow-lg",children:[e.jsx("div",{className:"w-2 h-2 bg-white rounded-full mr-1"}),"LIVE"]})}),s.is_featured&&e.jsx("div",{className:"absolute top-3 right-3",children:e.jsxs(W,{className:"vip-badge text-white border-0",children:[e.jsx(ee,{className:"w-3 h-3 mr-1"}),"VIP"]})}),e.jsx("div",{className:"absolute inset-0 bg-black/0 group-hover:bg-black/40 transition-all duration-300 flex items-center justify-center",children:h===s.game_id?e.jsxs("div",{className:"flex flex-col items-center gap-2 text-white",children:[e.jsx(se,{className:"w-8 h-8 animate-spin"}),e.jsx("span",{className:"text-sm font-semibold",children:"입장 중..."})]}):e.jsxs(w,{size:"lg",className:"opacity-0 group-hover:opacity-100 transition-opacity duration-300 bg-gradient-to-r from-yellow-600 to-amber-600 hover:from-yellow-500 hover:to-amber-500 text-black font-bold shadow-lg shadow-yellow-500/40",disabled:h===s.game_id,children:[e.jsx(ae,{className:"w-5 h-5 mr-2"}),"VIP 입장"]})}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 p-4 text-white",children:[e.jsx("h3",{className:"font-bold text-lg mb-1 truncate neon-glow",children:s.game_name}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"text-sm text-yellow-300 truncate",children:s.provider_name}),e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-400",children:[e.jsx(te,{className:"w-3 h-3"}),e.jsx("span",{children:"24H"})]})]})]})]})},s.game_id))}),S.length===0&&!_&&e.jsxs("div",{className:"text-center py-16 luxury-card rounded-2xl border-2 border-yellow-600/20",children:[e.jsx("div",{className:"mx-auto w-24 h-24 bg-gradient-to-br from-yellow-500/20 to-amber-600/20 rounded-full flex items-center justify-center mb-6",children:e.jsx(f,{className:"w-12 h-12 text-yellow-400"})}),e.jsx("h3",{className:"text-2xl font-bold gold-text mb-2",children:"게임을 찾을 수 없습니다"}),e.jsx("p",{className:"text-yellow-200/80 text-lg mb-4",children:u?`"${u}"에 대한 검색 결과가 없습니다.`:p!=="all"?"선택한 카테고리의 게임이 없습니다.":d!=="all"?"선택한 제공사의 게임이 없습니다.":"사용 가능한 카지노 게임이 없습니다."}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(w,{variant:"outline",onClick:()=>{N(""),j("all"),b("all")},className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20",children:"전체 게임 보기"}),e.jsx(w,{variant:"outline",onClick:()=>v(),className:"border-yellow-600/30 text-yellow-300 hover:bg-yellow-900/20",children:"새로고침"})]})]})]})]})}export{pe as UserCasino};

import{r as d,j as e}from"./react-core-CwM-CeLv.js";import{L as m,S as P,p as E,q as B,r as M,t as $,i as h,I as U}from"./index-Cn1S8-JW.js";import{T as V}from"./textarea-DcWc96jr.js";import{P as q,a as z,b as G}from"./popover-KcKD6lRl.js";import{C as H,a as R,e as W,b as J,c as K,d as Q}from"./command-D1kDSEeZ.js";import{A as X,a as Y,b as Z,c as ee,d as se,e as ae}from"./AdminDialog-qdCOZfhu.js";import{k as x}from"./vendor-CQn7sZ7L.js";import{T as te,i as re,_ as ne,k as ie,O as oe}from"./lucide-icons-wLPRtdhM.js";function pe({open:A,onOpenChange:b,type:a,targetType:l,selectedTarget:u,targets:v=[],onSubmit:k,onTypeChange:D}){const[i,p]=d.useState(""),[c,r]=d.useState(""),[N,j]=d.useState(""),[w,S]=d.useState(!1),[C,F]=d.useState(!1),L=[1e3,3e3,5e3,1e4,3e4,5e4,1e5,3e5,5e5,1e6],n=u||v.find(s=>s.id===i),t=n?parseFloat(n.balance?.toString()||"0"):0,f=!!u,y=s=>{const g=parseFloat(c||"0")+s;if(a==="withdrawal"&&i&&g>t){x.error(`출금 금액이 보유금(${t.toLocaleString()}원)을 초과할 수 없습니다.`),r(t.toString());return}r(g.toString())},I=s=>{const o=parseFloat(s||"0");if(a==="withdrawal"&&i&&o>t){x.error(`출금 금액이 보유금(${t.toLocaleString()}원)을 초과할 수 없습니다.`),r(t.toString());return}r(s)},T=()=>{r("0")},_=()=>{n&&a==="withdrawal"&&r(t.toString())},O=async()=>{const s=u?.id||i;if(!s){x.error(`${l==="user"?"회원":"파트너"}를 선택해주세요.`);return}const o=parseFloat(c||"0");if(o<=0){x.error("금액을 입력해주세요.");return}if(a==="withdrawal"&&o>t){x.error(`출금 금액이 보유금(${t.toLocaleString()}원)을 초과할 수 없습니다.`);return}try{F(!0),await k({targetId:s,type:a,amount:o,memo:N}),f||p(""),r(""),j(""),b(!1)}catch(g){console.error("강제 입출금 실행 오류:",g)}finally{F(!1)}};return e.jsx(X,{open:A,onOpenChange:s=>{s||(f||p(""),r(""),j("")),b(s)},children:e.jsxs(Y,{className:"sm:max-w-[550px]",children:[e.jsxs(Z,{children:[e.jsx(ee,{className:"flex items-center gap-2",children:a==="deposit"?e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-5 w-5 text-emerald-500"}),"강제 입금"]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-5 w-5 text-rose-500"}),"강제 출금"]})}),e.jsxs(se,{children:[l==="user"?"회원":"파트너","의 잔액을 직접 조정합니다."]})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"force-transaction-type",children:"거래 유형"}),e.jsxs(P,{value:a,onValueChange:s=>D(s),children:[e.jsx(E,{id:"force-transaction-type",className:"input-premium h-10",children:e.jsx(B,{})}),e.jsxs(M,{className:"bg-slate-800 border-slate-700",children:[e.jsx($,{value:"deposit",children:"입금"}),e.jsx($,{value:"withdrawal",children:"출금"})]})]})]}),!f&&e.jsxs("div",{className:"grid gap-2",children:[e.jsxs(m,{htmlFor:"force-transaction-target-search",children:[l==="user"?"회원":"파트너"," 선택"]}),e.jsxs(q,{open:w,onOpenChange:S,children:[e.jsx(z,{asChild:!0,children:e.jsxs(h,{id:"force-transaction-target-search",variant:"outline",role:"combobox","aria-expanded":w,className:"justify-between input-premium h-10",children:[i?`${n?.username} (${n?.nickname}) - ${t.toLocaleString()}원`:"아이디, 닉네임으로 검색",e.jsx(ne,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(G,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(H,{className:"bg-slate-800",children:[e.jsx(R,{placeholder:"아이디, 닉네임으로 검색...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsxs(W,{children:[e.jsxs(J,{className:"text-slate-400 py-6 text-center text-sm",children:[l==="user"?"회원":"파트너","을 찾을 수 없습니다."]}),e.jsx(K,{className:"max-h-64 overflow-auto",children:v.map(s=>e.jsxs(Q,{value:`${s.username} ${s.nickname}`,onSelect:()=>{p(s.id),S(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:`mr-2 h-4 w-4 ${i===s.id?`opacity-100 ${a==="deposit"?"text-emerald-500":"text-rose-500"}`:"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:s.username}),e.jsx("div",{className:"text-xs text-slate-400",children:s.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-cyan-400 font-mono",children:[parseFloat(s.balance?.toString()||"0").toLocaleString(),"원"]})})]},s.id))})]})]})})]})]}),n&&e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("span",{className:"text-sm text-slate-400",children:["선택된 ",l==="user"?"회원":"파트너"]}),e.jsx("span",{className:"text-cyan-400 font-medium",children:n.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"현재 보유금"}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[t.toLocaleString(),"원"]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(m,{htmlFor:"force-transaction-amount",children:"금액"}),e.jsx(h,{type:"button",variant:"ghost",size:"sm",onClick:T,className:`h-7 px-2 text-xs text-slate-400 ${a==="deposit"?"hover:text-orange-400 hover:bg-orange-500/10":"hover:text-red-400 hover:bg-red-500/10"}`,children:"전체삭제"})]}),e.jsx(U,{id:"force-transaction-amount",name:"amount",type:"number",value:c,onChange:s=>I(s.target.value),className:"input-premium",placeholder:"금액을 입력하세요"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{className:"text-slate-400 text-sm",children:"단축 입력 (누적 더하기)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:L.map(s=>e.jsxs(h,{type:"button",variant:"outline",onClick:()=>y(s),className:`h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 ${a==="deposit"?"hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]":"hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]"}`,children:["+",s>=1e4?`${s/1e4}만`:`${s/1e3}천`]},s))})]}),a==="withdrawal"&&n&&e.jsx("div",{className:"grid gap-2",children:e.jsxs(h,{type:"button",variant:"outline",onClick:_,className:"w-full h-9 bg-red-900/20 border-red-500/50 text-red-400 hover:bg-red-900/40 hover:border-red-500",children:[e.jsx(oe,{className:"h-4 w-4 mr-2"}),"전액출금"]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(m,{htmlFor:"force-transaction-memo",children:"메모"}),e.jsx(V,{id:"force-transaction-memo",name:"memo",value:N,onChange:s=>j(s.target.value),placeholder:"메모를 입력하세요 (선택사항)",className:"input-premium min-h-[80px]"})]})]}),e.jsx(ae,{children:e.jsx(h,{type:"button",onClick:O,disabled:C||!u?.id&&!i||!c||parseFloat(c)<=0,className:`w-full ${a==="deposit"?"btn-premium-warning":"btn-premium-danger"}`,children:C?"처리 중...":a==="deposit"?"강제 입금":"강제 출금"})})]})})}export{pe as F};

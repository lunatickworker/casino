import{r as c,s as i,j as e,R as o,A as h,w as L,ay as u,C as U,a as $,b as B,d as E,e as I,G as M,a1 as k,B as d}from"./index-DHLZKrSC.js";import{S as O}from"./scroll-area-BAJXbkC5.js";import{M as n}from"./MetricCard-DmGakNT9.js";import{T as p}from"./triangle-alert-CDjjtVAU.js";import{C as j}from"./clock-DJz0fDvN.js";function J(){const[x,g]=c.useState([]),[N,f]=c.useState(!0),[r,b]=c.useState({total:0,success:0,error:0,lastSync:null}),l=async()=>{try{const{data:s,error:a}=await i.from("api_sync_logs").select("*").order("created_at",{ascending:!1}).limit(50);if(a)throw a;g(s||[]),s&&s.length>0&&b({total:s.length,success:s.filter(t=>t.status==="success").length,error:s.filter(t=>t.status==="error").length,lastSync:s[0].created_at})}catch(s){console.error("‚ùå ÎèôÍ∏∞Ìôî Î°úÍ∑∏ Ï°∞Ìöå Ïò§Î•ò:",s)}finally{f(!1)}},m=s=>{const a=new Date(s),t=new Date(a.getTime()+540*60*1e3),w=t.getUTCFullYear(),C=String(t.getUTCMonth()+1).padStart(2,"0"),_=String(t.getUTCDate()).padStart(2,"0"),T=String(t.getUTCHours()).padStart(2,"0"),A=String(t.getUTCMinutes()).padStart(2,"0"),D=String(t.getUTCSeconds()).padStart(2,"0");return`${w}ÎÖÑ${C}Ïõî${_}Ïùº ${T}:${A}:${D}`};c.useEffect(()=>{l()},[]),c.useEffect(()=>{const s=i.channel("api_sync_logs_changes").on("postgres_changes",{event:"*",schema:"public",table:"api_sync_logs"},a=>{console.log("üîÑ ÏÉàÎ°úÏö¥ ÎèôÍ∏∞Ìôî Î°úÍ∑∏:",a),l()}).subscribe();return()=>{i.removeChannel(s)}},[]);const v=s=>{switch(s){case"success":return e.jsx(u,{className:"h-4 w-4 text-green-500"});case"error":return e.jsx(p,{className:"h-4 w-4 text-red-500"});default:return e.jsx(j,{className:"h-4 w-4 text-gray-500"})}},y=s=>{switch(s){case"success":return e.jsx(d,{className:"bg-green-600",children:"ÏÑ±Í≥µ"});case"error":return e.jsx(d,{variant:"destructive",children:"Ïò§Î•ò"});default:return e.jsx(d,{variant:"outline",children:"ÎåÄÍ∏∞"})}},S=s=>{switch(s){case"balance":return{icon:e.jsx(k,{className:"h-4 w-4 text-blue-400"}),label:"ÏûîÍ≥† ÎèôÍ∏∞Ìôî"};case"game_history":return{icon:e.jsx(M,{className:"h-4 w-4 text-green-400"}),label:"Í≤åÏûÑ Í∏∞Î°ù"};default:return{icon:e.jsx(h,{className:"h-4 w-4 text-purple-400"}),label:s}}};return N?e.jsx("div",{className:"flex items-center justify-center p-8",children:e.jsx(o,{className:"h-6 w-6 animate-spin text-blue-400"})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-white flex items-center gap-2",children:[e.jsx(h,{className:"h-6 w-6"}),"ÏûêÎèô ÎèôÍ∏∞Ìôî Î™®ÎãàÌÑ∞"]}),e.jsx("p",{className:"text-slate-400 mt-1",children:"Ïã§ÏãúÍ∞Ñ API ÎèôÍ∏∞Ìôî ÏÉÅÌÉúÎ•º ÌôïÏù∏Ìï©ÎãàÎã§"})]}),e.jsxs(L,{onClick:l,className:"bg-slate-700 hover:bg-slate-600",children:[e.jsx(o,{className:"h-4 w-4 mr-2"}),"ÏÉàÎ°úÍ≥†Ïπ®"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(n,{title:"Ï¥ù ÎèôÍ∏∞Ìôî",value:r.total.toLocaleString(),subtitle:"Ï†ÑÏ≤¥ ÎèôÍ∏∞Ìôî",icon:o,color:"blue"}),e.jsx(n,{title:"ÏÑ±Í≥µ",value:r.success.toLocaleString(),subtitle:"ÏÑ±Í≥µÌïú ÎèôÍ∏∞Ìôî",icon:u,color:"green"}),e.jsx(n,{title:"Ïò§Î•ò",value:r.error.toLocaleString(),subtitle:"Ïã§Ìå®Ìïú ÎèôÍ∏∞Ìôî",icon:p,color:"red"}),e.jsx(n,{title:"ÎßàÏßÄÎßâ ÎèôÍ∏∞Ìôî",value:r.lastSync?m(r.lastSync):"-",subtitle:"ÏµúÍ∑º Ïã§Ìñâ",icon:j,color:"purple"})]}),e.jsxs(U,{className:"bg-slate-800/50 border-slate-700",children:[e.jsxs($,{children:[e.jsx(B,{className:"text-white",children:"ÎèôÍ∏∞Ìôî Î°úÍ∑∏"}),e.jsx(E,{className:"text-slate-400",children:"ÏµúÍ∑º 50Í∞úÏùò ÎèôÍ∏∞Ìôî Í∏∞Î°ù (Ïã§ÏãúÍ∞Ñ ÏóÖÎç∞Ïù¥Ìä∏)"})]}),e.jsx(I,{children:e.jsx(O,{className:"h-[600px] pr-4",children:e.jsx("div",{className:"space-y-3",children:x.length===0?e.jsx("div",{className:"text-center py-8 text-slate-400",children:"ÎèôÍ∏∞Ìôî Î°úÍ∑∏Í∞Ä ÏóÜÏäµÎãàÎã§"}):x.map(s=>{const a=S(s.sync_type);return e.jsxs("div",{className:"p-4 bg-slate-700/30 rounded-lg border border-slate-600 hover:bg-slate-700/50 transition-colors",children:[e.jsxs("div",{className:"flex items-start justify-between mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[a.icon,e.jsx("span",{className:"text-white font-medium",children:a.label}),y(s.status)]}),e.jsxs("div",{className:"flex items-center gap-2",children:[v(s.status),e.jsxs("span",{className:"text-slate-400 text-sm font-mono",children:[s.sync_duration_ms,"ms"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"OPCODE:"}),e.jsx("span",{className:"text-white ml-2 font-mono",children:s.opcode})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-slate-400",children:"Ï≤òÎ¶¨ Í±¥Ïàò:"}),e.jsxs("span",{className:"text-white ml-2",children:[s.records_processed,"Í±¥"]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400",children:"ÏãúÍ∞Ñ:"}),e.jsx("span",{className:"text-white ml-2 font-mono text-xs",children:m(s.created_at)})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("span",{className:"text-slate-400",children:"API:"}),e.jsx("span",{className:"text-white ml-2 font-mono text-xs",children:s.api_endpoint})]})]}),s.error_message&&e.jsx("div",{className:"mt-2 p-2 bg-red-900/20 border border-red-500/30 rounded",children:e.jsxs("div",{className:"text-red-400 text-sm",children:["Ïò§Î•ò: ",s.error_message]})}),s.response_data&&e.jsxs("details",{className:"mt-2",children:[e.jsx("summary",{className:"text-slate-400 text-xs cursor-pointer hover:text-white",children:"ÏùëÎãµ Îç∞Ïù¥ÌÑ∞ Î≥¥Í∏∞"}),e.jsx("pre",{className:"mt-2 p-2 bg-slate-900 rounded text-xs text-slate-300 overflow-x-auto",children:JSON.stringify(s.response_data,null,2)})]})]},s.id)})})})})]})]})}export{J as AutoSyncMonitor};

const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DBZ0Cn5g.js","assets/index-lVTNIJQg.css","assets/opcodeHelper--nsctERE.js"])))=>i.map(i=>d[i]);
import{k as ys,q as vs,v as bs,r as u,s as d,t as l,j as e,L as He,w as C,Y as A,O as z,H as Ke,m as ws,n as Ns,o as Ge,p as ye,C as V,a as B,b as R,d as Ue,e as H,I as j,S as ve,x as be,y as we,z as Ne,D as k,T as ks,U as We,B as E,E as g,Z as Ss,$ as Cs,_ as ke}from"./index-DBZ0Cn5g.js";import{A as Se,a as Ce,b as De,c as Pe,d as $e,e as Te}from"./AdminDialog-gp6nPL82.js";import{M as I}from"./MetricCard-Cj1Etvsa.js";import{PartnerTransactions as Ds}from"./PartnerTransactions-DbPiLgNu.js";import{F as Ps}from"./ForceTransactionModal-BVA_x6EH.js";import{D as $s}from"./download-Xx-IS9zz.js";import{P as Ts}from"./plus-Brv5fLBj.js";import{S as Is}from"./search-DBLVvwNz.js";import{D as ee}from"./dollar-sign-eVuSTzYT.js";import{K as ze}from"./key-D-pYrfi0.js";import{T as Ye}from"./trash-2-oFwyE4O4.js";import{S as Fs}from"./square-pen-DofIoIxu.js";import"./DataTable-uFCT-Q5Q.js";import"./calendar-Bc1vANiG.js";import"./textarea-B2eSiypl.js";import"./popover-Drn2cjh1.js";import"./command-Bi-vmF70.js";import"./dialog-DrUif41K.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ls=[["path",{d:"M12 5v14",key:"s699le"}],["path",{d:"m19 12-7 7-7-7",key:"1idqje"}]],As=ys("arrow-down",Ls),K={system_admin:"시스템관리자",head_office:"대본사",main_office:"본사",sub_office:"부본사",distributor:"총판",store:"매장"},se={system_admin:"bg-purple-500",head_office:"bg-red-500",main_office:"bg-orange-500",sub_office:"bg-yellow-500",distributor:"bg-blue-500",store:"bg-green-500"},Es={active:"bg-green-500",inactive:"bg-gray-500",blocked:"bg-red-500"},Os={active:"활성",inactive:"비활성",blocked:"차단"};function tt(){const{authState:n}=vs(),{connected:Y,sendMessage:O}=bs(),[y,te]=u.useState([]),[G,q]=u.useState(!0),[re,Ze]=u.useState(""),[ae,Je]=u.useState("all"),[ne,Qe]=u.useState("all"),[_,ie]=u.useState(null),[Xe,Z]=u.useState(!1),[es,J]=u.useState(!1),[ss,Q]=u.useState(!1),[w,le]=u.useState(null),[oe,X]=u.useState(""),[ce,Ie]=u.useState(!1),[Fe,ts]=u.useState(!1),[de,rs]=u.useState("hierarchy"),[as,ns]=u.useState({}),[is,ls]=u.useState(new Set),[me,Le]=u.useState(""),[ue,os]=u.useState({rolling:.5,losing:5,fee:1}),[cs,pe]=u.useState(!1),[ds,he]=u.useState("deposit"),[W,xe]=u.useState(null),[x,fe]=u.useState(null),[r,h]=u.useState({username:"",nickname:"",password:"",partner_type:"head_office",parent_id:"",opcode:"",secret_key:"",api_token:"",commission_rolling:.5,commission_losing:5,withdrawal_fee:0}),Ae=async s=>{try{const{data:t,error:i}=await d.from("partners").select("commission_rolling, commission_losing, withdrawal_fee, partner_type, nickname").eq("id",s).maybeSingle();return i?(console.error("파트너 커미션 조회 오류:",i),null):t?{rolling:t.commission_rolling||100,losing:t.commission_losing||100,fee:t.withdrawal_fee||100,nickname:t.nickname}:null}catch(t){return console.error("파트너 커미션 조회 실패:",t),null}},Ee=async()=>{if(!n.user?.id)return;const s=await Ae(n.user.id);s&&fe(s)},Oe=async()=>{try{const{data:s,error:t}=await d.from("system_settings").select("setting_key, setting_value").in("setting_key",["default_rolling_commission","default_losing_commission","default_withdrawal_fee"]);if(t){console.error("시스템 기본 커미션 로드 오류:",t);return}if(s&&s.length>0){const i={rolling:.5,losing:5,fee:1};s.forEach(a=>{a.setting_key==="default_rolling_commission"?i.rolling=parseFloat(a.setting_value)||.5:a.setting_key==="default_losing_commission"?i.losing=parseFloat(a.setting_value)||5:a.setting_key==="default_withdrawal_fee"&&(i.fee=parseFloat(a.setting_value)||1)}),os(i),h(a=>({...a,commission_rolling:i.rolling,commission_losing:i.losing,withdrawal_fee:i.fee}))}}catch(s){console.error("시스템 기본 커미션 로드 실패:",s)}};u.useEffect(()=>{n.user?.id&&(Oe(),Ee(),U(),ge())},[n.user?.id]),u.useEffect(()=>{if(!n.user?.id)return;console.log("✅ Realtime 구독: partners.balance 변경 감지");const s=d.channel("partner_balance_changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"partners"},t=>{const i=t.old.balance,a=t.new.balance;i!==a&&(console.log(`💰 보유금 변경: ${i} → ${a}`),te(o=>o.map(m=>m.id===t.new.id?{...m,balance:a}:m)))}).subscribe();return()=>{d.removeChannel(s)}},[n.user?.id]);const U=async()=>{try{if(q(!0),console.log("🔍 [파트너 조회] authState.user:",{id:n.user?.id,username:n.user?.username,level:n.user?.level,partner_type:n.user?.partner_type}),!n.user?.id){console.error("❌ [파트너 조회] 로그인된 사용자가 없습니다"),l.error("로그인 정보가 없습니다. 다시 로그인해주세요."),te([]),q(!1);return}let s=d.from("partners").select(`
          *,
          parent:parent_id (
            nickname
          )
        `).order("level",{ascending:!0}).order("created_at",{ascending:!1});const t=n.user.level===1;console.log(`🔍 [파트너 조회] 시스템 관리자 여부: ${t}`);const{data:i,error:a}=t?await s:await d.rpc("get_hierarchical_partners",{p_partner_id:n.user.id});if(console.log("📊 [파트너 조회] 결과:",{데이터개수:i?.length||0,에러:a?.message||"null"}),a)throw a;const o=await Promise.all((i||[]).map(async m=>{const{count:F}=await d.from("partners").select("*",{count:"exact"}).eq("parent_id",m.id),{count:p}=await d.from("users").select("*",{count:"exact"}).eq("referrer_id",m.id),f=m.balance||0;return{...m,parent_nickname:m.parent?.nickname||"-",child_count:F||0,user_count:p||0,balance:f}}));te(o)}catch(s){console.error("파트너 목록 조회 오류:",s),l.error("파트너 목록을 불러오는데 실패했습니다.")}finally{q(!1)}},qe=(s,t,i,a)=>{if(a==="head_office")return s!==100||t!==100||i!==100?(l.error("대본사의 커미션은 100%로 고정됩니다."),!1):!0;if(x){if(s>x.rolling)return l.error(`롤링 커미션은 상위 파트너(${x.rolling}%)를 초과할 수 없습니다.`),!1;if(t>x.losing)return l.error(`루징 커미션은 상위 파트너(${x.losing}%)를 초과할 수 없습니다.`),!1;if(i>x.fee)return l.error(`환전 수수료는 상위 파트너(${x.fee}%)를 초과할 수 없습니다.`),!1}return!0},ms=async()=>{try{if(q(!0),!r.username.trim()){l.error("아이디를 입력해주세요.");return}if(!r.nickname.trim()){l.error("닉네임을 입력해주세요.");return}if(!r.password.trim()){l.error("비밀번호를 입력해주세요.");return}if(!xs(r.partner_type)){l.error("해당 등급의 파트너를 생성할 권한이 없습니다.");return}if(n.user?.level!==1){const v=await _e(r.partner_type);if(v.hasGap){l.error(v.message,{duration:5e3});return}if(!v.directParentId){l.error(`${K[r.partner_type]}의 상위 조직을 찾을 수 없습니다.`);return}}let s=r.commission_rolling,t=r.commission_losing,i=r.withdrawal_fee;if(r.partner_type==="head_office"&&(s=100,t=100,i=100),!qe(s,t,i,r.partner_type))return;const a=je(r.partner_type);let o=n.user?.id||null;if(n.user?.level!==1){const v=await _e(r.partner_type);v.directParentId&&(o=v.directParentId)}const{data:m,error:F}=await d.rpc("hash_password",{password:r.password});if(F){console.error("❌ 비밀번호 해시 오류:",F),l.error("비밀번호 처리 중 오류가 발생했습니다.");return}let p="",f="",b="";if(r.partner_type==="head_office")p=r.opcode,f=r.secret_key,b=r.api_token,console.log("🔑 [대본사 생성] formData의 opcode/token 사용:",p);else{console.log("🔍 [하위 파트너 생성] 상위 파트너에서 API 설정 조회 시작");let v=o,c=0;const P=10;for(;v&&c<P;){const{data:T,error:Re}=await d.from("partners").select("opcode, secret_key, api_token, parent_id, partner_type, nickname").eq("id",v).single();if(Re)throw console.error("❌ 상위 파트너 조회 오류:",Re),new Error("상위 파트너 조회 실패");if(console.log(`  📊 Depth ${c}: ${T.partner_type} (${T.nickname})`),T.opcode&&T.secret_key&&T.api_token){p=T.opcode,f=T.secret_key,b=T.api_token,console.log(`✅ API 설정 발견: ${T.partner_type}에서 조회 완료 (영구 사용)`);break}v=T.parent_id,c++}if(!p||!f||!b){l.error("상위 파트너에서 API 설정(opcode/secret_key/token)을 찾을 수 없습니다.");return}}const N=r.username.replace(/^btn_/,"");console.log("📡 [POST /api/account] 외부 API 계정 생성 호출:",{opcode:p,username:N,partner_type:r.partner_type});const{createAccount:$}=await ke(async()=>{const{createAccount:v}=await import("./index-DBZ0Cn5g.js").then(c=>c.a$);return{createAccount:v}},__vite__mapDeps([0,1])),M=await $(p,N,f);if(console.log("📊 [POST /api/account] API 응답:",M),M.error){console.error("❌ 외부 API 계정 생성 실패:",M.error),l.error(`파트너 생성 실패: ${M.error}`);return}console.log("✅ 외부 API 계정 생성 성공");const D={username:r.username,nickname:r.nickname,password_hash:m,partner_type:r.partner_type,level:a,parent_id:o,commission_rolling:s,commission_losing:t,withdrawal_fee:i,status:"active"};console.log("📝 파트너 생성 데이터:",{username:D.username,partner_type:D.partner_type,level:D.level,parent_id:D.parent_id,current_user:n.user?.username,current_user_level:n.user?.level}),D.opcode=p,D.secret_key=f,D.api_token=b,console.log("💾 [DB 저장] API 설정 저장:",{has_opcode:!!p,has_secret_key:!!f,has_api_token:!!b,partner_type:r.partner_type});const{data:S,error:L}=await d.from("partners").insert([D]).select().single();if(L){console.error("❌ 파트너 생성 DB 오류:",L),l.error("파트너 생성 중 데이터베이스 오류가 발생했습니다.");return}console.log("✅ 파트너 생성 성공:",{id:S.id,username:S.username,partner_type:S.partner_type,level:S.level,parent_id:S.parent_id}),l.success("파트너가 성공적으로 생성되었습니다."),Z(!1),Me(),Y&&O&&O({type:"partner_created",data:{partner:S}}),U()}catch(s){console.error("파트너 생성 오류:",s),l.error("파트너 생성에 실패했습니다.")}finally{q(!1)}},us=async()=>{if(_)try{if(q(!0),!qe(r.commission_rolling,r.commission_losing,r.withdrawal_fee,_.partner_type))return;const s={nickname:r.nickname,commission_rolling:r.commission_rolling,commission_losing:r.commission_losing,withdrawal_fee:r.withdrawal_fee,updated_at:new Date().toISOString()};r.password&&r.password.trim()!==""&&(s.password_hash=r.password),_.partner_type==="head_office"&&(s.opcode=r.opcode,s.secret_key=r.secret_key,s.api_token=r.api_token);const{error:t}=await d.from("partners").update(s).eq("id",_.id);if(t)throw t;l.success("파트너 정보가 수정되었습니다."),J(!1),ie(null),Y&&O&&O({type:"partner_updated",data:{partnerId:_.id,updates:s}}),U()}catch(s){console.error("파트너 수정 오류:",s),l.error("파트너 수정에 실패했습니다.")}finally{q(!1)}},ps=async()=>{if(w){if(oe!==w.username){l.error("삭제 확인을 위해 파트너 아이디를 정확히 입력해주세요.");return}try{Ie(!0);const{count:s}=await d.from("partners").select("*",{count:"exact",head:!0}).eq("parent_id",w.id);if(s&&s>0){l.error(`하위 파트너가 ${s}명 존재하여 삭제할 수 없습니다. 하위 파트너를 먼저 삭제해주세요.`);return}const{count:t}=await d.from("users").select("*",{count:"exact",head:!0}).eq("referrer_id",w.id);if(t&&t>0){l.error(`관리 중인 회원이 ${t}명 존재하여 삭제할 수 없습니다. 회원을 먼저 다른 파트너로 이동하거나 삭제해주세요.`);return}const{error:i}=await d.from("partners").delete().eq("id",w.id);if(i)throw i;l.success(`${w.nickname} 파트너가 삭제되었습니다.`,{duration:3e3,icon:"🗑️"}),Y&&O&&O({type:"partner_deleted",data:{partnerId:w.id}}),Q(!1),le(null),X(""),U()}catch(s){console.error("파트너 삭제 오류:",s),l.error("파트너 삭제에 실패했습니다.")}finally{Ie(!1)}}},hs=async s=>{if(n.user?.id)try{console.log("💰 [파트너 강제 입출금] 시작:",s);const{data:t,error:i}=await d.from("partners").select("*").eq("id",s.targetId).single();if(i||!t){l.error("파트너 정보를 찾을 수 없습니다.");return}const{data:a,error:o}=await d.from("partners").select("balance, level, nickname, partner_type").eq("id",n.user.id).single();if(o||!a){l.error("관리자 정보를 찾을 수 없습니다.");return}const m=a.level===1;if(s.type==="withdrawal"&&t.balance<s.amount){l.error(`파트너의 보유금이 부족합니다. (현재: ${t.balance.toLocaleString()}원)`);return}if(s.type==="deposit"&&!m&&a.balance<s.amount){l.error(`관리자 보유금이 부족합니다. (현재: ${a.balance.toLocaleString()}원)`);return}const{getAdminOpcode:F,isMultipleOpcode:p}=await ke(async()=>{const{getAdminOpcode:c,isMultipleOpcode:P}=await import("./opcodeHelper--nsctERE.js");return{getAdminOpcode:c,isMultipleOpcode:P}},__vite__mapDeps([2,0,1]));let f,b,N,$;try{const c=await F(t);if(p(c)){if(c.opcodes.length===0)throw new Error("사용 가능한 OPCODE가 없습니다.");f=c.opcodes[0].opcode,b=c.opcodes[0].secretKey,N=c.opcodes[0].token;const{data:P}=await d.from("partners").select("username").eq("id",c.opcodes[0].partnerId).single();$=P?.username?.replace(/^btn_/,"")||""}else f=c.opcode,b=c.secretKey,N=c.token,$=t.username.replace(/^btn_/,"")}catch(c){l.error(`API 설정 조회 실패: ${c.message}`);return}console.log("📡 [파트너 강제 입출금] API 호출:",{type:s.type,amount:s.amount,apiUsername:$,opcode:f});const{depositToAccount:M,withdrawFromAccount:D}=await ke(async()=>{const{depositToAccount:c,withdrawFromAccount:P}=await import("./index-DBZ0Cn5g.js").then(T=>T.a$);return{depositToAccount:c,withdrawFromAccount:P}},__vite__mapDeps([0,1]));let S;try{s.type==="deposit"?S=await M(f,$,N,s.amount,b):S=await D(f,$,N,s.amount,b)}catch(c){l.error(`API 호출 실패: ${c.message}`);return}if(console.log("📊 [파트너 강제 입출금] API 응답:",S),S.error){l.error(`외부 API 오류: ${S.error}`);return}if(S.data){const c=S.data;if(c.RESULT===!1){const P=c.DATA?.message||c.message||"외부 API 처리 실패";l.error(`외부 API 오류: ${P}`);return}if(c.is_text&&c.text_response){const P=c.text_response.toLowerCase();if(P.includes("error")||P.includes("실패")||P.includes("초과")){l.error(`외부 API 오류: ${c.text_response}`);return}}}l.success(`외부 계정에 ${s.amount.toLocaleString()}원을 ${s.type==="deposit"?"입금":"출금"}했습니다.`);let L=a.balance,v=t.balance;s.type==="deposit"?(L=a.balance-s.amount,await d.from("partners").update({balance:L,updated_at:new Date().toISOString()}).eq("id",n.user.id),v=t.balance+s.amount,await d.from("partners").update({balance:v,updated_at:new Date().toISOString()}).eq("id",s.targetId),await d.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:a.balance,balance_after:L,amount:-s.amount,transaction_type:"withdrawal",from_partner_id:n.user.id,to_partner_id:s.targetId,processed_by:n.user.id,memo:`[강제입금] ${t.nickname}에게 ${s.amount.toLocaleString()}원 입금${s.memo?`: ${s.memo}`:""}`}),await d.from("partner_balance_logs").insert({partner_id:s.targetId,balance_before:t.balance,balance_after:v,amount:s.amount,transaction_type:"deposit",from_partner_id:n.user.id,to_partner_id:s.targetId,processed_by:n.user.id,memo:`[강제입금] ${a.nickname}으로부터 ${s.amount.toLocaleString()}원 입금${s.memo?`: ${s.memo}`:""}`})):(v=t.balance-s.amount,await d.from("partners").update({balance:v,updated_at:new Date().toISOString()}).eq("id",s.targetId),L=a.balance+s.amount,await d.from("partners").update({balance:L,updated_at:new Date().toISOString()}).eq("id",n.user.id),await d.from("partner_balance_logs").insert({partner_id:s.targetId,balance_before:t.balance,balance_after:v,amount:-s.amount,transaction_type:"withdrawal",from_partner_id:s.targetId,to_partner_id:n.user.id,processed_by:n.user.id,memo:`[강제출금] ${a.nickname}에게 ${s.amount.toLocaleString()}원 출금${s.memo?`: ${s.memo}`:""}`}),await d.from("partner_balance_logs").insert({partner_id:n.user.id,balance_before:a.balance,balance_after:L,amount:s.amount,transaction_type:"deposit",from_partner_id:s.targetId,to_partner_id:n.user.id,processed_by:n.user.id,memo:`[강제출금] ${t.nickname}으로부터 ${s.amount.toLocaleString()}원 회수${s.memo?`: ${s.memo}`:""}`})),l.success(`${t.nickname}에게 ${s.amount.toLocaleString()}원을 ${s.type==="deposit"?"입금":"출금"}했습니다.`),Y&&O&&O({type:"partner_balance_updated",data:{partnerId:s.targetId,amount:s.amount,type:s.type}}),U()}catch(t){console.error("❌ [파트너 강제 입출금] 오류:",t),l.error(`${s.type==="deposit"?"입금":"출금"} 처리 중 오류가 발생했습니다.`)}},ge=async()=>{try{const s=new Date().toISOString().split("T")[0],{data:t}=await d.from("transactions").select("transaction_type, amount").eq("partner_id",n.user?.id).gte("created_at",s),{data:i}=await d.from("settlements").select("*").eq("partner_id",n.user?.id).gte("period_start",new Date(new Date().getFullYear(),new Date().getMonth(),1).toISOString());ns({todayDeposits:t?.filter(a=>a.transaction_type==="deposit").reduce((a,o)=>a+Number(o.amount),0)||0,todayWithdrawals:t?.filter(a=>a.transaction_type==="withdrawal").reduce((a,o)=>a+Number(o.amount),0)||0,monthlyCommission:i?.reduce((a,o)=>a+Number(o.commission_amount),0)||0})}catch(s){console.error("대시보드 데이터 조회 오류:",s)}},_e=async s=>{if(!n.user)return{hasGap:!0,missingLevels:[],directParentId:null,message:"사용자 정보가 없습니다."};const t=n.user.level,i=je(s);if(t===1)return{hasGap:!1,missingLevels:[],directParentId:n.user.id,message:""};if(i===t+1)return{hasGap:!1,missingLevels:[],directParentId:n.user.id,message:""};const a=[];let o=null;for(let p=t+1;p<i;p++){const{data:f,error:b}=await d.from("partners").select("id, level, partner_type, nickname").eq("level",p).eq("status","active");if(b){console.error(`레벨 ${p} 파트너 조회 오류:`,b);continue}const{data:N,error:$}=await d.rpc("get_hierarchical_partners",{p_partner_id:n.user.id});if($){console.error("계층 파트너 조회 오류:",$),a.push(p);continue}(N||[]).filter(D=>D.level===p&&D.status==="active").length===0&&a.push(p)}if(a.length===0){const p=i-1,{data:f}=await d.rpc("get_hierarchical_partners",{p_partner_id:n.user.id}),b=(f||[]).filter(N=>N.level===p&&N.status==="active");b.length>0&&(o=b.sort((N,$)=>new Date($.created_at).getTime()-new Date(N.created_at).getTime())[0].id)}const m={2:"대본사",3:"본사",4:"부본사",5:"총판",6:"매장"};let F="";if(a.length>0){const p=a.map(f=>m[f]||`Level ${f}`).join(", ");F=`⚠️ ${K[s]}을(를) 생성하려면 먼저 중간 계층(${p})을 생성해야 합니다.`}return{hasGap:a.length>0,missingLevels:a,directParentId:o,message:F}},xs=s=>{if(!n.user)return!1;const t=n.user.level,i=je(s);return t===1?!0:t===2?i>2:i>t},je=s=>({system_admin:1,head_office:2,main_office:3,sub_office:4,distributor:5,store:6})[s],Me=()=>{h({username:"",nickname:"",password:"",partner_type:"head_office",parent_id:"",opcode:"",secret_key:"",api_token:"",commission_rolling:ue.rolling,commission_losing:ue.losing,withdrawal_fee:ue.fee})},fs=s=>{h({username:s.username,nickname:s.nickname,password:"",partner_type:s.partner_type,parent_id:s.parent_id||"",opcode:s.opcode||"",secret_key:s.secret_key||"",api_token:s.api_token||"",commission_rolling:s.commission_rolling,commission_losing:s.commission_losing,withdrawal_fee:s.withdrawal_fee})},gs=s=>{const t=new Map,i=[];return s.forEach(a=>{t.set(a.id,{...a,children:[]})}),s.forEach(a=>{const o=t.get(a.id);if(o)if(a.parent_id&&t.has(a.parent_id)){const m=t.get(a.parent_id);m&&m.children&&m.children.push(o)}else i.push(o)}),i},_s=s=>{ls(t=>{const i=new Set(t);return i.has(s)?i.delete(s):i.add(s),i})},js=y.filter(s=>{const t=s.username.toLowerCase().includes(re.toLowerCase())||s.nickname.toLowerCase().includes(re.toLowerCase()),i=ae==="all"||s.partner_type===ae,a=ne==="all"||s.status===ne;return t&&i&&a}),Ve=gs(js),Be=(s,t)=>{const i=is.has(s.id),a=s.children&&s.children.length>0,o=t*24;return e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-1.5 p-2.5 rounded-lg hover:bg-slate-800/50 transition-colors border border-slate-700/30 bg-slate-800/20 min-w-[1200px]",children:[e.jsxs("div",{className:"flex items-center gap-2 min-w-[130px] flex-shrink-0",style:{paddingLeft:`${o}px`},children:[e.jsx("button",{onClick:()=>a&&_s(s.id),className:`flex items-center justify-center w-5 h-5 rounded transition-colors flex-shrink-0 ${a?"hover:bg-slate-700 text-slate-300 cursor-pointer":"invisible"}`,children:a&&(i?e.jsx(Ss,{className:"h-3 w-3"}):e.jsx(Cs,{className:"h-3 w-3"}))}),e.jsx("span",{className:"font-medium text-white text-sm truncate",children:s.username})]}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"min-w-[90px] flex-shrink-0",children:e.jsx("span",{className:"text-slate-300 text-sm truncate",children:s.nickname})}),e.jsx("div",{className:"min-w-[85px] flex-shrink-0",children:e.jsx(E,{className:`${se[s.partner_type]} text-white text-xs`,children:K[s.partner_type]})}),e.jsx("div",{className:"min-w-[60px] flex-shrink-0",children:e.jsx(E,{className:`${Es[s.status]} text-white text-xs`,children:Os[s.status]})}),e.jsx("div",{className:"min-w-[110px] text-right flex-shrink-0",children:e.jsxs("span",{className:"font-mono text-green-400 text-sm",children:[s.balance.toLocaleString(),"원"]})}),e.jsx("div",{className:"min-w-[170px] flex-shrink-0",children:e.jsxs("div",{className:"flex items-center gap-1 text-xs",children:[e.jsxs(E,{variant:"outline",className:"bg-green-500/10 text-green-400 border-green-500/30 text-xs px-1",children:["R:",s.commission_rolling,"%"]}),e.jsxs(E,{variant:"outline",className:"bg-orange-500/10 text-orange-400 border-orange-500/30 text-xs px-1",children:["L:",s.commission_losing,"%"]}),e.jsxs(E,{variant:"outline",className:"bg-blue-500/10 text-blue-400 border-blue-500/30 text-xs px-1",children:["F:",s.withdrawal_fee,"%"]})]})}),e.jsxs("div",{className:"flex items-center gap-1.5 min-w-[110px] flex-shrink-0",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(A,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:s.child_count||0})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(We,{className:"h-3 w-3 text-slate-400"}),e.jsx("span",{className:"text-xs text-slate-400",children:s.user_count||0})]})]}),e.jsx("div",{className:"min-w-[120px] flex-shrink-0",children:s.last_login_at?(()=>{const m=new Date(s.last_login_at),F=m.getFullYear(),p=String(m.getMonth()+1).padStart(2,"0"),f=String(m.getDate()).padStart(2,"0"),b=String(m.getHours()).padStart(2,"0"),N=String(m.getMinutes()).padStart(2,"0");return e.jsx("span",{className:"text-xs text-slate-400",children:`${F}/${p}/${f} ${b}:${N}`})})():e.jsx("span",{className:"text-xs text-slate-600",children:"-"})})]}),e.jsxs("div",{className:"flex items-center gap-1.5 w-[240px] flex-shrink-0",children:[(n.user?.level===1&&s.partner_type==="head_office"||s.parent_id===n.user?.id&&s.partner_type!=="head_office")&&e.jsxs(e.Fragment,{children:[e.jsx(C,{variant:"outline",size:"sm",onClick:()=>{xe(s),he("deposit"),pe(!0)},className:"bg-green-500/10 border-green-500/50 text-green-400 hover:bg-green-500/20 flex-shrink-0",title:n.user?.level===1&&s.partner_type==="head_office"?"입금":"보유금 지급",children:e.jsx(ee,{className:"h-4 w-4"})}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>{xe(s),he("withdrawal"),pe(!0)},className:"bg-orange-500/10 border-orange-500/50 text-orange-400 hover:bg-orange-500/20 flex-shrink-0",title:n.user?.level===1&&s.partner_type==="head_office"?"출금":"보유금 회수",children:e.jsx(As,{className:"h-4 w-4"})})]}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>{ie(s),fs(s),J(!0)},className:"bg-blue-500/10 border-blue-500/50 text-blue-400 hover:bg-blue-500/20 flex-shrink-0",children:e.jsx(Fs,{className:"h-3 w-3"})}),e.jsx(C,{variant:"outline",size:"sm",onClick:()=>{l.info(`${s.nickname} 파트너의 상세 정보를 확인합니다.`)},className:"bg-slate-700/50 border-slate-600 text-slate-300 hover:bg-slate-700 flex-shrink-0",children:e.jsx(Ke,{className:"h-3 w-3"})}),s.partner_type!=="system_admin"&&e.jsx(C,{variant:"outline",size:"sm",onClick:()=>{le(s),X(""),Q(!0)},className:"bg-red-500/10 border-red-500/50 text-red-400 hover:bg-red-500/20 flex-shrink-0",children:e.jsx(Ye,{className:"h-3 w-3"})})]})]}),i&&a&&e.jsx("div",{className:"mt-1 space-y-1",children:s.children.map(m=>Be(m,t+1))})]},s.id)};return u.useEffect(()=>{Oe(),Ee(),U(),ge()},[]),u.useEffect(()=>{de==="dashboard"&&ge()},[de]),G&&y.length===0?e.jsx(He,{}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"파트너 관리"}),e.jsx("p",{className:"text-sm text-slate-400",children:n.user?.nickname})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(C,{onClick:()=>ts(!Fe),className:"border-slate-700 text-slate-300 hover:bg-slate-700/50",children:[e.jsx(A,{className:"h-4 w-4 mr-2"}),Fe?"목록 보기":"계층 보기"]}),e.jsxs(C,{className:"border-slate-700 text-slate-300 hover:bg-slate-700/50",children:[e.jsx($s,{className:"h-4 w-4 mr-2"}),"내보내기"]}),e.jsxs(C,{onClick:()=>Z(!0),children:[e.jsx(Ts,{className:"h-4 w-4 mr-2"}),"파트너 생성"]})]})]}),e.jsxs("div",{className:"grid gap-5 md:grid-cols-4",children:[e.jsx(I,{title:"전체 하위 파트너",value:y.filter(s=>s.id!==n.user?.id).length.toLocaleString(),subtitle:"관리 중인 파트너",icon:A,color:"purple"}),n.user?.level===2&&e.jsx(I,{title:"본사",value:y.filter(s=>s.id!==n.user?.id&&s.partner_type==="main_office").length.toLocaleString(),subtitle:"본사 파트너",icon:z,color:"red"}),n.user?.level===3&&e.jsx(I,{title:"부본사",value:y.filter(s=>s.id!==n.user?.id&&s.partner_type==="sub_office").length.toLocaleString(),subtitle:"부본사 파트너",icon:z,color:"red"}),n.user?.level===4&&e.jsx(I,{title:"총판",value:y.filter(s=>s.id!==n.user?.id&&s.partner_type==="distributor").length.toLocaleString(),subtitle:"총판 파트너",icon:z,color:"red"}),n.user?.level===2&&e.jsx(I,{title:"부본사/총판/매장",value:y.filter(s=>s.id!==n.user?.id&&(s.partner_type==="sub_office"||s.partner_type==="distributor"||s.partner_type==="store")).length.toLocaleString(),subtitle:"하위 파트너",icon:A,color:"orange"}),n.user?.level===3&&e.jsx(I,{title:"총판/매장",value:y.filter(s=>s.id!==n.user?.id&&(s.partner_type==="distributor"||s.partner_type==="store")).length.toLocaleString(),subtitle:"하위 파트너",icon:A,color:"orange"}),n.user?.level===4&&e.jsx(I,{title:"매장",value:y.filter(s=>s.id!==n.user?.id&&s.partner_type==="store").length.toLocaleString(),subtitle:"매장 파트너",icon:A,color:"orange"}),n.user?.level===5&&e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"매장",value:y.filter(s=>s.id!==n.user?.id&&s.partner_type==="store").length.toLocaleString(),subtitle:"매장 파트너",icon:z,color:"red"}),e.jsx(I,{title:"-",value:"0",subtitle:"하위 없음",icon:A,color:"orange"})]}),(n.user?.level===1||n.user?.level===6)&&e.jsxs(e.Fragment,{children:[e.jsx(I,{title:"대본사",value:y.filter(s=>s.id!==n.user?.id&&s.partner_type==="head_office").length.toLocaleString(),subtitle:"대본사 파트너",icon:z,color:"red"}),e.jsx(I,{title:"본사/부본사",value:y.filter(s=>s.id!==n.user?.id&&(s.partner_type==="main_office"||s.partner_type==="sub_office")).length.toLocaleString(),subtitle:"중간 파트너",icon:A,color:"orange"})]}),e.jsx(I,{title:"활성 파트너",value:y.filter(s=>s.id!==n.user?.id&&s.status==="active").length.toLocaleString(),subtitle:"정상 운영 중",icon:Ke,color:"green"})]}),e.jsxs(ws,{value:de,onValueChange:rs,className:"space-y-6",children:[e.jsx("div",{className:"border-b border-slate-700/50",children:e.jsxs(Ns,{className:"bg-transparent h-auto p-0 border-0 gap-8",children:[e.jsx(Ge,{value:"hierarchy",className:"bg-transparent border-b-2 border-transparent rounded-none data-[state=active]:border-cyan-400 data-[state=active]:bg-transparent data-[state=active]:text-cyan-400 data-[state=active]:shadow-none pb-3 px-0 transition-all",children:"파트너 계층 관리"}),e.jsx(Ge,{value:"dashboard",className:"bg-transparent border-b-2 border-transparent rounded-none data-[state=active]:border-cyan-400 data-[state=active]:bg-transparent data-[state=active]:text-cyan-400 data-[state=active]:shadow-none pb-3 px-0 transition-all",children:"파트너 대시보드"})]})}),e.jsx(ye,{value:"hierarchy",className:"space-y-4",children:e.jsxs(V,{className:"bg-slate-900/40 border-slate-700/50 backdrop-blur",children:[e.jsxs(B,{children:[e.jsx(R,{className:"text-white",children:"파트너 계층 관리"}),e.jsx(Ue,{className:"text-slate-400",children:"7단계 권한 체계의 파트너를 관리합니다."})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"flex items-center gap-4 mb-6",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"relative",children:[e.jsx(Is,{className:"absolute left-2 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(j,{placeholder:"아이디 또는 닉네임으로 검색...",className:"pl-8 bg-slate-800/50 border-slate-700 text-white",value:re,onChange:s=>Ze(s.target.value)})]})}),e.jsxs(ve,{value:ae,onValueChange:Je,children:[e.jsx(be,{className:"w-[180px] bg-slate-800/50 border-slate-700 text-white",children:e.jsx(we,{placeholder:"파트너 등급"})}),e.jsxs(Ne,{children:[e.jsx(k,{value:"all",children:"전체 등급"}),e.jsx(k,{value:"head_office",children:"대본사"}),e.jsx(k,{value:"main_office",children:"본사"}),e.jsx(k,{value:"sub_office",children:"부본사"}),e.jsx(k,{value:"distributor",children:"총판"}),e.jsx(k,{value:"store",children:"매장"})]})]}),e.jsxs(ve,{value:ne,onValueChange:Qe,children:[e.jsx(be,{className:"w-[180px] bg-slate-800/50 border-slate-700 text-white",children:e.jsx(we,{placeholder:"상태 필터"})}),e.jsxs(Ne,{children:[e.jsx(k,{value:"all",children:"전체 상태"}),e.jsx(k,{value:"active",children:"활성"}),e.jsx(k,{value:"inactive",children:"비활성"}),e.jsx(k,{value:"blocked",children:"차단"})]})]})]}),e.jsx("div",{className:"mb-3 px-3 py-2 bg-slate-800/50 rounded-lg border border-slate-700/30",children:e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx("div",{className:"min-w-[130px] flex-shrink-0",children:e.jsx("div",{className:"text-xs font-medium text-slate-400",children:"아이디"})}),e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("div",{className:"min-w-[90px] text-xs font-medium text-slate-400",children:"닉네임"}),e.jsx("div",{className:"min-w-[85px] text-xs font-medium text-slate-400",children:"등급"}),e.jsx("div",{className:"min-w-[60px] text-xs font-medium text-slate-400",children:"상태"}),e.jsx("div",{className:"min-w-[110px] text-xs font-medium text-slate-400 text-right",children:"보유금"}),e.jsx("div",{className:"min-w-[170px] text-xs font-medium text-slate-400",children:"커미션"}),e.jsx("div",{className:"min-w-[110px] text-xs font-medium text-slate-400",children:"하위/회원"}),e.jsx("div",{className:"min-w-[120px] text-xs font-medium text-slate-400",children:"최근 접속"})]}),e.jsx("div",{className:"w-[240px] text-xs font-medium text-slate-400 text-center flex-shrink-0",children:"관리"})]})}),G?e.jsx(He,{}):Ve.length===0?e.jsx("div",{className:"text-center py-12 text-slate-400",children:"파트너가 없습니다."}):e.jsx("div",{className:"space-y-1 overflow-x-auto",children:Ve.map(s=>Be(s,0))})]})]})}),e.jsx(ye,{value:"transactions",className:"space-y-4",children:e.jsx(Ds,{})}),e.jsx(ye,{value:"dashboard",className:"space-y-4",children:e.jsxs(V,{className:"bg-slate-900/40 border-slate-700/50 backdrop-blur",children:[e.jsxs(B,{children:[e.jsxs(R,{className:"flex items-center gap-2 text-white",children:[e.jsx(ks,{className:"h-5 w-5"}),"파트너 대시보드"]}),e.jsx(Ue,{className:"text-slate-400",children:"파트너별 성과 및 수익 현황을 확인합니다."})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-3 mb-6",children:[e.jsxs(V,{children:[e.jsxs(B,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"이번달 커미션"}),e.jsx(ee,{className:"h-4 w-4 text-green-500"})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[(as.monthlyCommission||0).toLocaleString(),"원"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+12% from last month"})]})]}),e.jsxs(V,{children:[e.jsxs(B,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"총 파트너 수"}),e.jsx(A,{className:"h-4 w-4 text-blue-500"})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[y.length.toLocaleString(),"개"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+2 new this month"})]})]}),e.jsxs(V,{children:[e.jsxs(B,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(R,{className:"text-sm font-medium",children:"활성 회원 수"}),e.jsx(We,{className:"h-4 w-4 text-purple-500"})]}),e.jsxs(H,{children:[e.jsxs("div",{className:"text-2xl font-bold text-purple-600",children:[y.reduce((s,t)=>s+(t.user_count||0),0).toLocaleString(),"명"]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"+5% from last month"})]})]})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs(V,{children:[e.jsx(B,{children:e.jsx(R,{className:"text-lg",children:"상위 성과 파트너"})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:y.filter(s=>s.partner_type!=="system_admin").sort((s,t)=>(t.user_count||0)-(s.user_count||0)).slice(0,5).map((s,t)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(E,{className:`${se[s.partner_type]} text-white`,children:["#",t+1]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:s.nickname}),e.jsx("p",{className:"text-sm text-muted-foreground",children:K[s.partner_type]})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-medium",children:[s.user_count||0,"명"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"관리 회원"})]})]},s.id))})})]}),e.jsxs(V,{children:[e.jsx(B,{children:e.jsx(R,{className:"text-lg",children:"파트너 레벨별 분포"})}),e.jsx(H,{children:e.jsx("div",{className:"space-y-3",children:Object.entries(K).map(([s,t])=>{const i=y.filter(o=>o.partner_type===s).length,a=y.length>0?Math.round(i/y.length*100):0;return e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm font-medium",children:t}),e.jsxs("span",{className:"text-sm text-muted-foreground",children:[i,"개 (",a,"%)"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full ${se[s]}`,style:{width:`${a}%`}})})]},s)})})})]})]})]})]})})]}),e.jsx(Se,{open:Xe,onOpenChange:Z,children:e.jsxs(Ce,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(De,{children:[e.jsx(Pe,{children:"새 파트너 생성"}),e.jsx($e,{children:"새로운 파트너를 시스템에 등록합니다."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"username",children:"아이디"}),e.jsx(j,{id:"username",value:r.username,onChange:s=>h(t=>({...t,username:s.target.value})),placeholder:"파트너 아이디 입력"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"nickname",children:"닉네임"}),e.jsx(j,{id:"nickname",value:r.nickname,onChange:s=>h(t=>({...t,nickname:s.target.value})),placeholder:"파트너 닉네임 입력"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"password",children:"비밀번호"}),e.jsx(j,{id:"password",type:"password",value:r.password,onChange:s=>h(t=>({...t,password:s.target.value})),placeholder:"초기 비밀번호 입력"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"partner_type",children:"파트너 등급"}),e.jsxs(ve,{value:r.partner_type,onValueChange:async s=>{if(h(t=>({...t,partner_type:s})),n.user?.level!==1){const t=await _e(s);if(Le(t.message),t.directParentId&&!t.hasGap){const i=await Ae(t.directParentId);i&&(fe(i),console.log(`✅ ${K[s]} 상위 파트너 커미션 로드:`,i))}}else s==="head_office"&&fe({rolling:100,losing:100,fee:100,nickname:"시스템"})},children:[e.jsx(be,{children:e.jsx(we,{})}),e.jsxs(Ne,{children:[n.user?.level===1&&e.jsx(k,{value:"head_office",children:"대본사"}),n.user?.level===2&&e.jsx(k,{value:"main_office",children:"본사"}),n.user?.level===3&&e.jsx(k,{value:"sub_office",children:"부본사"}),n.user?.level===4&&e.jsx(k,{value:"distributor",children:"총판"}),n.user?.level===5&&e.jsx(k,{value:"store",children:"매장"})]})]}),me&&e.jsx("div",{className:"p-3 bg-red-50 dark:bg-red-900/10 rounded-lg border border-red-200 dark:border-red-800",children:e.jsx("p",{className:"text-xs text-red-700 dark:text-red-300",children:me})})]})]}),r.partner_type==="head_office"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"opcode",className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"OPCODE"]}),e.jsx(j,{id:"opcode",value:r.opcode,onChange:s=>h(t=>({...t,opcode:s.target.value})),placeholder:"외부 API OPCODE 입력"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"secret_key",children:"Secret Key"}),e.jsx(j,{id:"secret_key",value:r.secret_key,onChange:s=>h(t=>({...t,secret_key:s.target.value})),placeholder:"비밀 키 입력"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"api_token",children:"API Token"}),e.jsx(j,{id:"api_token",value:r.api_token,onChange:s=>h(t=>({...t,api_token:s.target.value})),placeholder:"API 토큰 입력"})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-green-500"}),"커미션 설정"]}),r.partner_type!=="head_office"&&x&&e.jsxs(E,{variant:"outline",className:"text-xs",children:["상위 한도: ",x.rolling,"% / ",x.losing,"%"]})]}),r.partner_type==="head_office"?e.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/10 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300",children:["🏢 ",e.jsx("strong",{children:"대본사"}),"는 최상위 파트너로 커미션이 자동으로 ",e.jsx("strong",{children:"100%"}),"로 설정됩니다."]})}):e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-200 dark:border-blue-800",children:e.jsx("p",{className:"text-xs text-blue-700 dark:text-blue-300",children:"💡 커미션은 상위 파트너의 요율을 초과할 수 없습니다. 계층 구조에 따라 하위로 갈수록 낮아집니다."})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"commission_rolling",children:"롤링 커미션 (%)"}),e.jsx(j,{id:"commission_rolling",type:"text",step:"0.1",min:"0",max:r.partner_type==="head_office"?100:x?.rolling||100,value:r.partner_type==="head_office"?100:r.commission_rolling,onChange:s=>{if(r.partner_type==="head_office")return;const t=s.target.value;if(t===""){h(o=>({...o,commission_rolling:0}));return}const i=parseFloat(t);if(isNaN(i))return;const a=x?.rolling||100;if(i>a){l.error(`롤링 커미션은 상위 한도(${a}%)를 초과할 수 없습니다.`);return}h(o=>({...o,commission_rolling:i}))},disabled:r.partner_type==="head_office",className:r.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.partner_type==="head_office"?"대본사 고정값":"회원 총 베팅액 × 커미션 요율"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"commission_losing",children:"루징 커미션 (%)"}),e.jsx(j,{id:"commission_losing",type:"text",step:"0.1",min:"0",max:r.partner_type==="head_office"?100:x?.losing||100,value:r.partner_type==="head_office"?100:r.commission_losing,onChange:s=>{if(r.partner_type==="head_office")return;const t=s.target.value;if(t===""){h(o=>({...o,commission_losing:0}));return}const i=parseFloat(t);if(isNaN(i))return;const a=x?.losing||100;if(i>a){l.error(`루징 커미션은 상위 한도(${a}%)를 초과할 수 없습니다.`);return}h(o=>({...o,commission_losing:i}))},disabled:r.partner_type==="head_office",className:r.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.partner_type==="head_office"?"대본사 고정값":"회원 순손실액 × 커미션 요율"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"withdrawal_fee",children:"환전 수수료 (%)"}),e.jsx(j,{id:"withdrawal_fee",type:"text",step:"0.1",min:"0",max:r.partner_type==="head_office"?100:x?.fee||100,value:r.partner_type==="head_office"?100:r.withdrawal_fee,onChange:s=>{if(r.partner_type==="head_office")return;const t=s.target.value;if(t===""){h(o=>({...o,withdrawal_fee:0}));return}const i=parseFloat(t);if(isNaN(i))return;const a=x?.fee||100;if(i>a){l.error(`환전 수수료는 상위 한도(${a}%)를 초과할 수 없습니다.`);return}h(o=>({...o,withdrawal_fee:i}))},disabled:r.partner_type==="head_office",className:r.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:r.partner_type==="head_office"?"대본사 고정값":"환전 금액에 적용되는 수수료"})]})]})]})]}),e.jsxs(Te,{children:[e.jsx(C,{variant:"outline",onClick:()=>{Z(!1),Me(),Le("")},children:"취소"}),e.jsx(C,{onClick:ms,disabled:G||!!me&&n.user?.level!==1,children:G?"생성 중...":"파트너 생성"})]})]})}),e.jsx(Se,{open:es,onOpenChange:J,children:e.jsxs(Ce,{className:"sm:max-w-[600px] max-h-[80vh] overflow-y-auto",children:[e.jsxs(De,{children:[e.jsx(Pe,{children:"파트너 정보 수정"}),e.jsx($e,{children:"파트너의 정보를 수정합니다."})]}),e.jsxs("div",{className:"grid gap-4 py-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_username",children:"아이디"}),e.jsx(j,{id:"edit_username",value:r.username,disabled:!0,className:"bg-muted"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_nickname",children:"닉네임"}),e.jsx(j,{id:"edit_nickname",value:r.nickname,onChange:s=>h(t=>({...t,nickname:s.target.value}))})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_password",children:"비밀번호 (변경시에만 입력)"}),e.jsx(j,{id:"edit_password",type:"password",value:r.password,onChange:s=>h(t=>({...t,password:s.target.value})),placeholder:"비밀번호를 변경하려면 입력하세요"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"비밀번호를 변경하지 않으려면 비워두세요"})]}),_?.partner_type==="head_office"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"edit_opcode",className:"flex items-center gap-2",children:[e.jsx(ze,{className:"h-4 w-4"}),"OPCODE"]}),e.jsx(j,{id:"edit_opcode",value:r.opcode,onChange:s=>h(t=>({...t,opcode:s.target.value}))})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_secret_key",children:"Secret Key"}),e.jsx(j,{id:"edit_secret_key",value:r.secret_key,onChange:s=>h(t=>({...t,secret_key:s.target.value}))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_api_token",children:"API Token"}),e.jsx(j,{id:"edit_api_token",value:r.api_token,onChange:s=>h(t=>({...t,api_token:s.target.value}))})]})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(g,{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4 text-green-500"}),"커미션 설정"]}),_?.partner_type!=="head_office"&&x&&e.jsxs(E,{variant:"outline",className:"text-xs",children:["상위 한도: ",x.rolling,"% / ",x.losing,"% / ",x.fee,"%"]})]}),_?.partner_type==="head_office"?e.jsx("div",{className:"p-3 bg-purple-50 dark:bg-purple-900/10 rounded-lg border border-purple-200 dark:border-purple-800",children:e.jsxs("p",{className:"text-xs text-purple-700 dark:text-purple-300",children:["🏢 ",e.jsx("strong",{children:"대본사"}),"는 최상위 파트너로 커미션이 ",e.jsx("strong",{children:"100%"}),"로 고정됩니다."]})}):e.jsx("div",{className:"p-3 bg-amber-50 dark:bg-amber-900/10 rounded-lg border border-amber-200 dark:border-amber-800",children:e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300",children:"⚠️ 커미션 변경 시 정산에 즉시 반영되며, 상위 파트너 요율을 초과할 수 없습니다."})}),e.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_commission_rolling",children:"롤링 커미션 (%)"}),e.jsx(j,{id:"edit_commission_rolling",type:"number",step:"0.1",min:"0",max:_?.partner_type==="head_office"?100:x?.rolling||100,value:r.commission_rolling,onChange:s=>h(t=>({...t,commission_rolling:parseFloat(s.target.value)||0})),disabled:_?.partner_type==="head_office",className:_?.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:_?.partner_type==="head_office"?"대본사 고정값":"회원 총 베팅액 × 커미션 요율"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_commission_losing",children:"루징 커미션 (%)"}),e.jsx(j,{id:"edit_commission_losing",type:"number",step:"0.1",min:"0",max:_?.partner_type==="head_office"?100:x?.losing||100,value:r.commission_losing,onChange:s=>h(t=>({...t,commission_losing:parseFloat(s.target.value)||0})),disabled:_?.partner_type==="head_office",className:_?.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:_?.partner_type==="head_office"?"대본사 고정값":"회원 순손실액 × 커미션 요율"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"edit_withdrawal_fee",children:"환전 수수료 (%)"}),e.jsx(j,{id:"edit_withdrawal_fee",type:"number",step:"0.1",min:"0",max:_?.partner_type==="head_office"?100:x?.fee||100,value:r.withdrawal_fee,onChange:s=>h(t=>({...t,withdrawal_fee:parseFloat(s.target.value)||0})),disabled:_?.partner_type==="head_office",className:_?.partner_type==="head_office"?"bg-muted":""}),e.jsx("p",{className:"text-xs text-muted-foreground",children:_?.partner_type==="head_office"?"대본사 고정값":"환전 금액에 적용되는 수수료"})]})]})]})]}),e.jsxs(Te,{children:[e.jsx(C,{variant:"outline",onClick:()=>{J(!1),ie(null)},children:"취소"}),e.jsx(C,{onClick:us,disabled:G,children:G?"수정 중...":"수정 완료"})]})]})}),e.jsx(Ps,{open:cs,onOpenChange:s=>{pe(s),s||xe(null)},type:ds,targetType:"partner",selectedTarget:W?{id:W.id,username:W.username,nickname:W.nickname,balance:W.balance||0}:null,onSubmit:hs,onTypeChange:he}),e.jsx(Se,{open:ss,onOpenChange:Q,children:e.jsxs(Ce,{className:"sm:max-w-[500px]",children:[e.jsxs(De,{children:[e.jsx(Pe,{className:"text-red-600",children:"⚠️ 파트너 삭제 확인"}),e.jsx($e,{children:"이 작업은 되돌릴 수 없습니다. 삭제하려면 아래에 파트너 아이디를 입력해주세요."})]}),w&&e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsx("div",{className:"p-4 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-800",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"파트너"}),e.jsxs("span",{className:"font-medium",children:[w.nickname," (",w.username,")"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"등급"}),e.jsx(E,{className:`${se[w.partner_type]} text-white`,children:K[w.partner_type]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"하위 파트너"}),e.jsxs("span",{className:"font-medium",children:[w.child_count||0,"명"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-muted-foreground",children:"관리 회원"}),e.jsxs("span",{className:"font-medium",children:[w.user_count||0,"명"]})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(g,{htmlFor:"delete-confirm",className:"text-red-600",children:["삭제 확인: ",e.jsx("span",{className:"font-mono",children:w.username})," 입력"]}),e.jsx(j,{id:"delete-confirm",value:oe,onChange:s=>X(s.target.value),placeholder:"파트너 아이디를 정확히 입력하세요",className:"border-red-300 focus:border-red-500"})]}),e.jsx("div",{className:"bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded-lg border border-yellow-200 dark:border-yellow-800",children:e.jsxs("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:[e.jsx("strong",{children:"주의:"})," 하위 파트너나 관리 회원이 있으면 삭제할 수 없습니다."]})})]}),e.jsxs(Te,{children:[e.jsx(C,{variant:"outline",onClick:()=>{Q(!1),le(null),X("")},disabled:ce,children:"취소"}),e.jsx(C,{variant:"destructive",onClick:ps,disabled:ce||oe!==w?.username,children:ce?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"삭제 중..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ye,{className:"h-4 w-4 mr-2"}),"삭제"]})})]})]})})]})}export{tt as PartnerManagement,tt as default};

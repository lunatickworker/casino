import{v as ke,r as l,s as f,j as e,L as De,w as j,T as Te,i as Fe,m as Ae,n as Le,o as P,Y as Ee,S as X,x as Z,y as ee,z as te,D as L,I as se,R as $e,c as ae,p as R,E as k,F as Me,t as b,B as ne,K as re,M as oe,N as ie,O as le,P as qe}from"./index-DuEcnhwm.js";import{T as ce}from"./textarea-DBQhSv6D.js";import{A as de,a as me,b as pe,c as he,d as ue,e as ge}from"./AdminDialog-BvprPua4.js";import{C as Oe,a as Pe,b as Re,f as We,c as Be,d as Ue,e as Ke}from"./command-DPl0GGzl.js";import{P as ze,a as Ve,b as Ge}from"./popover-BzUJcAdW.js";import{D as W}from"./DataTable-B36ocgWm.js";import{M as B}from"./MetricCard-C8dgoA9F.js";import{P as He}from"./plus-CMxSp9_h.js";import{C as Ye}from"./clock-CHydOgIN.js";import{T as Qe}from"./triangle-alert-B5pgGtA1.js";import{S as Je}from"./search-DyNhXeLR.js";import{G as Xe,C as Ze}from"./gift-BCy86-_q.js";import{T as et}from"./trash-2-CbXK9AWp.js";import"./dialog-BlSexbtz.js";function gt({user:h}){const{lastMessage:x,sendMessage:z}=ke(),[y,U]=l.useState(!0),[N,_]=l.useState(!1),xe=()=>{const t=window.location.hash.substring(1);return t==="deposit-request"||t==="withdrawal-request"||t==="deposit-history"||t==="withdrawal-history"?t:"deposit-request"},[D,V]=l.useState(xe()),[E,G]=l.useState([]),[v,fe]=l.useState([]),[S,je]=l.useState("today"),[K,be]=l.useState(""),[$,T]=l.useState(0),[M,H]=l.useState({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),[c,F]=l.useState({open:!1,transaction:null,action:"approve",memo:""}),[a,u]=l.useState({open:!1,type:"deposit",userId:"",amount:"",memo:""}),[Y,Q]=l.useState(!1),we=[1e3,3e3,5e3,1e4,3e4,5e4,1e5,3e5,5e5,1e6];l.useEffect(()=>{const t=()=>{const s=window.location.hash.substring(1);(s==="deposit-request"||s==="withdrawal-request"||s==="deposit-history"||s==="withdrawal-history")&&V(s)};return window.addEventListener("hashchange",t),()=>window.removeEventListener("hashchange",t)},[]);const C=async(t=!1)=>{try{t?U(!0):_(!0),console.log("ğŸ”„ ë°ì´í„° ë¡œë“œ ì‹œì‘:",{isInitial:t,periodFilter:S,userLevel:h.level});const s=ve(S);let n=f.from("transactions").select(`
          *,
          user:users(id, nickname, username, balance, bank_name, bank_account, bank_holder),
          processed_partner:partners!transactions_processed_by_fkey(nickname, level)
        `).gte("created_at",s.start).lte("created_at",s.end);if(h.level>1){const{data:m}=await f.from("users").select("id").eq("referrer_id",h.id),p=m?.map(g=>g.id)||[];if(p.length>0)n=n.in("user_id",p);else{G([]),H({totalDeposit:0,totalWithdrawal:0,pendingDepositCount:0,pendingWithdrawalCount:0}),t&&U(!1);return}}const{data:r,error:i}=await n.order("created_at",{ascending:!1});if(i)throw i;console.log("âœ… ê±°ë˜ ë°ì´í„° ë¡œë“œ ì™„ë£Œ:",r?.length||0,"ê±´"),G(r||[]);let d=f.from("users").select("id, nickname, username, balance, bank_name, bank_account, bank_holder").eq("status","active");h.level>1&&(d=d.eq("referrer_id",h.id));const{data:w}=await d.order("nickname");if(fe(w||[]),r){const m=r.filter(o=>(o.transaction_type==="deposit"||o.transaction_type==="admin_deposit")&&o.status==="completed").reduce((o,A)=>o+parseFloat(A.amount.toString()),0),p=r.filter(o=>(o.transaction_type==="withdrawal"||o.transaction_type==="admin_withdrawal")&&o.status==="completed").reduce((o,A)=>o+parseFloat(A.amount.toString()),0),g=r.filter(o=>o.transaction_type==="deposit"&&o.status==="pending"),I=r.filter(o=>o.transaction_type==="withdrawal"&&o.status==="pending");console.log("ğŸ“Š í†µê³„ ê³„ì‚°:",{depositSum:m,withdrawalSum:p,depositCount:r.filter(o=>(o.transaction_type==="deposit"||o.transaction_type==="admin_deposit")&&o.status==="completed").length,withdrawalCount:r.filter(o=>(o.transaction_type==="withdrawal"||o.transaction_type==="admin_withdrawal")&&o.status==="completed").length}),H({totalDeposit:m,totalWithdrawal:p,pendingDepositCount:g.length,pendingWithdrawalCount:I.length})}}catch(s){console.error("âŒ ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:",s),b.error("ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{t?U(!1):_(!1)}},ve=t=>{const s=new Date,n=new Date(s.getFullYear(),s.getMonth(),s.getDate());switch(t){case"today":return{start:n.toISOString(),end:s.toISOString()};case"week":const r=new Date(n);return r.setDate(n.getDate()-7),{start:r.toISOString(),end:s.toISOString()};case"month":const i=new Date(n);return i.setMonth(n.getMonth()-1),{start:i.toISOString(),end:s.toISOString()};default:return{start:n.toISOString(),end:s.toISOString()}}};l.useEffect(()=>{C(!0)},[]),l.useEffect(()=>{y||C(!1)},[S,$]),l.useEffect(()=>{const t=f.channel("transactions-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},s=>{console.log("ğŸ’° transactions í…Œì´ë¸” ë³€ê²½ ê°ì§€:",s),T(n=>n+1)}).subscribe();return()=>{f.removeChannel(t)}},[]),l.useEffect(()=>{x&&["deposit_approved","withdrawal_approved","deposit_rejected","withdrawal_rejected"].includes(x.type)&&(console.log("ğŸ’¬ WebSocket ì…ì¶œê¸ˆ ì•Œë¦¼:",x),T(t=>t+1))},[x]);const J=(t,s)=>{F({open:!0,transaction:t,action:s,memo:""})},ye=async()=>{if(c.transaction)try{_(!0);const{action:t,transaction:s,memo:n}=c;if(t==="approve"){const i=await re(h),d=oe(i)?i.opcodes[0]:i;if(!s.user?.username)throw new Error("ì‚¬ìš©ì ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");const w=Math.floor(parseFloat(s.amount.toString()));console.log("ğŸ’° ê±°ë˜ ìŠ¹ì¸ ì²˜ë¦¬ ì‹œì‘:",{transaction_type:s.transaction_type,username:s.user.username,amount:w,opcode:d.opcode});let m;if(s.transaction_type==="deposit"?(console.log("ğŸ“¥ ì…ê¸ˆ API í˜¸ì¶œ ì¤‘..."),m=await ie(s.user.username,w,d.opcode,d.token,d.secretKey)):s.transaction_type==="withdrawal"&&(console.log("ğŸ“¤ ì¶œê¸ˆ API í˜¸ì¶œ ì¤‘..."),m=await le(s.user.username,w,d.opcode,d.token,d.secretKey)),m&&!m.success)throw console.error("âŒ Invest API í˜¸ì¶œ ì‹¤íŒ¨:",m),new Error(m.error||"Invest API í˜¸ì¶œ ì‹¤íŒ¨");console.log("âœ… Invest API ì²˜ë¦¬ ì™„ë£Œ:",m)}const{error:r}=await f.from("transactions").update({status:t==="approve"?"completed":"rejected",processed_by:h.id,processed_at:new Date().toISOString(),memo:t==="reject"?n:s.memo}).eq("id",s.id);if(r)throw r;b.success(`ê±°ë˜ê°€ ${t==="approve"?"ìŠ¹ì¸":"ê±°ì ˆ"}ë˜ì—ˆìŠµë‹ˆë‹¤.`),z({type:"transaction_processed",data:{transactionId:s.id,action:t,processedBy:h.nickname,userId:s.user_id}}),F({open:!1,transaction:null,action:"approve",memo:""})}catch(t){console.error("ê±°ë˜ ì²˜ë¦¬ ì‹¤íŒ¨:",t),b.error(t instanceof Error?t.message:"ê±°ë˜ ì²˜ë¦¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}},Ne=async()=>{try{_(!0);const{type:t,userId:s,amount:n,memo:r}=a;if(!s||!n){b.error("íšŒì›ê³¼ ê¸ˆì•¡ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");return}const i=v.find(A=>A.id===s);if(!i){b.error("íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}if(!i.username){b.error("íšŒì› usernameì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");return}const d=Math.floor(parseFloat(n)),w=parseFloat(i.balance?.toString()||"0");if(console.log("ğŸ’° ê°•ì œ ì…ì¶œê¸ˆ ì²˜ë¦¬ ì‹œì‘:",{type:t,username:i.username,amount:d,balanceBefore:w}),t==="withdrawal"&&d>w){b.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(â‚©${w.toLocaleString()})ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),_(!1);return}const m=await re(h),p=oe(m)?m.opcodes[0]:m;console.log("ğŸ”‘ OPCODE ì„¤ì •:",{opcode:p.opcode,token:"***"+p.token.slice(-4),secretKey:"***"+p.secretKey.slice(-4)});let g;if(t==="deposit"?(console.log("ğŸ“¥ ì…ê¸ˆ API í˜¸ì¶œ ì¤‘..."),g=await ie(i.username,d,p.opcode,p.token,p.secretKey)):(console.log("ğŸ“¤ ì¶œê¸ˆ API í˜¸ì¶œ ì¤‘..."),g=await le(i.username,d,p.opcode,p.token,p.secretKey)),!g.success||g.error)throw new Error(g.error||"Invest API í˜¸ì¶œ ì‹¤íŒ¨");console.log("âœ… Invest API ê°•ì œ ì…ì¶œê¸ˆ ì™„ë£Œ:",g);const I=qe(g.data,i.username);console.log("ğŸ’° ì‹¤ì œ ì”ê³ :",I);const{error:o}=await f.from("transactions").insert({user_id:s,partner_id:h.id,transaction_type:t==="deposit"?"admin_deposit":"admin_withdrawal",amount:d,status:"completed",balance_before:w,balance_after:I,memo:`[ê´€ë¦¬ì ê°•ì œ ${t==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"}] ${r}`,processed_by:h.id,processed_at:new Date().toISOString(),external_response:g.data});if(o)throw o;console.log("âœ… transactions INSERT ì™„ë£Œ â†’ íŠ¸ë¦¬ê±°ê°€ users.balance ìë™ ì—…ë°ì´íŠ¸"),b.success(`ê°•ì œ ${t==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"}ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. (ì”ì•¡: â‚©${I.toLocaleString()})`),z({type:"admin_force_transaction",data:{userId:s,type:t,amount:d,balanceAfter:I,processedBy:h.nickname}}),u({open:!1,type:"deposit",userId:"",amount:"",memo:""})}catch(t){console.error("ê°•ì œ ì…ì¶œê¸ˆ ì‹¤íŒ¨:",t),b.error(t instanceof Error?t.message:"ê°•ì œ ì…ì¶œê¸ˆì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.")}finally{_(!1)}};if(l.useEffect(()=>{C(!0)},[]),l.useEffect(()=>{$>0&&!y&&(console.log("ğŸ”„ Realtime íŠ¸ë¦¬ê±° ë°ì´í„° ë¡œë“œ:",$),C(!1))},[$]),l.useEffect(()=>{y||(console.log("ğŸ“… ê¸°ê°„ í•„í„° ë³€ê²½:",S),C(!1))},[S]),l.useEffect(()=>{console.log("ğŸ”Œ Realtime subscription ì„¤ì • ì¤‘...");const t=f.channel("transactions-realtime-changes").on("postgres_changes",{event:"*",schema:"public",table:"transactions"},n=>{console.log("ğŸ’³ transactions í…Œì´ë¸” ë³€ê²½ ê°ì§€:",n.eventType,n.new),T(r=>r+1)}).subscribe(n=>{console.log("ğŸ’³ transactions ì±„ë„ êµ¬ë… ìƒíƒœ:",n)}),s=f.channel("users-realtime-balance-changes").on("postgres_changes",{event:"UPDATE",schema:"public",table:"users"},n=>{console.log("ğŸ‘¤ users í…Œì´ë¸” ë³€ê²½ ê°ì§€:",n.new),T(r=>r+1)}).subscribe(n=>{console.log("ğŸ‘¤ users ì±„ë„ êµ¬ë… ìƒíƒœ:",n)});return()=>{console.log("ğŸ”Œ Realtime subscription ì •ë¦¬ ì¤‘..."),f.removeChannel(t),f.removeChannel(s)}},[]),l.useEffect(()=>{(x?.type==="transaction_update"||x?.type==="deposit_request"||x?.type==="withdrawal_request"||x?.type==="admin_force_transaction"||x?.type==="transaction_processed")&&(console.log("ğŸ“¨ WebSocket ë©”ì‹œì§€ ìˆ˜ì‹ :",x.type),T(t=>t+1))},[x]),y)return e.jsx(De,{});const q=t=>K===""||t.user?.nickname?.toLowerCase().includes(K.toLowerCase()),_e=E.filter(t=>t.transaction_type==="deposit"&&t.status==="pending"&&q(t)),Se=E.filter(t=>t.transaction_type==="withdrawal"&&t.status==="pending"&&q(t)),Ce=E.filter(t=>(t.transaction_type==="deposit"||t.transaction_type==="withdrawal")&&t.status==="completed"&&q(t)),Ie=E.filter(t=>(t.transaction_type==="admin_deposit"||t.transaction_type==="admin_withdrawal"||t.transaction_type==="admin_adjustment")&&t.status==="completed"&&q(t)),O=(t=!1)=>[{header:"ê±°ë˜ ì¼ì‹œ",cell:s=>e.jsx("span",{className:"text-sm text-slate-300",children:new Date(s.created_at).toLocaleString("ko-KR")})},{header:"íšŒì›",cell:s=>e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-slate-200",children:s.user?.nickname}),e.jsx("p",{className:"text-sm text-slate-500",children:s.user?.username})]})},{header:"ê±°ë˜ ìœ í˜•",cell:s=>{const r={deposit:{text:"ì…ê¸ˆ",color:"bg-green-500"},withdrawal:{text:"ì¶œê¸ˆ",color:"bg-red-500"},admin_deposit:{text:"ì…ê¸ˆ",color:"bg-green-600"},admin_withdrawal:{text:"ì¶œê¸ˆ",color:"bg-red-600"},admin_adjustment:{text:s.memo?.includes("ê°•ì œ ì¶œê¸ˆ")?"ì¶œê¸ˆ":"ì…ê¸ˆ",color:s.memo?.includes("ê°•ì œ ì¶œê¸ˆ")?"bg-red-600":"bg-green-600"}}[s.transaction_type]||{text:s.transaction_type,color:"bg-gray-500"};return e.jsx(ne,{className:`${r.color} text-white`,children:r.text})}},{header:"ê¸ˆì•¡",cell:s=>{const n=s.transaction_type==="withdrawal"||s.transaction_type==="admin_withdrawal"||s.transaction_type==="admin_adjustment"&&s.memo?.includes("ê°•ì œ ì¶œê¸ˆ");return e.jsxs("span",{className:ae("font-mono font-semibold",n?"text-red-400":"text-green-400"),children:[n?"-":"+","â‚©",parseFloat(s.amount.toString()).toLocaleString()]})}},{header:"ë³€ê²½ í›„ ë³´ìœ ê¸ˆ",cell:s=>e.jsxs("span",{className:"font-mono text-cyan-400",children:["â‚©",parseFloat(s.balance_after?.toString()||"0").toLocaleString()]})},{header:"ìƒíƒœ",cell:s=>{const r={pending:{text:"ëŒ€ê¸°",color:"bg-yellow-500"},completed:{text:"ì™„ë£Œ",color:"bg-green-500"},rejected:{text:"ê±°ì ˆ",color:"bg-red-500"}}[s.status]||{text:s.status,color:"bg-gray-500"};return e.jsx(ne,{className:`${r.color} text-white`,children:r.text})}},{header:"ë©”ëª¨",cell:s=>e.jsx("div",{className:"max-w-xs",children:e.jsx("span",{className:"text-sm text-slate-400 block truncate",title:s.memo||"",children:s.memo||"-"})})},{header:"ì²˜ë¦¬ì",cell:s=>e.jsx("span",{className:"text-sm text-slate-400",children:s.processed_partner?.nickname||"-"})},...t?[{header:"ì‘ì—…",cell:s=>e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(j,{size:"sm",onClick:()=>J(s,"approve"),disabled:N,className:"h-8 px-3 bg-green-600 hover:bg-green-700",children:"ìŠ¹ì¸"}),e.jsx(j,{size:"sm",variant:"outline",onClick:()=>J(s,"reject"),disabled:N,className:"h-8 px-3 border-red-500 text-red-500 hover:bg-red-500 hover:text-white",children:"ê±°ì ˆ"})]})}]:[]];return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-1",children:[e.jsx("h1",{className:"text-2xl font-bold text-slate-100",children:"ì…ì¶œê¸ˆ ê´€ë¦¬"}),e.jsx("p",{className:"text-sm text-slate-400",children:"íšŒì› ì…ì¶œê¸ˆ ì‹ ì²­ ë° ì²˜ë¦¬ ê´€ë¦¬"})]}),e.jsxs(j,{onClick:()=>u({...a,open:!0}),className:"btn-premium-primary",children:[e.jsx(He,{className:"h-4 w-4 mr-2"}),"ê°•ì œ ì…ì¶œê¸ˆ"]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-5",children:[e.jsx(B,{title:"ì´ ì…ê¸ˆ",value:`â‚©${M.totalDeposit.toLocaleString()}`,subtitle:"ëˆ„ì  ì…ê¸ˆ",icon:Te,color:"green"}),e.jsx(B,{title:"ì´ ì¶œê¸ˆ",value:`â‚©${M.totalWithdrawal.toLocaleString()}`,subtitle:"ëˆ„ì  ì¶œê¸ˆ",icon:Fe,color:"red"}),e.jsx(B,{title:"ì…ê¸ˆ ì‹ ì²­",value:`${M.pendingDepositCount}ê±´`,subtitle:"ì²˜ë¦¬ ëŒ€ê¸°",icon:Ye,color:"amber"}),e.jsx(B,{title:"ì¶œê¸ˆ ì‹ ì²­",value:`${M.pendingWithdrawalCount}ê±´`,subtitle:"ì²˜ë¦¬ ëŒ€ê¸°",icon:Qe,color:"orange"})]}),e.jsx("div",{className:"glass-card rounded-xl p-6",children:e.jsxs(Ae,{value:D,onValueChange:V,className:"space-y-6",children:[e.jsxs(Le,{className:"grid w-full grid-cols-4 bg-slate-800/50 p-1 rounded-lg",children:[e.jsx(P,{value:"deposit-request",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ì…ê¸ˆ ì‹ ì²­"}),e.jsx(P,{value:"withdrawal-request",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ì¶œê¸ˆ ì‹ ì²­"}),e.jsx(P,{value:"completed-history",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ì…ì¶œê¸ˆ ë‚´ì—­"}),e.jsx(P,{value:"admin-history",className:"data-[state=active]:bg-slate-700 data-[state=active]:text-white",children:"ê´€ë¦¬ì ì…ì¶œê¸ˆ ë‚´ì—­"})]}),e.jsx("div",{className:"flex items-center justify-between pb-4 border-b border-slate-700/50",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ee,{className:"h-5 w-5 text-slate-400"}),e.jsxs("h3",{className:"font-semibold text-slate-100",children:[D==="deposit-request"&&"ì…ê¸ˆ ì‹ ì²­",D==="withdrawal-request"&&"ì¶œê¸ˆ ì‹ ì²­",D==="completed-history"&&"ì…ì¶œê¸ˆ ë‚´ì—­",D==="admin-history"&&"ê´€ë¦¬ì ì…ì¶œê¸ˆ ë‚´ì—­"]})]})}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(X,{value:S,onValueChange:je,children:[e.jsx(Z,{className:"w-[140px] input-premium",children:e.jsx(ee,{placeholder:"ê¸°ê°„"})}),e.jsxs(te,{className:"bg-slate-800 border-slate-700",children:[e.jsx(L,{value:"today",children:"ì˜¤ëŠ˜"}),e.jsx(L,{value:"week",children:"ìµœê·¼ 7ì¼"}),e.jsx(L,{value:"month",children:"ìµœê·¼ 30ì¼"})]})]}),e.jsxs("div",{className:"flex-1 relative",children:[e.jsx(Je,{className:"absolute left-3 top-2.5 h-4 w-4 text-slate-400"}),e.jsx(se,{placeholder:"íšŒì› ê²€ìƒ‰...",className:"pl-10 input-premium",value:K,onChange:t=>be(t.target.value)})]}),e.jsxs(j,{onClick:()=>{console.log("ğŸ”„ ìˆ˜ë™ ìƒˆë¡œê³ ì¹¨"),C(!1)},disabled:N,variant:"outline",className:"btn-premium-primary",children:[e.jsx($e,{className:ae("h-4 w-4 mr-2",N&&"animate-spin")}),"ìƒˆë¡œê³ ì¹¨"]})]}),e.jsx(R,{value:"deposit-request",children:e.jsx(W,{searchable:!1,columns:O(!0),data:_e,loading:y,emptyMessage:"ì…ê¸ˆ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤."})}),e.jsx(R,{value:"withdrawal-request",children:e.jsx(W,{searchable:!1,columns:O(!0),data:Se,loading:y,emptyMessage:"ì¶œê¸ˆ ì‹ ì²­ì´ ì—†ìŠµë‹ˆë‹¤."})}),e.jsx(R,{value:"completed-history",children:e.jsx(W,{searchable:!1,columns:O(!1),data:Ce,loading:y,emptyMessage:"ì…ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})}),e.jsx(R,{value:"admin-history",children:e.jsx(W,{searchable:!1,columns:O(!1),data:Ie,loading:y,emptyMessage:"ê´€ë¦¬ì ì…ì¶œê¸ˆ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤."})})]})}),e.jsx(de,{open:c.open,onOpenChange:t=>F({...c,open:t}),children:e.jsxs(me,{className:"bg-slate-900 border-slate-700",children:[e.jsxs(pe,{children:[e.jsx(he,{className:"text-white",children:c.action==="approve"?"ê±°ë˜ ìŠ¹ì¸":"ê±°ë˜ ê±°ì ˆ"}),e.jsx(ue,{className:"text-slate-400",children:c.action==="approve"?"ì´ ê±°ë˜ë¥¼ ìŠ¹ì¸í•˜ì‹œê² ìŠµë‹ˆê¹Œ?":"ê±°ì ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."})]}),c.transaction&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-lg space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"íšŒì›:"}),e.jsx("span",{className:"text-white",children:c.transaction.user?.nickname})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"ê±°ë˜ ìœ í˜•:"}),e.jsx("span",{className:"text-white",children:c.transaction.transaction_type==="deposit"?"ì…ê¸ˆ":"ì¶œê¸ˆ"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-slate-400",children:"ê¸ˆì•¡:"}),e.jsxs("span",{className:"text-green-400 font-mono",children:["â‚©",parseFloat(c.transaction.amount.toString()).toLocaleString()]})]})]}),c.action==="reject"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"transaction-reject-reason",className:"text-slate-300",children:"ê±°ì ˆ ì‚¬ìœ "}),e.jsx(ce,{id:"transaction-reject-reason",name:"reject_reason",value:c.memo,onChange:t=>F({...c,memo:t.target.value}),placeholder:"ê±°ì ˆ ì‚¬ìœ ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”...",className:"bg-slate-800 border-slate-700 text-white",rows:3})]})]}),e.jsxs(ge,{children:[e.jsx(j,{variant:"outline",onClick:()=>F({...c,open:!1}),disabled:N,children:"ì·¨ì†Œ"}),e.jsx(j,{onClick:ye,disabled:N||c.action==="reject"&&!c.memo,className:c.action==="approve"?"bg-green-600 hover:bg-green-700":"bg-red-600 hover:bg-red-700",children:c.action==="approve"?"ìŠ¹ì¸":"ê±°ì ˆ"})]})]})}),e.jsx(de,{open:a.open,onOpenChange:t=>u({...a,open:t}),children:e.jsxs(me,{className:"sm:max-w-[550px]",children:[e.jsxs(pe,{children:[e.jsx(he,{className:"flex items-center gap-2",children:a.type==="deposit"?e.jsxs(e.Fragment,{children:[e.jsx(Xe,{className:"h-5 w-5 text-emerald-500"}),"ê°•ì œ ì…ê¸ˆ"]}):e.jsxs(e.Fragment,{children:[e.jsx(Ze,{className:"h-5 w-5 text-rose-500"}),"ê°•ì œ ì¶œê¸ˆ"]})}),e.jsx(ue,{children:"íšŒì›ì˜ ì”ì•¡ì„ ì§ì ‘ ì¡°ì •í•©ë‹ˆë‹¤."})]}),e.jsxs("div",{className:"grid gap-5 py-4",children:[e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"force-dialog-type",children:"ê±°ë˜ ìœ í˜•"}),e.jsxs(X,{value:a.type,onValueChange:t=>u({...a,type:t}),children:[e.jsx(Z,{id:"force-dialog-type",className:"input-premium h-10",children:e.jsx(ee,{})}),e.jsxs(te,{className:"bg-slate-800 border-slate-700",children:[e.jsx(L,{value:"deposit",children:"ì…ê¸ˆ"}),e.jsx(L,{value:"withdrawal",children:"ì¶œê¸ˆ"})]})]})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"force-dialog-user-search",children:"íšŒì› ì„ íƒ"}),e.jsxs(ze,{open:Y,onOpenChange:Q,children:[e.jsx(Ve,{asChild:!0,children:e.jsxs(j,{id:"force-dialog-user-search",variant:"outline",role:"combobox","aria-expanded":Y,className:"justify-between input-premium h-10",children:[a.userId?v.find(t=>t.id===a.userId)?.username+` (${v.find(t=>t.id===a.userId)?.nickname}) - ${parseFloat(v.find(t=>t.id===a.userId)?.balance?.toString()||"0").toLocaleString()}ì›`:"ì•„ì´ë””, ë‹‰ë„¤ì„ìœ¼ë¡œ ê²€ìƒ‰",e.jsx(Oe,{className:"ml-2 h-4 w-4 shrink-0 opacity-50"})]})}),e.jsx(Ge,{className:"w-[480px] p-0 bg-slate-800 border-slate-700",children:e.jsxs(Pe,{className:"bg-slate-800",children:[e.jsx(Re,{placeholder:"ì•„ì´ë””, ë‹‰ë„¤ì„ìœ¼ë¡œ ê²€ìƒ‰...",className:"h-9 text-slate-100 placeholder:text-slate-500"}),e.jsxs(We,{children:[e.jsx(Be,{className:"text-slate-400 py-6 text-center text-sm",children:"íšŒì›ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤."}),e.jsx(Ue,{className:"max-h-64 overflow-auto",children:v.map(t=>e.jsxs(Ke,{value:`${t.username} ${t.nickname}`,onSelect:()=>{u({...a,userId:t.id}),Q(!1)},className:"flex items-center justify-between cursor-pointer hover:bg-slate-700/50 text-slate-300",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:`mr-2 h-4 w-4 ${a.userId===t.id?`opacity-100 ${a.type==="deposit"?"text-emerald-500":"text-rose-500"}`:"opacity-0"}`}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium text-slate-100",children:t.username}),e.jsx("div",{className:"text-xs text-slate-400",children:t.nickname})]})]}),e.jsx("div",{className:"text-sm",children:e.jsxs("span",{className:"text-cyan-400 font-mono",children:[parseFloat(t.balance?.toString()||"0").toLocaleString(),"ì›"]})})]},t.id))})]})]})})]})]}),a.userId&&(()=>{const t=v.find(s=>s.id===a.userId);return t?e.jsxs("div",{className:"p-3 bg-slate-800/50 rounded-lg border border-slate-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"ì„ íƒëœ íšŒì›"}),e.jsx("span",{className:"text-cyan-400 font-medium",children:t.nickname})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-slate-400",children:"í˜„ì¬ ë³´ìœ ê¸ˆ"}),e.jsxs("span",{className:"font-mono text-cyan-400",children:[parseFloat(t.balance?.toString()||"0").toLocaleString(),"ì›"]})]})]}):null})(),e.jsxs("div",{className:"grid gap-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{htmlFor:"force-dialog-amount",children:"ê¸ˆì•¡"}),e.jsx(j,{type:"button",variant:"ghost",size:"sm",onClick:()=>u({...a,amount:"0"}),className:`h-7 px-2 text-xs text-slate-400 ${a.type==="deposit"?"hover:text-orange-400 hover:bg-orange-500/10":"hover:text-red-400 hover:bg-red-500/10"}`,children:"ì „ì²´ì‚­ì œ"})]}),e.jsx(se,{id:"force-dialog-amount",name:"amount",type:"number",value:a.amount,onChange:t=>{const s=parseFloat(t.target.value||"0");if(a.type==="withdrawal"&&a.userId){const n=v.find(r=>r.id===a.userId);if(n){const r=parseFloat(n.balance?.toString()||"0");if(s>r){b.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(${r.toLocaleString()}ì›)ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),u({...a,amount:r.toString()});return}}}u({...a,amount:t.target.value})},placeholder:"ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”",className:"input-premium"})]}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{className:"text-slate-400 text-sm",children:"ë‹¨ì¶• ì…ë ¥ (ëˆ„ì  ë”í•˜ê¸°)"}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:we.map(t=>e.jsxs(j,{type:"button",variant:"outline",onClick:()=>{const n=parseFloat(a.amount||"0")+t;if(a.type==="withdrawal"&&a.userId){const r=v.find(i=>i.id===a.userId);if(r){const i=parseFloat(r.balance?.toString()||"0");if(n>i){b.error(`ì¶œê¸ˆ ê¸ˆì•¡ì´ ë³´ìœ ê¸ˆ(${i.toLocaleString()}ì›)ì„ ì´ˆê³¼í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.`),u({...a,amount:i.toString()});return}}}u({...a,amount:n.toString()})},className:`h-9 transition-all bg-slate-800/50 border-slate-700 text-slate-300 ${a.type==="deposit"?"hover:bg-orange-500/20 hover:border-orange-500/60 hover:text-orange-400 hover:shadow-[0_0_15px_rgba(251,146,60,0.3)]":"hover:bg-red-500/20 hover:border-red-500/60 hover:text-red-400 hover:shadow-[0_0_15px_rgba(239,68,68,0.3)]"}`,children:["+",t>=1e4?`${t/1e4}ë§Œ`:`${t/1e3}ì²œ`]},t))})]}),a.type==="withdrawal"&&a.userId&&e.jsx("div",{className:"grid gap-2",children:e.jsxs(j,{type:"button",variant:"outline",onClick:()=>{const t=v.find(s=>s.id===a.userId);if(t){const s=parseFloat(t.balance?.toString()||"0");u({...a,amount:s.toString()})}},className:"w-full h-9 bg-red-900/20 border-red-500/50 text-red-400 hover:bg-red-900/40 hover:border-red-500",children:[e.jsx(et,{className:"h-4 w-4 mr-2"}),"ì „ì•¡ì¶œê¸ˆ"]})}),e.jsxs("div",{className:"grid gap-2",children:[e.jsx(k,{htmlFor:"force-dialog-memo",children:"ë©”ëª¨"}),e.jsx(ce,{id:"force-dialog-memo",name:"memo",value:a.memo,onChange:t=>u({...a,memo:t.target.value}),placeholder:"ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)",className:"input-premium min-h-[80px]"})]})]}),e.jsx(ge,{children:e.jsx(j,{type:"button",onClick:Ne,disabled:N||!a.userId||!a.amount||parseFloat(a.amount)<=0,className:`w-full ${a.type==="deposit"?"btn-premium-warning":"btn-premium-danger"}`,children:N?"ì²˜ë¦¬ ì¤‘...":a.type==="deposit"?"ê°•ì œ ì…ê¸ˆ":"ê°•ì œ ì¶œê¸ˆ"})})]})})]})}export{gt as TransactionManagement,gt as default};
